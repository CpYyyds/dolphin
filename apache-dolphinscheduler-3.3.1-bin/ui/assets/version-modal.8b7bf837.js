import{d as C,bb as b,b9 as z,ba as N,u as w,bH as D,E as y,r as m,h as s,H as g,I as _,c}from"./index.02a17cf1.js";import{u as V,a as M}from"./use-modal.c59c2056.js";import{d as P,s as R,e as S}from"./index.9cbc470c.js";import{D as B}from"./DeleteOutlined.d3b97bbb.js";import{d as I}from"./Select.51d2f90f.js";import{N as k}from"./Popconfirm.98866df0.js";import{N as v}from"./Tooltip.76a430fa.js";import{N as j}from"./Button.1b3ea9f7.js";import{N as h}from"./Space.8a344b95.js";import{M as T}from"./index.08dd828f.js";import{N as x,a as $}from"./DataTable.ddc5a79d.js";import"./lodash.3a74b132.js";import"./index.e3e49908.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./index.124d1fef.js";import"./index.bcd2e05d.js";import"./common.a16f92ec.js";import"./SettingOutlined.901415e1.js";import"./PauseCircleOutlined.6f50ffc5.js";import"./CloseCircleOutlined.d6e82e31.js";import"./CheckCircleOutlined.b15d9580.js";import"./EditOutlined.8be88705.js";import"./index.8474b6bf.js";import"./index.0bedecf2.js";import"./index.7552dd4e.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./use-merged-state.2bdc3563.js";import"./use-locale.47aab0f5.js";import"./use-compitable.cd47f4ac.js";import"./use-form-item.96cfc8ba.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./resolve-slot.92499a18.js";import"./cssr.f561ccf0.js";import"./Popover.92dc7b00.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./use-false-until-truthy.e57d8f60.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./utils.eff12f29.js";import"./format-length.a6a40b1f.js";import"./next-frame-once.50ecadf2.js";import"./Empty.249462a1.js";import"./index.5f9a33e7.js";import"./Suffix.62982c61.js";import"./index.21198e00.js";import"./keysOf.843c523b.js";import"./is-browser.e7afaa57.js";import"./get-slot.eeb09d52.js";import"./index.fe057c74.js";import"./Modal.920fa101.js";import"./Card.f8db533a.js";import"./ArrowDown.fd6213c2.js";import"./Checkbox.c8f5c3b1.js";import"./RadioGroup.7b709552.js";import"./Radio.4578e023.js";import"./Dropdown.de4044d8.js";import"./Icon.0cd298dd.js";import"./ChevronRight.d1d16011.js";import"./use-keyboard.8f9f6db8.js";import"./Ellipsis.eed9f363.js";import"./Input.59461546.js";import"./Forward.b8f2636c.js";const q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},E=N("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1),L=N("path",{d:"M464 688a48 48 0 1 0 96 0a48 48 0 1 0-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z",fill:"currentColor"},null,-1),O=[E,L],F=C({name:"ExclamationCircleOutlined",render:function(t,a){return b(),z("svg",q,O)}});function U(i){const{t}=w(),a=D(),e=y({columns:[],row:{},tableData:[],page:m(1),totalPage:m(1),pageSize:m(10),projectCode:m(Number(a.currentRoute.value.params.projectCode)),loadingRef:m(!1)}),u=(o,l)=>{o.columns=[{title:"#",key:"id",width:50,render:(r,n)=>n+1},{title:t("project.workflow.version"),key:"version",render:r=>r.version===o.row.version?s(I,{type:"success",size:"small"},{default:()=>`V${r.version} ${t("project.workflow.current_version")}`}):`V${r.version}`},{title:t("project.workflow.description"),key:"description"},{title:t("project.workflow.create_time"),key:"operateTime"}],l||o.columns.push({title:t("project.workflow.operation"),key:"operation",render:r=>s(h,null,{default:()=>[s(k,{onPositiveClick:()=>{f(r.version)}},{trigger:()=>s(v,{},{trigger:()=>s(j,{circle:!0,type:"info",size:"small",disabled:r.version===o.row.version},{icon:()=>s(F)}),default:()=>t("project.workflow.switch_version")}),default:()=>t("project.workflow.confirm_switch_version")}),s(k,{onPositiveClick:()=>{d(r.version)}},{trigger:()=>s(v,{},{trigger:()=>s(j,{circle:!0,type:"error",size:"small",disabled:r.version===o.row.version},{icon:()=>s(B)}),default:()=>t("project.workflow.delete")}),default:()=>t("project.workflow.delete_confirm")})]})})},p=o=>{e.loadingRef||(e.loadingRef=!0,e.row=o,P({pageSize:e.pageSize,pageNo:e.page},e.projectCode,e.row.code).then(l=>{e.tableData=l.totalList.map(r=>({...r})),e.totalPage=l.totalPage,e.loadingRef=!1}))},f=o=>{R(e.projectCode,e.row.code,o).then(()=>{e.row.version=o,window.$message.success(t("project.workflow.success")),i.emit("updateList")})},d=o=>{S(e.projectCode,e.row.code,o).then(()=>{window.$message.success(t("project.workflow.success")),i.emit("updateList"),e.tableData.length===1&&e.page>1&&(e.page-=1),p(e.row)})};return{variables:e,createColumns:u,getTableData:p}}const H={isInstance:{type:Boolean,default:!1},show:{type:Boolean,default:!1},row:{type:Object,default:{}}},ot=C({name:"workflowDefinitionVersion",props:H,emits:["update:show","update:row","updateList"],setup(i,t){const{variables:a,createColumns:e,getTableData:u}=U(t),{importState:p}=V(),{handleImportDefinition:f}=M(p,t),d=()=>{var n;i.show&&((n=i.row)==null?void 0:n.code)&&u(i.row)},o=()=>{t.emit("update:show")},l=()=>{f()},r=({file:n})=>{p.importForm.name=n.name,p.importForm.file=n.file};return g(()=>i.show,()=>{e(a,i.isInstance),d()}),g(w().locale,()=>{e(a,i.isInstance)}),{hideModal:o,handleImport:l,customRequest:r,requestData:d,..._(a)}},render(){const{t:i}=w(),{requestData:t,loadingRef:a}=this;return c(T,{show:this.$props.show,title:i("project.workflow.version_info"),onCancel:this.hideModal,onConfirm:this.hideModal},{default:()=>[c(h,{vertical:!0},{default:()=>[c(x,{loading:a,columns:this.columns,data:this.tableData,striped:!0,size:"small"},null),c(h,{justify:"center"},{default:()=>[c($,{page:this.page,"onUpdate:page":e=>this.page=e,"page-size":this.pageSize,"onUpdate:page-size":e=>this.pageSize=e,"page-count":this.totalPage,onUpdatePage:t},null)]})]})]})}});export{ot as default};
