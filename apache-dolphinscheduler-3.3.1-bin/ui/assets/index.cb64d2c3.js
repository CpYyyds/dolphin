import{u as D,bH as S,E as j,r as i,h as m,d as R,o as x,H as E,bf as _,I as P,c,i as U}from"./index.02a17cf1.js";import{_ as N}from"./lodash.3a74b132.js";import{B as z}from"./index.fe057c74.js";import{d as O,e as v,f as W}from"./index.8587fc8e.js";import{a as b}from"./index.bcd2e05d.js";import K from"./table-action.b515e754.js";import{b as V,r as g,d as q}from"./common.a16f92ec.js";import{D as A,C as n,c as B}from"./column-width-config.03ebcd18.js";import{N as L}from"./Ellipsis.eed9f363.js";import{N as M}from"./Icon.0cd298dd.js";import{N as $}from"./Spin.4db05d4b.js";import{N as I}from"./Tooltip.76a430fa.js";import{C}from"./index.ef447d1d.js";import H from"./workflow-instance-condition.38da26e0.js";import{t as F}from"./tableTotalCount.3d973079.js";import{N as T}from"./Space.8a344b95.js";import{N as G,a as X}from"./DataTable.ddc5a79d.js";import{N as Y}from"./Popconfirm.98866df0.js";import{N as J}from"./Button.1b3ea9f7.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./FormOutlined.0c6aa81a.js";import"./SyncOutlined.d69d028f.js";import"./CloseCircleOutlined.d6e82e31.js";import"./PlayCircleOutlined.66fb9fb6.js";import"./PauseCircleOutlined.6f50ffc5.js";import"./DeleteOutlined.d3b97bbb.js";import"./ControlOutlined.078243b3.js";import"./Popover.92dc7b00.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./cssr.f561ccf0.js";import"./utils.eff12f29.js";import"./format-length.a6a40b1f.js";import"./resolve-slot.92499a18.js";import"./use-merged-state.2bdc3563.js";import"./use-compitable.cd47f4ac.js";import"./next-frame-once.50ecadf2.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./use-locale.47aab0f5.js";import"./keysOf.843c523b.js";import"./get-slot.eeb09d52.js";import"./index.5f9a33e7.js";import"./SettingOutlined.901415e1.js";import"./CheckCircleOutlined.b15d9580.js";import"./EditOutlined.8be88705.js";import"./index.8474b6bf.js";import"./Card.f8db533a.js";import"./index.9cbc470c.js";import"./SearchOutlined.280f9205.js";import"./Select.51d2f90f.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./Empty.249462a1.js";import"./Suffix.62982c61.js";import"./index.21198e00.js";import"./Input.59461546.js";import"./DatePicker.d4b2a484.js";import"./typeof.481ce13f.js";import"./use-keyboard.8f9f6db8.js";import"./Forward.b8f2636c.js";import"./ArrowDown.fd6213c2.js";import"./Checkbox.c8f5c3b1.js";import"./RadioGroup.7b709552.js";import"./Radio.4578e023.js";import"./Dropdown.de4044d8.js";import"./ChevronRight.d1d16011.js";function Q(){const{t:o}=D(),r=S(),e=j({columns:[],tableWidth:A,checkedRowKeys:[],tableData:[],page:i(1),pageSize:i(10),totalPage:i(1),totalCount:i(0),searchVal:i(),executorName:i(),host:i(),stateType:i(),startDate:i(),endDate:i(),projectCode:i(Number(r.currentRoute.value.params.projectCode)),workflowDefinitionCode:r.currentRoute.value.query.workflowDefinitionCode?i(Number(r.currentRoute.value.query.workflowDefinitionCode)):i(),loadingRef:i(!1)}),u=a=>{a.columns=[{type:"selection",className:"btn-selected",...n.selection},{title:"#",key:"id",...n.index},{title:o("project.workflow.workflow_instance_name"),key:"name",...n.linkName,className:"workflow-name",resizable:!0,width:300,minWidth:300,maxWidth:600,render:t=>m(z,{onClick:()=>{const l=r.resolve({name:"workflow-instance-detail",params:{id:t.id},query:{code:t.workflowDefinitionCode}});window.open(l.href,"_blank")}},{default:()=>m(L,{style:"max-width: 580px;line-height: 1.5"},()=>t.name)})},{title:o("project.workflow.status"),key:"state",...n.state,className:"workflow-status",render:t=>Z(t.state,o)},{title:o("project.workflow.run_type"),key:"commandType",width:160,className:"workflow-run-type",render:t=>(N.filter(V(o),l=>l.code===t.commandType)[0]||{}).desc},{title:o("project.workflow.scheduling_time"),key:"scheduleTime",...n.time,render:t=>g(t.scheduleTime)},{title:o("project.workflow.start_time"),key:"startTime",...n.time,render:t=>g(t.startTime)},{title:o("project.workflow.end_time"),key:"endTime",...n.time,render:t=>g(t.endTime)},{title:o("project.workflow.duration"),key:"duration",...n.duration,render:t=>t.duration||"-"},{title:o("project.workflow.run_times"),key:"runTimes",...n.times,className:"workflow-run-times"},{title:o("project.workflow.fault_tolerant_sign"),key:"recovery",width:100},{title:o("project.workflow.dry_run_flag"),key:"dryRun",...n.dryRun,render:t=>t.dryRun===1?"YES":"NO"},{title:o("project.workflow.executor"),key:"executorName",...n.name},{title:o("project.workflow.host"),key:"host",...n.name},{title:o("project.workflow.operation"),key:"operation",...n.operation(7),render:(t,l)=>m(K,{row:t,onReRun:()=>s({index:l,workflowInstanceId:t.id,executeType:"REPEAT_RUNNING",buttonType:"run"}),onReStore:()=>s({index:l,workflowInstanceId:t.id,executeType:"START_FAILURE_TASK_PROCESS",buttonType:"store"}),onStop:()=>{t.state==="STOP"?s({index:l,workflowInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):w({workflowInstanceId:t.id,executeType:"STOP"})},onSuspend:()=>{t.state==="PAUSE"?s({index:l,workflowInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):w({workflowInstanceId:t.id,executeType:"PAUSE"})},onDeleteInstance:()=>d(t.id)})}],a.tableWidth&&(a.tableWidth=B(a.columns))},p=()=>{if(e.loadingRef)return;e.loadingRef=!0;const a={pageNo:e.page,pageSize:e.pageSize,searchVal:e.searchVal,executorName:e.executorName,host:e.host,stateType:e.stateType,startDate:e.startDate,endDate:e.endDate,workflowDefinitionCode:e.workflowDefinitionCode};O({...a},e.projectCode).then(t=>{e.totalCount=t.total,e.totalPage=t.totalPage,e.tableData=t.totalList.map(l=>({...l})),e.loadingRef=!1})},d=a=>{v(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===1&&e.page>1&&(e.page-=1),p()})},k=()=>{const a={workflowInstanceIds:N.join(e.checkedRowKeys,",")};W(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],p()})},w=a=>{b(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),p()})},y=(a,t)=>{let h,f;h||(f=10,h=setInterval(()=>{f>0&&f<=10?(f--,e.tableData[t].count=f):(a(),clearInterval(h),h=void 0)},1e3))},s=a=>{const{index:t}=a;e.tableData[t].buttonType=a.buttonType,b(a,e.projectCode).then(()=>{e.tableData[t].disabled=!0,window.$message.success(o("project.workflow.success")),y(()=>{p()},t)})};return{variables:e,createColumns:u,getTableData:p,batchDeleteInstance:k}}function Z(o,r){if(!o)return"";const e=q(r)[o],u=m(M,{color:e.color,class:e.classNames,style:{display:"flex"},size:20},()=>m(e.icon));return m(I,null,{trigger:()=>e.isSpin?m($,{size:20},{icon:()=>u}):u,default:()=>e.desc})}function ee(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!U(o)}const gt=R({name:"WorkflowInstanceList",setup(){let o;const{variables:r,createColumns:e,getTableData:u,batchDeleteInstance:p}=Q(),d=()=>{u()},k=s=>{r.workflowDefinitionCode=s.workflowDefinitionCode,r.searchVal=s.searchVal,r.executorName=s.executorName,r.host=s.host,r.stateType=s.stateType,r.startDate=s.startDate,r.endDate=s.endDate,r.page=1,d()},w=()=>{r.page=1,d()},y=()=>{p()};return x(()=>{e(r),d(),o=setInterval(()=>{d()},9e3)}),E(D().locale,()=>{e(r)}),_(()=>{clearInterval(o)}),{requestData:d,handleSearch:k,handleChangePageSize:w,handleBatchDelete:y,...P(r)}},render(){const{t:o}=D(),{loadingRef:r}=this;return c(T,{vertical:!0},{default:()=>[c(C,null,{default:()=>[c(H,{onHandleSearch:this.handleSearch},null)]}),c(C,{title:o("project.workflow.workflow_instance")},{default:()=>[c(T,{vertical:!0},{default:()=>[c(G,{loading:r,rowKey:e=>e.id,columns:this.columns,data:this.tableData,striped:!0,size:"small",scrollX:this.tableWidth,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":e=>this.checkedRowKeys=e,"row-class-name":"items-workflow-instances"},null),c(T,{justify:"center"},{default:()=>[c(X,{page:this.page,"onUpdate:page":e=>this.page=e,"page-size":this.pageSize,"onUpdate:page-size":e=>this.pageSize=e,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize,itemCount:this.totalCount,prefix:F},null)]})]}),c(I,null,{default:()=>o("project.workflow.delete"),trigger:()=>c(Y,{onPositiveClick:this.handleBatchDelete},{default:()=>o("project.workflow.delete_confirm"),trigger:()=>{let e;return c(J,{tag:"div",type:"primary",disabled:this.checkedRowKeys.length<=0,style:"position: absolute; bottom: 10px; left: 10px;",class:"btn-delete-all"},ee(e=o("project.workflow.delete"))?e:{default:()=>[e]})}})})]})]})}});export{gt as default};
