import{u as T,E as k,r as C,bG as R,bH as x,z,bI as O,d as A,bu as $,G as D,o as q,I as j,c as e,J as U,L,b8 as I,i as E}from"./index.02a17cf1.js";import{a as p,s as f}from"./service.ade35c11.js";import{g as P}from"./index.cd03a49b.js";import{u as G,a as Z}from"./timezone.805e550c.js";import{q as B}from"./index.b0aa157e.js";import{u as K}from"./use-message.66b07366.js";import{N as V}from"./Switch.a01ace9e.js";import{N as M}from"./Divider.987d98e5.js";import{N as H}from"./Image.a9e33dbe.js";import{N as J}from"./Form.de76c832.js";import{N as S}from"./FormItem.aeb1ee46.js";import{N as b}from"./Input.59461546.js";import{N}from"./Button.1b3ea9f7.js";import{N as W}from"./Space.8a344b95.js";import"./ui-setting.7e6814b1.js";import"./lodash.3a74b132.js";import"./use-form-item.96cfc8ba.js";import"./use-merged-state.2bdc3563.js";import"./resolve-slot.92499a18.js";import"./index.5f9a33e7.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./use-locale.47aab0f5.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./use-false-until-truthy.e57d8f60.js";import"./Tooltip.76a430fa.js";import"./Popover.92dc7b00.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./cssr.f561ccf0.js";import"./utils.eff12f29.js";import"./format-length.a6a40b1f.js";import"./use-compitable.cd47f4ac.js";import"./next-frame-once.50ecadf2.js";import"./keysOf.843c523b.js";import"./Suffix.62982c61.js";import"./is-browser.e7afaa57.js";import"./get-slot.eeb09d52.js";const Q="_container_1xagr_17",X="_logo_1xagr_37",m={container:Q,"language-switch":"_language-switch_1xagr_25","login-model":"_login-model_1xagr_30",logo:X,"logo-img":"_logo-img_1xagr_43","form-model":"_form-model_1xagr_49","oauth2-provider":"_oauth2-provider_1xagr_52"};function Y(){const{t:o,locale:i}=T(),t=k({loginFormRef:C(),loginForm:{userName:"",userPassword:"",ssoLoginUrl:""},rules:{userName:{trigger:["input","blur"],validator(){if(t.loginForm.userName==="")return new Error(o("login.userName_tips"))}},userPassword:{trigger:["input","blur"],validator(){if(t.loginForm.userPassword==="")return new Error(o("login.userPassword_tips"))}}}});return{state:t,t:o,locale:i}}function oo(o){const i=R();return{handleChange:s=>{o.value=s,i.setLocales(s),p.set("language",o.value,{path:"/"})}}}function eo(o){return f({url:"/login",method:"post",data:o})}function to(){return f({url:"/login/sso",method:"get"})}function so(){return f({url:"/oauth2-provider",method:"get"})}function ro(){return f({url:"/cookies",method:"delete"})}function io(o){const i=x(),t=z(),s=G(),n=Z(),g=O(),w=()=>{o.loginFormRef.validate(async r=>{if(!r){const a=await eo({...o.loginForm});await t.setSessionId(a.sessionId),await t.setSecurityConfigType(a.securityConfigType),p.set("sessionId",a.sessionId,{path:"/"});const l=await P();await t.setUserInfo(l);const u=await B({type:"FILE"});await t.setBaseResDir(u);const c=l.timeZone?l.timeZone:"UTC";await n.setTimezone(c);const h=s.lastRoute;i.push({path:h||"home"})}})},v=()=>{so().then(r=>{d.value=r})},d=C([]);return{handleLogin:w,handleGetOAuth2Provider:v,gotoOAuth2Page:async r=>{await ro(),window.location.href=`${r.authorizationUri}?client_id=${r.clientId}&response_type=code&redirect_uri=${r.redirectUri}?provider=${r.provider}`},oauth2Providers:d,handleRedirect:async()=>{const r=g.query.authType;if(r&&r==="oauth2"){const a=g.query.sessionId;if(a){p.set("sessionId",String(a),{path:"/"});const u=await P();await t.setUserInfo(u);const c=u.timeZone?u.timeZone:"UTC";await n.setTimezone(c),i.push("home")}const l=g.query.error;l&&window.$message.error(l)}}}}function F(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!E(o)}const Mo=A({name:"login",setup(){var a;window.$message=K();const{state:o,t:i,locale:t}=Y(),{handleChange:s}=oo(t),{handleLogin:n,handleGetOAuth2Provider:g,oauth2Providers:w,gotoOAuth2Page:v,handleRedirect:d}=io(o),_=R(),y=$();y.getTheme&&y.setDarkTheme();const r=(a=D())==null?void 0:a.appContext.config.globalProperties.trim;return p.set("language",_.getLocales,{path:"/"}),q(async()=>{const l=await to();if(o.loginForm.ssoLoginUrl=l,o.loginForm.ssoLoginUrl){const u=new URL(window.location.href),c=u.searchParams.get("state"),h=u.searchParams.get("code");c&&h&&(o.loginForm.userName=c,o.loginForm.userPassword=h,n())}else o.loginForm.ssoLoginUrl="";d()}),g(),{t:i,handleChange:s,handleLogin:n,...j(o),localesStore:_,trim:r,oauth2Providers:w,gotoOAuth2Page:v}},render(){let o,i,t;return e("div",{class:m.container},[e("div",{class:m["language-switch"]},[e(V,{onUpdateValue:this.handleChange,"default-value":this.localesStore.getLocales,"checked-value":"en_US","unchecked-value":"zh_CN"},{checked:()=>"en_US",unchecked:()=>"zh_CN"})]),e("div",{class:m["login-model"]},[e("div",{class:m.logo},[e("div",{class:m["logo-img"]},null)]),U(e("div",{class:m["form-model"]},[e(J,{rules:this.rules,ref:"loginFormRef"},{default:()=>[e(S,{label:this.t("login.userName"),"label-style":{color:"black"},path:"userName"},{default:()=>[e(b,{allowInput:this.trim,class:"input-user-name",type:"text",size:"large",value:this.loginForm.userName,"onUpdate:value":s=>this.loginForm.userName=s,placeholder:this.t("login.userName_tips"),autofocus:!0,onKeydown:I(this.handleLogin,["enter"])},null)]}),e(S,{label:this.t("login.userPassword"),"label-style":{color:"black"},path:"userPassword"},{default:()=>[e(b,{allowInput:this.trim,class:"input-password",type:"password",size:"large",value:this.loginForm.userPassword,"onUpdate:value":s=>this.loginForm.userPassword=s,placeholder:this.t("login.userPassword_tips"),onKeydown:I(this.handleLogin,["enter"])},null)]})]}),e(N,{class:"btn-login",round:!0,type:"info",disabled:!this.loginForm.userName||!this.loginForm.userPassword,style:{width:"100%"},onClick:this.handleLogin},F(o=this.t("login.login"))?o:{default:()=>[o]})]),[[L,this.loginForm.ssoLoginUrl.length===0]]),U(e("div",{class:m["form-model"]},[e("a",{href:this.loginForm.ssoLoginUrl,style:"text-decoration:none"},[e(N,{class:"btn-login-sso",round:!0,type:"info",style:{width:"100%",marginTop:"30px"},onClick:this.handleLogin},F(i=this.t("login.ssoLogin"))?i:{default:()=>[i]})])]),[[L,this.loginForm.ssoLoginUrl.length!==0]]),this.oauth2Providers.length>0&&e(M,null,F(t=this.t("login.loginWithOAuth2"))?t:{default:()=>[t]}),e(W,{class:m["oauth2-provider"],justify:"center"},{default:()=>{var s;return[(s=this.oauth2Providers)==null?void 0:s.map(n=>n.iconUri?e("div",{onClick:()=>this.gotoOAuth2Page(n)},[e(H,{"preview-disabled":!0,width:"30",src:n.iconUri},null)," "]):e(N,{onClick:()=>this.gotoOAuth2Page(n)},{default:()=>[n.provider]}))]}})])])}});export{Mo as default};
