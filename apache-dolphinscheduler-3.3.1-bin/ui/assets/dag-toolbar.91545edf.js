import{d as j,b9 as x,ba as m,bb as D,r as N,u as oe,bu as le,U as re,bH as ne,bI as ie,c as e,F as ae,i as se}from"./index.02a17cf1.js";import{S as l}from"./dag.module.806bc1a0.js";import{D as ce}from"./index.7d2218cd.js";import"./lodash.3a74b132.js";import{c as ue}from"./index.9b0cc109.js";import"./dag-context-menu.4080e7eb.js";import"./task-type.618fb0da.js";import"./gForce.e00398bc.js";import{u as de}from"./use-text-copy.5aaa6a47.js";import"./service.ade35c11.js";import"./dag-node-status.5341bb4a.js";import me from"./dag-startup-param.2e925564.js";import pe from"./variables-view.9c8f6618.js";import{u as fe}from"./use-dependencies.c18c5099.js";import{C as ge}from"./CopyOutlined.05f74603.js";import{S as he}from"./SearchOutlined.280f9205.js";import{D as we}from"./DownloadOutlined.bd8b049e.js";import{S as ve}from"./SyncOutlined.d69d028f.js";import{D as _e}from"./DeleteOutlined.d3b97bbb.js";import{F as be,a as ke}from"./FullscreenOutlined.f113d9e5.js";import{I as Ce}from"./InfoCircleOutlined.ab212e51.js";import{N as c}from"./Tooltip.76a430fa.js";import{N as a}from"./Button.1b3ea9f7.js";import{N as u}from"./Icon.0cd298dd.js";import{N as E}from"./Popover.92dc7b00.js";import{N as U}from"./text.856015a6.js";import{d as ye,N as Ne}from"./Select.51d2f90f.js";import"./toNumber.f676da43.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./debounce.aab20534.js";import"./common.a16f92ec.js";import"./SettingOutlined.901415e1.js";import"./PauseCircleOutlined.6f50ffc5.js";import"./CloseCircleOutlined.d6e82e31.js";import"./CheckCircleOutlined.b15d9580.js";import"./EditOutlined.8be88705.js";import"./index.8474b6bf.js";import"./typeof.481ce13f.js";import"./use-message.66b07366.js";import"./ui-setting.7e6814b1.js";import"./Spin.4db05d4b.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-compitable.cd47f4ac.js";import"./index.5f9a33e7.js";import"./format-length.a6a40b1f.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./use-false-until-truthy.e57d8f60.js";import"./cssr.f561ccf0.js";import"./utils.eff12f29.js";import"./resolve-slot.92499a18.js";import"./use-merged-state.2bdc3563.js";import"./next-frame-once.50ecadf2.js";import"./index.124d1fef.js";import"./index.e5f69831.js";import"./index.8587fc8e.js";import"./index.9cbc470c.js";import"./index.b889db2d.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./use-locale.47aab0f5.js";import"./Empty.249462a1.js";import"./Suffix.62982c61.js";import"./index.21198e00.js";const je={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Se=m("defs",null,null,-1),xe=m("path",{d:"M840 192h-56v-72c0-13.3-10.7-24-24-24H168c-13.3 0-24 10.7-24 24v272c0 13.3 10.7 24 24 24h592c13.3 0 24-10.7 24-24V256h32v200H465c-22.1 0-40 17.9-40 40v136h-44c-4.4 0-8 3.6-8 8v228c0 .6.1 1.3.2 1.9c-.1 2-.2 4.1-.2 6.1c0 46.4 37.6 84 84 84s84-37.6 84-84c0-2.1-.1-4.1-.2-6.1c.1-.6.2-1.2.2-1.9V640c0-4.4-3.6-8-8-8h-44V520h351c22.1 0 40-17.9 40-40V232c0-22.1-17.9-40-40-40zM720 352H208V160h512v192zM477 876c0 11-9 20-20 20s-20-9-20-20V696h40v180z",fill:"currentColor"},null,-1),De=[Se,xe],Ve=j({name:"FormatPainterOutlined",render:function(n,t){return D(),x("svg",je,De)}}),Oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Te=m("defs",null,null,-1),Fe=m("path",{d:"M956 686.5l-.1-.1l-.1-.1C911.7 593 843.4 545 752.5 545s-159.2 48.1-203.4 141.3v.1c-5.4 11.5-5.4 24.9 0 36.4C593.3 816 661.6 864 752.5 864s159.2-48.1 203.4-141.3c5.4-11.5 5.4-24.8.1-36.2zM752.5 800c-62.1 0-107.4-30-141.1-95.5C645 639 690.4 609 752.5 609c62.1 0 107.4 30 141.1 95.5C860 770 814.6 800 752.5 800z",fill:"currentColor"},null,-1),Me=m("path",{d:"M697 705a56 56 0 1 0 112 0a56 56 0 1 0-112 0z",fill:"currentColor"},null,-1),$e=m("path",{d:"M136 232h704v253h72V192c0-17.7-14.3-32-32-32H96c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h352v-72H136V232z",fill:"currentColor"},null,-1),ze=m("path",{d:"M724.9 338.1l-36.8-36.8c-3.1-3.1-8.2-3.1-11.3 0L493 485.3l-86.1-86.2c-3.1-3.1-8.2-3.1-11.3 0L251.3 543.4c-3.1 3.1-3.1 8.2 0 11.3l36.8 36.8c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8l86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.2-3.1 3.2-8.2 0-11.3z",fill:"currentColor"},null,-1),Ie=[Te,Fe,Me,$e,ze],Be=j({name:"FundViewOutlined",render:function(n,t){return D(),x("svg",Oe,Ie)}}),Le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},He=m("path",{d:"M666.7 505.5l-246-178A8 8 0 0 0 408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512L421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z",fill:"currentColor"},null,-1),Pe=m("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1),qe=[He,Pe],Re=j({name:"RightCircleOutlined",render:function(n,t){return D(),x("svg",Le,qe)}});function Ee(o){const n=N(""),{graph:t}=o,k=N(!1),h=()=>{k.value=!k.value},w=N([]),s=()=>{var v;const _=((v=t.value)==null?void 0:v.getNodes())||[];w.value=_.map(b=>({label:b.getData().taskName,value:b.id})),w.value.findIndex(b=>b.value===n.value)===-1&&(n.value="")};function S(_){if(n.value=_,!t.value)return;const C=t.value.getCellById(_);t.value.scrollToCell(C,{animation:{duration:600}}),t.value.cleanSelection(),t.value.select(C)}return{searchSelectValue:n,navigateTo:S,toggleSearchInput:h,searchInputVisible:k,reQueryNodes:s,nodesDropdown:w}}function y(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!se(o)}const Ue={layoutToggle:{type:Function,default:()=>{}},instance:{type:Object,default:null},definition:{type:Object,default:null},dependenciesData:{type:Object,require:!1}},ro=j({name:"workflow-dag-toolbar",props:Ue,emits:["versionToggle","saveModelToggle","removeTasks","refresh"],setup(o,n){const{t}=oe(),k=le(),h=re("graph",N()),w=ne(),s=ie(),S=Number(s.params.projectCode),_=Number(s.params.code),{getDependentTaskLinksByMultipleTasks:C}=fe(),v=o.dependenciesData,{searchSelectValue:b,navigateTo:G,toggleSearchInput:Q,searchInputVisible:A,reQueryNodes:W,nodesDropdown:J}=Ee({graph:h}),K=(i={fileName:"dag",bgColor:"#f2f3f7"})=>{var f;const{fileName:r,bgColor:p}=i;(f=h.value)==null||f.toPNG(g=>{ce.downloadDataUri(g,`${r}.png`)},{padding:{top:50,right:50,bottom:50,left:50},backgroundColor:p})},{isFullscreen:V,toggle:X}=ue(),Y=()=>{n.emit("versionToggle",!0)},Z=()=>{o.layoutToggle(!0)},ee=()=>{const{back:i,current:r}=history.state;if(i&&i!=="/login"){w.go(-1);return}if(!i||r.includes("workflow/definitions")){w.push({path:`/projects/${s.params.projectCode}/workflow-definition`});return}if(r.includes("workflow/instances")){w.push({path:`/projects/${s.params.projectCode}/workflow/instances`});return}},{copy:O}=de(),te=async()=>{var i;if(h.value){const r=h.value.getSelectedCells();if(r){const p=r.filter(g=>g.isNode()).map(g=>+g.id),f=await C(S,_,p);f.length>0?(v.showRef=!0,v.taskLinks=f,v.tip=t("project.task.delete_validate_dependent_tasks_desc"),v.required=!0):(n.emit("removeTasks",p,r),(i=h.value)==null||i.removeCells(r))}}};return()=>{var f,g,T,F,M,$,z,I,B,L,H;let i,r,p;return e("div",{class:[l.toolbar,l[k.darkTheme?"toolbar-dark":"toolbar-light"]]},[e("span",{class:l["workflow-name"]},[s.name==="workflow-instance-detail"?(f=o.instance)==null?void 0:f.name:((T=(g=o.definition)==null?void 0:g.workflowDefinition)==null?void 0:T.name)||t("project.dag.create")]),((M=(F=o.definition)==null?void 0:F.workflowDefinition)==null?void 0:M.name)&&e(c,null,{trigger:()=>e(a,{quaternary:!0,circle:!0,onClick:()=>{var P,q,R;const d=s.name==="workflow-instance-detail"?(P=o.instance)==null?void 0:P.name:(R=(q=o.definition)==null?void 0:q.workflowDefinition)==null?void 0:R.name;O(d)},class:l["toolbar-btn"]},{default:()=>[e(u,null,{default:()=>[e(ge,null,null)]})]}),default:()=>t("project.dag.copy_name")}),((z=($=o.definition)==null?void 0:$.workflowDefinition)==null?void 0:z.name)&&e(c,null,{trigger:()=>e(E,{placement:"bottom",trigger:"click",scrollable:!0,style:{maxWidth:"50vw",maxHeight:"70vh"}},{trigger:()=>e(a,{quaternary:!0,circle:!0,class:l["toolbar-btn"]},{default:()=>[e(u,null,{default:()=>[e(Be,null,null)]})]}),header:()=>{let d;return e(U,{strong:!0,depth:1},y(d=t("project.workflow.parameters_variables"))?d:{default:()=>[d]})},default:()=>e(pe,{onCopy:O},null)}),default:()=>t("project.dag.view_variables")}),e("div",{class:l["toolbar-left-part"]},[s.name!=="workflow-instance-detail"&&((B=(I=o.definition)==null?void 0:I.workflowDefinition)==null?void 0:B.releaseState)==="ONLINE"&&e(ye,{round:!0,size:"small",type:"info"},y(i=t("project.dag.online"))?i:{default:()=>[i]}),s.name==="workflow-instance-detail"&&e(ae,null,[e(c,null,{trigger:()=>e(E,{placement:"bottom",trigger:"click"},{trigger:()=>e(a,{quaternary:!0,circle:!0,class:l["toolbar-btn"]},{default:()=>[e(u,null,{default:()=>[e(Re,null,null)]})]}),header:()=>{let d;return e(U,{strong:!0,depth:1},y(d=t("project.workflow.startup_parameter"))?d:{default:()=>[d]})},default:()=>e(me,{startupParam:o.instance},null)}),default:()=>t("project.dag.startup_parameter")})])]),e("div",{class:l["toolbar-right-part"]},[e(c,null,{trigger:()=>e(a,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:Q},{icon:()=>e(u,null,{default:()=>[e(he,null,null)]})}),default:()=>t("project.dag.search")}),e("div",{class:`${l["toolbar-right-item"]} ${l["node-selector"]} ${A.value?l.visible:""}`},[e(Ne,{size:"small",value:b.value,options:J.value,onFocus:W,onUpdateValue:G,filterable:!0},null)]),e(c,null,{trigger:()=>e(a,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>K()},{icon:()=>e(u,null,{default:()=>[e(we,null,null)]})}),default:()=>t("project.dag.download_png")}),o.instance&&e(c,null,{trigger:()=>e(a,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>{n.emit("refresh")}},{icon:()=>e(u,null,{default:()=>[e(ve,null,null)]})}),default:()=>t("project.dag.refresh_dag_status")}),e(c,null,{trigger:()=>e(a,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>te()},{icon:()=>e(u,null,{default:()=>[e(_e,null,null)]})}),default:()=>t("project.dag.delete_cell")}),e(c,null,{trigger:()=>e(a,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:X},{icon:()=>e(u,null,{default:()=>[V.value?e(be,null,null):e(ke,null,null)]})}),default:()=>V.value?t("project.dag.fullscreen_close"):t("project.dag.fullscreen_open")}),e(c,null,{trigger:()=>e(a,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:Z},{icon:()=>e(u,null,{default:()=>[e(Ve,null,null)]})}),default:()=>t("project.dag.format")}),!!o.definition&&e(c,null,{trigger:()=>e(a,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:Y},{icon:()=>e(u,null,{default:()=>[e(Ce,null,null)]})}),default:()=>t("project.workflow.version_info")}),e(a,{class:[l["toolbar-right-item"],"btn-save"],type:"info",secondary:!0,round:!0,disabled:((H=(L=o.definition)==null?void 0:L.workflowDefinition)==null?void 0:H.releaseState)==="ONLINE"&&!o.instance,onClick:()=>{n.emit("saveModelToggle",!0)}},y(r=t("project.dag.save"))?r:{default:()=>[r]}),e(a,{secondary:!0,round:!0,onClick:ee,class:"btn-close"},y(p=t("project.dag.close"))?p:{default:()=>[p]})])])}}});export{ro as default};
