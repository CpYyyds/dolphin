import{s as R}from"./service.ade35c11.js";import{d as P,U as B,r as q,bI as M,u as j,o as V,c as n,F as g,i as A}from"./index.02a17cf1.js";import{u as K}from"./common.a16f92ec.js";import{u as F}from"./use-dependencies.c18c5099.js";import{N as o}from"./Button.1b3ea9f7.js";function z(e,a){return R.request({url:`/projects/${a}/task-definition/gen-task-codes`,method:"get",params:{genNum:e}})}const l={"dag-context-menu":"_dag-context-menu_e40aw_17","menu-item":"_menu-item_e40aw_25"};function c(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!A(e)}const U={startDisplay:{type:Boolean,default:!1},executeTaskDisplay:{type:Boolean,default:!1},menuDisplay:{type:Boolean,default:!1},taskInstance:{type:Object,require:!0},cell:{type:Object,require:!0},visible:{type:Boolean,default:!0},left:{type:Number,default:0},top:{type:Number,default:0},dependenciesData:{type:Object,require:!1}},Y=P({name:"dag-context-menu",props:U,emits:["hide","start","edit","viewLog","copyTask","removeTasks","executeTask","removeTaskInstanceCache"],setup(e,a){const d=B("graph",q()),i=M(),u=Number(i.params.projectCode),r=Number(i.params.code),{t:m}=j(),{getDependentTaskLinksByTask:k}=F(),s=e.dependenciesData,N=()=>{a.emit("hide",!1)},w=()=>{var t;a.emit("start",Number((t=e.cell)==null?void 0:t.id))},x=()=>{var t;a.emit("edit",Number((t=e.cell)==null?void 0:t.id))},v=()=>{e.taskInstance&&a.emit("viewLog",e.taskInstance.id,e.taskInstance.taskType)},D=()=>{var t;a.emit("executeTask",Number((t=e.cell)==null?void 0:t.id),"TASK_ONLY")},O=()=>{var t;e.taskInstance&&a.emit("executeTask",Number((t=e.cell)==null?void 0:t.id),"TASK_POST")},E=()=>{var t;e.taskInstance&&a.emit("executeTask",Number((t=e.cell)==null?void 0:t.id),"TASK_PRE")},I=()=>{var p,T,b,C;const f=(p=e.cell)==null?void 0:p.data.taskType,h=K(((T=e.cell)==null?void 0:T.data.taskName)+"_"),_=Number((b=e.cell)==null?void 0:b.id),y=(C=e.cell)==null?void 0:C.data.flag;z(1,u).then(S=>{const[L]=S;a.emit("copyTask",h,L,_,f,y,{x:e.left+100,y:e.top+100})})},$=async()=>{var h,_,y;const t=(h=e.cell)==null?void 0:h.id,f=await k(u,r,t);s.showRef=!1,f.length>0?(s.showRef=!0,s.taskLinks=f,s.tip=m("project.task.delete_validate_dependent_tasks_desc"),s.required=!0):((_=d.value)==null||_.removeCell(e.cell),a.emit("removeTasks",[Number((y=e.cell)==null?void 0:y.id)]))};return V(()=>{document.addEventListener("click",()=>{N()})}),{startRunning:w,handleEdit:x,handleCopy:I,handleDelete:$,handleViewLog:v,handleExecuteTaskOnly:D,handleExecuteTaskPOST:O,handleExecuteTaskPRE:E}},render(){let e,a,d,i,u,r,m,k;const{t:s}=j();return this.visible&&n("div",{class:l["dag-context-menu"],style:{left:`${this.left}px`,top:`${this.top}px`}},[this.startDisplay&&n(o,{class:`${l["menu-item"]}`,onClick:this.startRunning},c(e=s("project.node.start"))?e:{default:()=>[e]}),this.menuDisplay&&n(g,null,[n(o,{class:`${l["menu-item"]}`,onClick:this.handleEdit},c(a=s("project.node.edit"))?a:{default:()=>[a]}),n(o,{class:`${l["menu-item"]}`,onClick:this.handleCopy},c(d=s("project.node.copy"))?d:{default:()=>[d]}),n(o,{class:`${l["menu-item"]}`,onClick:this.handleDelete},c(i=s("project.node.delete"))?i:{default:()=>[i]})]),this.taskInstance&&n(g,null,[n(o,{class:`${l["menu-item"]}`,onClick:this.handleViewLog},c(u=s("project.node.view_log"))?u:{default:()=>[u]})]),this.executeTaskDisplay&&n(g,null,[n(o,{class:`${l["menu-item"]}`,onClick:this.handleExecuteTaskOnly},c(r=s("project.workflow.current_node_execution_task"))?r:{default:()=>[r]}),n(o,{class:`${l["menu-item"]}`,onClick:this.handleExecuteTaskPOST},c(m=s("project.workflow.backward_execution_task"))?m:{default:()=>[m]}),n(o,{class:`${l["menu-item"]}`,onClick:this.handleExecuteTaskPRE},c(k=s("project.workflow.forward_execution_task"))?k:{default:()=>[k]})])])}}),X=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"}));export{Y as C,X as d,z as g};
