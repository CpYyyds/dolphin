import{M as _}from"./index.08dd828f.js";import{u as h,E as v,r as s,d as b,G as k,H as g,I as M,c as r}from"./index.02a17cf1.js";import{v as C,c as R,u as w}from"./index.b0b7f313.js";import{N}from"./Form.de76c832.js";import{N as l}from"./FormItem.aeb1ee46.js";import{N as c}from"./Input.59461546.js";import"./index.fe057c74.js";import"./Button.1b3ea9f7.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./resolve-slot.92499a18.js";import"./Modal.920fa101.js";import"./keysOf.843c523b.js";import"./Card.f8db533a.js";import"./index.5f9a33e7.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./utils.eff12f29.js";import"./index.21198e00.js";import"./Space.8a344b95.js";import"./get-slot.eeb09d52.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./lodash.3a74b132.js";import"./format-length.a6a40b1f.js";import"./get.852d0cd9.js";import"./use-locale.47aab0f5.js";import"./use-merged-state.2bdc3563.js";import"./Suffix.62982c61.js";function S(t,i){const{t:o}=h(),e=v({clusterFormRef:s(),model:{code:s(-1),name:s(""),k8s_config:s(""),yarn_config:s(""),description:s("")},saving:!1,rules:{name:{required:!0,trigger:["input","blur"],validator(){if(e.model.name==="")return new Error(o("security.cluster.cluster_name_tips"))}},description:{required:!0,trigger:["input","blur"],validator(){if(e.model.description==="")return new Error(o("security.cluster.cluster_description_tips"))}}}}),m=async n=>{if(await e.clusterFormRef.validate(),!e.saving){e.saving=!0;try{n===0?await d():await u()}finally{e.saving=!1}}},d=()=>{C({clusterName:e.model.name}).then(()=>{const n={name:e.model.name,config:JSON.stringify({k8s:e.model.k8s_config,yarn:e.model.yarn_config}),description:e.model.description};R(n).then(()=>{e.model.name="",e.model.k8s_config="",e.model.yarn_config="",e.model.description="",i.emit("confirmModal",t.showModalRef)})})},u=()=>{const n={code:e.model.code,name:e.model.name,config:JSON.stringify({k8s:e.model.k8s_config,yarn:e.model.yarn_config}),description:e.model.description};w(n).then(()=>{i.emit("confirmModal",t.showModalRef)})};return{variables:e,handleValidate:m}}const I=`apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CZJQ0FURS0tLS0tCg==
    server: https://127.0.0.1:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CZJQ0FURS0tLS0tCg= 
`,F="In development...",ce=b({name:"ClusterModal",props:{showModalRef:{type:Boolean,default:!1},statusRef:{type:Number,default:0},row:{type:Object,default:{}}},emits:["cancelModal","confirmModal"],setup(t,i){var f;const{variables:o,handleValidate:e}=S(t,i),{t:m}=h(),d=()=>{t.statusRef===0&&(o.model.name="",o.model.k8s_config="",o.model.yarn_config="",o.model.description=""),i.emit("cancelModal",t.showModalRef)},u=()=>{e(t.statusRef)},n=a=>{if(o.model.code=a.code,o.model.name=a.name,a.config){const p=JSON.parse(a.config);o.model.k8s_config=p.k8s||"",o.model.yarn_config=p.yarn||""}else o.model.k8s_config="",o.model.yarn_config="";o.model.description=a.description},y=(f=k())==null?void 0:f.appContext.config.globalProperties.trim;return g(()=>t.statusRef,()=>{t.statusRef===0?(o.model.name="",o.model.k8s_config="",o.model.yarn_config="",o.model.description=""):n(t.row)}),g(()=>t.row,()=>{n(t.row)}),{t:m,...M(o),cancelModal:d,confirmModal:u,trim:y}},render(){const{t}=this;return r("div",null,[r(_,{title:this.statusRef===0?t("security.cluster.create_cluster"):t("security.cluster.edit_cluster"),show:this.showModalRef,onCancel:this.cancelModal,onConfirm:this.confirmModal,confirmDisabled:!this.model.name||!this.model.description,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>r(N,{model:this.model,rules:this.rules,ref:"clusterFormRef"},{default:()=>[r(l,{label:t("security.cluster.cluster_name"),path:"name"},{default:()=>[r(c,{allowInput:this.trim,class:"input-cluster-name",placeholder:t("security.cluster.cluster_name_tips"),value:this.model.name,"onUpdate:value":i=>this.model.name=i},null)]}),r(l,{label:t("security.cluster.kubernetes_config"),path:"k8s_config"},{default:()=>[r(c,{allowInput:this.trim,class:"input-cluster-config",placeholder:I,type:"textarea",autosize:{minRows:16},value:this.model.k8s_config,"onUpdate:value":i=>this.model.k8s_config=i},null)]}),r(l,{label:t("security.cluster.yarn_config"),path:"yarn_config"},{default:()=>[r(c,{allowInput:this.trim,class:"input-yarn-config",placeholder:F,disabled:!0,value:this.model.yarn_config,"onUpdate:value":i=>this.model.yarn_config=i},null)]}),r(l,{label:t("security.cluster.cluster_desc"),path:"description"},{default:()=>[r(c,{class:"input-cluster-desc",placeholder:t("security.cluster.cluster_description_tips"),value:this.model.description,"onUpdate:value":i=>this.model.description=i},null)]})]})})])}});export{ce as default};
