import{u as g,z as b,E as I,r as q,o as R,d as S,G as U,H as A,I as C,c as r,i as E}from"./index.02a17cf1.js";import{l as M}from"./lodash.3a74b132.js";import{q as $}from"./index.0bedecf2.js";import{q as P}from"./index.a4fa9a03.js";import{v as z,u as Z,e as V}from"./index.cd03a49b.js";import{M as x}from"./index.08dd828f.js";import{N as j}from"./Form.de76c832.js";import{N as l}from"./FormItem.aeb1ee46.js";import{N as f}from"./Input.59461546.js";import{N}from"./Select.51d2f90f.js";import{N as L}from"./RadioGroup.7b709552.js";import{N as O}from"./Space.8a344b95.js";import{N as _}from"./Radio.4578e023.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./index.fe057c74.js";import"./Button.1b3ea9f7.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./resolve-slot.92499a18.js";import"./Modal.920fa101.js";import"./keysOf.843c523b.js";import"./Card.f8db533a.js";import"./index.5f9a33e7.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./utils.eff12f29.js";import"./index.21198e00.js";import"./format-length.a6a40b1f.js";import"./get.852d0cd9.js";import"./use-locale.47aab0f5.js";import"./use-merged-state.2bdc3563.js";import"./Suffix.62982c61.js";import"./use-compitable.cd47f4ac.js";import"./cssr.f561ccf0.js";import"./Popover.92dc7b00.js";import"./_baseMap.d8d47059.js";import"./next-frame-once.50ecadf2.js";import"./Empty.249462a1.js";import"./get-slot.eeb09d52.js";function T(){const{t:s}=g(),a=b().getUserInfo.userType==="ADMIN_USER",i={userName:"",userPassword:"",tenantId:null,email:"",queue:"",phone:"",state:1};let n;const e=I({formRef:q(),formData:{...i},saving:!1,loading:!1,queues:[],tenants:[]}),d={userName:{trigger:["input","blur"],required:!0,validator(o,t){if(!t.trim())return new Error(s("security.user.username_tips"))}},userPassword:{trigger:["input","blur"],required:!0,validator(o,t){if(!t||!/^(?![0-9]+$)(?![a-z]+$)(?![A-Z]+$)(?![`~!@#$%^&*()_\-+=<>?:"{}|,./;'\\[\]·~！@#￥%……&*（）——\-+={}|《》？：“”【】、；‘’，。、]+$)[`~!@#$%^&*()_\-+=<>?:"{}|,./;'\\[\]·~！@#￥%……&*（）——\-+={}|《》？：“”【】、；‘’，。、0-9A-Za-z]{6,22}$/.test(t))return new Error(s("security.user.user_password_tips"))}},tenantId:{trigger:["input","blur"],required:!0,validator(o,t){if(a&&!t)return new Error(s("security.user.tenant_id_tips"))}},email:{trigger:["input","blur"],required:!0,validator(o,t){if(!t)return new Error(s("security.user.email_empty_tips"));if(!/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,}$/.test(t))return new Error(s("security.user.emial_correct_tips"))}},phone:{trigger:["input","blur"],required:!1,validator(o,t){const D=new RegExp("^[1][3,4,5,6,7,8,9][0-9]{9}$");if(t&&!D.test(t))return new Error(s("security.user.phone_correct_tips"))}}},h=async()=>{const o=await P();e.queues=o.map(t=>({label:t.queueName,value:t.queueName})),e.queues.length&&(i.queue=e.queues[0].value,e.formData.queue=e.queues[0].value)},p=async()=>{const o=await $();e.tenants=o.map(t=>({label:t.tenantCode,value:t.id})),e.tenants.length&&(i.tenantId=e.tenants[0].value,e.formData.tenantId=e.tenants[0].value)},v=()=>{e.formData={...i}},y=async o=>{try{return await e.formRef.validate(),e.saving?!1:(e.saving=!0,n!==e.formData.userName&&await z({userName:e.formData.userName}),o?await Z({id:o,...e.formData}):await V(e.formData),e.saving=!1,!0)}catch{return e.saving=!1,!1}},c=o=>{e.formData={...M.exports.pick(o,["userName","tenantId","email","queue","phone","state"]),userPassword:""},n=e.formData.userName};return R(async()=>{a&&(h(),p())}),{state:e,formRules:d,IS_ADMIN:a,onReset:v,onSave:y,onSetValues:c}}function w(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!E(s)}const F={show:{type:Boolean,default:!1},currentRecord:{type:Object,default:{}}},Pe=S({name:"user-modal",props:F,emits:["cancel","update"],setup(s,u){var c;const{t:m}=g(),{state:a,IS_ADMIN:i,formRules:n,onReset:e,onSave:d,onSetValues:h}=T(),p=()=>{e(),u.emit("cancel")},v=async()=>{var t;!await d((t=s.currentRecord)==null?void 0:t.id)||(p(),u.emit("update"))},y=(c=U())==null?void 0:c.appContext.config.globalProperties.trim;return A(()=>s.show,()=>{var o;s.show&&((o=s.currentRecord)==null?void 0:o.id)&&h(s.currentRecord)}),{t:m,...C(a),IS_ADMIN:i,formRules:n,onCancel:p,onConfirm:v,trim:y}},render(s){let u,m;const{t:a}=this,{currentRecord:i}=s;return r(x,{show:this.show,title:`${a(i!=null&&i.id?"security.user.edit_user":"security.user.create_user")}`,onCancel:this.onCancel,confirmLoading:this.loading,onConfirm:this.onConfirm,confirmClassName:"btn-submit",cancelClassName:"btn-cancel"},{default:()=>[r(j,{ref:"formRef",model:this.formData,rules:this.formRules,labelPlacement:"left",labelAlign:"left",labelWidth:120},{default:()=>{var n;return[r(l,{label:a("security.user.username"),path:"userName"},{default:()=>[r(f,{allowInput:this.trim,class:"input-username",value:this.formData.userName,"onUpdate:value":e=>this.formData.userName=e,minlength:3,maxlength:39,placeholder:a("security.user.username_tips")},null)]}),!((n=this.currentRecord)!=null&&n.id)&&r(l,{label:a("security.user.user_password"),path:"userPassword"},{default:()=>[r(f,{allowInput:this.trim,class:"input-password",type:"password",value:this.formData.userPassword,"onUpdate:value":e=>this.formData.userPassword=e,placeholder:a("security.user.user_password_tips")},null)]}),this.IS_ADMIN&&r(l,{label:a("security.user.tenant_code"),path:"tenantId"},{default:()=>[r(N,{class:"select-tenant",options:this.tenants,value:this.formData.tenantId,"onUpdate:value":e=>this.formData.tenantId=e},null)]}),this.IS_ADMIN&&r(l,{label:a("security.user.queue"),path:"queue"},{default:()=>[r(N,{class:"select-queue",options:this.queues,value:this.formData.queue,"onUpdate:value":e=>this.formData.queue=e,placeholder:a("security.user.queue_tips")},null)]}),r(l,{label:a("security.user.email"),path:"email"},{default:()=>[r(f,{allowInput:this.trim,class:"input-email",value:this.formData.email,"onUpdate:value":e=>this.formData.email=e,placeholder:a("security.user.email_empty_tips")},null)]}),r(l,{label:a("security.user.phone"),path:"phone"},{default:()=>[r(f,{allowInput:this.trim,class:"input-phone",value:this.formData.phone,"onUpdate:value":e=>this.formData.phone=e,placeholder:a("security.user.phone_empty_tips")},null)]}),r(l,{label:a("security.user.state"),path:"state"},{default:()=>[r(L,{value:this.formData.state,"onUpdate:value":e=>this.formData.state=e},{default:()=>[r(O,null,{default:()=>[r(_,{value:1,class:"radio-state-enable"},w(u=this.t("security.user.enable"))?u:{default:()=>[u]}),r(_,{value:0,class:"radio-state-disable"},w(m=this.t("security.user.disable"))?m:{default:()=>[m]})]})]})]})]}})]})}});export{Pe as UserModal,Pe as default};
