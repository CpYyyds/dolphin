import{d as T,bb as L,b9 as D,ba as M,u as P,bI as B,E as q,r as $,h as o,G as A,o as F,bf as G,H as j,I as X,c as i}from"./index.02a17cf1.js";import{A as Y,d as J,q as K,s as Q,a as Z}from"./index.53d53105.js";import{r as z,S as ee,p as b,t as te,a as ae}from"./common.a16f92ec.js";import{D as oe,C as n,c as re}from"./column-width-config.03ebcd18.js";import{D as ie}from"./DownloadOutlined.bd8b049e.js";import{k as x}from"./index.8474b6bf.js";import{N as h}from"./Tooltip.76a430fa.js";import{N as g}from"./Button.1b3ea9f7.js";import{N as d}from"./Icon.0cd298dd.js";import{N as w}from"./Space.8a344b95.js";import{N as le}from"./Spin.4db05d4b.js";import{u as se}from"./index.9b0cc109.js";import{L as ne,q as ce}from"./index.61e15cc7.js";import{u as me}from"./ui-setting.7e6814b1.js";import{C as I}from"./index.ef447d1d.js";import{t as pe}from"./tableTotalCount.3d973079.js";import{S as ue}from"./SearchOutlined.280f9205.js";import{N as S}from"./Input.59461546.js";import{N as de}from"./Select.51d2f90f.js";import{N as fe}from"./DatePicker.d4b2a484.js";import{N as he,a as ge}from"./DataTable.ddc5a79d.js";import"./service.ade35c11.js";import"./lodash.3a74b132.js";import"./SettingOutlined.901415e1.js";import"./PauseCircleOutlined.6f50ffc5.js";import"./CloseCircleOutlined.d6e82e31.js";import"./CheckCircleOutlined.b15d9580.js";import"./EditOutlined.8be88705.js";import"./Popover.92dc7b00.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./cssr.f561ccf0.js";import"./utils.eff12f29.js";import"./format-length.a6a40b1f.js";import"./resolve-slot.92499a18.js";import"./use-merged-state.2bdc3563.js";import"./use-compitable.cd47f4ac.js";import"./next-frame-once.50ecadf2.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./get-slot.eeb09d52.js";import"./index.5f9a33e7.js";import"./index.08dd828f.js";import"./index.fe057c74.js";import"./Modal.920fa101.js";import"./keysOf.843c523b.js";import"./Card.f8db533a.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./index.21198e00.js";import"./SyncOutlined.d69d028f.js";import"./FullscreenOutlined.f113d9e5.js";import"./use-locale.47aab0f5.js";import"./throttle.1d7e3cbb.js";import"./debounce.aab20534.js";import"./toNumber.f676da43.js";import"./Suffix.62982c61.js";import"./Empty.249462a1.js";import"./typeof.481ce13f.js";import"./use-keyboard.8f9f6db8.js";import"./Forward.b8f2636c.js";import"./ArrowDown.fd6213c2.js";import"./Checkbox.c8f5c3b1.js";import"./RadioGroup.7b709552.js";import"./Radio.4578e023.js";import"./Dropdown.de4044d8.js";import"./ChevronRight.d1d16011.js";import"./Ellipsis.eed9f363.js";const ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},we=M("path",{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0 0 11.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 0 0-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 0 0-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8c4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z",fill:"currentColor"},null,-1),Ne=[we],ye=T({name:"RetweetOutlined",render:function(c,l){return L(),D("svg",ke,Ne)}}),Se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Ce=M("path",{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144s144-64.5 144-144s-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80s80 35.8 80 80s-35.8 80-80 80z",fill:"currentColor"},null,-1),Re=[Ce],ve=T({name:"SaveOutlined",render:function(c,l){return L(),D("svg",Se,Re)}});function Te(){const{t}=P(),c=B(),l=Number(c.params.projectCode),m=Number(c.params.workflowInstanceId),e=q({columns:[],tableWidth:oe,tableData:[],page:1,pageSize:10,totalCount:$(0),searchVal:null,workflowInstanceId:m||null,host:null,stateType:null,datePickerRange:null,executorName:null,workflowDefinitionName:null,totalPage:1,showModalRef:!1,row:{},loadingRef:!1,logRef:"",logLoadingRef:!0,skipLineNum:0,limit:1e3}),p=s=>{s.columns=[{title:"#",key:"index",render:(a,R)=>R+1,...n.index},{title:t("project.task.task_name"),key:"name",...n.name},{title:t("project.task.workflow_name"),key:"workflowDefinitionName",...n.name},{title:t("project.task.node_type"),key:"taskType",...n.type},{title:t("project.task.state"),key:"state",...n.state,render:a=>_e(a.state,t)},{title:t("project.task.executor"),key:"executorName",...n.name},{title:t("project.task.host"),key:"host",...n.name,render:a=>a.host||"-"},{title:t("project.task.app_id"),key:"applicationID",...n.name,render:a=>a.applicationID||"-"},{title:t("project.task.dry_run_flag"),key:"dryRun",...n.dryRun,render:a=>a.dryRun===1?"YES":"NO"},{title:t("project.task.start_time"),...n.time,key:"startTime",render:a=>z(a.startTime)},{title:t("project.task.end_time"),...n.time,key:"endTime",render:a=>z(a.endTime)},{title:t("project.task.duration"),key:"duration",...n.duration,render:a=>o("span",null,a.duration?a.duration:"-")},{title:t("project.task.operation"),key:"operation",...n.operation(5),render(a){return o(w,null,{default:()=>[o(h,{},{trigger:()=>o(g,{tag:"div",circle:!0,type:"info",size:"small",onClick:()=>C(a.id)},{icon:()=>o(d,null,{default:()=>o(ve)})}),default:()=>t("project.task.savepoint")}),o(h,{},{trigger:()=>o(g,{tag:"div",circle:!0,type:"info",size:"small",onClick:()=>u(a.id)},{icon:()=>o(d,null,{default:()=>o(ee)})}),default:()=>t("project.task.stop")}),o(h,{},{trigger:()=>o(g,{circle:!0,type:"info",size:"small",disabled:!a.host,onClick:()=>f(a)},{icon:()=>o(d,null,{default:()=>o(Y)})}),default:()=>t("project.task.view_log")}),o(h,{},{trigger:()=>o(g,{circle:!0,type:"info",size:"small",onClick:()=>J(a.id)},{icon:()=>o(d,null,{default:()=>o(ie)})}),default:()=>t("project.task.download_log")}),o(h,{},{trigger:()=>o(g,{circle:!0,type:"warning",size:"small",disabled:!0,tag:"div"},{icon:()=>o(d,null,{default:()=>o(ye)})}),default:()=>t("project.task.jump_tip")})]})}}],s.tableWidth&&(s.tableWidth=re(s.columns))},f=s=>{e.showModalRef=!0,e.row=s},r=()=>{if(e.loadingRef)return;e.loadingRef=!0;const s={pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal,workflowInstanceId:e.workflowInstanceId,host:e.host,stateType:e.stateType,startDate:e.datePickerRange?x(b(e.datePickerRange[0]),"yyyy-MM-dd HH:mm:ss"):"",endDate:e.datePickerRange?x(b(e.datePickerRange[1]),"yyyy-MM-dd HH:mm:ss"):"",executorName:e.executorName,workflowDefinitionName:e.workflowDefinitionName,taskExecuteType:"STREAM"};K(s,{projectCode:l}).then(a=>{e.totalCount=a.total,e.tableData=[...a.totalList],e.totalPage=a.totalPage}).finally(()=>e.loadingRef=!1)},u=s=>{Q(l,s).then(()=>{window.$message.success(t("project.task.success")),r()})},C=s=>{Z(l,s).then(()=>{window.$message.success(t("project.task.success")),r()})};return{t,variables:e,getTableData:r,createColumns:p}}function _e(t,c){if(!t)return"";const l=te(c)[t],m=o(d,{color:l.color,class:l.classNames,style:{display:"flex"},size:20},()=>o(l.icon));return o(h,null,{trigger:()=>l.isSpin?o(le,{size:20},{icon:()=>m}):m,default:()=>l.desc})}const At=T({name:"task-instance",setup(){var _;let t;const l=me().getLogTimer,{t:m,variables:e,getTableData:p,createColumns:f}=Te(),r=()=>{e.page=1,p()},u=()=>{e.page=1,p()},C=()=>{e.searchVal=null,u()},s=()=>{e.workflowDefinitionName=null,u()},a=()=>{e.executorName=null,u()},R=()=>{e.host=null,u()},V=()=>{e.stateType=null,u()},U=()=>{e.datePickerRange=null,u()},H=()=>{e.showModalRef=!1},N=(k,v)=>{const{state:E}=se(ce({taskInstanceId:Number(k.id),limit:e.limit,skipLineNum:e.skipLineNum}).then(y=>{e.logRef+=y.message||"",y&&y.message!==""?(e.limit+=1e3,e.skipLineNum+=y.lineNum,N(k,v)):(e.logLoadingRef=!1,setTimeout(()=>{e.logRef="",e.limit=1e3,e.skipLineNum=0,e.logLoadingRef=!0,N(k,v)},v*1e3))}),{});return E},O=k=>{e.logRef="",e.limit=1e3,e.skipLineNum=0,N(k,l)},W=(_=A())==null?void 0:_.appContext.config.globalProperties.trim;return F(()=>{f(e),p(),t=setInterval(()=>{p()},3e3)}),G(()=>{clearInterval(t)}),j(P().locale,()=>{f(e)}),j(()=>e.showModalRef,()=>{e.showModalRef?N(e.row,l):(e.row={},e.logRef="",e.logLoadingRef=!0,e.skipLineNum=0,e.limit=1e3)}),{t:m,...X(e),getTableData:p,onUpdatePageSize:r,onSearch:u,onClearSearchTaskName:C,onClearSearchWorkFlowName:s,onClearSearchExecutorName:a,onClearSearchHost:R,onClearSearchStateType:V,onClearSearchTime:U,onConfirmModal:H,refreshLogs:O,trim:W}},render(){const{t,getTableData:c,onUpdatePageSize:l,onSearch:m,onConfirmModal:e,loadingRef:p,refreshLogs:f}=this;return i(w,{vertical:!0},{default:()=>[i(I,null,{default:()=>[i(w,{justify:"end",wrap:!1},{default:()=>[i(S,{allowInput:this.trim,value:this.searchVal,"onUpdate:value":r=>this.searchVal=r,size:"small",placeholder:t("project.task.task_name"),clearable:!0,onClear:this.onClearSearchTaskName},null),i(S,{allowInput:this.trim,value:this.workflowDefinitionName,"onUpdate:value":r=>this.workflowDefinitionName=r,size:"small",placeholder:t("project.task.workflow_name"),clearable:!0,onClear:this.onClearSearchWorkFlowName},null),i(S,{allowInput:this.trim,value:this.executorName,"onUpdate:value":r=>this.executorName=r,size:"small",placeholder:t("project.task.executor"),clearable:!0,onClear:this.onClearSearchExecutorName},null),i(S,{allowInput:this.trim,value:this.host,"onUpdate:value":r=>this.host=r,size:"small",placeholder:t("project.task.host"),clearable:!0,onClear:this.onClearSearchHost},null),i(de,{value:this.stateType,"onUpdate:value":r=>this.stateType=r,size:"small",options:ae(t).slice(1),placeholder:t("project.task.state"),style:{width:"180px"},clearable:!0,onClear:this.onClearSearchStateType},null),i(fe,{value:this.datePickerRange,"onUpdate:value":r=>this.datePickerRange=r,type:"datetimerange",size:"small","start-placeholder":t("project.task.start_time"),"end-placeholder":t("project.task.end_time"),clearable:!0,onClear:this.onClearSearchTime},null),i(g,{size:"small",type:"primary",onClick:m},{default:()=>[i(d,null,{default:()=>[i(ue,null,null)]})]})]})]}),i(I,{title:t("project.task.stream_task")},{default:()=>[i(w,{vertical:!0},{default:()=>[i(he,{loading:p,columns:this.columns,data:this.tableData,scrollX:this.tableWidth},null),i(w,{justify:"center"},{default:()=>[i(ge,{page:this.page,"onUpdate:page":r=>this.page=r,"page-size":this.pageSize,"onUpdate:page-size":r=>this.pageSize=r,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:c,onUpdatePageSize:l,itemCount:this.totalCount,prefix:pe},null)]})]})]}),i(ne,{showModalRef:this.showModalRef,logRef:this.logRef,row:this.row,logLoadingRef:this.logLoadingRef,onConfirmModal:e,onRefreshLogs:f},null)]})}});export{At as default};
