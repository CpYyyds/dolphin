import{M as R}from"./index.08dd828f.js";import{bw as b,by as M,u as w,z as I,E as N,r as u,d as x,G as v,H as g,I as U,c as r}from"./index.02a17cf1.js";import{u as T}from"./index.9b0cc109.js";import{l as E}from"./index.cd03a49b.js";import{s as m}from"./service.ade35c11.js";import{k as h}from"./index.8474b6bf.js";import{b as _,N as S}from"./DatePicker.d4b2a484.js";import{R as D}from"./ReloadOutlined.809168a4.js";import{N as A}from"./Form.de76c832.js";import{N as y}from"./FormItem.aeb1ee46.js";import{N as G}from"./Select.51d2f90f.js";import{N as L}from"./Space.8a344b95.js";import{N as C}from"./Input.59461546.js";import{N as H}from"./Button.1b3ea9f7.js";import{N as O}from"./Icon.0cd298dd.js";function q(e,s){b(2,arguments);var o=M(s);return _(e,-o)}function ae(e){return m({url:"/access-tokens",method:"get",params:e})}function F(e){return m({url:"/access-tokens",method:"post",data:e})}function V(e){return m({url:`/access-tokens/${e.id}`,method:"put",data:e})}function ie(e){return m({url:`/access-tokens/${e}`,method:"delete",params:{id:e}})}function j(e){return m({url:"/access-tokens/generate",method:"post",data:e})}function P(e,s){const{t:o}=w(),a=I(),t=N({alertGroupFormRef:u(),model:{id:u(-1),userId:u(a.getUserInfo.userType==="GENERAL_USER"?a.getUserInfo.id:null),expireTime:u(Date.now()),token:u(""),generalOptions:[]},saving:!1,rules:{userId:{required:!0,trigger:["input","blur"],validator(){if(!t.model.userId)return new Error(o("security.token.user_tips"))}},expireTime:{required:!0,trigger:["input","blur"],validator(){if(!t.model.expireTime)return new Error(o("security.token.expiration_time_tips"))}},token:{required:!0,trigger:["input","blur"],validator(){if(t.model.token==="")return new Error(o("security.token.token_tips"))}}}}),c=()=>{const{state:n}=T(E().then(l=>{t.model.generalOptions=l.map(d=>({label:d.userName,value:d.id}))}),{});return n},f=()=>{const n={userId:a.getUserInfo.id,expireTime:h(t.model.expireTime,"yyyy-MM-dd HH:mm:ss")};T(j(n).then(l=>{t.model.token=l}),{})},i=async n=>{if(await t.alertGroupFormRef.validate(),!t.saving){t.saving=!0;try{n===0?await k():await p(),t.saving=!1}catch{t.saving=!1}}},k=()=>{const n={userId:Number(t.model.userId),expireTime:h(t.model.expireTime,"yyyy-MM-dd HH:mm:ss"),token:t.model.token};F(n).then(()=>{t.model.userId=a.getUserInfo.userType==="GENERAL_USER"?a.getUserInfo.id:null,t.model.expireTime=Date.now(),t.model.token="",s.emit("confirmModal",e.showModalRef)})},p=()=>{const n={id:t.model.id,userId:Number(t.model.userId),expireTime:h(t.model.expireTime,"yyyy-MM-dd HH:mm:ss"),token:t.model.token};V(n).then(()=>{s.emit("confirmModal",e.showModalRef)})};return{variables:t,handleValidate:i,getListData:c,getToken:f}}const z=x({name:"TokenModal",props:{showModalRef:{type:Boolean,default:!1},statusRef:{type:Number,default:0},row:{type:Object,default:{}}},emits:["cancelModal","confirmModal"],setup(e,s){var d;const{variables:o,handleValidate:a,getListData:t,getToken:c}=P(e,s),{t:f}=w(),i=I(),k=()=>{e.statusRef===0?(o.model.userId=i.getUserInfo.userType==="GENERAL_USER"?i.getUserInfo.id:null,o.model.expireTime=Date.now(),o.model.token=""):(o.model.userId=e.row.userId,o.model.expireTime=new Date(e.row.expireTime).getTime(),o.model.token=e.row.token),s.emit("cancelModal",e.showModalRef)},p=()=>{a(e.statusRef)},n=()=>{e.statusRef!==0&&(o.model.token="")},l=(d=v())==null?void 0:d.appContext.config.globalProperties.trim;return g(()=>e.showModalRef,()=>{e.showModalRef&&i.getUserInfo.userType!=="GENERAL_USER"&&t()}),g(()=>e.statusRef,()=>{e.statusRef===0?(o.model.userId=i.getUserInfo.userType==="GENERAL_USER"?i.getUserInfo.id:null,o.model.expireTime=Date.now(),o.model.token=""):(o.model.id=e.row.id,o.model.userId=e.row.userId,o.model.expireTime=new Date(e.row.expireTime).getTime(),o.model.token=e.row.token)}),g(()=>e.row,()=>{o.model.id=e.row.id,o.model.userId=e.row.userId,o.model.expireTime=new Date(e.row.expireTime).getTime(),o.model.token=e.row.token}),{t:f,...U(o),cancelModal:k,confirmModal:p,getToken:c,changeUser:n,userStore:i,trim:l}},render(){const{t:e,getToken:s,changeUser:o,userStore:a}=this;return r("div",null,[r(R,{title:this.statusRef===0?e("security.token.create_token"):e("security.token.edit_token"),show:this.showModalRef,onCancel:this.cancelModal,onConfirm:this.confirmModal,confirmDisabled:!this.model.userId||!this.model.expireTime||!this.model.token,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>r(A,{model:this.model,rules:this.rules,ref:"alertGroupFormRef"},{default:()=>[r(y,{label:e("security.token.expiration_time"),path:"expireTime"},{default:()=>[r(S,{"is-date-disabled":t=>t<q(new Date,1),style:{width:"100%"},type:"datetime",clearable:!0,value:this.model.expireTime,"onUpdate:value":t=>this.model.expireTime=t},null)]}),a.getUserInfo.userType!=="GENERAL_USER"&&r(y,{label:e("security.token.user"),path:"userId"},{default:()=>[r(G,{class:"input-username",filterable:!0,placeholder:e("security.token.user_tips"),options:this.model.generalOptions,value:this.model.userId,"onUpdate:value":t=>this.model.userId=t,onUpdateValue:o},null)]}),r(y,{label:e("security.token.token"),path:"token"},{default:()=>[r(L,null,{default:()=>[r(C,{allowInput:this.trim,class:"input-token",style:{width:"504px"},disabled:!0,placeholder:e("security.token.token_tips"),value:this.model.token,"onUpdate:value":t=>this.model.token=t},null),r(H,{class:"btn-generate-token",strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>s()},{icon:()=>r(O,null,{default:()=>[r(D,null,null)]})})]})]})]})})])}}),le=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"}));export{z as T,ie as d,ae as q,le as t};
