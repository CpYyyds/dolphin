import{M as E}from"./index.08dd828f.js";import{d as R,bI as _,u as k,r as y,cj as T,G as O,o as S,H as U,c as t,i as C}from"./index.02a17cf1.js";import{v as F}from"./index.9cbc470c.js";/* empty css                 */import{N as P}from"./DynamicInput.728c18a6.js";import{N as D}from"./Form.de76c832.js";import{N as n}from"./FormItem.aeb1ee46.js";import{N as p}from"./Input.59461546.js";import{N as x}from"./Switch.a01ace9e.js";import{N as V}from"./InputNumber.cad532d0.js";import{N as d}from"./Select.51d2f90f.js";import{N as G,a as s}from"./Grid.1918be0a.js";import{a as N}from"./Checkbox.c8f5c3b1.js";import"./index.fe057c74.js";import"./Button.1b3ea9f7.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./resolve-slot.92499a18.js";import"./Modal.920fa101.js";import"./keysOf.843c523b.js";import"./Card.f8db533a.js";import"./index.5f9a33e7.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./utils.eff12f29.js";import"./index.21198e00.js";import"./Space.8a344b95.js";import"./get-slot.eeb09d52.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./lodash.3a74b132.js";import"./use-merged-state.2bdc3563.js";import"./use-locale.47aab0f5.js";import"./Add.a9b5dac9.js";import"./ButtonGroup.1b8a381d.js";import"./ArrowDown.fd6213c2.js";import"./format-length.a6a40b1f.js";import"./get.852d0cd9.js";import"./Suffix.62982c61.js";import"./use-compitable.cd47f4ac.js";import"./cssr.f561ccf0.js";import"./Popover.92dc7b00.js";import"./_baseMap.d8d47059.js";import"./next-frame-once.50ecadf2.js";import"./Empty.249462a1.js";function w(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!C(u)}const M={visible:{type:Boolean,default:!1},definition:{type:Object,default:void 0},instance:{type:Object,default:void 0}},xe=R({name:"dag-save-modal",props:M,emits:["update:show","save"],setup(u,m){var b;const I=_(),{t:l}=k(),L=Number(I.params.projectCode),a=y({name:"",description:"",executionType:"PARALLEL",timeoutFlag:!1,timeout:0,globalParams:[],release:!1,sync:!1}),c=y(),j={name:{required:!0,message:l("project.dag.dag_name_empty")},timeout:{validator(){if(a.value.timeoutFlag&&!T.test(String(a.value.timeout)))return new Error(l("project.dag.positive_integer"))}},globalParams:{validator(){const o=new Set,r=a.value.globalParams.map(i=>i.key);if(new Set(r).size!==r.length)return new Error(l("project.dag.prop_repeat"));for(const i of a.value.globalParams){const g=i.value;if(i.direct==="IN"&&!g)return new Error(l("project.dag.prop_empty"));o.add(g)}}}},h=()=>{c.value.validate(async o=>{var r,e;if(!o){const i={name:a.value.name,code:(r=u.definition)==null?void 0:r.workflowDefinition.code};((e=u.definition)==null?void 0:e.workflowDefinition.name)!==a.value.name?F(i,L).then(()=>m.emit("save",a.value)):m.emit("save",a.value)}})},A=()=>{m.emit("update:show",!1)},v=()=>{var r;const o=(r=u.definition)==null?void 0:r.workflowDefinition;o&&(a.value.name=o.name,a.value.description=o.description,a.value.executionType=o.executionType||"PARALLEL",o.timeout&&o.timeout>0&&(a.value.timeoutFlag=!0,a.value.timeout=o.timeout),a.value.globalParams=o.globalParamList.map(e=>({key:e.prop,value:e.value,direct:e.direct,type:e.type})))},f=(b=O())==null?void 0:b.appContext.config.globalProperties.trim;return S(()=>v()),U(()=>{var o;return(o=u.definition)==null?void 0:o.workflowDefinition},()=>v()),()=>{let o,r;return t(E,{show:u.visible,title:l("project.dag.basic_info"),onConfirm:h,onCancel:A,autoFocus:!1},{default:()=>[t(D,{model:a.value,rules:j,ref:c},{default:()=>[t(n,{label:l("project.node.workflow_name"),path:"name"},{default:()=>[t(p,{allowInput:f,value:a.value.name,"onUpdate:value":e=>a.value.name=e,class:"input-name"},null)]}),t(n,{label:l("project.dag.description"),path:"description"},{default:()=>[t(p,{allowInput:f,type:"textarea",value:a.value.description,"onUpdate:value":e=>a.value.description=e,class:"input-description"},null)]}),t(n,{label:l("project.dag.timeout_alert"),path:"timeoutFlag"},{default:()=>[t(x,{value:a.value.timeoutFlag,"onUpdate:value":e=>a.value.timeoutFlag=e},null)]}),a.value.timeoutFlag&&t(n,{showLabel:!1,path:"timeout"},{default:()=>[t(V,{value:a.value.timeout,"onUpdate:value":e=>a.value.timeout=e,"show-button":!1,min:0},{suffix:()=>l("project.dag.minute")})]}),!u.instance&&t(n,{label:l("project.dag.workflow_execute_type"),path:"executionType"},{default:()=>[t(d,{options:[{value:"PARALLEL",label:l("project.dag.parallel")},{value:"SERIAL_WAIT",label:l("project.dag.serial_wait")},{value:"SERIAL_DISCARD",label:l("project.dag.serial_discard")},{value:"SERIAL_PRIORITY",label:l("project.dag.serial_priority")}],value:a.value.executionType,"onUpdate:value":e=>a.value.executionType=e},null)]}),t(n,{label:l("project.dag.global_variables"),path:"globalParams"},{default:()=>[t(P,{value:a.value.globalParams,"onUpdate:value":e=>a.value.globalParams=e,onCreate:()=>({key:"",direct:"IN",type:"VARCHAR",value:""}),class:"input-global-params"},{default:e=>t(G,{xGap:12,cols:24},{default:()=>[t(s,{span:6},{default:()=>[t(p,{value:e.value.key,"onUpdate:value":i=>e.value.key=i,placeholder:l("project.dag.key")},null)]}),t(s,{span:5},{default:()=>[t(d,{options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],value:e.value.direct,"onUpdate:value":i=>e.value.direct=i,defaultValue:"IN"},null)]}),t(s,{span:7},{default:()=>[t(d,{options:[{value:"VARCHAR",label:"VARCHAR"},{value:"INTEGER",label:"INTEGER"},{value:"LONG",label:"LONG"},{value:"FLOAT",label:"FLOAT"},{value:"DOUBLE",label:"DOUBLE"},{value:"DATE",label:"DATE"},{value:"TIME",label:"TIME"},{value:"BOOLEAN",label:"BOOLEAN"},{value:"LIST",label:"LIST"},{value:"FILE",label:"FILE"}],value:e.value.type,"onUpdate:value":i=>e.value.type=i,defaultValue:"VARCHAR"},null)]}),t(s,{span:6},{default:()=>[t(p,{value:e.value.value,"onUpdate:value":i=>e.value.value=i,placeholder:l("project.dag.value")},null)]})]})})]}),u.definition&&!u.instance&&t(n,{path:"timeoutFlag",showLabel:!1},{default:()=>[t(N,{checked:a.value.release,"onUpdate:checked":e=>a.value.release=e},w(o=l("project.dag.online_directly"))?o:{default:()=>[o]})]}),u.instance&&t(n,{path:"sync",showLabel:!1},{default:()=>[t(N,{checked:a.value.sync,"onUpdate:checked":e=>a.value.sync=e},w(r=l("project.dag.update_directly"))?r:{default:()=>[r]})]})]})]})}}});export{xe as default};
