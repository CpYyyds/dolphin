import{u as z,z as T,r as U,o as N,H as _,h as r,E as I,d as R,G as b,I as P,c as a,i as v}from"./index.02a17cf1.js";import{D as L,C as u,c as O}from"./column-width-config.03ebcd18.js";import{N as D}from"./Dropdown.de4044d8.js";import{U as j,K as A}from"./UserOutlined.9c056eb8.js";import{E}from"./EditOutlined.8be88705.js";import{D as V}from"./DeleteOutlined.d3b97bbb.js";import{d as H}from"./Select.51d2f90f.js";import{N as y}from"./Tooltip.76a430fa.js";import{N as c}from"./Button.1b3ea9f7.js";import{N as h}from"./Icon.0cd298dd.js";import{N as W}from"./Popconfirm.98866df0.js";import{N as m}from"./Space.8a344b95.js";import{q,f as x}from"./index.cd03a49b.js";import{p as w}from"./common.a16f92ec.js";import{k as M}from"./index.8474b6bf.js";import{UserModal as G}from"./user-detail-modal.2bdb781e.js";import{AuthorizeModal as B}from"./authorize-modal.8530bcf8.js";import{PasswordModal as K}from"./password-modal.0a8a42ea.js";import{C}from"./index.ef447d1d.js";import{S as F}from"./index.0da29625.js";import{S as X}from"./SearchOutlined.280f9205.js";import{N as $,a as J}from"./DataTable.ddc5a79d.js";import"./lodash.3a74b132.js";import"./Popover.92dc7b00.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./cssr.f561ccf0.js";import"./utils.eff12f29.js";import"./format-length.a6a40b1f.js";import"./resolve-slot.92499a18.js";import"./use-merged-state.2bdc3563.js";import"./use-compitable.cd47f4ac.js";import"./next-frame-once.50ecadf2.js";import"./ChevronRight.d1d16011.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./use-keyboard.8f9f6db8.js";import"./use-locale.47aab0f5.js";import"./use-form-item.96cfc8ba.js";import"./Empty.249462a1.js";import"./index.5f9a33e7.js";import"./Suffix.62982c61.js";import"./index.21198e00.js";import"./is-browser.e7afaa57.js";import"./keysOf.843c523b.js";import"./get-slot.eeb09d52.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./SettingOutlined.901415e1.js";import"./PauseCircleOutlined.6f50ffc5.js";import"./CloseCircleOutlined.d6e82e31.js";import"./CheckCircleOutlined.b15d9580.js";import"./index.0bedecf2.js";import"./index.a4fa9a03.js";import"./index.08dd828f.js";import"./index.fe057c74.js";import"./Modal.920fa101.js";import"./Card.f8db533a.js";import"./Form.de76c832.js";import"./FormItem.aeb1ee46.js";import"./Input.59461546.js";import"./RadioGroup.7b709552.js";import"./Radio.4578e023.js";import"./index.d2c86bbc.js";import"./index.2cf2fa64.js";import"./index.747658f4.js";import"./index.module.d033057f.js";import"./Checkbox.c8f5c3b1.js";import"./ArrowDown.fd6213c2.js";import"./Ellipsis.eed9f363.js";import"./Forward.b8f2636c.js";function Q(t){const{t:e}=z(),d=T().getUserInfo.userType==="ADMIN_USER",p=U({columns:[],tableWidth:L}),n=()=>{const o=[{title:"#",key:"index",render:(i,s)=>s+1,...u.index},{title:e("security.user.username"),key:"userName",className:"name",...u.userName},{title:e("security.user.user_type"),key:"userType",render:i=>i.userType==="GENERAL_USER"?e("security.user.ordinary_user"):e("security.user.administrator"),...u.type},{title:e("security.user.tenant_code"),key:"tenantCode",...u.name},{title:e("security.user.queue"),key:"queue",width:120},{title:e("security.user.email"),key:"email",...u.name},{title:e("security.user.phone"),key:"phone",width:140},{title:e("security.user.state"),key:"state",...u.state,render:(i,s)=>r(H,{type:i.state===1?"success":"error"},{default:()=>e(`security.user.state_${i.state===1?"enabled":"disabled"}`)})},{title:e("security.user.create_time"),key:"createTime",...u.time},{title:e("security.user.update_time"),key:"updateTime",...u.time},{title:e("security.user.operation"),key:"operation",...u.operation(4),render:(i,s)=>r(m,null,{default:()=>[r(D,{trigger:"click",options:[{label:e("security.user.project"),key:"authorize_project"},{label:e("security.user.datasource"),key:"authorize_datasource"},{label:e("security.user.namespace"),key:"authorize_namespace"}],onSelect:g=>void t({rowData:i,key:g},"authorize")},()=>r(y,{trigger:"hover"},{trigger:()=>r(c,{circle:!0,type:"info",size:"small",class:"authorize"},{icon:()=>r(h,null,()=>r(j))}),default:()=>e("security.user.authorize")})),r(y,{trigger:"hover"},{trigger:()=>r(c,{circle:!0,type:"info",size:"small",class:"edit",onClick:()=>void t({rowData:i},"edit")},()=>r(h,null,()=>r(E))),default:()=>e("security.user.edit")}),d&&r(y,{trigger:"hover"},{trigger:()=>r(c,{circle:!0,type:"error",size:"small",class:"edit",onClick:()=>void t({rowData:i},"resetPassword")},()=>r(h,null,()=>r(A))),default:()=>e("security.user.reset_password")}),r(W,{onPositiveClick:()=>void t({rowData:i},"delete")},{trigger:()=>r(y,{},{trigger:()=>r(c,{circle:!0,type:"error",size:"small",class:"delete"},{icon:()=>r(h,null,{default:()=>r(V)})}),default:()=>e("security.user.delete")}),default:()=>e("security.user.delete_confirm")})]})}];p.value={columns:o,tableWidth:O(o)}};return N(()=>{n()}),_(z().locale,()=>{n()}),{columnsRef:p,createColumns:n}}function Y(){const t=I({page:1,pageSize:10,itemCount:0,searchVal:"",list:[],loading:!1,currentRecord:{},authorizeType:"authorize_project",detailModalShow:!1,authorizeModalShow:!1,passwordModalShow:!1}),e=async()=>{if(t.loading)return;t.loading=!0;const{totalList:o,total:i}=await q({pageNo:t.page,pageSize:t.pageSize,searchVal:t.searchVal});if(t.loading=!1,!o)throw Error();t.list=o.map(s=>(s.createTime=s.createTime?M(w(s.createTime),"yyyy-MM-dd HH:mm:ss"):"",s.updateTime=s.updateTime?M(w(s.updateTime),"yyyy-MM-dd HH:mm:ss"):"",s.tenantId=s.tenantId===0?null:s.tenantId,s)),t.itemCount=i},l=()=>{t.list.length===1&&t.page>1&&--t.page,e()},f=async o=>{await x({id:o}),l()},d=(o,i)=>{t.currentRecord=o.rowData,i==="edit"&&(t.detailModalShow=!0),i==="authorize"&&o.key&&(t.authorizeModalShow=!0,t.authorizeType=o.key),i==="delete"&&f(o.rowData.id),i==="resetPassword"&&(t.passwordModalShow=!0)},p=o=>{t.page=o,e()},n=o=>{t.page=1,t.pageSize=o,e()};return N(()=>{e()}),{state:t,changePage:p,changePageSize:n,updateList:l,onOperationClick:d}}function Z(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!v(t)}const Mt=R({name:"user-manage",setup(){var S;const{t}=z(),{state:e,changePage:l,changePageSize:f,updateList:d,onOperationClick:p}=Y(),{columnsRef:n}=Q(p),o=()=>{e.detailModalShow=!0,e.currentRecord=null},i=()=>{e.detailModalShow=!1},s=()=>{e.authorizeModalShow=!1},g=()=>{e.passwordModalShow=!1},k=(S=b())==null?void 0:S.appContext.config.globalProperties.trim;return{t,columnsRef:n,...P(e),changePage:l,changePageSize:f,onAddUser:o,onUpdatedList:d,onDetailModalCancel:i,onAuthorizeModalCancel:s,onPasswordModalCancel:g,trim:k}},render(){let t;return a(m,{vertical:!0},{default:()=>{var e;return[a(C,null,{default:()=>[a(m,{justify:"space-between"},{default:()=>[a(c,{onClick:this.onAddUser,type:"primary",class:"btn-create-user",size:"small"},Z(t=this.t("security.user.create_user"))?t:{default:()=>[t]}),a(m,null,{default:()=>[a(F,{value:this.searchVal,"onUpdate:value":l=>this.searchVal=l,onSearch:this.onUpdatedList},null),a(c,{type:"primary",size:"small",onClick:this.onUpdatedList},{default:()=>[a(h,null,{default:()=>[a(X,null,null)]})]})]})]})]}),a(C,{title:this.t("menu.user_manage")},{default:()=>[a(m,{vertical:!0},{default:()=>[a($,{"row-class-name":"items",columns:this.columnsRef.columns,data:this.list,loading:this.loading,scrollX:this.columnsRef.tableWidth},null),a(m,{justify:"center"},{default:()=>[a(J,{page:this.page,"onUpdate:page":l=>this.page=l,"page-size":this.pageSize,"onUpdate:page-size":l=>this.pageSize=l,"item-count":this.itemCount,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,"on-update:page":this.changePage,"on-update:page-size":this.changePageSize},null)]})]})]}),a(G,{show:this.detailModalShow,currentRecord:this.currentRecord,onCancel:this.onDetailModalCancel,onUpdate:this.onUpdatedList},null),a(B,{show:this.authorizeModalShow,type:this.authorizeType,userId:(e=this.currentRecord)==null?void 0:e.id,onCancel:this.onAuthorizeModalCancel},null),a(K,{show:this.passwordModalShow,currentRecord:this.currentRecord,onCancel:this.onPasswordModalCancel},null)]}})}});export{Mt as default};
