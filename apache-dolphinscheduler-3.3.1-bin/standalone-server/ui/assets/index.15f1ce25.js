import{u as R,h as G,E as N,r as m,d as U,bH as M,G as L,o as H,I as O,c as a}from"./index.02a17cf1.js";import{d as j,b as z}from"./index.a8939d99.js";import x from"./table-action.ec3d631d.js";import{_ as Q}from"./lodash.3a74b132.js";import{C as n,c as W,D as B}from"./column-width-config.03ebcd18.js";import{p as w}from"./common.a16f92ec.js";import{k as P}from"./index.8474b6bf.js";import F from"./form-modal.0dac2b89.js";import{C as q}from"./index.ef447d1d.js";import{S}from"./index.0da29625.js";import{S as A}from"./SearchOutlined.280f9205.js";import{N as _}from"./Space.8a344b95.js";import{N as E}from"./Select.51d2f90f.js";import{N as V}from"./Button.1b3ea9f7.js";import{N as X}from"./Icon.0cd298dd.js";import{N as J,a as K}from"./DataTable.ddc5a79d.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./EditOutlined.8be88705.js";import"./PlayCircleOutlined.66fb9fb6.js";import"./Tooltip.76a430fa.js";import"./Popover.92dc7b00.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./cssr.f561ccf0.js";import"./utils.eff12f29.js";import"./format-length.a6a40b1f.js";import"./resolve-slot.92499a18.js";import"./use-merged-state.2bdc3563.js";import"./use-compitable.cd47f4ac.js";import"./next-frame-once.50ecadf2.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./get-slot.eeb09d52.js";import"./index.5f9a33e7.js";import"./SettingOutlined.901415e1.js";import"./PauseCircleOutlined.6f50ffc5.js";import"./CloseCircleOutlined.d6e82e31.js";import"./CheckCircleOutlined.b15d9580.js";import"./index.08dd828f.js";import"./index.fe057c74.js";import"./Modal.920fa101.js";import"./keysOf.843c523b.js";import"./Card.f8db533a.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./index.21198e00.js";import"./Form.de76c832.js";import"./FormItem.aeb1ee46.js";import"./Input.59461546.js";import"./use-locale.47aab0f5.js";import"./Suffix.62982c61.js";import"./Empty.249462a1.js";import"./ArrowDown.fd6213c2.js";import"./Checkbox.c8f5c3b1.js";import"./RadioGroup.7b709552.js";import"./Radio.4578e023.js";import"./Dropdown.de4044d8.js";import"./ChevronRight.d1d16011.js";import"./use-keyboard.8f9f6db8.js";import"./Ellipsis.eed9f363.js";import"./Forward.b8f2636c.js";function T(l=(e,c)=>{},d=()=>{}){const{t:e}=R(),c=[{title:"#",key:"index",render:(i,o)=>o+1,...n.index},{title:e("resource.task_group_queue.project_name"),key:"projectName",...n.name},{title:e("resource.task_group_queue.task_name"),key:"taskName",...n.name},{title:e("resource.task_group_queue.workflow_instance_name"),key:"workflowInstanceName",...n.name},{title:e("resource.task_group_queue.task_group_name"),key:"taskGroupName",...n.name},{title:e("resource.task_group_queue.priority"),key:"priority",width:120},{title:e("resource.task_group_queue.force_starting_status"),key:"forceStart",...n.state},{title:e("resource.task_group_queue.in_queue"),key:"inQueue",width:120},{title:e("resource.task_group_queue.task_status"),key:"status",...n.state},{title:e("resource.task_group_queue.create_time"),key:"createTime",...n.time},{title:e("resource.task_group_queue.update_time"),key:"updateTime",...n.time},{title:e("resource.task_group_queue.actions"),key:"actions",...n.operation(2),render:i=>G(x,{row:i,onResetTableData:()=>{t.page>1&&t.tableData.length===1&&(t.page-=1),d()},onUpdatePriority:(o,s)=>{l(o,s)}})}],t=N({tableData:[],tableWidth:W(c)||B,page:m(1),pageSize:m(10),groupId:m(3),totalPage:m(1),loadingRef:m(!1)});return{getTableData:i=>{if(t.loadingRef)return;t.loadingRef=!0;const o={pageNo:1,pageSize:2147483647};Promise.all([j(i),z(o)]).then(s=>{const p=s[1].totalList;t.totalPage=s[0].totalPage,t.tableData=s[0].totalList.map((u,f)=>{let r="";if(p){const k=Q.find(p,{id:u.groupId});k&&(r=k.name)}return u.taskGroupName=r,u.createTime=P(w(u.createTime),"yyyy-MM-dd HH:mm:ss"),u.updateTime=P(w(u.updateTime),"yyyy-MM-dd HH:mm:ss"),{...u}})},()=>{}),t.loadingRef=!1},variables:t,columns:c}}const nt=U({name:"taskGroupQueue",setup(){var I;const l=M(),{t:d}=R(),{variables:e,getTableData:c}=T(),t=m(!1),g=m([]),i=m(Number(l.currentRoute.value.params.id)),o=N({groupId:m(),workflowInstanceName:"",instanceName:"",pageSize:10,pageNo:1});let s=N({queueId:0,priority:0});const p=()=>{c({pageSize:e.pageSize,pageNo:e.page,groupId:o.groupId,taskInstanceName:o.instanceName,workflowInstanceName:o.workflowInstanceName})},u=()=>{t.value=!1},f=()=>{t.value=!1,s={queueId:0,priority:0},p()},r=()=>{e.page=1,p()},k=(h,y)=>{t.value=!0,s.queueId=h,s.priority=y},v=()=>{p()},D=(I=L())==null?void 0:I.appContext.config.globalProperties.trim;return H(()=>{const h={pageNo:1,pageSize:2147483647};i.value&&(o.groupId=i.value),z(h).then(y=>{y.totalList.map(b=>{const C={label:b.name,value:b.id};g.value.push(C)})}),p()}),{...O(e),t:d,onSearch:v,searchParamRef:o,resetTableData:p,onUpdatePageSize:r,updatePriority:k,onCancel:u,onConfirm:f,showModalRef:t,updateItemData:s,taskGroupOptions:g,trim:D}},render(){const{t:l,resetTableData:d,onUpdatePageSize:e,updatePriority:c,onCancel:t,onConfirm:g,onSearch:i,showModalRef:o,updateItemData:s,taskGroupOptions:p,loadingRef:u}=this,{columns:f}=T(c,d);return a(_,{vertical:!0},{default:()=>[a(q,null,{default:()=>[a(_,{justify:"end"},{default:()=>[a(E,{size:"small",options:p,clearable:!0,style:{width:"180px"},value:this.searchParamRef.groupId,"onUpdate:value":r=>this.searchParamRef.groupId=r,placeholder:l("resource.task_group_queue.task_group_name")},null),a(S,{value:this.searchParamRef.workflowInstanceName,"onUpdate:value":r=>this.searchParamRef.workflowInstanceName=r,placeholder:l("resource.task_group_queue.workflow_instance_name"),onSearch:i},null),a(S,{value:this.searchParamRef.instanceName,"onUpdate:value":r=>this.searchParamRef.instanceName=r,placeholder:l("resource.task_group_queue.task_instance_name"),onSearch:i},null),a(V,{size:"small",type:"primary",onClick:i},{default:()=>[a(X,null,{default:()=>[a(A,null,null)]})]})]})]}),a(q,{title:l("resource.task_group_queue.queue")},{default:()=>[a(_,{vertical:!0},{default:()=>[a(J,{loading:u,columns:f,size:"small",data:this.tableData,striped:!0,scrollX:this.tableWidth},null),a(_,{justify:"center"},{default:()=>[a(K,{page:this.page,"onUpdate:page":r=>this.page=r,"page-size":this.pageSize,"onUpdate:page-size":r=>this.pageSize=r,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:d,onUpdatePageSize:e},null)]})]})]}),o&&a(F,{show:o,onCancel:t,onConfirm:g,data:s},null)]})}});export{nt as default};
