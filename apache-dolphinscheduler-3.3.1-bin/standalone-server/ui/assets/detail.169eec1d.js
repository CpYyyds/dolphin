import{u as T,E as Y,d as Q,G as W,H as E,I as R,c as t,J as o,K as X,L as l,i as Z}from"./index.02a17cf1.js";import{M as ee}from"./index.08dd828f.js";import{u as ae,s as C,d as P}from"./index.module.ff725d2f.js";import{q as te,c as re,v as se,u as oe,a as le}from"./index.2cf2fa64.js";import{N as ue}from"./Spin.4db05d4b.js";import{N as ne}from"./Form.de76c832.js";import{N as s}from"./FormItem.aeb1ee46.js";import{N as u}from"./Input.59461546.js";import{N as ie}from"./InputNumber.cad532d0.js";import{N as de}from"./Select.51d2f90f.js";import{N as pe}from"./RadioGroup.7b709552.js";import{N as D}from"./Radio.4578e023.js";import{N as ce}from"./Space.8a344b95.js";import{N as me}from"./Button.1b3ea9f7.js";import"./index.fe057c74.js";import"./Modal.920fa101.js";import"./keysOf.843c523b.js";import"./Card.f8db533a.js";import"./resolve-slot.92499a18.js";import"./index.5f9a33e7.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./utils.eff12f29.js";import"./is-browser.e7afaa57.js";import"./index.21198e00.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./lodash.3a74b132.js";import"./use-compitable.cd47f4ac.js";import"./use-form-item.96cfc8ba.js";import"./format-length.a6a40b1f.js";import"./get.852d0cd9.js";import"./use-locale.47aab0f5.js";import"./use-merged-state.2bdc3563.js";import"./Suffix.62982c61.js";import"./Add.a9b5dac9.js";import"./cssr.f561ccf0.js";import"./Popover.92dc7b00.js";import"./_baseMap.d8d47059.js";import"./next-frame-once.50ecadf2.js";import"./Empty.249462a1.js";import"./get-slot.eeb09d52.js";function he(n){const{t:c}=T(),a=Y({saving:!1,testing:!1,loading:!1});let e;const m=()=>{const d=n();return{...d,other:d.other?JSON.parse(d.other):null}};return{status:a,queryById:async d=>{if(a.loading)return{};a.loading=!0;const p=await te(d);return a.loading=!1,e=p.name,p},testConnect:async()=>{if(!a.testing){a.testing=!0;try{const d=await re(m());window.$message.success(d&&d.msg?d.msg:`${c("datasource.test_connect")} ${c("datasource.success")}`),a.testing=!1}catch{a.testing=!1}}},createOrUpdate:async d=>{const p=n();if(a.saving||!p.name)return!1;a.saving=!0;try{return e!==p.name&&await se({name:p.name}),d?await oe(m(),d):await le(m()),a.saving=!1,!0}catch{return a.saving=!1,!1}}}}function K(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!Z(n)}const we={show:{type:Boolean,default:!1},id:{type:Number},selectType:{type:String,default:"MYSQL"}},na=Q({name:"DetailModal",props:we,emits:["cancel","update","open"],setup(n,c){var I;const{t:a}=T(),{state:e,changeType:m,changePort:y,resetFieldsValue:f,setFieldsValue:v,getFieldsValue:d}=ae(n.id),{status:p,queryById:b,testConnect:g,createOrUpdate:k}=he(d),_=()=>{f(),c.emit("cancel")},S=async()=>{await e.detailFormRef.validate(),await k(n.id)&&(_(),c.emit("update"))},U=async()=>{await e.detailFormRef.validate(),g()},w=m,i=y,N=(I=W())==null?void 0:I.appContext.config.globalProperties.trim,A=()=>{c.emit("open")};return E(()=>n.show,async()=>{e.detailForm.type=n.selectType,e.detailForm.label=n.selectType==="HIVE"?"HIVE/IMPALA":n.selectType,n.show&&e.detailForm.type&&await m(e.detailForm.type,P[e.detailForm.type]),n.show&&n.id&&v(await b(n.id))}),E(()=>n.selectType,async()=>{e.detailForm.type=n.selectType,e.detailForm.label=n.selectType==="HIVE"?"HIVE/IMPALA":n.selectType,e.detailForm.type&&await m(e.detailForm.type,P[e.detailForm.type])}),{t:a,...R(e),...R(p),onChangeType:w,onChangePort:i,onSubmit:S,onTest:U,onCancel:_,trim:N,handleSourceModalOpen:A}},render(){const{show:n,id:c,t:a,detailForm:e,rules:m,requiredDataBase:y,showHost:f,showPort:v,showRestEndpoint:d,showAccessKeyId:p,showAccessKeySecret:b,showRegionId:g,showEndpoint:k,showAwsRegion:_,showCompatibleMode:S,showConnectType:U,showPrincipal:w,showMode:i,showDataBaseName:N,showJDBCConnectParameters:A,showPublicKey:I,showNamespace:M,showKubeConfig:F,modeOptions:O,redShiftModeOptions:L,sagemakerModeOption:V,loading:x,saving:z,testing:B,onChangePort:j,onCancel:H,onTest:$,onSubmit:G,handleSourceModalOpen:J}=this;return t(ee,{class:"dialog-create-data-source",show:n,title:`${a(c?"datasource.edit":"datasource.create")}${a("datasource.datasource")}`,onConfirm:G,confirmLoading:z||x,onCancel:H,confirmClassName:"btn-submit",cancelClassName:"btn-cancel"},{default:()=>{let h,q;return t(ue,{show:x},{default:()=>[t(ne,{rules:m,ref:"detailFormRef","require-mark-placement":"left","label-align":"left"},{default:()=>[t(s,{label:a("datasource.datasource"),path:"type","show-require-mark":!0},{default:()=>[t("div",{class:[C.typeBox,!!c&&C.disabledBox]},[o(t("div",{"onUpdate:value":r=>e.type=r},[e.label]),[[X,e.type,"value"]]),t("div",{class:[C["text-color"],"btn-data-source-type-drop-down"],onClick:J},[a("datasource.select")])])]}),t(s,{label:a("datasource.datasource_name"),path:"name","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-data-source-name",value:e.name,"onUpdate:value":r=>e.name=r,maxlength:60,placeholder:a("datasource.datasource_name_tips")},null)]}),t(s,{label:a("datasource.description"),path:"note"},{default:()=>[t(u,{class:"input-data-source-description",value:e.note,"onUpdate:value":r=>e.note=r,type:"textarea",placeholder:a("datasource.description_tips")},null)]}),o(t(s,{label:a("datasource.ip"),path:"host","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-ip",value:e.host,"onUpdate:value":r=>e.host=r,type:"text",maxlength:255,placeholder:a("datasource.ip_tips")},null)]}),[[l,f]]),o(t(s,{label:a("datasource.zeppelin_rest_endpoint"),path:"restEndPoint","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-zeppelin_rest_endpoint",value:e.restEndpoint,"onUpdate:value":r=>e.restEndpoint=r,type:"text",maxlength:255,placeholder:a("datasource.zeppelin_rest_endpoint_tips")},null)]}),[[l,d]]),o(t(s,{label:a("datasource.access_key_id"),path:"accessKeyId","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-access_key_id",value:e.accessKeyId,"onUpdate:value":r=>e.accessKeyId=r,type:"text",maxlength:255,placeholder:a("datasource.access_key_id_tips")},null)]}),[[l,p]]),o(t(s,{label:a("datasource.access_key_secret"),path:"accessKeySecret","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-access_key_secret",value:e.accessKeySecret,"onUpdate:value":r=>e.accessKeySecret=r,type:"text",maxlength:255,placeholder:a("datasource.access_key_secret_tips")},null)]}),[[l,b]]),o(t(s,{label:a("datasource.region_id"),path:"regionId","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-region_id",value:e.regionId,"onUpdate:value":r=>e.regionId=r,type:"text",maxlength:255,placeholder:a("datasource.region_id_tips")},null)]}),[[l,g]]),o(t(s,{label:a("datasource.endpoint"),path:"endpoint"},{default:()=>[t(u,{allowInput:this.trim,class:"input-endpoint",value:e.endpoint,"onUpdate:value":r=>e.endpoint=r,type:"text",maxlength:255,placeholder:a("datasource.endpoint_tips")},null)]}),[[l,k]]),o(t(s,{label:a("datasource.port"),path:"port","show-require-mark":!(i&&e.mode==="IAM-accessKey")},{default:()=>[t(ie,{class:"input-port",value:e.port,"onUpdate:value":r=>e.port=r,"show-button":!1,placeholder:a("datasource.port_tips"),"on-blur":j,style:{width:"100%"}},null)]}),[[l,v]]),o(t(s,{label:"Principal",path:"principal","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.principal,"onUpdate:value":r=>e.principal=r,type:"text",placeholder:a("datasource.principal_tips")},null)]}),[[l,w]]),o(t(s,{label:"krb5.conf",path:"javaSecurityKrb5Conf"},{default:()=>[t(u,{allowInput:this.trim,value:e.javaSecurityKrb5Conf,"onUpdate:value":r=>e.javaSecurityKrb5Conf=r,type:"text",placeholder:a("datasource.krb5_conf_tips")},null)]}),[[l,w]]),o(t(s,{label:a("datasource.validation"),path:"mode","show-require-mark":!0},{default:()=>[t(de,{value:e.mode,"onUpdate:value":r=>e.mode=r,options:e.type==="REDSHIFT"?L:e.type==="SAGEMAKER"?V:O},null)]}),[[l,i]]),o(t(s,{label:a("datasource.database_username"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",placeholder:a("datasource.database_username")},null)]}),[[l,i&&e.mode==="SqlPassword"]]),o(t(s,{label:a("datasource.database_password"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.database_password")},null)]}),[[l,i&&e.mode==="SqlPassword"]]),o(t(s,{label:a("datasource.Azure_AD_username"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",placeholder:a("datasource.Azure_AD_username")},null)]}),[[l,i&&e.mode==="ActiveDirectoryPassword"]]),o(t(s,{label:a("datasource.Azure_AD_password"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.Azure_AD_password")},null)]}),[[l,i&&e.mode==="ActiveDirectoryPassword"]]),o(t(s,{label:a("datasource.MSIClientId"),path:"MSIClientId"},{default:()=>[t(u,{allowInput:this.trim,value:e.MSIClientId,"onUpdate:value":r=>e.MSIClientId=r,type:"password",placeholder:a("datasource.MSIClientId")},null)]}),[[l,i&&e.mode==="ActiveDirectoryMSI"]]),o(t(s,{label:a("datasource.clientId"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",placeholder:a("datasource.clientId")},null)]}),[[l,i&&e.mode==="ActiveDirectoryServicePrincipal"]]),o(t(s,{label:a("datasource.clientSecret"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.clientSecret")},null)]}),[[l,i&&e.mode==="ActiveDirectoryServicePrincipal"]]),o(t(s,{label:a("datasource.clientId"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",placeholder:a("datasource.clientId")},null)]}),[[l,i&&e.mode==="accessToken"]]),o(t(s,{label:a("datasource.clientSecret"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.clientSecret")},null)]}),[[l,i&&e.mode==="accessToken"]]),o(t(s,{label:a("datasource.OAuth_token_endpoint"),path:"endpoint","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.endpoint,"onUpdate:value":r=>e.endpoint=r,type:"text",placeholder:a("datasource.OAuth_token_endpoint")},null)]}),[[l,i&&e.mode==="accessToken"]]),o(t(s,{label:a("datasource.AccessKeyID"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",maxlength:60,placeholder:a("datasource.AccessKeyID_tips")},null)]}),[[l,i&&e.mode==="IAM-accessKey"]]),o(t(s,{label:a("datasource.SecretAccessKey"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.SecretAccessKey_tips")},null)]}),[[l,i&&e.mode==="IAM-accessKey"]]),o(t(s,{label:a("datasource.dbUser"),path:"dbUser","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-dbUser",value:e.dbUser,"onUpdate:value":r=>e.dbUser=r,type:"text",placeholder:a("datasource.dbUser_tips")},null)]}),[[l,i&&e.mode==="IAM-accessKey"&&e.type!="SAGEMAKER"]]),o(t(s,{label:"keytab.username",path:"loginUserKeytabUsername"},{default:()=>[t(u,{allowInput:this.trim,value:e.loginUserKeytabUsername,"onUpdate:value":r=>e.loginUserKeytabUsername=r,type:"text",placeholder:a("datasource.keytab_username_tips")},null)]}),[[l,w]]),o(t(s,{label:"keytab.path",path:"loginUserKeytabPath"},{default:()=>[t(u,{allowInput:this.trim,value:e.loginUserKeytabPath,"onUpdate:value":r=>e.loginUserKeytabPath=r,type:"text",placeholder:a("datasource.keytab_path_tips")},null)]}),[[l,w]]),o(t(s,{label:a("datasource.user_name"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-username",value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",maxlength:60,placeholder:a("datasource.user_name_tips")},null)]}),[[l,(!i||e.mode==="password")&&e.type!="K8S"&&e.type!="ALIYUN_SERVERLESS_SPARK"]]),o(t(s,{label:a("datasource.user_password"),path:"password"},{default:()=>[t(u,{allowInput:this.trim,class:"input-password",value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.user_password_tips")},null)]}),[[l,(!i||e.mode==="password")&&e.type!="K8S"&&e.type!="ALIYUN_SERVERLESS_SPARK"]]),o(t(s,{label:a("datasource.aws_region"),path:"awsRegion","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.awsRegion,"onUpdate:value":r=>e.awsRegion=r,type:"text",maxlength:60,placeholder:a("datasource.aws_region_tips")},null)]}),[[l,_]]),o(t(s,{label:a("datasource.database_name"),path:"database","show-require-mark":y},{default:()=>[t(u,{allowInput:this.trim,class:"input-data-base",value:e.database,"onUpdate:value":r=>e.database=r,type:"text",maxlength:60,placeholder:a("datasource.database_name_tips")},null)]}),[[l,N]]),e.type==="SNOWFLAKE"&&t(s,{label:a("datasource.datawarehouse"),path:"datawarehouse","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-datawarehouse",value:e.datawarehouse,"onUpdate:value":r=>e.datawarehouse=r,maxlength:60,placeholder:a("datasource.datawarehouse_tips")},null)]}),o(t(s,{label:a("datasource.oracle_connect_type"),path:"connectType","show-require-mark":!0},{default:()=>[t(pe,{value:e.connectType,"onUpdate:value":r=>e.connectType=r},{default:()=>[t(ce,null,{default:()=>[t(D,{value:"ORACLE_SERVICE_NAME"},K(h=a("datasource.oracle_service_name"))?h:{default:()=>[h]}),t(D,{value:"ORACLE_SID"},K(q=a("datasource.oracle_sid"))?q:{default:()=>[q]})]})]})]}),[[l,U]]),o(t(s,{label:a("datasource.compatible_mode"),path:"compatibleMode","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-data-base",value:e.compatibleMode,"onUpdate:value":r=>e.compatibleMode=r,type:"text",maxlength:60,placeholder:a("datasource.compatible_mode_tips")},null)]}),[[l,S]]),o(t(s,{label:a("datasource.jdbc_connect_parameters"),path:"other"},{default:()=>[t(u,{allowInput:this.trim,class:"input-jdbc-params",value:e.other,"onUpdate:value":r=>e.other=r,type:"textarea",autosize:{minRows:2},placeholder:`${a("datasource.format_tips")} {"key1":"value1","key2":"value2"...} ${a("datasource.connection_parameter")}`},null)]}),[[l,A]]),o(t(s,{label:"PublicKey",path:"publicKey"},{default:()=>[t(u,{value:e.publicKey,"onUpdate:value":r=>e.publicKey=r,type:"textarea",autosize:{minRows:4}},null)]}),[[l,I]]),o(t(s,{label:a("datasource.kubeConfig"),path:"kubeConfig","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-kubeConfig",value:e.kubeConfig,"onUpdate:value":r=>e.kubeConfig=r,type:"textarea",autosize:{minRows:14},placeholder:a("datasource.kubeConfig_tips")},null)]}),[[l,F]]),o(t(s,{label:a("datasource.namespace"),path:"namespace","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.namespace,"onUpdate:value":r=>e.namespace=r,placeholder:a("datasource.namespace_tips")},null)]}),[[l,M]])]})]})},"btn-middle":()=>{let h;return t(me,{class:"btn-test-connection",type:"primary",size:"small",onClick:$,loading:B||x},K(h=a("datasource.test_connect"))?h:{default:()=>[h]})}})}});export{na as default};
