import{u as P,z as R,E as v,r as _,d as N,G as I,H as y,I as b,c as a}from"./index.02a17cf1.js";import{l as g}from"./lodash.3a74b132.js";import{u as D}from"./index.cd03a49b.js";import{M as S}from"./index.08dd828f.js";import{N as C}from"./Form.de76c832.js";import{N as p}from"./FormItem.aeb1ee46.js";import{N as f}from"./Input.59461546.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./index.fe057c74.js";import"./Button.1b3ea9f7.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./resolve-slot.92499a18.js";import"./Modal.920fa101.js";import"./keysOf.843c523b.js";import"./Card.f8db533a.js";import"./index.5f9a33e7.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./utils.eff12f29.js";import"./index.21198e00.js";import"./Space.8a344b95.js";import"./get-slot.eeb09d52.js";import"./format-length.a6a40b1f.js";import"./get.852d0cd9.js";import"./use-locale.47aab0f5.js";import"./use-merged-state.2bdc3563.js";import"./Suffix.62982c61.js";function U(){const{t:r}=P(),n=R().getUserInfo.userType==="ADMIN_USER",i={userName:"",userPassword:"",confirmPassword:""},s=v({formRef:_(),formData:{...i},saving:!1,loading:!1});function u(o,e){return!!s.formRef.model.userPassword&&s.formRef.model.userPassword.startsWith(e)&&s.formRef.model.userPassword.length>=e.length}function m(o,e){return e===s.formRef.model.userPassword}const l={userPassword:{trigger:["input","blur"],required:!0,validator(o,e){if(!e||!/^(?![0-9]+$)(?![a-z]+$)(?![A-Z]+$)(?![`~!@#$%^&*()_\-+=<>?:"{}|,./;'\\[\]·~！@#￥%……&*（）——\-+={}|《》？：“”【】、；‘’，。、]+$)[`~!@#$%^&*()_\-+=<>?:"{}|,./;'\\[\]·~！@#￥%……&*（）——\-+={}|《》？：“”【】、；‘’，。、0-9A-Za-z]{6,22}$/.test(e))return new Error(r("security.user.user_password_tips"))}},confirmPassword:[{trigger:["input","blur"],required:!0},{validator:u,message:r("security.user.confirm_password_tips"),trigger:["input"]},{validator:m,message:r("security.user.confirm_password_tips"),trigger:["blur","password-input"]}]};return{state:s,formRules:l,IS_ADMIN:n,onReset:()=>{s.formData={...i}},onSave:async o=>{try{if(await s.formRef.validate(),s.saving)return!1;s.saving=!0;const e={...g.exports.pick(o,["id","userName","tenantId","email","queue","phone","state"]),userPassword:s.formData.userPassword};return await D(e),s.saving=!1,!0}catch{return s.saving=!1,!1}},onSetValues:o=>{s.formData={...g.exports.pick(o,["userName"]),userPassword:"",confirmPassword:""}}}}const $={show:{type:Boolean,default:!1},currentRecord:{type:Object,default:{}}},dr=N({name:"password-modal",props:$,emits:["cancel","update"],setup(r,t){var o;const{t:c}=P(),{state:n,IS_ADMIN:i,formRules:s,onReset:u,onSave:m,onSetValues:l}=U(),d=()=>{u(),t.emit("cancel")},w=async()=>{var e;(e=r.currentRecord)!=null&&e.id&&!await m(r.currentRecord)||(d(),t.emit("update"))},h=(o=I())==null?void 0:o.appContext.config.globalProperties.trim;return y(()=>r.show,()=>{var e;r.show&&((e=r.currentRecord)==null?void 0:e.id)&&l(r.currentRecord)}),{t:c,...b(n),IS_ADMIN:i,formRules:s,onCancel:d,onConfirm:w,trim:h}},render(){const{t:r}=this;return a(S,{show:this.show,title:r("security.user.reset_password"),onCancel:this.onCancel,confirmLoading:this.loading,onConfirm:this.onConfirm,confirmClassName:"btn-submit",cancelClassName:"btn-cancel"},{default:()=>[a(C,{ref:"formRef",model:this.formData,rules:this.formRules,labelPlacement:"left",labelAlign:"left",labelWidth:150},{default:()=>[a(p,{label:r("security.user.username"),path:"userName"},{default:()=>[a(f,{allowInput:this.trim,class:"input-username",value:this.formData.userName,"onUpdate:value":t=>this.formData.userName=t,minlength:3,maxlength:39,disabled:!0,placeholder:r("security.user.username_tips")},null)]}),a(p,{label:r("security.user.user_password"),path:"userPassword"},{default:()=>[a(f,{allowInput:this.trim,class:"input-password",type:"password",value:this.formData.userPassword,"onUpdate:value":t=>this.formData.userPassword=t,placeholder:r("security.user.user_password_tips")},null)]}),a(p,{label:r("password.confirm_password"),path:"confirmPassword"},{default:()=>[a(f,{allowInput:this.trim,type:"password",value:this.formData.confirmPassword,"onUpdate:value":t=>this.formData.confirmPassword=t,placeholder:r("password.confirm_password_tips")},null)]})]})]})}});export{dr as PasswordModal,dr as default};
