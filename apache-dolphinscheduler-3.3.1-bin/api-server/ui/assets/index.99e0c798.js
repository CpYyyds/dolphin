import{bI as b,u as h,E as D,r as p,d as L,o as C,H as M,I as S,c as i}from"./index.02a17cf1.js";import{u as v}from"./index.9b0cc109.js";import{l as f}from"./lodash.3a74b132.js";import{a as H,b as T}from"./index.b5f8acb4.js";import{k as c}from"./index.8474b6bf.js";import g from"./state-card.b0435dd8.js";import I from"./definition-card.31d8eb2c.js";import{g as W}from"./DatePicker.d4b2a484.js";import{s as x}from"./index.b7e4ecb8.js";import{N as y,a as w}from"./Grid.1918be0a.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./Pie.39703b46.js";import"./index.8ac5dcc4.js";import"./index.ef447d1d.js";import"./Card.f8db533a.js";import"./resolve-slot.92499a18.js";import"./index.5f9a33e7.js";import"./keysOf.843c523b.js";import"./DataTable.ddc5a79d.js";import"./ArrowDown.fd6213c2.js";import"./format-length.a6a40b1f.js";import"./Button.1b3ea9f7.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./Checkbox.c8f5c3b1.js";import"./use-merged-state.2bdc3563.js";import"./RadioGroup.7b709552.js";import"./flatten.8ad131a2.js";import"./get-slot.eeb09d52.js";import"./Radio.4578e023.js";import"./Popover.92dc7b00.js";import"./index.8a81335d.js";import"./use-false-until-truthy.e57d8f60.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./cssr.f561ccf0.js";import"./utils.eff12f29.js";import"./use-compitable.cd47f4ac.js";import"./next-frame-once.50ecadf2.js";import"./Suffix.62982c61.js";import"./Dropdown.de4044d8.js";import"./Icon.0cd298dd.js";import"./ChevronRight.d1d16011.js";import"./Select.51d2f90f.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./use-locale.47aab0f5.js";import"./Empty.249462a1.js";import"./index.21198e00.js";import"./use-keyboard.8f9f6db8.js";import"./Ellipsis.eed9f363.js";import"./Tooltip.76a430fa.js";import"./Input.59461546.js";import"./Forward.b8f2636c.js";import"./typeof.481ce13f.js";import"./Bar.5119cff7.js";function V(){const n=b(),{t:s}=h(),o=D({taskLoadingRef:p(!1)});return{getTaskState:t=>{if(o.taskLoadingRef)return;o.taskLoadingRef=!0;const{state:l}=v(H({startDate:t?c(t[0],"yyyy-MM-dd HH:mm:ss"):"",endDate:t?c(t[1],"yyyy-MM-dd HH:mm:ss"):"",projectCode:Number(n.params.projectCode)}).then(a=>{const r=a.taskInstanceStatusCounts.map((e,d)=>({state:s("home."+f.exports.toLower(e.state)),number:e.count})),u=a.taskInstanceStatusCounts.map(e=>({value:e.count,name:s("home."+f.exports.toLower(e.state))}));return o.taskLoadingRef=!1,{table:r,chart:u}}),{table:[],chart:[]});return l},taskVariables:o}}function N(){const n=b(),{t:s}=h(),o=D({workflowLoadingRef:p(!1)});return{getWorkflowState:t=>{if(o.workflowLoadingRef)return;o.workflowLoadingRef=!0;const{state:l}=v(T({startDate:t?c(t[0],"yyyy-MM-dd HH:mm:ss"):"",endDate:t?c(t[1],"yyyy-MM-dd HH:mm:ss"):"",projectCode:Number(n.params.projectCode)}).then(a=>{const r=a.workflowInstanceStatusCounts.map((e,d)=>({state:s("home."+f.exports.toLower(e.state)),number:e.count})),u=a.workflowInstanceStatusCounts.map(e=>({value:e.count,name:s("home."+f.exports.toLower(e.state))}));return o.workflowLoadingRef=!1,{table:r,chart:u}}),{table:[],chart:[]});return l},workflowVariables:o}}const Ut=L({name:"workflow-monitor",setup(){const{t:n,locale:s}=h(),o=p([W(x()),Date.now()]),m=p(),t=p(),{getTaskState:l,taskVariables:a}=V(),{getWorkflowState:r,workflowVariables:u}=N(),e=k=>{m.value=l(k)},d=k=>{t.value=r(k)},R=()=>{m.value=l(o.value)||m.value,t.value=r(o.value)||t.value};return C(()=>{R()}),M(()=>s.value,()=>R()),{t:n,dateRef:o,handleTaskDate:e,handleWorkflowDate:d,taskStateRef:m,workflowStateRef:t,...S(a),...S(u)}},render(){const{t:n,dateRef:s,handleTaskDate:o,handleWorkflowDate:m,taskLoadingRef:t,workflowLoadingRef:l}=this;return i("div",null,[i(y,{"x-gap":12,cols:2},{default:()=>[i(w,null,{default:()=>{var a,r;return[i(g,{title:n("home.task_state_statistics"),date:s,tableData:(a=this.taskStateRef)==null?void 0:a.value.table,chartData:(r=this.taskStateRef)==null?void 0:r.value.chart,onUpdateDatePickerValue:o,loadingRef:t},null)]}}),i(w,null,{default:()=>{var a,r;return[i(g,{title:n("home.workflow_state_statistics"),date:s,tableData:(a=this.workflowStateRef)==null?void 0:a.value.table,chartData:(r=this.workflowStateRef)==null?void 0:r.value.chart,onUpdateDatePickerValue:m,loadingRef:l},null)]}})]}),i(y,{cols:1,style:"margin-top: 12px;"},{default:()=>[i(w,null,{default:()=>[i(I,{title:n("home.workflow_definition_statistics")},null)]})]})])}});export{Ut as default};
