import{u as F,z as a,E as I,r as f,O as u,H as g,d as w,o as v,G as U,I as N,c as t,i as C}from"./index.02a17cf1.js";import{g as b,u as _}from"./index.cd03a49b.js";import{C as R}from"./index.ef447d1d.js";import{M as y}from"./index.08dd828f.js";import M from"./info.1b4fcc03.js";import{N as S}from"./Button.1b3ea9f7.js";import{N as x}from"./Form.de76c832.js";import{N as l}from"./FormItem.aeb1ee46.js";import{N as n}from"./Input.59461546.js";import"./service.ade35c11.js";import"./ui-setting.7e6814b1.js";import"./lodash.3a74b132.js";import"./Card.f8db533a.js";import"./resolve-slot.92499a18.js";import"./index.5f9a33e7.js";import"./keysOf.843c523b.js";import"./index.fe057c74.js";import"./Modal.920fa101.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./utils.eff12f29.js";import"./is-browser.e7afaa57.js";import"./index.21198e00.js";import"./Space.8a344b95.js";import"./get-slot.eeb09d52.js";import"./use-form-item.96cfc8ba.js";import"./format-length.a6a40b1f.js";import"./get.852d0cd9.js";import"./use-locale.47aab0f5.js";import"./use-merged-state.2bdc3563.js";import"./Suffix.62982c61.js";function q(){const{t:e,locale:i}=F(),r=a().userInfo,o=I({profileFormRef:f(),profileForm:{username:r.userName,email:r.email,phone:r.phone},saving:!1,rules:{username:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.username==="")return new Error(e("profile.username_tips"))}},email:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.email==="")return new Error(e("profile.email_tips"));if(!u.regex.email.test(o.profileForm.email||""))return new Error(e("profile.email_correct_tips"))}}}});return g(r,()=>{o.profileForm={username:r.userName,email:r.email,phone:r.phone}}),{state:o,t:e,locale:i}}function E(){const e=a();return{getUserInfo:async()=>{const r=await b();await e.setUserInfo(r)}}}function j(e){const r=a().userInfo;return{handleUpdate:async()=>{if(await e.profileFormRef.validate(),e.saving!==!0){e.saving=!0;try{await _({userPassword:"",id:r.id,userName:e.profileForm.username,tenantId:r.tenantId,email:e.profileForm.email,phone:e.profileForm.phone,state:r.state,queue:r.queue}),e.saving=!1}catch{e.saving=!1}}}}}function O(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!C(e)}const Fe=w({name:"profile",setup(){var p;const e=a().userInfo,i=f(!1),{state:r,t:o}=q(),{handleUpdate:s}=j(r),{getUserInfo:m}=E();v(async()=>{await m()});const c=()=>{i.value=!1,r.profileForm.email=e.email,r.profileForm.phone=e.phone,r.profileForm.username=e.userName},d=async()=>{i.value=!1,await s(),await m()},h=(p=U())==null?void 0:p.appContext.config.globalProperties.trim;return{...N(r),showModalRef:i,t:o,onCancel:c,onConfirm:d,trim:h}},render(){const{t:e,onCancel:i,onConfirm:r}=this;return t("div",null,[t(R,{title:e("profile.profile")},{default:()=>t(M,null,null),"header-extra":()=>{let o;return t(S,{type:"info",size:"small",onClick:()=>this.showModalRef=!this.showModalRef},O(o=e("profile.edit"))?o:{default:()=>[o]})}}),t(y,{title:e("profile.edit_profile"),show:this.showModalRef,onCancel:i,onConfirm:r,confirmDisabled:!this.profileForm.username||!this.profileForm.email||!u.regex.email.test(this.profileForm.email),confirmLoading:this.saving},{default:()=>t(x,{rules:this.rules,ref:"profileFormRef"},{default:()=>[t(l,{label:e("profile.username"),path:"username"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.username,"onUpdate:value":o=>this.profileForm.username=o,placeholder:e("profile.username_tips")},null)]}),t(l,{label:e("profile.email"),path:"email"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.email,"onUpdate:value":o=>this.profileForm.email=o,placeholder:e("profile.email_tips")},null)]}),t(l,{label:e("profile.phone"),path:"phone"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.phone,"onUpdate:value":o=>this.profileForm.phone=o,placeholder:e("profile.phone_tips")},null)]})]})})])}});export{Fe as default};
