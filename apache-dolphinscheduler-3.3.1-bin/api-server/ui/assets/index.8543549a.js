import{u as E,bH as B,E as A,r,h as c,d as G,bI as H,G as X,H as J,o as Q,I as Y,c as i,i as Z}from"./index.02a17cf1.js";import{_ as K}from"./lodash.3a74b132.js";import{u as ee}from"./index.9b0cc109.js";import{u as te}from"./use-text-copy.5aaa6a47.js";import{j as oe,k as q,r as O,l as ae,f as se,m as ie}from"./index.9cbc470c.js";import{o as F,b as re}from"./use-modal.c59c2056.js";import ne from"./table-action.fb6fd0bc.js";import{s as le,S as ce}from"./start-modal.3068e161.js";import{B as pe}from"./index.fe057c74.js";import{D as de,C as p,c as me}from"./column-width-config.03ebcd18.js";import{u as fe}from"./use-dependencies.c18c5099.js";import{C as he}from"./CopyOutlined.05f74603.js";import{U as we}from"./UnorderedListOutlined.b1f565fb.js";import{N as ue}from"./Ellipsis.eed9f363.js";import{N as u}from"./Space.8a344b95.js";import{N as f}from"./Button.1b3ea9f7.js";import{N as I}from"./Icon.0cd298dd.js";import{N as j}from"./Tooltip.76a430fa.js";import{d as b}from"./Select.51d2f90f.js";import{u as ge}from"./ui-setting.7e6814b1.js";import{C as P}from"./index.ef447d1d.js";import ke from"./import-modal.49c328f7.js";import ye from"./timing-modal.0f8d0b08.js";import Se from"./version-modal.8b7bf837.js";import je from"./copy-modal.d8010e85.js";import{S as Ce}from"./index.0da29625.js";import be from"./dependencies-modal.425ef74a.js";import{t as Ne}from"./tableTotalCount.3d973079.js";import{S as Re}from"./SearchOutlined.280f9205.js";import{N as _e,a as ze}from"./DataTable.ddc5a79d.js";import{N as De}from"./Popconfirm.98866df0.js";import"./use-message.66b07366.js";import"./service.ade35c11.js";import"./index.e3e49908.js";import"./index.124d1fef.js";import"./index.bcd2e05d.js";import"./common.a16f92ec.js";import"./SettingOutlined.901415e1.js";import"./PauseCircleOutlined.6f50ffc5.js";import"./CloseCircleOutlined.d6e82e31.js";import"./CheckCircleOutlined.b15d9580.js";import"./EditOutlined.8be88705.js";import"./index.8474b6bf.js";import"./index.0bedecf2.js";import"./index.7552dd4e.js";import"./FormOutlined.0c6aa81a.js";import"./PlayCircleOutlined.66fb9fb6.js";import"./DownloadOutlined.bd8b049e.js";import"./UploadOutlined.bbed6507.js";import"./ArrowUpOutlined.5d908421.js";import"./DeleteOutlined.d3b97bbb.js";import"./Popover.92dc7b00.js";import"./index.8a81335d.js";import"./flatten.8ad131a2.js";import"./Scrollbar.988383de.js";import"./VResizeObserver.f80d6e55.js";import"./use-false-until-truthy.e57d8f60.js";import"./_baseMap.d8d47059.js";import"./get.852d0cd9.js";import"./cssr.f561ccf0.js";import"./utils.eff12f29.js";import"./format-length.a6a40b1f.js";import"./resolve-slot.92499a18.js";import"./use-merged-state.2bdc3563.js";import"./use-compitable.cd47f4ac.js";import"./next-frame-once.50ecadf2.js";import"./is-browser.e7afaa57.js";import"./use-form-item.96cfc8ba.js";import"./use-locale.47aab0f5.js";import"./keysOf.843c523b.js";import"./get-slot.eeb09d52.js";import"./index.5f9a33e7.js";import"./index.08dd828f.js";import"./Modal.920fa101.js";import"./Card.f8db533a.js";import"./fade-in-scale-up.cssr.d8408fe5.js";import"./index.21198e00.js";import"./index.1f780a3d.js";import"./Form.de76c832.js";import"./FormItem.aeb1ee46.js";import"./RadioGroup.7b709552.js";import"./Radio.4578e023.js";import"./Checkbox.c8f5c3b1.js";import"./InputNumber.cad532d0.js";import"./Input.59461546.js";import"./Suffix.62982c61.js";import"./Add.a9b5dac9.js";import"./RadioButton.2774fa7f.js";import"./DatePicker.d4b2a484.js";import"./typeof.481ce13f.js";import"./use-keyboard.8f9f6db8.js";import"./Empty.249462a1.js";import"./Forward.b8f2636c.js";import"./DynamicInput.728c18a6.js";import"./ButtonGroup.1b8a381d.js";import"./ArrowDown.fd6213c2.js";import"./Grid.1918be0a.js";import"./Switch.a01ace9e.js";import"./index.b889db2d.js";import"./Upload.60743b2e.js";import"./Image.a9e33dbe.js";import"./timezone.01550da9.js";import"./Tabs.eddc3105.js";import"./throttle.1d7e3cbb.js";import"./debounce.aab20534.js";import"./toNumber.f676da43.js";import"./Dropdown.de4044d8.js";import"./ChevronRight.d1d16011.js";import"./index.d2c86bbc.js";function Le(){const{t:s}=E(),d=B(),{copy:h}=te(),{getDependentTaskLinks:n}=fe(),e=A({columns:[],tableWidth:de,checkedRowKeys:[],row:{},tableData:[],projectCode:r(Number(d.currentRoute.value.params.projectCode)),page:r(1),pageSize:r(10),searchVal:r(),totalPage:r(1),totalCount:r(0),timingType:r("create"),timingState:r("OFFLINE"),showRef:r(!1),startShowRef:r(!1),timingShowRef:r(!1),versionShowRef:r(!1),copyShowRef:r(!1),loadingRef:r(!1),setTimingDialogShowRef:r(!1),dependenciesData:r({showRef:!1,taskLinks:r([]),required:r(!1),tip:r(""),action:()=>{}})}),o=t=>{t.columns=[{type:"selection",className:"btn-selected",...p.selection},{title:"#",key:"id",...p.index,render:(a,l)=>l+1},{title:s("project.workflow.workflow_name"),key:"name",className:"workflow-name",...p.name,titleColSpan:3,resizable:!0,width:300,minWidth:300,maxWidth:600,render:a=>c(u,{justify:"space-between",wrap:!1,class:le["workflow-name"]},{default:()=>c(pe,{onClick:()=>{const l=d.resolve({name:"workflow-definition-detail",params:{code:a.code}});window.open(l.href,"_blank")}},{default:()=>c(ue,{style:"max-width: 580px;line-height: 1.5"},()=>a.name)})})},{title:"Copy",key:"copy",...p.copy,render:a=>c(j,null,{trigger:()=>c(f,{quaternary:!0,circle:!0,type:"info",size:"tiny",onClick:()=>void h(a.name)},{icon:()=>c(I,{size:16},()=>c(he))}),default:()=>s("project.workflow.copy_workflow_name")})},{title:"Instances",key:"instances",...p.instances,render:a=>c(j,null,{trigger:()=>c(f,{quaternary:!0,circle:!0,type:"info",size:"tiny",onClick:()=>{d.push({name:"workflow-instance-list",query:{workflowDefinitionCode:a.code}})}},{icon:()=>c(I,{size:18},()=>c(we))}),default:()=>s("project.workflow.visit_workflow_instances")})},{title:s("project.workflow.status"),key:"releaseState",...p.state,render:a=>a.releaseState==="ONLINE"?c(b,{type:"success",size:"small"},{default:()=>s("project.workflow.up_line")}):c(b,{type:"warning",size:"small"},{default:()=>s("project.workflow.down_line")})},{title:s("project.workflow.schedule_publish_status"),key:"scheduleReleaseState",...p.state,render:a=>a.scheduleReleaseState==="ONLINE"?c(b,{type:"success",size:"small"},{default:()=>s("project.workflow.up_line")}):a.scheduleReleaseState==="OFFLINE"?c(b,{type:"warning",size:"small"},{default:()=>s("project.workflow.down_line")}):"-"},{title:s("project.workflow.create_time"),key:"createTime",...p.time},{title:s("project.workflow.update_time"),key:"updateTime",...p.time},{title:s("project.workflow.description"),key:"description",...p.note},{title:s("project.workflow.create_user"),key:"userName",...p.userName},{title:s("project.workflow.modify_user"),key:"modifyBy",...p.userName},{title:s("project.workflow.operation"),key:"operation",...p.operation(10),render:a=>c(ne,{row:a,onEditWorkflow:()=>C(a),onStartWorkflow:()=>N(a),onTimingWorkflow:()=>R(a),onVersionWorkflow:()=>_(a),onDeleteWorkflow:()=>T(a),onReleaseWorkflow:()=>W(a),onReleaseScheduler:()=>V(a),onCopyWorkflow:()=>v(a),onExportWorkflow:()=>$(a),onGotoWorkflowTree:()=>M(a)})}],t.tableWidth&&(t.tableWidth=me(t.columns))},C=t=>{e.row=t,d.push({name:"workflow-definition-detail",params:{code:t.code}})},N=t=>{e.startShowRef=!0,e.row=t},R=t=>{e.timingShowRef=!0,t!=null&&t.schedule?(e.row=t.schedule,e.timingType="update",e.timingState=t.scheduleReleaseState):(e.row=t,e.timingType="create",e.timingState="OFFLINE")},_=t=>{e.versionShowRef=!0,e.row=t},w=()=>{const t={codes:K.join(e.checkedRowKeys,",")};oe(t,e.projectCode).then(()=>{window.$message.success(s("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},z=()=>{const t="workflow_"+new Date().getTime(),a={codes:K.join(e.checkedRowKeys,",")};q(a,e.projectCode).then(l=>{S(l,t),window.$message.success(s("project.workflow.success")),e.checkedRowKeys=[]})},D=()=>{},L=()=>{const t=e.row,a={name:t.name,releaseState:t.releaseState==="ONLINE"?"OFFLINE":"ONLINE"};a.releaseState==="OFFLINE"&&O(a,e.projectCode,t.code).then(()=>{m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal}),window.$message.success(s("project.workflow.success"))}),e.dependenciesData.showRef=!1},U=()=>{const t=e.row;F(e.projectCode,t.schedule.id).then(()=>{window.$message.success(s("project.workflow.success")),m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})}),e.dependenciesData.showRef=!1},W=t=>{const a={name:t.name,releaseState:t.releaseState==="ONLINE"?"OFFLINE":"ONLINE"};e.row=t,a.releaseState==="ONLINE"?O(a,e.projectCode,t.code).then(()=>{m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})}):n(e.projectCode,t.code).then(l=>{l&&l.length>0?e.dependenciesData={showRef:!0,taskLinks:l,tip:s("project.workflow.warning_dependent_tasks_desc"),required:!1,action:L}:O(a,e.projectCode,t.code).then(()=>{window.$message.success(s("project.workflow.success")),m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})})},T=t=>{n(e.projectCode,t.code).then(a=>{a&&a.length>0?e.dependenciesData={showRef:!0,taskLinks:a,tip:s("project.workflow.delete_validate_dependent_tasks_desc"),required:!0,action:()=>{}}:ae(e.projectCode,t.code).then(()=>{window.$message.success(s("project.workflow.success")),m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})})},V=t=>{e.row=t,t.schedule&&(t.schedule.releaseState==="ONLINE"?n(e.projectCode,t.code).then(a=>{a&&a.length>0?e.dependenciesData={showRef:!0,taskLinks:a,tip:s("project.workflow.warning_offline_scheduler_dependent_tasks_desc"),required:!1,action:U}:F(e.projectCode,t.schedule.id).then(()=>{window.$message.success(s("project.workflow.success")),m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})}):re(e.projectCode,t.schedule.id).then(()=>{window.$message.success(s("project.workflow.success")),m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})}))},v=t=>{const a={codes:String(t.code),targetProjectCode:e.projectCode};se(a,e.projectCode).then(()=>{window.$message.success(s("project.workflow.success")),m({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},S=(t,a="json")=>{if(!t)return;const l=new Blob([t]),g=`${a}.json`;if("download"in document.createElement("a")){const x=window.URL.createObjectURL(l),k=document.createElement("a");k.style.display="none",k.href=x,k.setAttribute("download",g),document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(x)}else window.navigator.msSaveBlob&&window.navigator.msSaveBlob(l,g)},$=t=>{const a="workflow_"+new Date().getTime(),l={codes:String(t.code)};q(l,e.projectCode).then(g=>{S(g,a)})},M=t=>{d.push({name:"workflow-definition-tree",params:{projectCode:e.projectCode,definitionCode:t.code}})},m=t=>{if(e.loadingRef)return;e.loadingRef=!0;const{state:a}=ee(ie({...t},e.projectCode).then(l=>{e.totalCount=l.total,e.totalPage=l.totalPage,e.tableData=l.totalList.map(g=>({...g})),e.loadingRef=!1}),{total:0,table:[]});return a};return{variables:e,createColumns:o,getTableData:m,batchDeleteWorkflow:w,batchExportWorkflow:z,batchCopyWorkflow:D}}function y(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!Z(s)}const To=G({name:"WorkflowDefinitionList",setup(){var S;const s=B(),d=H(),h=Number(d.params.projectCode),n=ge(),{variables:e,createColumns:o,getTableData:C,batchDeleteWorkflow:N,batchExportWorkflow:R,batchCopyWorkflow:_}=Le(),w=()=>{C({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})},z=()=>{w()},D=()=>{e.checkedRowKeys=[],w()},L=()=>{e.page=1,w()},U=()=>{e.page=1,C({pageSize:e.pageSize,pageNo:e.page,searchVal:""})},W=()=>{e.page=1,w()},T=()=>{s.push({path:`/projects/${h}/workflow/definitions/create`})},V=()=>{s.push({path:`/projects/${h}/workflow/definitions/create`,query:{dynamic:"true"}})},v=(S=X())==null?void 0:S.appContext.config.globalProperties.trim;return J(E().locale,()=>{o(e)}),Q(()=>{o(e),w()}),{requestData:w,handleSearch:L,onClearSearch:U,handleUpdateList:z,createDefinition:T,createDefinitionDynamic:V,handleChangePageSize:W,batchDeleteWorkflow:N,batchExportWorkflow:R,batchCopyWorkflow:_,handleCopyUpdateList:D,...Y(e),uiSettingStore:n,trim:v}},render(){let s,d,h;const{t:n}=E(),{loadingRef:e}=this;return i(u,{vertical:!0},{default:()=>[i(P,null,{default:()=>[i(u,{justify:"space-between"},{default:()=>[i(u,null,{default:()=>[i(f,{type:"primary",size:"small",onClick:this.createDefinition,class:"btn-create-workflow"},y(s=n("project.workflow.create_workflow"))?s:{default:()=>[s]}),this.uiSettingStore.getDynamicTask&&i(f,{type:"warning",size:"small",onClick:this.createDefinitionDynamic},y(d=n("project.workflow.create_workflow_dynamic"))?d:{default:()=>[d]}),i(f,{strong:!0,secondary:!0,size:"small",onClick:()=>this.showRef=!0},y(h=n("project.workflow.import_workflow"))?h:{default:()=>[h]})]}),i(u,null,{default:()=>[i(Ce,{placeholder:n("resource.function.enter_keyword_tips"),value:this.searchVal,"onUpdate:value":o=>this.searchVal=o,onSearch:this.handleSearch,onClear:this.onClearSearch},null),i(f,{type:"primary",size:"small",onClick:this.handleSearch},{default:()=>[i(I,null,{default:()=>[i(Re,null,null)]})]})]})]})]}),i(P,{title:n("project.workflow.workflow_definition")},{default:()=>[i(u,{vertical:!0},{default:()=>[i(_e,{loading:e,rowKey:o=>o.code,columns:this.columns,data:this.tableData,striped:!0,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":o=>this.checkedRowKeys=o,"row-class-name":"items",scrollX:this.tableWidth},null),i(u,{justify:"space-between"},{default:()=>[i(u,null,{default:()=>[i(j,null,{default:()=>n("project.workflow.batch_delete"),trigger:()=>i(De,{onPositiveClick:this.batchDeleteWorkflow},{default:()=>n("project.workflow.delete_confirm"),trigger:()=>{let o;return i(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,class:"btn-delete-all"},y(o=n("project.workflow.batch_delete"))?o:{default:()=>[o]})}})}),i(j,null,{default:()=>n("project.workflow.batch_export"),trigger:()=>{let o;return i(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:this.batchExportWorkflow,class:"btn-delete-all"},y(o=n("project.workflow.batch_export"))?o:{default:()=>[o]})}}),i(j,null,{default:()=>n("project.workflow.batch_copy"),trigger:()=>{let o;return i(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:()=>this.copyShowRef=!0,class:"btn-delete-all"},y(o=n("project.workflow.batch_copy"))?o:{default:()=>[o]})}})]}),i(ze,{page:this.page,"onUpdate:page":o=>this.page=o,"page-size":this.pageSize,"onUpdate:page-size":o=>this.pageSize=o,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize,itemCount:this.totalCount,prefix:Ne},null)]})]})]}),i(ke,{show:this.showRef,"onUpdate:show":o=>this.showRef=o,onUpdateList:this.handleUpdateList},null),i(ce,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.startShowRef,"onUpdate:show":o=>this.startShowRef=o,onUpdateList:this.handleUpdateList},null),i(ye,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.timingShowRef,"onUpdate:show":o=>this.timingShowRef=o,type:this.timingType,"onUpdate:type":o=>this.timingType=o,state:this.timingState,"onUpdate:state":o=>this.timingState=o,onUpdateList:this.handleUpdateList},null),i(Se,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.versionShowRef,"onUpdate:show":o=>this.versionShowRef=o,onUpdateList:this.handleUpdateList},null),i(je,{codes:this.checkedRowKeys,"onUpdate:codes":o=>this.checkedRowKeys=o,show:this.copyShowRef,"onUpdate:show":o=>this.copyShowRef=o,onUpdateList:this.handleCopyUpdateList},null),i(be,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.dependenciesData.showRef,"onUpdate:show":o=>this.dependenciesData.showRef=o,taskLinks:this.dependenciesData.taskLinks,"onUpdate:taskLinks":o=>this.dependenciesData.taskLinks=o,required:this.dependenciesData.required,content:this.dependenciesData.tip,onConfirm:this.dependenciesData.action},null)]})}});export{To as default};
