import{l as db}from"./lodash.3a74b132.js";import{h as hb,g as ze,d as Le,_ as Pm,c as ur,a as St,b as cr,i as wi,f as jt,e as Y,j as vb}from"./typeof.481ce13f.js";import{y as su}from"./index.02a17cf1.js";const Uf=e=>typeof e=="number",o2=e=>Number.isNaN(Number(e)),s2=e=>e!==null&&typeof e=="object",Ro=e=>{if(e===null)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];return e.forEach(r=>{t.push(r)}),t.map(r=>Ro(r))}if(typeof e=="object"&&e!=={}){const t=Object.assign({},e);return Object.keys(t).forEach(r=>{t[r]=Ro(t[r])}),t}return e};function pb(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Co;if(typeof pb=="function")try{Co=db.exports}catch{}Co||(Co=window._);var Rr=Co,et=Rr,Su=pt,mb="\0",Bn="\0",$f="";function pt(e){this._isDirected=et.has(e,"directed")?e.directed:!0,this._isMultigraph=et.has(e,"multigraph")?e.multigraph:!1,this._isCompound=et.has(e,"compound")?e.compound:!1,this._label=void 0,this._defaultNodeLabelFn=et.constant(void 0),this._defaultEdgeLabelFn=et.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[Bn]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}pt.prototype._nodeCount=0;pt.prototype._edgeCount=0;pt.prototype.isDirected=function(){return this._isDirected};pt.prototype.isMultigraph=function(){return this._isMultigraph};pt.prototype.isCompound=function(){return this._isCompound};pt.prototype.setGraph=function(e){return this._label=e,this};pt.prototype.graph=function(){return this._label};pt.prototype.setDefaultNodeLabel=function(e){return et.isFunction(e)||(e=et.constant(e)),this._defaultNodeLabelFn=e,this};pt.prototype.nodeCount=function(){return this._nodeCount};pt.prototype.nodes=function(){return et.keys(this._nodes)};pt.prototype.sources=function(){return et.filter(this.nodes(),et.bind(function(e){return et.isEmpty(this._in[e])},this))};pt.prototype.sinks=function(){return et.filter(this.nodes(),et.bind(function(e){return et.isEmpty(this._out[e])},this))};pt.prototype.setNodes=function(e,t){var r=arguments;return et.each(e,et.bind(function(n){r.length>1?this.setNode(n,t):this.setNode(n)},this)),this};pt.prototype.setNode=function(e,t){return et.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=Bn,this._children[e]={},this._children[Bn][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)};pt.prototype.node=function(e){return this._nodes[e]};pt.prototype.hasNode=function(e){return et.has(this._nodes,e)};pt.prototype.removeNode=function(e){var t=this;if(et.has(this._nodes,e)){var r=function(n){t.removeEdge(t._edgeObjs[n])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],et.each(this.children(e),et.bind(function(n){this.setParent(n)},this)),delete this._children[e]),et.each(et.keys(this._in[e]),r),delete this._in[e],delete this._preds[e],et.each(et.keys(this._out[e]),r),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this};pt.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(et.isUndefined(t))t=Bn;else{t+="";for(var r=t;!et.isUndefined(r);r=this.parent(r))if(r===e)throw new Error("Setting "+t+" as parent of "+e+" would create create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this};pt.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]};pt.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if(t!==Bn)return t}};pt.prototype.children=function(e){if(et.isUndefined(e)&&(e=Bn),this._isCompound){var t=this._children[e];if(t)return et.keys(t)}else{if(e===Bn)return this.nodes();if(this.hasNode(e))return[]}};pt.prototype.predecessors=function(e){var t=this._preds[e];if(t)return et.keys(t)};pt.prototype.successors=function(e){var t=this._sucs[e];if(t)return et.keys(t)};pt.prototype.neighbors=function(e){var t=this.predecessors(e);if(t)return et.union(t,this.successors(e))};pt.prototype.isLeaf=function(e){var t;return this.isDirected()?t=this.successors(e):t=this.neighbors(e),t.length===0};pt.prototype.filterNodes=function(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph()),et.each(this._nodes,et.bind(function(a,o){e(o)&&t.setNode(o,a)},this)),et.each(this._edgeObjs,et.bind(function(a){t.hasNode(a.v)&&t.hasNode(a.w)&&t.setEdge(a,this.edge(a))},this));var r=this,n={};function i(a){var o=r.parent(a);return o===void 0||t.hasNode(o)?(n[a]=o,o):o in n?n[o]:i(o)}return this._isCompound&&et.each(t.nodes(),function(a){t.setParent(a,i(a))}),t};pt.prototype.setDefaultEdgeLabel=function(e){return et.isFunction(e)||(e=et.constant(e)),this._defaultEdgeLabelFn=e,this};pt.prototype.edgeCount=function(){return this._edgeCount};pt.prototype.edges=function(){return et.values(this._edgeObjs)};pt.prototype.setPath=function(e,t){var r=this,n=arguments;return et.reduce(e,function(i,a){return n.length>1?r.setEdge(i,a,t):r.setEdge(i,a),a}),this};pt.prototype.setEdge=function(){var e,t,r,n,i=!1,a=arguments[0];typeof a=="object"&&a!==null&&"v"in a?(e=a.v,t=a.w,r=a.name,arguments.length===2&&(n=arguments[1],i=!0)):(e=a,t=arguments[1],r=arguments[3],arguments.length>2&&(n=arguments[2],i=!0)),e=""+e,t=""+t,et.isUndefined(r)||(r=""+r);var o=ba(this._isDirected,e,t,r);if(et.has(this._edgeLabels,o))return i&&(this._edgeLabels[o]=n),this;if(!et.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[o]=i?n:this._defaultEdgeLabelFn(e,t,r);var s=yb(this._isDirected,e,t,r);return e=s.v,t=s.w,Object.freeze(s),this._edgeObjs[o]=s,Vf(this._preds[t],e),Vf(this._sucs[e],t),this._in[t][o]=s,this._out[e][o]=s,this._edgeCount++,this};pt.prototype.edge=function(e,t,r){var n=arguments.length===1?wu(this._isDirected,arguments[0]):ba(this._isDirected,e,t,r);return this._edgeLabels[n]};pt.prototype.hasEdge=function(e,t,r){var n=arguments.length===1?wu(this._isDirected,arguments[0]):ba(this._isDirected,e,t,r);return et.has(this._edgeLabels,n)};pt.prototype.removeEdge=function(e,t,r){var n=arguments.length===1?wu(this._isDirected,arguments[0]):ba(this._isDirected,e,t,r),i=this._edgeObjs[n];return i&&(e=i.v,t=i.w,delete this._edgeLabels[n],delete this._edgeObjs[n],jf(this._preds[t],e),jf(this._sucs[e],t),delete this._in[t][n],delete this._out[e][n],this._edgeCount--),this};pt.prototype.inEdges=function(e,t){var r=this._in[e];if(r){var n=et.values(r);return t?et.filter(n,function(i){return i.v===t}):n}};pt.prototype.outEdges=function(e,t){var r=this._out[e];if(r){var n=et.values(r);return t?et.filter(n,function(i){return i.w===t}):n}};pt.prototype.nodeEdges=function(e,t){var r=this.inEdges(e,t);if(r)return r.concat(this.outEdges(e,t))};function Vf(e,t){e[t]?e[t]++:e[t]=1}function jf(e,t){--e[t]||delete e[t]}function ba(e,t,r,n){var i=""+t,a=""+r;if(!e&&i>a){var o=i;i=a,a=o}return i+$f+a+$f+(et.isUndefined(n)?mb:n)}function yb(e,t,r,n){var i=""+t,a=""+r;if(!e&&i>a){var o=i;i=a,a=o}var s={v:i,w:a};return n&&(s.name=n),s}function wu(e,t){return ba(e,t.v,t.w,t.name)}var _b="2.1.4",Eb={Graph:Su,version:_b},jr=Rr,bb=Su,gb={write:Tb,read:wb};function Tb(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:Ab(e),edges:Sb(e)};return jr.isUndefined(e.graph())||(t.value=jr.clone(e.graph())),t}function Ab(e){return jr.map(e.nodes(),function(t){var r=e.node(t),n=e.parent(t),i={v:t};return jr.isUndefined(r)||(i.value=r),jr.isUndefined(n)||(i.parent=n),i})}function Sb(e){return jr.map(e.edges(),function(t){var r=e.edge(t),n={v:t.v,w:t.w};return jr.isUndefined(t.name)||(n.name=t.name),jr.isUndefined(r)||(n.value=r),n})}function wb(e){var t=new bb(e.options).setGraph(e.value);return jr.each(e.nodes,function(r){t.setNode(r.v,r.value),r.parent&&t.setParent(r.v,r.parent)}),jr.each(e.edges,function(r){t.setEdge({v:r.v,w:r.w,name:r.name},r.value)}),t}var ro=Rr,Rb=Cb;function Cb(e){var t={},r=[],n;function i(a){ro.has(t,a)||(t[a]=!0,n.push(a),ro.each(e.successors(a),i),ro.each(e.predecessors(a),i))}return ro.each(e.nodes(),function(a){n=[],i(a),n.length&&r.push(n)}),r}var Lm=Rr,Mm=Cr;function Cr(){this._arr=[],this._keyIndices={}}Cr.prototype.size=function(){return this._arr.length};Cr.prototype.keys=function(){return this._arr.map(function(e){return e.key})};Cr.prototype.has=function(e){return Lm.has(this._keyIndices,e)};Cr.prototype.priority=function(e){var t=this._keyIndices[e];if(t!==void 0)return this._arr[t].priority};Cr.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key};Cr.prototype.add=function(e,t){var r=this._keyIndices;if(e=String(e),!Lm.has(r,e)){var n=this._arr,i=n.length;return r[e]=i,n.push({key:e,priority:t}),this._decrease(i),!0}return!1};Cr.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key};Cr.prototype.decrease=function(e,t){var r=this._keyIndices[e];if(t>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[r].priority+" New: "+t);this._arr[r].priority=t,this._decrease(r)};Cr.prototype._heapify=function(e){var t=this._arr,r=2*e,n=r+1,i=e;r<t.length&&(i=t[r].priority<t[i].priority?r:i,n<t.length&&(i=t[n].priority<t[i].priority?n:i),i!==e&&(this._swap(e,i),this._heapify(i)))};Cr.prototype._decrease=function(e){for(var t=this._arr,r=t[e].priority,n;e!==0&&(n=e>>1,!(t[n].priority<r));)this._swap(e,n),e=n};Cr.prototype._swap=function(e,t){var r=this._arr,n=this._keyIndices,i=r[e],a=r[t];r[e]=a,r[t]=i,n[a.key]=e,n[i.key]=t};var xb=Rr,Nb=Mm,km=Ib,Ob=xb.constant(1);function Ib(e,t,r,n){return Pb(e,String(t),r||Ob,n||function(i){return e.outEdges(i)})}function Pb(e,t,r,n){var i={},a=new Nb,o,s,u=function(c){var f=c.v!==o?c.v:c.w,d=i[f],v=r(c),g=s.distance+v;if(v<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+c+" Weight: "+v);g<d.distance&&(d.distance=g,d.predecessor=o,a.decrease(f,g))};for(e.nodes().forEach(function(c){var f=c===t?0:Number.POSITIVE_INFINITY;i[c]={distance:f},a.add(c,f)});a.size()>0&&(o=a.removeMin(),s=i[o],s.distance!==Number.POSITIVE_INFINITY);)n(o).forEach(u);return i}var Lb=km,Mb=Rr,kb=Db;function Db(e,t,r){return Mb.transform(e.nodes(),function(n,i){n[i]=Lb(e,i,t,r)},{})}var zf=Rr,Dm=Fb;function Fb(e){var t=0,r=[],n={},i=[];function a(o){var s=n[o]={onStack:!0,lowlink:t,index:t++};if(r.push(o),e.successors(o).forEach(function(f){zf.has(n,f)?n[f].onStack&&(s.lowlink=Math.min(s.lowlink,n[f].index)):(a(f),s.lowlink=Math.min(s.lowlink,n[f].lowlink))}),s.lowlink===s.index){var u=[],c;do c=r.pop(),n[c].onStack=!1,u.push(c);while(o!==c);i.push(u)}}return e.nodes().forEach(function(o){zf.has(n,o)||a(o)}),i}var Gb=Rr,Bb=Dm,Ub=$b;function $b(e){return Gb.filter(Bb(e),function(t){return t.length>1||t.length===1&&e.hasEdge(t[0],t[0])})}var Vb=Rr,jb=Hb,zb=Vb.constant(1);function Hb(e,t,r){return Xb(e,t||zb,r||function(n){return e.outEdges(n)})}function Xb(e,t,r){var n={},i=e.nodes();return i.forEach(function(a){n[a]={},n[a][a]={distance:0},i.forEach(function(o){a!==o&&(n[a][o]={distance:Number.POSITIVE_INFINITY})}),r(a).forEach(function(o){var s=o.v===a?o.w:o.v,u=t(o);n[a][s]={distance:u,predecessor:a}})}),i.forEach(function(a){var o=n[a];i.forEach(function(s){var u=n[s];i.forEach(function(c){var f=u[a],d=o[c],v=u[c],g=f.distance+d.distance;g<v.distance&&(v.distance=g,v.predecessor=d.predecessor)})})}),n}var Hi=Rr,Fm=Gm;Gm.CycleException=uu;function Gm(e){var t={},r={},n=[];function i(a){if(Hi.has(r,a))throw new uu;Hi.has(t,a)||(r[a]=!0,t[a]=!0,Hi.each(e.predecessors(a),i),delete r[a],n.push(a))}if(Hi.each(e.sinks(),i),Hi.size(t)!==e.nodeCount())throw new uu;return n}function uu(){}var Hf=Fm,Wb=Yb;function Yb(e){try{Hf(e)}catch(t){if(t instanceof Hf.CycleException)return!1;throw t}return!0}var xo=Rr,Bm=qb;function qb(e,t,r){xo.isArray(t)||(t=[t]);var n=(e.isDirected()?e.successors:e.neighbors).bind(e),i=[],a={};return xo.each(t,function(o){if(!e.hasNode(o))throw new Error("Graph does not have node: "+o);Um(e,o,r==="post",a,n,i)}),i}function Um(e,t,r,n,i,a){xo.has(n,t)||(n[t]=!0,r||a.push(t),xo.each(i(t),function(o){Um(e,o,r,n,i,a)}),r&&a.push(t))}var Kb=Bm,Qb=Zb;function Zb(e,t){return Kb(e,t,"post")}var Jb=Bm,eg=tg;function tg(e,t){return Jb(e,t,"pre")}var Xf=Rr,rg=Su,ng=Mm,ig=ag;function ag(e,t){var r=new rg,n={},i=new ng,a;function o(u){var c=u.v===a?u.w:u.v,f=i.priority(c);if(f!==void 0){var d=t(u);d<f&&(n[c]=a,i.decrease(c,d))}}if(e.nodeCount()===0)return r;Xf.each(e.nodes(),function(u){i.add(u,Number.POSITIVE_INFINITY),r.setNode(u)}),i.decrease(e.nodes()[0],0);for(var s=!1;i.size()>0;){if(a=i.removeMin(),Xf.has(n,a))r.setEdge(a,n[a]);else{if(s)throw new Error("Input graph is not connected: "+e);s=!0}e.nodeEdges(a).forEach(o)}return r}var og={components:Rb,dijkstra:km,dijkstraAll:kb,findCycles:Ub,floydWarshall:jb,isAcyclic:Wb,postorder:Qb,preorder:eg,prim:ig,tarjan:Dm,topsort:Fm},Wf=Eb,sg={Graph:Wf.Graph,json:gb,alg:og,version:Wf.version};let cu=sg;!cu&&typeof window<"u"&&(cu=window.graphlib);Array.prototype.flat||(Array.prototype.flat=function(e){let t=e||1;if(!isFinite(t))return;const r=this.length;let n=[];if(this.length===0)return this;for(;t--;){const i=[];let a=!1;if(n.length===0){a=!0;for(let o=0;o<r;o++)this[o]instanceof Array?n.push(...this[o]):n.push(this[o])}else{for(let o=0;o<n.length;o++)n[o]instanceof Array?(a=!0,i.push(...n[o])):i.push(n[o]);n=i}if(!a&&t===1/0)break}return n});const bn=cu,Yf=e=>{e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev},ug=(e,t)=>{if(e!=="_next"&&e!=="_prev")return t};class cg{constructor(){const t={};t._next=t._prev=t,this.isentinel=t}dequeue(){const t=this.isentinel,r=t._prev;if(r!==t)return Yf(r),r}enqueue(){const t=this.isentinel,r=t._prev;if(r!==t)return Yf(r),r}toString(){const t=[],r=this.isentinel;let n=r._prev;for(;n!==r;)t.push(JSON.stringify(n,ug)),n=n._prev;return`[${t.join(", ")}]`}}const fg=bn.Graph,lg=()=>1,dg=(e,t)=>{var r;if(e.nodeCount()<=1)return[];const n=vg(e,t||lg);return(r=hg(n.graph,n.buckets,n.zeroIdx).map(a=>e.outEdges(a.v,a.w)))===null||r===void 0?void 0:r.flat()},hg=(e,t,r)=>{let n=[];const i=t[t.length-1],a=t[0];let o;for(;e.nodeCount();){for(;o=a.dequeue();)Gs(e,t,r,o);for(;o=i.dequeue();)Gs(e,t,r,o);if(e.nodeCount()){for(let s=t.length-2;s>0;--s)if(o=t[s].dequeue(),o){n=n.concat(Gs(e,t,r,o,!0));break}}}return n},Gs=(e,t,r,n,i)=>{var a,o;const s=i?[]:void 0;return(a=e.inEdges(n.v))===null||a===void 0||a.forEach(u=>{const c=e.edge(u),f=e.node(u.v);i&&s.push({v:u.v,w:u.w}),f.out===void 0&&(f.out=0),f.out-=c,fu(t,r,f)}),(o=e.outEdges(n.v))===null||o===void 0||o.forEach(u=>{const c=e.edge(u),f=u.w,d=e.node(f);d.in===void 0&&(d.in=0),d.in-=c,fu(t,r,d)}),e.removeNode(n.v),s},vg=(e,t)=>{const r=new fg;let n=0,i=0;e.nodes().forEach(u=>{r.setNode(u,{v:u,in:0,out:0})}),e.edges().forEach(u=>{const c=r.edge(u.v,u.w)||0,f=t==null?void 0:t(u),d=c+f;r.setEdge(u.v,u.w,d),i=Math.max(i,r.node(u.v).out+=f),n=Math.max(n,r.node(u.w).in+=f)});const a=[],o=i+n+3;for(let u=0;u<o;u++)a.push(new cg);const s=n+1;return r.nodes().forEach(u=>{fu(a,s,r.node(u))}),{buckets:a,zeroIdx:s,graph:r}},fu=(e,t,r)=>{r.out?r.in?e[r.out-r.in+t].enqueue(r):e[e.length-1].enqueue(r):e[0].enqueue(r)},pg=e=>{const t=n=>i=>n.edge(i).weight,r=e.graph().acyclicer==="greedy"?dg(e,t(e)):mg(e);r==null||r.forEach(n=>{const i=e.edge(n);e.removeEdge(n),i.forwardName=n.name,i.reversed=!0,e.setEdge(n.w,n.v,i,`rev-${Math.random()}`)})},mg=e=>{const t=[],r={},n={},i=a=>{var o;n.hasOwnProperty(a)||(n[a]=!0,r[a]=!0,(o=e.outEdges(a))===null||o===void 0||o.forEach(s=>{r.hasOwnProperty(s.w)?t.push(s):i(s.w)}),delete r[a])};return e.nodes().forEach(i),t},yg=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.reversed){e.removeEdge(t);const n=r.forwardName;delete r.reversed,delete r.forwardName,e.setEdge(t.w,t.v,r,n)}})},qf={run:pg,undo:yg},$m=bn.Graph,Vm=(e,t,r,n)=>{let i;do i=`${n}${Math.random()}`;while(e.hasNode(i));return r.dummy=t,e.setNode(i,r),i},jm=e=>{const t=new $m().setGraph(e.graph());return e.nodes().forEach(r=>{t.setNode(r,e.node(r))}),e.edges().forEach(r=>{const n=t.edge(r.v,r.w)||{weight:0,minlen:1},i=e.edge(r);t.setEdge(r.v,r.w,{weight:n.weight+i.weight,minlen:Math.max(n.minlen,i.minlen)})}),t},_g=e=>{const t=new $m({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(r=>{var n;!((n=e.children(r))===null||n===void 0)&&n.length||t.setNode(r,e.node(r))}),e.edges().forEach(r=>t.setEdge(r,e.edge(r))),t},Mo=(e,t)=>{const r={};return e==null||e.forEach((n,i)=>{r[n]=t[i]}),r},Eg=e=>{const t=e.nodes().map(r=>{var n;const i={};return(n=e.outEdges(r))===null||n===void 0||n.forEach(a=>{i[a.w]=(i[a.w]||0)+e.edge(a).weight}),i});return Mo(e.nodes(),t)},bg=e=>{const t=e.nodes().map(r=>{var n;const i={};return(n=e.inEdges(r))===null||n===void 0||n.forEach(a=>{i[a.v]=(i[a.v]||0)+e.edge(a).weight}),i});return Mo(e.nodes(),t)},gg=(e,t)=>{const r=e.x,n=e.y,i=t.x-r,a=t.y-n;let o=e.width/2,s=e.height/2;if(!i&&!a)return{x:0,y:0};let u,c;return Math.abs(a)*o>Math.abs(i)*s?(a<0&&(s=-s),u=s*i/a,c=s):(i<0&&(o=-o),u=o,c=o*a/i),{x:r+u,y:n+c}},Tg=e=>{const t=[],r=[],n=Xm(e)+1;for(let i=0;i<n;i++)t.push([]),r.push([]);return e.nodes().forEach(i=>{const o=e.node(i).rank;o!==void 0&&t[o]&&r[o].push(i)}),r==null||r.forEach((i,a)=>{i==null||i.sort((o,s)=>{var u,c;return((u=e.node(o))===null||u===void 0?void 0:u.order)-((c=e.node(s))===null||c===void 0?void 0:c.order)}),i.forEach(o=>{t[a].push(o)})}),t},zm=e=>{const t=e.nodes().filter(n=>e.node(n).rank!==void 0).map(n=>e.node(n).rank),r=Math.min(...t);e.nodes().forEach(n=>{const i=e.node(n);i.hasOwnProperty("rank")&&(i.rank||(i.rank=0),i.rank-=r)})},Hm=e=>{const t=e.nodes().filter(o=>e.node(o).rank!==void 0).map(o=>e.node(o).rank),r=Math.min(...t),n=[];e.nodes().forEach(o=>{var s;const u=(((s=e.node(o))===null||s===void 0?void 0:s.rank)||0)-r;n[u]||(n[u]=[]),n[u].push(o)});let i=0;const a=e.graph().nodeRankFactor||0;for(let o=0;o<n.length;o++){const s=n[o];s===void 0&&o%a!==0?--i:i&&(s==null||s.forEach(u=>{e.node(u).rank||(e.node(u).rank=0),e.node(u).rank+=i}))}},Ag=(e,t,r,n)=>{const i={width:0,height:0};return Uf(r)&&Uf(n)&&(i.rank=r,i.order=n),Vm(e,"border",i,t)},Xm=e=>{const t=e.nodes().map(r=>{const n=e.node(r).rank;return n!==void 0?n:-1/0});return Math.max(...t)},Sg=(e,t)=>{const r={lhs:[],rhs:[]};return e==null||e.forEach(n=>{t(n)?r.lhs.push(n):r.rhs.push(n)}),r},wg=(e,t)=>{const r=Date.now();try{return t()}finally{console.log(`${e} time: ${Date.now()-r}ms`)}},Rg=(e,t)=>t(),Ru=(e,t)=>{let r=1/0,n;return e==null||e.forEach(i=>{const a=t(i);r>a&&(r=a,n=i)}),n},Yt={addDummyNode:Vm,simplify:jm,asNonCompoundGraph:_g,successorWeights:Eg,predecessorWeights:bg,intersectRect:gg,buildLayerMatrix:Tg,normalizeRanks:zm,removeEmptyRanks:Hm,addBorderNode:Ag,maxRank:Xm,partition:Sg,time:wg,notime:Rg,zipObject:Mo,minBy:Ru},Cg=e=>{e.graph().dummyChains=[],e.edges().forEach(t=>xg(e,t))},xg=(e,t)=>{var r,n;let i=t.v,a=e.node(i).rank;const o=t.w,s=e.node(o).rank,u=t.name,c=e.edge(t),f=c.labelRank;if(s===a+1)return;e.removeEdge(t);let d,v,g;for(g=0,++a;a<s;++g,++a)c.points=[],v={edgeLabel:c,width:0,height:0,edgeObj:t,rank:a},d=Yt.addDummyNode(e,"edge",v,"_d"),a===f&&(v.width=c.width,v.height=c.height,v.dummy="edge-label",v.labelpos=c.labelpos),e.setEdge(i,d,{weight:c.weight},u),g===0&&(e.graph().dummyChains||(e.graph().dummyChains=[]),(n=(r=e.graph())===null||r===void 0?void 0:r.dummyChains)===null||n===void 0||n.push(d)),i=d;e.setEdge(i,o,{weight:c.weight},u)},Ng=e=>{var t;(t=e.graph().dummyChains)===null||t===void 0||t.forEach(r=>{var n;let i=e.node(r);const a=i.edgeLabel;let o;i.edgeObj&&e.setEdge(i.edgeObj,a);let s=r;for(;i.dummy;)o=(n=e.successors(s))===null||n===void 0?void 0:n[0],e.removeNode(s),a.points.push({x:i.x,y:i.y}),i.dummy==="edge-label"&&(a.x=i.x,a.y=i.y,a.width=i.width,a.height=i.height),s=o,i=e.node(s)})},Kf={run:Cg,undo:Ng},Wm=e=>{var t;const r={},n=i=>{var a;const o=e.node(i);if(r.hasOwnProperty(i))return o.rank;r[i]=!0;const s=(a=e.outEdges(i))===null||a===void 0?void 0:a.map(c=>n(c.w)-e.edge(c).minlen||1/0);let u=Math.min(...s);return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),o.rank=u,u};(t=e.sources())===null||t===void 0||t.forEach(i=>n(i))},Og=e=>{var t;const r={};let n=0;const i=o=>{var s;const u=e.node(o);if(r.hasOwnProperty(o))return u.rank;r[o]=!0;const c=(s=e.outEdges(o))===null||s===void 0?void 0:s.map(d=>i(d.w)-e.edge(d).minlen||1/0);let f=Math.min(...c);return(f===Number.POSITIVE_INFINITY||f===void 0||f===null)&&(f=0),u.rank=f,n=Math.min(u.rank,n),u.rank};(t=e.sources())===null||t===void 0||t.forEach(o=>i(o)),n+=1;const a=(o,s)=>{var u;const c=e.node(o),f=isNaN(c.layer)?s:c.layer;(c.rank===void 0||c.rank<f)&&(c.rank=f),(u=e.outEdges(o))===null||u===void 0||u.map(d=>{a(d.w,f+e.edge(d).minlen)})};e.nodes().forEach(o=>{const s=e.node(o);isNaN(s.layer)?s.rank-=n:a(o,s.layer)})},yn=(e,t)=>e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen,Ym=bn.Graph,Ig=e=>{const t=new Ym({directed:!1}),r=e.nodes()[0],n=e.nodeCount();t.setNode(r,{});let i,a;for(;Pg(t,e)<n;)i=qm(t,e),a=t.hasNode(i.v)?yn(e,i):-yn(e,i),Km(t,e,a);return t},Pg=(e,t)=>{const r=n=>{t.nodeEdges(n).forEach(i=>{const a=i.v,o=n===a?i.w:a;!e.hasNode(o)&&!yn(t,i)&&(e.setNode(o,{}),e.setEdge(n,o,{}),r(o))})};return e.nodes().forEach(r),e.nodeCount()},Lg=e=>{const t=new Ym({directed:!1}),r=e.nodes()[0],n=e.nodeCount();t.setNode(r,{});let i,a;for(;Mg(t,e)<n;)i=qm(t,e),a=t.hasNode(i.v)?yn(e,i):-yn(e,i),Km(t,e,a);return t},Mg=(e,t)=>{const r=n=>{var i;(i=t.nodeEdges(n))===null||i===void 0||i.forEach(a=>{const o=a.v,s=n===o?a.w:o;!e.hasNode(s)&&(t.node(s).layer!==void 0||!yn(t,a))&&(e.setNode(s,{}),e.setEdge(n,s,{}),r(s))})};return e.nodes().forEach(r),e.nodeCount()},qm=(e,t)=>Ru(t.edges(),r=>e.hasNode(r.v)!==e.hasNode(r.w)?yn(t,r):1/0),Km=(e,t,r)=>{e.nodes().forEach(n=>{t.node(n).rank||(t.node(n).rank=0),t.node(n).rank+=r})},kg=bn.alg,{preorder:Dg,postorder:Fg}=kg,Vn=e=>{e=jm(e),Wm(e);const t=Ig(e);xu(t),Cu(t,e);let r,n;for(;r=Jm(t);)n=ey(t,e,r),ty(t,e,r,n)},Cu=(e,t)=>{let r=Fg(e,e.nodes());r=r==null?void 0:r.slice(0,(r==null?void 0:r.length)-1),r==null||r.forEach(n=>{Gg(e,t,n)})},Gg=(e,t,r)=>{const i=e.node(r).parent;e.edge(r,i).cutvalue=Qm(e,t,r)},Qm=(e,t,r)=>{var n;const a=e.node(r).parent;let o=!0,s=t.edge(r,a),u=0;return s||(o=!1,s=t.edge(a,r)),u=s.weight,(n=t.nodeEdges(r))===null||n===void 0||n.forEach(c=>{const f=c.v===r,d=f?c.w:c.v;if(d!==a){const v=f===o,g=t.edge(c).weight;if(u+=v?g:-g,Ug(e,r,d)){const T=e.edge(r,d).cutvalue;u+=v?-T:T}}}),u},xu=(e,t)=>{t!==void 0&&(t=e.nodes()[0]),Zm(e,{},1,t)},Zm=(e,t,r,n,i)=>{var a;const o=r;let s=r;const u=e.node(n);return t[n]=!0,(a=e.neighbors(n))===null||a===void 0||a.forEach(c=>{t.hasOwnProperty(c)||(s=Zm(e,t,s,c,n))}),u.low=o,u.lim=s++,i?u.parent=i:delete u.parent,s},Jm=e=>e.edges().find(t=>e.edge(t).cutvalue<0),ey=(e,t,r)=>{let n=r.v,i=r.w;t.hasEdge(n,i)||(n=r.w,i=r.v);const a=e.node(n),o=e.node(i);let s=a,u=!1;a.lim>o.lim&&(s=o,u=!0);const c=t.edges().filter(f=>u===Qf(e,e.node(f.v),s)&&u!==Qf(e,e.node(f.w),s));return Ru(c,f=>yn(t,f))},ty=(e,t,r,n)=>{const i=r.v,a=r.w;e.removeEdge(i,a),e.setEdge(n.v,n.w,{}),xu(e),Cu(e,t),Bg(e,t)},Bg=(e,t)=>{const r=e.nodes().find(i=>!t.node(i).parent);let n=Dg(e,r);n=n==null?void 0:n.slice(1),n==null||n.forEach(i=>{const a=e.node(i).parent;let o=t.edge(i,a),s=!1;o||(o=t.edge(a,i),s=!0),t.node(i).rank=t.node(a).rank+(s?o.minlen:-o.minlen)})},Ug=(e,t,r)=>e.hasEdge(t,r),Qf=(e,t,r)=>r.low<=t.lim&&t.lim<=r.lim;Vn.initLowLimValues=xu;Vn.initCutValues=Cu;Vn.calcCutValue=Qm;Vn.leaveEdge=Jm;Vn.enterEdge=ey;Vn.exchangeEdges=ty;const $g=e=>{switch(e.graph().ranker){case"network-simplex":jg(e);break;case"tight-tree":Zf(e);break;case"longest-path":Vg(e);break;default:Zf(e)}},Vg=Wm,Zf=e=>{Og(e),Lg(e)},jg=e=>{Vn(e)},zg=e=>{var t;const r=Xg(e);(t=e.graph().dummyChains)===null||t===void 0||t.forEach(n=>{var i,a;let o=e.node(n);const s=o.edgeObj;if(!s)return;const u=Hg(e,r,s.v,s.w),c=u.path,f=u.lca;let d=0,v=c[d],g=!0;for(;n!==s.w;){if(o=e.node(n),g){for(;(v=c[d])!==f&&e.node(v).maxRank<o.rank;)d++;v===f&&(g=!1)}if(!g){for(;d<c.length-1&&((i=e.node(v=c[d+1]))===null||i===void 0?void 0:i.minRank)<=o.rank;)d++;v=c[d]}e.setParent(n,v),n=(a=e.successors(n))===null||a===void 0?void 0:a[0]}})},Hg=(e,t,r,n)=>{const i=[],a=[],o=Math.min(t[r].low,t[n].low),s=Math.max(t[r].lim,t[n].lim);let u,c;u=r;do u=e.parent(u),i.push(u);while(u&&(t[u].low>o||s>t[u].lim));for(c=u,u=n;(u=e.parent(u))!==c;)a.push(u);return{lca:c,path:i.concat(a.reverse())}},Xg=e=>{var t;const r={};let n=0;const i=a=>{var o;const s=n;(o=e.children(a))===null||o===void 0||o.forEach(i),r[a]={low:s,lim:n++}};return(t=e.children())===null||t===void 0||t.forEach(i),r},Wg=e=>{var t;const r=Yt.addDummyNode(e,"root",{},"_root"),n=Yg(e),i=Math.max(...Object.values(n))-1,a=2*i+1;e.graph().nestingRoot=r,e.edges().forEach(s=>{e.edge(s).minlen*=a});const o=qg(e)+1;(t=e.children())===null||t===void 0||t.forEach(s=>{ry(e,r,a,o,i,n,s)}),e.graph().nodeRankFactor=a},ry=(e,t,r,n,i,a,o)=>{const s=e.children(o);if(!(s!=null&&s.length)){o!==t&&e.setEdge(t,o,{weight:0,minlen:r});return}const u=Yt.addBorderNode(e,"_bt"),c=Yt.addBorderNode(e,"_bb"),f=e.node(o);e.setParent(u,o),f.borderTop=u,e.setParent(c,o),f.borderBottom=c,s==null||s.forEach(d=>{ry(e,t,r,n,i,a,d);const v=e.node(d),g=v.borderTop?v.borderTop:d,T=v.borderBottom?v.borderBottom:d,C=v.borderTop?n:2*n,x=g!==T?1:i-a[o]+1;e.setEdge(u,g,{minlen:x,weight:C,nestingEdge:!0}),e.setEdge(T,c,{minlen:x,weight:C,nestingEdge:!0})}),e.parent(o)||e.setEdge(t,u,{weight:0,minlen:i+a[o]})},Yg=e=>{var t;const r={},n=(i,a)=>{const o=e.children(i);o==null||o.forEach(s=>n(s,a+1)),r[i]=a};return(t=e.children())===null||t===void 0||t.forEach(i=>n(i,1)),r},qg=e=>{let t=0;return e.edges().forEach(r=>{t+=e.edge(r).weight}),t},Kg=e=>{const t=e.graph();t.nestingRoot&&e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(r=>{e.edge(r).nestingEdge&&e.removeEdge(r)})},Jf={run:Wg,cleanup:Kg},Qg=e=>{var t;const r=n=>{const i=e.children(n),a=e.node(n);if(i!=null&&i.length&&i.forEach(o=>r(o)),a.hasOwnProperty("minRank")){a.borderLeft=[],a.borderRight=[];for(let o=a.minRank,s=a.maxRank+1;o<s;++o)el(e,"borderLeft","_bl",n,a,o),el(e,"borderRight","_br",n,a,o)}};(t=e.children())===null||t===void 0||t.forEach(n=>r(n))},el=(e,t,r,n,i,a)=>{const o={rank:a,width:0,height:0,borderType:t},s=i[t][a-1],u=Yt.addDummyNode(e,"border",o,r);i[t][a]=u,e.setParent(u,n),s&&e.setEdge(s,u,{weight:1})},Zg=e=>{var t;const r=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(r==="lr"||r==="rl")&&ny(e)},Jg=e=>{var t;const r=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(r==="bt"||r==="rl")&&eT(e),(r==="lr"||r==="rl")&&(tT(e),ny(e))},ny=e=>{e.nodes().forEach(t=>{tl(e.node(t))}),e.edges().forEach(t=>{tl(e.edge(t))})},tl=e=>{const t=e.width;e.width=e.height,e.height=t},eT=e=>{e.nodes().forEach(t=>{Bs(e.node(t))}),e.edges().forEach(t=>{var r;const n=e.edge(t);(r=n.points)===null||r===void 0||r.forEach(i=>Bs(i)),n.hasOwnProperty("y")&&Bs(n)})},Bs=e=>{e.y=-e.y},tT=e=>{e.nodes().forEach(t=>{Us(e.node(t))}),e.edges().forEach(t=>{var r;const n=e.edge(t);(r=n.points)===null||r===void 0||r.forEach(i=>Us(i)),n.hasOwnProperty("x")&&Us(n)})},Us=e=>{const t=e.x;e.x=e.y,e.y=t},rl={adjust:Zg,undo:Jg},nl=e=>{const t={},r=e.nodes().filter(f=>{var d;return!(!((d=e.children(f))===null||d===void 0)&&d.length)}),n=r.map(f=>e.node(f).rank),i=Math.max(...n),a=[];for(let f=0;f<i+1;f++)a.push([]);const o=f=>{var d;if(t.hasOwnProperty(f))return;t[f]=!0;const v=e.node(f);isNaN(v.rank)||a[v.rank].push(f),(d=e.successors(f))===null||d===void 0||d.forEach(g=>o(g))},s=r.sort((f,d)=>e.node(f).rank-e.node(d).rank),c=s.filter(f=>e.node(f).fixorder!==void 0).sort((f,d)=>e.node(f).fixorder-e.node(d).fixorder);return c==null||c.forEach(f=>{isNaN(e.node(f).rank)||a[e.node(f).rank].push(f),t[f]=!0}),s==null||s.forEach(o),a},rT=(e,t,r)=>{const n=Mo(r,r.map((f,d)=>d)),a=t.map(f=>{var d;const v=(d=e.outEdges(f))===null||d===void 0?void 0:d.map(g=>({pos:n[g.w]||0,weight:e.edge(g).weight}));return v==null?void 0:v.sort((g,T)=>g.pos-T.pos)}).flat().filter(f=>f!==void 0);let o=1;for(;o<r.length;)o<<=1;const s=2*o-1;o-=1;const u=Array(s).fill(0,0,s);let c=0;return a==null||a.forEach(f=>{let d=f.pos+o;u[d]+=f.weight;let v=0;for(;d>0;)d%2&&(v+=u[d+1]),d=d-1>>1,u[d]+=f.weight;c+=f.weight*v}),c},il=(e,t)=>{let r=0;for(let n=1;n<(t==null?void 0:t.length);++n)r+=rT(e,t[n-1],t[n]);return r},nT=bn.Graph,iT=(e,t,r)=>{const n=aT(e),i=new nT({compound:!0}).setGraph({root:n}).setDefaultNodeLabel(a=>e.node(a));return e.nodes().forEach(a=>{const o=e.node(a),s=e.parent(a);(o.rank===t||o.minRank<=t&&t<=o.maxRank)&&(i.setNode(a),i.setParent(a,s||n),e[r](a).forEach(u=>{const c=u.v===a?u.w:u.v,f=i.edge(c,a),d=f!==void 0?f.weight:0;i.setEdge(c,a,{weight:e.edge(u).weight+d})}),o.hasOwnProperty("minRank")&&i.setNode(a,{borderLeft:o.borderLeft[t],borderRight:o.borderRight[t]}))}),i},aT=e=>{let t;for(;e.hasNode(t=`_root${Math.random()}`););return t},oT=(e,t,r)=>{const n={};let i;r==null||r.forEach(a=>{let o=e.parent(a),s,u;for(;o;){if(s=e.parent(o),s?(u=n[s],n[s]=o):(u=i,i=o),u&&u!==o){t.setEdge(u,o);return}o=s}})},sT=(e,t)=>t.map(r=>{const n=e.inEdges(r);if(!(n!=null&&n.length))return{v:r};{const i={sum:0,weight:0};return n==null||n.forEach(a=>{const o=e.edge(a),s=e.node(a.v);i.sum+=o.weight*s.order,i.weight+=o.weight}),{v:r,barycenter:i.sum/i.weight,weight:i.weight}}}),uT=(e,t)=>{var r,n,i;const a={};e==null||e.forEach((s,u)=>{const c=a[s.v]={i:u,indegree:0,in:[],out:[],vs:[s.v]};s.barycenter!==void 0&&(c.barycenter=s.barycenter,c.weight=s.weight)}),(r=t.edges())===null||r===void 0||r.forEach(s=>{const u=a[s.v],c=a[s.w];u!==void 0&&c!==void 0&&(c.indegree++,u.out.push(a[s.w]))});const o=(i=(n=Object.values(a)).filter)===null||i===void 0?void 0:i.call(n,s=>!s.indegree);return cT(o)},cT=e=>{var t,r;const n=[],i=u=>c=>{c.merged||(c.barycenter===void 0||u.barycenter===void 0||c.barycenter>=u.barycenter)&&fT(u,c)},a=u=>c=>{c.in.push(u),--c.indegree===0&&e.push(c)};for(;e!=null&&e.length;){const u=e.pop();n.push(u),(t=u.in.reverse())===null||t===void 0||t.forEach(c=>i(u)(c)),(r=u.out)===null||r===void 0||r.forEach(c=>a(u)(c))}const o=n.filter(u=>!u.merged),s=["vs","i","barycenter","weight"];return o.map(u=>{const c={};return s==null||s.forEach(f=>{u[f]!==void 0&&(c[f]=u[f])}),c})},fT=(e,t)=>{var r;let n=0,i=0;e.weight&&(n+=e.barycenter*e.weight,i+=e.weight),t.weight&&(n+=t.barycenter*t.weight,i+=t.weight),e.vs=(r=t.vs)===null||r===void 0?void 0:r.concat(e.vs),e.barycenter=n/i,e.weight=i,e.i=Math.min(t.i,e.i),t.merged=!0},lT=(e,t,r)=>{const n=Yt.partition(e,d=>d.hasOwnProperty("fixorder")&&!isNaN(d.fixorder)||d.hasOwnProperty("barycenter")),i=n.lhs,a=n.rhs.sort((d,v)=>-d.i- -v.i),o=[];let s=0,u=0,c=0;i==null||i.sort(dT(!!t,!!r)),c=al(o,a,c),i==null||i.forEach(d=>{var v;c+=(v=d.vs)===null||v===void 0?void 0:v.length,o.push(d.vs),s+=d.barycenter*d.weight,u+=d.weight,c=al(o,a,c)});const f={vs:o.flat()};return u&&(f.barycenter=s/u,f.weight=u),f},al=(e,t,r)=>{let n=r,i;for(;t.length&&(i=t[t.length-1]).i<=n;)t.pop(),e==null||e.push(i.vs),n++;return n},dT=(e,t)=>(r,n)=>{if(r.fixorder!==void 0&&n.fixorder!==void 0)return r.fixorder-n.fixorder;if(r.barycenter<n.barycenter)return-1;if(r.barycenter>n.barycenter)return 1;if(t&&r.order!==void 0&&n.order!==void 0){if(r.order<n.order)return-1;if(r.order>n.order)return 1}return e?n.i-r.i:r.i-n.i},iy=(e,t,r,n,i)=>{var a,o,s,u;let c=e.children(t);const f=e.node(t),d=f?f.borderLeft:void 0,v=f?f.borderRight:void 0,g={};d&&(c=c==null?void 0:c.filter($=>$!==d&&$!==v));const T=sT(e,c||[]);T==null||T.forEach($=>{var Q;if(!((Q=e.children($.v))===null||Q===void 0)&&Q.length){const X=iy(e,$.v,r,n);g[$.v]=X,X.hasOwnProperty("barycenter")&&vT($,X)}});const C=uT(T,r);hT(C,g),(a=C.filter($=>{var Q;return!!$.vs||((Q=$.vs)===null||Q===void 0?void 0:Q.length)>0}))===null||a===void 0||a.forEach($=>{const Q=e.node($.vs[0]);$.fixorder=Q.fixorder,$.order=Q.order});const x=lT(C,n,i);if(d&&(x.vs=[d,x.vs,v].flat(),!((o=e.predecessors(d))===null||o===void 0)&&o.length)){const $=e.node(((s=e.predecessors(d))===null||s===void 0?void 0:s[0])||{}),Q=e.node(((u=e.predecessors(v))===null||u===void 0?void 0:u[0])||{});x.hasOwnProperty("barycenter")||(x.barycenter=0,x.weight=0),x.barycenter=(x.barycenter*x.weight+$.order+Q.order)/(x.weight+2),x.weight+=2}return x},hT=(e,t)=>{e==null||e.forEach(r=>{var n;const i=(n=r.vs)===null||n===void 0?void 0:n.map(a=>t[a]?t[a].vs:a);r.vs=i.flat()})},vT=(e,t)=>{e.barycenter!==void 0?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)},pT=bn.Graph,mT=e=>{const t=Yt.maxRank(e),r=[],n=[];for(let c=1;c<t+1;c++)r.push(c);for(let c=t-1;c>-1;c--)n.push(c);const i=ol(e,r,"inEdges"),a=ol(e,n,"outEdges");let o=nl(e);$s(e,o);let s=Number.POSITIVE_INFINITY,u;for(let c=0,f=0;f<4;++c,++f){sl(c%2?i:a,c%4>=2),o=Yt.buildLayerMatrix(e);const d=il(e,o);d<s&&(f=0,u=Ro(o),s=d)}o=nl(e),$s(e,o);for(let c=0,f=0;f<4;++c,++f){sl(c%2?i:a,c%4>=2,!0),o=Yt.buildLayerMatrix(e);const d=il(e,o);d<s&&(f=0,u=Ro(o),s=d)}$s(e,u)},ol=(e,t,r)=>t.map(n=>iT(e,n,r)),sl=(e,t,r)=>{const n=new pT;e==null||e.forEach(i=>{var a;const o=i.graph().root,s=iy(i,o,n,t,r);for(let u=0;u<((a=s.vs)===null||a===void 0?void 0:a.length);u++)i.node(s.vs[u]).order=u;oT(i,n,s.vs)})},$s=(e,t)=>{t==null||t.forEach(r=>{r==null||r.forEach((n,i)=>{e.node(n).order=i})})},yT=bn.Graph,_T=(e,t)=>{const r={},n=(i,a)=>{let o=0,s=0;const u=i.length,c=a==null?void 0:a[(a==null?void 0:a.length)-1];return a==null||a.forEach((f,d)=>{var v;const g=bT(e,f),T=g?e.node(g).order:u;(g||f===c)&&((v=a.slice(s,d+1))===null||v===void 0||v.forEach(C=>{var x;(x=e.predecessors(C))===null||x===void 0||x.forEach($=>{const Q=e.node($),X=Q.order;(X<o||T<X)&&!(Q.dummy&&e.node(C).dummy)&&ay(r,$,C)})}),s=d+1,o=T)}),a};return t!=null&&t.length&&t.reduce(n),r},ET=(e,t)=>{const r={},n=(a,o,s,u,c)=>{let f;const d=[];for(let v=o;v<s;v++)d.push(v);d.forEach(v=>{var g;f=a[v],e.node(f).dummy&&((g=e.predecessors(f))===null||g===void 0||g.forEach(T=>{const C=e.node(T);C.dummy&&(C.order<u||C.order>c)&&ay(r,T,f)}))})},i=(a,o)=>{let s=-1,u,c=0;return o==null||o.forEach((f,d)=>{if(e.node(f).dummy==="border"){const v=e.predecessors(f)||[];v.length&&(u=e.node(v[0]).order,n(o,c,d,s,u),c=d,s=u)}n(o,c,o.length,u,a.length)}),o};return t!=null&&t.length&&t.reduce(i),r},bT=(e,t)=>{var r;if(e.node(t).dummy)return(r=e.predecessors(t))===null||r===void 0?void 0:r.find(n=>e.node(n).dummy)},ay=(e,t,r)=>{let n=t,i=r;if(n>i){const o=n;n=i,i=o}let a=e[n];a||(e[n]=a={}),a[i]=!0},gT=(e,t,r)=>{let n=t,i=r;if(n>i){const a=t;n=i,i=a}return e[n]&&e[n].hasOwnProperty(i)},TT=(e,t,r,n)=>{const i={},a={},o={};return t==null||t.forEach(s=>{s==null||s.forEach((u,c)=>{i[u]=u,a[u]=u,o[u]=c})}),t==null||t.forEach(s=>{let u=-1;s==null||s.forEach(c=>{let f=n(c);if(f.length){f=f.sort((v,g)=>o[v]-o[g]);const d=(f.length-1)/2;for(let v=Math.floor(d),g=Math.ceil(d);v<=g;++v){const T=f[v];a[c]===c&&u<o[T]&&!gT(r,c,T)&&(a[T]=c,a[c]=i[c]=i[T],u=o[T])}}})}),{root:i,align:a}},AT=(e,t,r,n,i)=>{var a;const o={},s=ST(e,t,r,i),u=i?"borderLeft":"borderRight",c=(v,g)=>{let T=s.nodes(),C=T.pop();const x={};for(;C;)x[C]?v(C):(x[C]=!0,T.push(C),T=T.concat(g(C))),C=T.pop()},f=v=>{o[v]=(s.inEdges(v)||[]).reduce((g,T)=>Math.max(g,(o[T.v]||0)+s.edge(T)),0)},d=v=>{const g=(s.outEdges(v)||[]).reduce((C,x)=>Math.min(C,(o[x.w]||0)-s.edge(x)),Number.POSITIVE_INFINITY),T=e.node(v);g!==Number.POSITIVE_INFINITY&&T.borderType!==u&&(o[v]=Math.max(o[v],g))};return c(f,s.predecessors.bind(s)),c(d,s.successors.bind(s)),(a=Object.values(n))===null||a===void 0||a.forEach(v=>{o[v]=o[r[v]]}),o},ST=(e,t,r,n)=>{const i=new yT,a=e.graph(),o=xT(a.nodesep,a.edgesep,n);return t==null||t.forEach(s=>{let u;s==null||s.forEach(c=>{const f=r[c];if(i.setNode(f),u){const d=r[u],v=i.edge(d,f);i.setEdge(d,f,Math.max(o(e,c,u),v||0))}u=c})}),i},wT=(e,t)=>Yt.minBy(Object.values(t),r=>{var n;let i=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return(n=Object.keys(r))===null||n===void 0||n.forEach(o=>{const s=r[o],u=NT(e,o)/2;i=Math.max(s+u,i),a=Math.min(s-u,a)}),i-a});function RT(e,t){const r=Object.values(t),n=Math.min(...r),i=Math.max(...r);["u","d"].forEach(a=>{["l","r"].forEach(o=>{const s=a+o,u=e[s];let c;if(u===t)return;const f=Object.values(u);c=o==="l"?n-Math.min(...f):i-Math.max(...f),c&&(e[s]={},Object.keys(u).forEach(d=>{e[s][d]=u[d]+c}))})})}const CT=(e,t)=>{const r={};return Object.keys(e.ul).forEach(n=>{if(t)r[n]=e[t.toLowerCase()][n];else{const a=Object.values(e).map(o=>o[n]).sort((o,s)=>o-s);r[n]=(a[1]+a[2])/2}}),r},xT=(e,t,r)=>(n,i,a)=>{const o=n.node(i),s=n.node(a);let u=0,c;if(u+=o.width/2,o.hasOwnProperty("labelpos"))switch((o.labelpos||"").toLowerCase()){case"l":c=-o.width/2;break;case"r":c=o.width/2;break}if(c&&(u+=r?c:-c),c=0,u+=(o.dummy?t:e)/2,u+=(s.dummy?t:e)/2,u+=s.width/2,s.hasOwnProperty("labelpos"))switch((s.labelpos||"").toLowerCase()){case"l":c=s.width/2;break;case"r":c=-s.width/2;break}return c&&(u+=r?c:-c),c=0,u},NT=(e,t)=>{var r;return((r=e.node(t))===null||r===void 0?void 0:r.width)||0},OT=e=>{const t=Yt.buildLayerMatrix(e),r=e.graph().ranksep;let n=0;t==null||t.forEach(i=>{const a=i.map(s=>e.node(s).height),o=Math.max(...a);i==null||i.forEach(s=>{e.node(s).y=n+o/2}),n+=o+r})},IT=e=>{const t=Yt.buildLayerMatrix(e),r=Object.assign(_T(e,t),ET(e,t)),n={};let i;["u","d"].forEach(o=>{i=o==="u"?t:Object.values(t).reverse(),["l","r"].forEach(s=>{s==="r"&&(i=i.map(d=>Object.values(d).reverse()));const u=(o==="u"?e.predecessors:e.successors).bind(e),c=TT(e,i,r,u),f=AT(e,i,c.root,c.align,s==="r");s==="r"&&Object.keys(f).forEach(d=>f[d]=-f[d]),n[o+s]=f})});const a=wT(e,n);return a&&RT(n,a),CT(n,e.graph().align)},PT=e=>{var t;e=Yt.asNonCompoundGraph(e),OT(e);const r=IT(e);(t=Object.keys(r))===null||t===void 0||t.forEach(n=>{e.node(n).x=r[n]})},LT=(e,t)=>{const n=e.nodes().filter(o=>{var s;return!(!((s=e.children(o))===null||s===void 0)&&s.length)}).map(o=>e.node(o).rank),i=Math.max(...n),a=[];for(let o=0;o<i+1;o++)a.push([]);t==null||t.forEach(o=>{const s=e.node(o);!s||s.dummy||isNaN(s.rank)||(s.fixorder=a[s.rank].length,a[s.rank].push(o))})},MT=bn.Graph,u2=(e,t)=>{const r=t&&t.debugTiming?Yt.time:Yt.notime;r("layout",()=>{t&&!t.keepNodeOrder&&t.prevGraph&&r("  inheritOrder",()=>{DT(e,t.prevGraph)});const n=r("  buildLayoutGraph",()=>jT(e));t&&t.edgeLabelSpace===!1||r("  makeSpaceForEdgeLabels",()=>{zT(n)});try{r("  runLayout",()=>{kT(n,r,t)})}catch(i){if(i.message==="Not possible to find intersection inside of the rectangle"){console.error(`The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:
`,i);return}throw i}r("  updateInputGraph",()=>{FT(e,n)})})},kT=(e,t,r)=>{t("    removeSelfEdges",()=>{JT(e)}),t("    acyclic",()=>{qf.run(e)}),t("    nestingGraph.run",()=>{Jf.run(e)}),t("    rank",()=>{$g(Yt.asNonCompoundGraph(e))}),t("    injectEdgeLabelProxies",()=>{HT(e)}),t("    removeEmptyRanks",()=>{Hm(e)}),t("    nestingGraph.cleanup",()=>{Jf.cleanup(e)}),t("    normalizeRanks",()=>{zm(e)}),t("    assignRankMinMax",()=>{XT(e)}),t("    removeEdgeLabelProxies",()=>{WT(e)}),t("    normalize.run",()=>{Kf.run(e)}),t("    parentDummyChains",()=>{zg(e)}),t("    addBorderSegments",()=>{Qg(e)}),r&&r.keepNodeOrder&&t("    initDataOrder",()=>{LT(e,r.nodeOrder)}),t("    order",()=>{mT(e)}),t("    insertSelfEdges",()=>{eA(e)}),t("    adjustCoordinateSystem",()=>{rl.adjust(e)}),t("    position",()=>{PT(e)}),t("    positionSelfEdges",()=>{tA(e)}),t("    removeBorderNodes",()=>{ZT(e)}),t("    normalize.undo",()=>{Kf.undo(e)}),t("    fixupEdgeLabelCoords",()=>{KT(e)}),t("    undoCoordinateSystem",()=>{rl.undo(e)}),t("    translateGraph",()=>{YT(e)}),t("    assignNodeIntersects",()=>{qT(e)}),t("    reversePoints",()=>{QT(e)}),t("    acyclic.undo",()=>{qf.undo(e)})},DT=(e,t)=>{const r=t._nodes||{};e.nodes().forEach(n=>{const i=e.node(n);r[n]!==void 0?(i.fixorder=r[n]._order,delete r[n]._order):delete i.fixorder})},FT=(e,t)=>{e.nodes().forEach(r=>{var n;const i=e.node(r),a=t.node(r);i&&(i.x=a.x,i.y=a.y,i._order=a.order,i._rank=a.rank,!((n=t.children(r))===null||n===void 0)&&n.length&&(i.width=a.width,i.height=a.height))}),e.edges().forEach(r=>{const n=e.edge(r),i=t.edge(r);n.points=i.points,i.hasOwnProperty("x")&&(n.x=i.x,n.y=i.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height},GT=["nodesep","edgesep","ranksep","marginx","marginy"],BT={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Vs=["acyclicer","ranker","rankdir","align"],UT=["width","height","layer","fixorder"],ul={width:0,height:0},$T=["minlen","weight","width","height","labeloffset"],VT={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},js=["labelpos"],jT=e=>{const t=new MT({multigraph:!0,compound:!0}),r=Hs(e.graph()),n={};return Vs==null||Vs.forEach(i=>{r[i]!==void 0&&(n[i]=r[i])}),t.setGraph(Object.assign({},BT,zs(r,GT),n)),e.nodes().forEach(i=>{const a=Hs(e.node(i)),o=zs(a,UT);Object.keys(ul).forEach(s=>{o[s]===void 0&&(o[s]=ul[s])}),t.setNode(i,o),t.setParent(i,e.parent(i))}),e.edges().forEach(i=>{const a=Hs(e.edge(i)),o={};js==null||js.forEach(s=>{a[s]!==void 0&&(o[s]=a[s])}),t.setEdge(i,Object.assign({},VT,zs(a,$T),o))}),t},zT=e=>{const t=e.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,e.nodes().forEach(r=>{const n=e.node(r);isNaN(n.layer)||(n.layer?n.layer*=2:n.layer=0)}),e.edges().forEach(r=>{var n;const i=e.edge(r);i.minlen*=2,((n=i.labelpos)===null||n===void 0?void 0:n.toLowerCase())!=="c"&&(t.rankdir==="TB"||t.rankdir==="BT"?i.width+=i.labeloffset:i.height+=i.labeloffset)})},HT=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.width&&r.height){const n=e.node(t.v),i=e.node(t.w),a={e:t,rank:(i.rank-n.rank)/2+n.rank};Yt.addDummyNode(e,"edge-proxy",a,"_ep")}})},XT=e=>{let t=0;e.nodes().forEach(r=>{const n=e.node(r);n.borderTop&&(n.minRank=e.node(n.borderTop).rank,n.maxRank=e.node(n.borderBottom).rank,t=Math.max(t,n.maxRank||-1/0))}),e.graph().maxRank=t},WT=e=>{e.nodes().forEach(t=>{const r=e.node(t);r.dummy==="edge-proxy"&&(e.edge(r.e).labelRank=r.rank,e.removeNode(t))})},YT=e=>{let t=Number.POSITIVE_INFINITY,r=0,n=Number.POSITIVE_INFINITY,i=0;const a=e.graph(),o=a.marginx||0,s=a.marginy||0,u=c=>{if(!c)return;const f=c.x,d=c.y,v=c.width,g=c.height;!isNaN(f)&&!isNaN(v)&&(t=Math.min(t,f-v/2),r=Math.max(r,f+v/2)),!isNaN(d)&&!isNaN(g)&&(n=Math.min(n,d-g/2),i=Math.max(i,d+g/2))};e.nodes().forEach(c=>{u(e.node(c))}),e.edges().forEach(c=>{const f=e.edge(c);f.hasOwnProperty("x")&&u(f)}),t-=o,n-=s,e.nodes().forEach(c=>{const f=e.node(c);f.x-=t,f.y-=n}),e.edges().forEach(c=>{var f;const d=e.edge(c);(f=d.points)===null||f===void 0||f.forEach(v=>{v.x-=t,v.y-=n}),d.hasOwnProperty("x")&&(d.x-=t),d.hasOwnProperty("y")&&(d.y-=n)}),a.width=r-t+o,a.height=i-n+s},qT=e=>{e.edges().forEach(t=>{const r=e.edge(t),n=e.node(t.v),i=e.node(t.w);let a,o;r.points?(a=r.points[0],o=r.points[r.points.length-1]):(r.points=[],a=i,o=n),r.points.unshift(Yt.intersectRect(n,a)),r.points.push(Yt.intersectRect(i,o))})},KT=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.hasOwnProperty("x"))switch((r.labelpos==="l"||r.labelpos==="r")&&(r.width-=r.labeloffset),r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset;break}})},QT=e=>{e.edges().forEach(t=>{const r=e.edge(t);r.reversed&&r.points.reverse()})},ZT=e=>{e.nodes().forEach(t=>{var r,n,i;if(!((r=e.children(t))===null||r===void 0)&&r.length){const a=e.node(t),o=e.node(a.borderTop),s=e.node(a.borderBottom),u=e.node(a.borderLeft[((n=a.borderLeft)===null||n===void 0?void 0:n.length)-1]),c=e.node(a.borderRight[((i=a.borderRight)===null||i===void 0?void 0:i.length)-1]);a.width=Math.abs((c==null?void 0:c.x)-(u==null?void 0:u.x))||10,a.height=Math.abs((s==null?void 0:s.y)-(o==null?void 0:o.y))||10,a.x=((u==null?void 0:u.x)||0)+a.width/2,a.y=((o==null?void 0:o.y)||0)+a.height/2}}),e.nodes().forEach(t=>{e.node(t).dummy==="border"&&e.removeNode(t)})},JT=e=>{e.edges().forEach(t=>{if(t.v===t.w){const r=e.node(t.v);r.selfEdges||(r.selfEdges=[]),r.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}})},eA=e=>{const t=Yt.buildLayerMatrix(e);t==null||t.forEach(r=>{let n=0;r==null||r.forEach((i,a)=>{var o;const s=e.node(i);s.order=a+n,(o=s.selfEdges)===null||o===void 0||o.forEach(u=>{Yt.addDummyNode(e,"selfedge",{width:u.label.width,height:u.label.height,rank:s.rank,order:a+ ++n,e:u.e,label:u.label},"_se")}),delete s.selfEdges})})},tA=e=>{e.nodes().forEach(t=>{const r=e.node(t);if(r.dummy==="selfedge"){const n=e.node(r.e.v),i=n.x+n.width/2,a=n.y,o=r.x-i,s=n.height/2;e.setEdge(r.e,r.label),e.removeNode(t),r.label.points=[{x:i+2*o/3,y:a-s},{x:i+5*o/6,y:a-s},{y:a,x:i+o},{x:i+5*o/6,y:a+s},{x:i+2*o/3,y:a+s}],r.label.x=r.x,r.label.y=r.y}})},zs=(e,t)=>{const r={};return t==null||t.forEach(n=>{e[n]!==void 0&&(r[n]=+e[n])}),r},Hs=e=>{const t={};return Object.keys(e).forEach(r=>{const n=e[r];t[r.toLowerCase()]=n}),t};function Ge(e,t,r,n){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Be(e,t,r,n,i){var a={};return Object.keys(n).forEach(function(o){a[o]=n[o]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(o,s){return s(e,t,o)||o},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0?(Object.defineProperty(e,t,a),null):a}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var cl;(function(e){(function(t){var r=typeof su=="object"?su:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(e);typeof r.Reflect>"u"?r.Reflect=e:n=i(r.Reflect,n),t(n);function i(a,o){return function(s,u){typeof a[s]!="function"&&Object.defineProperty(a,s,{configurable:!0,writable:!0,value:u}),o&&o(s,u)}}})(function(t){var r=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",s={__proto__:[]}instanceof Array,u=!o&&!s,c={create:o?function(){return y(Object.create(null))}:s?function(){return y({__proto__:null})}:function(){return y({})},has:u?function(z,oe){return r.call(z,oe)}:function(z,oe){return oe in z},get:u?function(z,oe){return r.call(z,oe)?z[oe]:void 0}:function(z,oe){return z[oe]}},f=Object.getPrototypeOf(Function),d=typeof process=="object"&&process["env"]&&process["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",v=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Yn(),g=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:$o(),T=!d&&typeof WeakMap=="function"?WeakMap:Vo(),C=new T;function x(z,oe,ge,xe){if(Tt(ge)){if(!Aa(z))throw new TypeError;if(!Ri(oe))throw new TypeError;return $e(z,oe)}else{if(!Aa(z))throw new TypeError;if(!Mt(oe))throw new TypeError;if(!Mt(xe)&&!Tt(xe)&&!qt(xe))throw new TypeError;return qt(xe)&&(xe=void 0),ge=xr(ge),Ke(z,oe,ge,xe)}}t("decorate",x);function $(z,oe){function ge(xe,De){if(!Mt(xe))throw new TypeError;if(!Tt(De)&&!Sa(De))throw new TypeError;mt(z,oe,xe,De)}return ge}t("metadata",$);function Q(z,oe,ge,xe){if(!Mt(ge))throw new TypeError;return Tt(xe)||(xe=xr(xe)),mt(z,oe,ge,xe)}t("defineMetadata",Q);function X(z,oe,ge){if(!Mt(oe))throw new TypeError;return Tt(ge)||(ge=xr(ge)),lt(z,oe,ge)}t("hasMetadata",X);function he(z,oe,ge){if(!Mt(oe))throw new TypeError;return Tt(ge)||(ge=xr(ge)),Me(z,oe,ge)}t("hasOwnMetadata",he);function ae(z,oe,ge){if(!Mt(oe))throw new TypeError;return Tt(ge)||(ge=xr(ge)),wt(z,oe,ge)}t("getMetadata",ae);function Ae(z,oe,ge){if(!Mt(oe))throw new TypeError;return Tt(ge)||(ge=xr(ge)),fr(z,oe,ge)}t("getOwnMetadata",Ae);function Ie(z,oe){if(!Mt(z))throw new TypeError;return Tt(oe)||(oe=xr(oe)),ct(z,oe)}t("getMetadataKeys",Ie);function Ve(z,oe){if(!Mt(z))throw new TypeError;return Tt(oe)||(oe=xr(oe)),Lt(z,oe)}t("getOwnMetadataKeys",Ve);function tt(z,oe,ge){if(!Mt(oe))throw new TypeError;Tt(ge)||(ge=xr(ge));var xe=He(oe,ge,!1);if(Tt(xe)||!xe.delete(z))return!1;if(xe.size>0)return!0;var De=C.get(oe);return De.delete(ge),De.size>0||C.delete(oe),!0}t("deleteMetadata",tt);function $e(z,oe){for(var ge=z.length-1;ge>=0;--ge){var xe=z[ge],De=xe(oe);if(!Tt(De)&&!qt(De)){if(!Ri(De))throw new TypeError;oe=De}}return oe}function Ke(z,oe,ge,xe){for(var De=z.length-1;De>=0;--De){var Kt=z[De],nt=Kt(oe,ge,xe);if(!Tt(nt)&&!qt(nt)){if(!Mt(nt))throw new TypeError;xe=nt}}return xe}function He(z,oe,ge){var xe=C.get(z);if(Tt(xe)){if(!ge)return;xe=new v,C.set(z,xe)}var De=xe.get(oe);if(Tt(De)){if(!ge)return;De=new v,xe.set(oe,De)}return De}function lt(z,oe,ge){var xe=Me(z,oe,ge);if(xe)return!0;var De=Wn(oe);return qt(De)?!1:lt(z,De,ge)}function Me(z,oe,ge){var xe=He(oe,ge,!1);return Tt(xe)?!1:nn(xe.has(z))}function wt(z,oe,ge){var xe=Me(z,oe,ge);if(xe)return fr(z,oe,ge);var De=Wn(oe);if(!qt(De))return wt(z,De,ge)}function fr(z,oe,ge){var xe=He(oe,ge,!1);if(!Tt(xe))return xe.get(z)}function mt(z,oe,ge,xe){var De=He(ge,xe,!0);De.set(z,oe)}function ct(z,oe){var ge=Lt(z,oe),xe=Wn(z);if(xe===null)return ge;var De=ct(xe,oe);if(De.length<=0)return ge;if(ge.length<=0)return De;for(var Kt=new g,nt=[],ft=0,qe=ge;ft<qe.length;ft++){var bt=qe[ft],Et=Kt.has(bt);Et||(Kt.add(bt),nt.push(bt))}for(var Gt=0,qn=De;Gt<qn.length;Gt++){var bt=qn[Gt],Et=Kt.has(bt);Et||(Kt.add(bt),nt.push(bt))}return nt}function Lt(z,oe){var ge=[],xe=He(z,oe,!1);if(Tt(xe))return ge;for(var De=xe.keys(),Kt=wa(De),nt=0;;){var ft=Uo(Kt);if(!ft)return ge.length=nt,ge;var qe=Ra(ft);try{ge[nt]=qe}catch(bt){try{lr(Kt)}finally{throw bt}}nt++}}function Ct(z){if(z===null)return 1;switch(typeof z){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return z===null?1:6;default:return 6}}function Tt(z){return z===void 0}function qt(z){return z===null}function Mr(z){return typeof z=="symbol"}function Mt(z){return typeof z=="object"?z!==null:typeof z=="function"}function Hn(z,oe){switch(Ct(z)){case 0:return z;case 1:return z;case 2:return z;case 3:return z;case 4:return z;case 5:return z}var ge=oe===3?"string":oe===5?"number":"default",xe=Ci(z,i);if(xe!==void 0){var De=xe.call(z,ge);if(Mt(De))throw new TypeError;return De}return Xn(z,ge==="default"?"number":ge)}function Xn(z,oe){if(oe==="string"){var ge=z.toString;if(an(ge)){var xe=ge.call(z);if(!Mt(xe))return xe}var De=z.valueOf;if(an(De)){var xe=De.call(z);if(!Mt(xe))return xe}}else{var De=z.valueOf;if(an(De)){var xe=De.call(z);if(!Mt(xe))return xe}var Kt=z.toString;if(an(Kt)){var xe=Kt.call(z);if(!Mt(xe))return xe}}throw new TypeError}function nn(z){return!!z}function Bo(z){return""+z}function xr(z){var oe=Hn(z,3);return Mr(oe)?oe:Bo(oe)}function Aa(z){return Array.isArray?Array.isArray(z):z instanceof Object?z instanceof Array:Object.prototype.toString.call(z)==="[object Array]"}function an(z){return typeof z=="function"}function Ri(z){return typeof z=="function"}function Sa(z){switch(Ct(z)){case 3:return!0;case 4:return!0;default:return!1}}function Ci(z,oe){var ge=z[oe];if(ge!=null){if(!an(ge))throw new TypeError;return ge}}function wa(z){var oe=Ci(z,a);if(!an(oe))throw new TypeError;var ge=oe.call(z);if(!Mt(ge))throw new TypeError;return ge}function Ra(z){return z.value}function Uo(z){var oe=z.next();return oe.done?!1:oe}function lr(z){var oe=z.return;oe&&oe.call(z)}function Wn(z){var oe=Object.getPrototypeOf(z);if(typeof z!="function"||z===f||oe!==f)return oe;var ge=z.prototype,xe=ge&&Object.getPrototypeOf(ge);if(xe==null||xe===Object.prototype)return oe;var De=xe.constructor;return typeof De!="function"||De===z?oe:De}function Yn(){var z={},oe=[],ge=function(){function nt(ft,qe,bt){this._index=0,this._keys=ft,this._values=qe,this._selector=bt}return nt.prototype["@@iterator"]=function(){return this},nt.prototype[a]=function(){return this},nt.prototype.next=function(){var ft=this._index;if(ft>=0&&ft<this._keys.length){var qe=this._selector(this._keys[ft],this._values[ft]);return ft+1>=this._keys.length?(this._index=-1,this._keys=oe,this._values=oe):this._index++,{value:qe,done:!1}}return{value:void 0,done:!0}},nt.prototype.throw=function(ft){throw this._index>=0&&(this._index=-1,this._keys=oe,this._values=oe),ft},nt.prototype.return=function(ft){return this._index>=0&&(this._index=-1,this._keys=oe,this._values=oe),{value:ft,done:!0}},nt}();return function(){function nt(){this._keys=[],this._values=[],this._cacheKey=z,this._cacheIndex=-2}return Object.defineProperty(nt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),nt.prototype.has=function(ft){return this._find(ft,!1)>=0},nt.prototype.get=function(ft){var qe=this._find(ft,!1);return qe>=0?this._values[qe]:void 0},nt.prototype.set=function(ft,qe){var bt=this._find(ft,!0);return this._values[bt]=qe,this},nt.prototype.delete=function(ft){var qe=this._find(ft,!1);if(qe>=0){for(var bt=this._keys.length,Et=qe+1;Et<bt;Et++)this._keys[Et-1]=this._keys[Et],this._values[Et-1]=this._values[Et];return this._keys.length--,this._values.length--,ft===this._cacheKey&&(this._cacheKey=z,this._cacheIndex=-2),!0}return!1},nt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=z,this._cacheIndex=-2},nt.prototype.keys=function(){return new ge(this._keys,this._values,xe)},nt.prototype.values=function(){return new ge(this._keys,this._values,De)},nt.prototype.entries=function(){return new ge(this._keys,this._values,Kt)},nt.prototype["@@iterator"]=function(){return this.entries()},nt.prototype[a]=function(){return this.entries()},nt.prototype._find=function(ft,qe){return this._cacheKey!==ft&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ft)),this._cacheIndex<0&&qe&&(this._cacheIndex=this._keys.length,this._keys.push(ft),this._values.push(void 0)),this._cacheIndex},nt}();function xe(nt,ft){return nt}function De(nt,ft){return ft}function Kt(nt,ft){return[nt,ft]}}function $o(){return function(){function z(){this._map=new v}return Object.defineProperty(z.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),z.prototype.has=function(oe){return this._map.has(oe)},z.prototype.add=function(oe){return this._map.set(oe,oe),this},z.prototype.delete=function(oe){return this._map.delete(oe)},z.prototype.clear=function(){this._map.clear()},z.prototype.keys=function(){return this._map.keys()},z.prototype.values=function(){return this._map.values()},z.prototype.entries=function(){return this._map.entries()},z.prototype["@@iterator"]=function(){return this.keys()},z.prototype[a]=function(){return this.keys()},z}()}function Vo(){var z=16,oe=c.create(),ge=xe();return function(){function qe(){this._key=xe()}return qe.prototype.has=function(bt){var Et=De(bt,!1);return Et!==void 0?c.has(Et,this._key):!1},qe.prototype.get=function(bt){var Et=De(bt,!1);return Et!==void 0?c.get(Et,this._key):void 0},qe.prototype.set=function(bt,Et){var Gt=De(bt,!0);return Gt[this._key]=Et,this},qe.prototype.delete=function(bt){var Et=De(bt,!1);return Et!==void 0?delete Et[this._key]:!1},qe.prototype.clear=function(){this._key=xe()},qe}();function xe(){var qe;do qe="@@WeakMap@@"+ft();while(c.has(oe,qe));return oe[qe]=!0,qe}function De(qe,bt){if(!r.call(qe,ge)){if(!bt)return;Object.defineProperty(qe,ge,{value:c.create()})}return qe[ge]}function Kt(qe,bt){for(var Et=0;Et<bt;++Et)qe[Et]=Math.random()*255|0;return qe}function nt(qe){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(qe)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(qe)):Kt(new Uint8Array(qe),qe):Kt(new Array(qe),qe)}function ft(){var qe=nt(z);qe[6]=qe[6]&79|64,qe[8]=qe[8]&191|128;for(var bt="",Et=0;Et<z;++Et){var Gt=qe[Et];(Et===4||Et===6||Et===8)&&(bt+="-"),Gt<16&&(bt+="0"),bt+=Gt.toString(16).toLowerCase()}return bt}}function y(z){return z.__=void 0,delete z.__,z}})})(cl||(cl={}));var oy={exports:{}},Nu={exports:{}};(function(e){function t(r,n){this.v=r,this.k=n}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Nu);var Ou={exports:{}},Iu={exports:{}};(function(e){function t(r,n,i,a){var o=Object.defineProperty;try{o({},"",{})}catch{o=0}e.exports=t=function(u,c,f,d){function v(g,T){t(u,g,function(C){return this._invoke(g,T,C)})}c?o?o(u,c,{value:f,enumerable:!d,configurable:!d,writable:!d}):u[c]=f:(v("next",0),v("throw",1),v("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,i,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Iu);(function(e){var t=Iu.exports;function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,i,a=typeof Symbol=="function"?Symbol:{},o=a.iterator||"@@iterator",s=a.toStringTag||"@@toStringTag";function u(x,$,Q,X){var he=$&&$.prototype instanceof f?$:f,ae=Object.create(he.prototype);return t(ae,"_invoke",function(Ae,Ie,Ve){var tt,$e,Ke,He=0,lt=Ve||[],Me=!1,wt={p:0,n:0,v:n,a:fr,f:fr.bind(n,4),d:function(ct,Lt){return tt=ct,$e=0,Ke=n,wt.n=Lt,c}};function fr(mt,ct){for($e=mt,Ke=ct,i=0;!Me&&He&&!Lt&&i<lt.length;i++){var Lt,Ct=lt[i],Tt=wt.p,qt=Ct[2];mt>3?(Lt=qt===ct)&&(Ke=Ct[($e=Ct[4])?5:($e=3,3)],Ct[4]=Ct[5]=n):Ct[0]<=Tt&&((Lt=mt<2&&Tt<Ct[1])?($e=0,wt.v=ct,wt.n=Ct[1]):Tt<qt&&(Lt=mt<3||Ct[0]>ct||ct>qt)&&(Ct[4]=mt,Ct[5]=ct,wt.n=qt,$e=0))}if(Lt||mt>1)return c;throw Me=!0,ct}return function(mt,ct,Lt){if(He>1)throw TypeError("Generator is already running");for(Me&&ct===1&&fr(ct,Lt),$e=ct,Ke=Lt;(i=$e<2?n:Ke)||!Me;){tt||($e?$e<3?($e>1&&(wt.n=-1),fr($e,Ke)):wt.n=Ke:wt.v=Ke);try{if(He=2,tt){if($e||(mt="next"),i=tt[mt]){if(!(i=i.call(tt,Ke)))throw TypeError("iterator result is not an object");if(!i.done)return i;Ke=i.value,$e<2&&($e=0)}else $e===1&&(i=tt.return)&&i.call(tt),$e<2&&(Ke=TypeError("The iterator does not provide a '"+mt+"' method"),$e=1);tt=n}else if((i=(Me=wt.n<0)?Ke:Ae.call(Ie,wt))!==c)break}catch(Ct){tt=n,$e=1,Ke=Ct}finally{He=1}}return{value:i,done:Me}}}(x,Q,X),!0),ae}var c={};function f(){}function d(){}function v(){}i=Object.getPrototypeOf;var g=[][o]?i(i([][o]())):(t(i={},o,function(){return this}),i),T=v.prototype=f.prototype=Object.create(g);function C(x){return Object.setPrototypeOf?Object.setPrototypeOf(x,v):(x.__proto__=v,t(x,s,"GeneratorFunction")),x.prototype=Object.create(T),x}return d.prototype=v,t(T,"constructor",v),t(v,"constructor",d),d.displayName="GeneratorFunction",t(v,s,"GeneratorFunction"),t(T),t(T,s,"Generator"),t(T,o,function(){return this}),t(T,"toString",function(){return"[object Generator]"}),(e.exports=r=function(){return{w:u,m:C}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Ou);var sy={exports:{}},Pu={exports:{}},Lu={exports:{}};(function(e){var t=Nu.exports,r=Iu.exports;function n(i,a){function o(u,c,f,d){try{var v=i[u](c),g=v.value;return g instanceof t?a.resolve(g.v).then(function(T){o("next",T,f,d)},function(T){o("throw",T,f,d)}):a.resolve(g).then(function(T){v.value=T,f(v)},function(T){return o("throw",T,f,d)})}catch(T){d(T)}}var s;this.next||(r(n.prototype),r(n.prototype,typeof Symbol=="function"&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),r(this,"_invoke",function(u,c,f){function d(){return new a(function(v,g){o(u,f,v,g)})}return s=s?s.then(d,d):d()},!0)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Lu);(function(e){var t=Ou.exports,r=Lu.exports;function n(i,a,o,s,u){return new r(t().w(i,a,o,s),u||Promise)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Pu);(function(e){var t=Pu.exports;function r(n,i,a,o,s){var u=t(n,i,a,o,s);return u.next().then(function(c){return c.done?c.value:u.next()})}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(sy);var uy={exports:{}};(function(e){function t(r){var n=Object(r),i=[];for(var a in n)i.unshift(a);return function o(){for(;i.length;)if((a=i.pop())in n)return o.value=a,o.done=!1,o;return o.done=!0,o}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(uy);var cy={exports:{}};(function(e){var t=hb.exports.default;function r(n){if(n!=null){var i=n[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],a=0;if(i)return i.call(n);if(typeof n.next=="function")return n;if(!isNaN(n.length))return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}}}throw new TypeError(t(n)+" is not iterable")}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(cy);(function(e){var t=Nu.exports,r=Ou.exports,n=sy.exports,i=Pu.exports,a=Lu.exports,o=uy.exports,s=cy.exports;function u(){var c=r(),f=c.m(u),d=(Object.getPrototypeOf?Object.getPrototypeOf(f):f.__proto__).constructor;function v(C){var x=typeof C=="function"&&C.constructor;return!!x&&(x===d||(x.displayName||x.name)==="GeneratorFunction")}var g={throw:1,return:2,break:3,continue:3};function T(C){var x,$;return function(Q){x||(x={stop:function(){return $(Q.a,2)},catch:function(){return Q.v},abrupt:function(he,ae){return $(Q.a,g[he],ae)},delegateYield:function(he,ae,Ae){return x.resultName=ae,$(Q.d,s(he),Ae)},finish:function(he){return $(Q.f,he)}},$=function(he,ae,Ae){Q.p=x.prev,Q.n=x.next;try{return he(ae,Ae)}finally{x.next=Q.n}}),x.resultName&&(x[x.resultName]=Q.v,x.resultName=void 0),x.sent=Q.v,x.next=Q.n;try{return C.call(this,x)}finally{Q.p=x.prev,Q.n=x.next}}}return(e.exports=u=function(){return{wrap:function($,Q,X,he){return c.w(T($),Q,X,he&&he.reverse())},isGeneratorFunction:v,mark:c.m,awrap:function($,Q){return new t($,Q)},AsyncIterator:a,async:function($,Q,X,he,ae){return(v(Q)?i:n)(T($),Q,X,he,ae)},keys:o,values:s}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=u,e.exports.__esModule=!0,e.exports.default=e.exports})(oy);var go=oy.exports(),Ne=go;try{regeneratorRuntime=go}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=go:Function("r","regeneratorRuntime = r")(go)}function fl(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function _t(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function o(u){fl(a,n,i,o,s,"next",u)}function s(u){fl(a,n,i,o,s,"throw",u)}o(void 0)})}}var rA=-1,nA=1;function Vr(){return nA++}var jn=function e(t){Le(this,e)},zn=function(){function e(t){Le(this,e),this.clazz=void 0,this.components=[],this.entities=[],this.lookup={},this.clazz=t}return ze(e,[{key:"clear",value:function(){this.components=[],this.entities=[],this.lookup={}}},{key:"contains",value:function(r){return this.lookup[r]>-1}},{key:"create",value:function(r,n){this.lookup[r]=this.components.length;var i=new this.clazz(n||{});return this.components.push(i),this.entities.push(r),i}},{key:"remove",value:function(r){var n=this.lookup[r];n>-1&&n<this.components.length-1&&(this.components[n]=this.components[this.components.length-1],this.entities[n]=this.entities[this.entities.length-1],this.lookup[this.entities[n]]=n),this.components.pop(),this.entities.pop(),delete this.lookup[r]}},{key:"removeKeepSorted",value:function(r){var n=this.lookup[r];if(n>-1){var i=this.entities[n];if(n<this.components.length-1){for(var a=n+1;a<this.components.length;++a)this.components[a-1]=this.components[a];for(var o=n+1;o<this.entities.length;++o)this.entities[o-1]=this.entities[o],this.lookup[this.entities[o-1]]=o-1}this.components.pop(),this.entities.pop(),delete this.lookup[i]}}},{key:"moveItem",value:function(r,n){if(r!==n){for(var i=this.components[r],a=this.entities[r],o=r<n?1:-1,s=r;s!==n;s+=o){var u=s+o;this.components[s]=this.components[u],this.entities[s]=this.entities[u],this.lookup[this.entities[s]]=s}this.components[n]=i,this.entities[n]=a,this.lookup[a]=n}}},{key:"getEntity",value:function(r){return this.entities[r]}},{key:"getComponent",value:function(r){return this.components[r]}},{key:"getComponentByEntity",value:function(r){var n=this.lookup[r];return n>-1?this.components[n]:null}},{key:"getCount",value:function(){return this.components.length}},{key:"getEntityByComponentIndex",value:function(r){for(var n=0,i=Object.keys(this.lookup);n<i.length;n++){var a=i[n],o=Number(a);if(this.lookup[o]===r)return o}return rA}},{key:"find",value:function(r){for(var n=0;n<this.getCount();n++){var i=this.getComponent(n);if(r(i,n))return i}return null}},{key:"findIndex",value:function(r){for(var n=0;n<this.getCount();n++){var i=this.getComponent(n);if(r(i,n))return n}return-1}},{key:"forEach",value:function(r){for(var n=0,i=Object.keys(this.lookup);n<i.length;n++){var a=i[n],o=Number(a),s=this.lookup[o];r(o,this.getComponent(s))}}},{key:"forEachAsync",value:function(){var t=_t(Ne.mark(function n(i){var a,o,s,u,c;return Ne.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:a=0,o=Object.keys(this.lookup);case 1:if(!(a<o.length)){d.next=10;break}return s=o[a],u=Number(s),c=this.lookup[u],d.next=7,i(u,this.getComponent(c));case 7:a++,d.next=1;break;case 10:case"end":return d.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"map",value:function(r){for(var n=[],i=0,a=Object.keys(this.lookup);i<a.length;i++){var o=a[i],s=Number(o),u=this.lookup[s];n.push(r(s,this.getComponent(u)))}return n}}]),e}();function iA(e){if(Array.isArray(e))return e}function aA(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,o,s=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(f){c=!0,i=f}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}function oA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ko(e,t){return iA(e)||aA(e,t)||Pm(e,t)||oA()}var Lr="named",fy="name",Mu="unmanaged",ly="optional",Do="inject",ma="multi_inject",dy="inversify:tagged",hy="inversify:tagged_props",lu="inversify:paramtypes",sA="design:paramtypes",ll="post_construct";function uA(){return[Do,ma,fy,Mu,Lr,ly]}var dl=uA(),or={Request:"Request",Singleton:"Singleton",Transient:"Transient"},ar={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},en={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},cA=0;function ga(){return cA++}var fA=function(){function e(t,r){this.id=ga(),this.activated=!1,this.serviceIdentifier=t,this.scope=r,this.type=ar.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===or.Singleton?this.activated:!1,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}(),lA="Cannot apply @injectable decorator multiple times.",dA="Metadata key was used more than once in a parameter:",Xi="NULL argument",hl="Key Not Found",hA="Ambiguous match found for serviceIdentifier:",vA="Could not unbind serviceIdentifier:",pA="No matching bindings found for serviceIdentifier:",mA="Missing required @injectable annotation in:",yA="Missing required @inject or @multiInject annotation in:",_A=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},EA="Circular dependency found:",bA="Invalid binding type:",gA="No snapshot available to restore.",TA="Invalid return type in middleware. Middleware must return!",AA="Value provided to function binding must be a function!",SA="The toSelf function can only be applied when a constructor is used as service identifier",wA="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",RA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+(e[0]+" must be >= than the number of constructor arguments of its base class.")},CA="Invalid Container constructor argument. Container options must be an object.",xA="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",NA="Invalid Container option. Auto bind injectable must be a boolean",OA="Invalid Container option. Skip base check must be a boolean",IA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},PA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency "+("in one of the '"+e[0]+"' bindings. Please investigate bindings with")+("service identifier '"+e[1]+"'.")},LA="Maximum call stack size exceeded",MA=function(){function e(){}return e.prototype.getConstructorMetadata=function(t){var r=Reflect.getMetadata(lu,t),n=Reflect.getMetadata(dy,t);return{compilerGeneratedMetadata:r,userGeneratedMetadata:n||{}}},e.prototype.getPropertiesMetadata=function(t){var r=Reflect.getMetadata(hy,t)||[];return r},e}(),To={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function vy(e){return e instanceof RangeError||e.message===LA}function ya(e){if(typeof e=="function"){var t=e;return t.name}else{if(typeof e=="symbol")return e.toString();var t=e;return t}}function vl(e,t,r){var n="",i=r(e,t);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(a){var o="Object";a.implementationType!==null&&(o=Fo(a.implementationType)),n=n+`
 `+o,a.constraint.metaData&&(n=n+" - "+a.constraint.metaData)})),n}function py(e,t){return e.parentRequest===null?!1:e.parentRequest.serviceIdentifier===t?!0:py(e.parentRequest,t)}function kA(e){function t(n,i){i===void 0&&(i=[]);var a=ya(n.serviceIdentifier);return i.push(a),n.parentRequest!==null?t(n.parentRequest,i):i}var r=t(e);return r.reverse().join(" --> ")}function my(e){e.childRequests.forEach(function(t){if(py(t,t.serviceIdentifier)){var r=kA(t);throw new Error(EA+" "+r)}else my(t)})}function DA(e,t){if(t.isTagged()||t.isNamed()){var r="",n=t.getNamedTag(),i=t.getCustomTags();return n!==null&&(r+=n.toString()+`
`),i!==null&&i.forEach(function(a){r+=a.toString()+`
`})," "+e+`
 `+e+" - "+r}else return" "+e}function Fo(e){if(e.name)return e.name;var t=e.toString(),r=t.match(/^function\s*([^\s(]+)/);return r?r[1]:"Anonymous function: "+t}var yy=function(){function e(t){this.id=ga(),this.container=t}return e.prototype.addPlan=function(t){this.plan=t},e.prototype.setCurrentRequest=function(t){this.currentRequest=t},e}(),_n=function(){function e(t,r){this.key=t,this.value=r}return e.prototype.toString=function(){return this.key===Lr?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}(),FA=function(){function e(t,r){this.parentContext=t,this.rootRequest=r}return e}();function _y(e,t,r,n){var i=dy;by(i,e,t,n,r)}function Ey(e,t,r){var n=hy;by(n,e.constructor,t,r)}function by(e,t,r,n,i){var a={},o=typeof i=="number",s=i!==void 0&&o?i.toString():r;if(o&&r!==void 0)throw new Error(wA);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var u=a[s];if(!Array.isArray(u))u=[];else for(var c=0,f=u;c<f.length;c++){var d=f[c];if(d.key===n.key)throw new Error(dA+" "+d.key.toString())}u.push(n),a[s]=u,Reflect.defineMetadata(e,a,t)}var GA=function(){function e(t){this._cb=t}return e.prototype.unwrap=function(){return this._cb()},e}();function Ue(e){return function(t,r,n){if(e===void 0)throw new Error(_A(t.name));var i=new _n(Do,e);typeof n=="number"?_y(t,r,n,i):Ey(t,r,i)}}var BA=function(){function e(t){this.str=t}return e.prototype.startsWith=function(t){return this.str.indexOf(t)===0},e.prototype.endsWith=function(t){var r="",n=t.split("").reverse().join("");return r=this.str.split("").reverse().join(""),this.startsWith.call({str:r},n)},e.prototype.contains=function(t){return this.str.indexOf(t)!==-1},e.prototype.equals=function(t){return this.str===t},e.prototype.value=function(){return this.str},e}(),Go=function(){function e(t,r,n,i){this.id=ga(),this.type=t,this.serviceIdentifier=n,this.name=new BA(r||""),this.metadata=new Array;var a=null;typeof i=="string"?a=new _n(Lr,i):i instanceof _n&&(a=i),a!==null&&this.metadata.push(a)}return e.prototype.hasTag=function(t){for(var r=0,n=this.metadata;r<n.length;r++){var i=n[r];if(i.key===t)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(ma)},e.prototype.matchesArray=function(t){return this.matchesTag(ma)(t)},e.prototype.isNamed=function(){return this.hasTag(Lr)},e.prototype.isTagged=function(){return this.metadata.some(function(t){return dl.every(function(r){return t.key!==r})})},e.prototype.isOptional=function(){return this.matchesTag(ly)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(t){return t.key===Lr})[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(t){return dl.every(function(r){return t.key!==r})}):null},e.prototype.matchesNamedTag=function(t){return this.matchesTag(Lr)(t)},e.prototype.matchesTag=function(t){var r=this;return function(n){for(var i=0,a=r.metadata;i<a.length;i++){var o=a[i];if(o.key===t&&o.value===n)return!0}return!1}},e}(),No=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};function UA(e,t){var r=Fo(t),n=gy(e,r,t,!1);return n}function gy(e,t,r,n){var i=e.getConstructorMetadata(r),a=i.compilerGeneratedMetadata;if(a===void 0){var o=mA+" "+t+".";throw new Error(o)}var s=i.userGeneratedMetadata,u=Object.keys(s),c=r.length===0&&u.length>0,f=u.length>r.length,d=c||f?u.length:r.length,v=VA(n,t,a,s,d),g=Ty(e,r),T=No(No([],v),g);return T}function $A(e,t,r,n,i){var a=i[e.toString()]||[],o=Sy(a),s=o.unmanaged!==!0,u=n[e],c=o.inject||o.multiInject;if(u=c||u,u instanceof GA&&(u=u.unwrap()),s){var f=u===Object,d=u===Function,v=u===void 0,g=f||d||v;if(!t&&g){var T=yA+" argument "+e+" in class "+r+".";throw new Error(T)}var C=new Go(en.ConstructorArgument,o.targetName,u);return C.metadata=a,C}return null}function VA(e,t,r,n,i){for(var a=[],o=0;o<i;o++){var s=o,u=$A(s,e,t,r,n);u!==null&&a.push(u)}return a}function Ty(e,t){for(var r=e.getPropertiesMetadata(t),n=[],i=Object.keys(r),a=0,o=i;a<o.length;a++){var s=o[a],u=r[s],c=Sy(r[s]),f=c.targetName||s,d=c.inject||c.multiInject,v=new Go(en.ClassProperty,f,d);v.metadata=u,n.push(v)}var g=Object.getPrototypeOf(t.prototype).constructor;if(g!==Object){var T=Ty(e,g);n=No(No([],n),T)}return n}function Ay(e,t){var r=Object.getPrototypeOf(t.prototype).constructor;if(r!==Object){var n=Fo(r),i=gy(e,n,r,!0),a=i.map(function(u){return u.metadata.filter(function(c){return c.key===Mu})}),o=[].concat.apply([],a).length,s=i.length-o;return s>0?s:Ay(e,r)}else return 0}function Sy(e){var t={};return e.forEach(function(r){t[r.key.toString()]=r.value}),{inject:t[Do],multiInject:t[ma],targetName:t[fy],unmanaged:t[Mu]}}var ku=function(){function e(t,r,n,i,a){this.id=ga(),this.serviceIdentifier=t,this.parentContext=r,this.parentRequest=n,this.target=a,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return e.prototype.addChildRequest=function(t,r,n){var i=new e(t,this.parentContext,this,r,n);return this.childRequests.push(i),i},e}();function du(e){return e._bindingDictionary}function jA(e,t,r,n,i,a){var o=e?ma:Do,s=new _n(o,r),u=new Go(t,n,r,s);if(i!==void 0){var c=new _n(i,a);u.metadata.push(c)}return u}function pl(e,t,r,n,i){var a=_a(r.container,i.serviceIdentifier),o=[];return a.length===To.NoBindingsAvailable&&r.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(r.container.bind(i.serviceIdentifier).toSelf(),a=_a(r.container,i.serviceIdentifier)),t?o=a:o=a.filter(function(s){var u=new ku(s.serviceIdentifier,r,n,s,i);return s.constraint(u)}),zA(i.serviceIdentifier,o,i,r.container),o}function zA(e,t,r,n){switch(t.length){case To.NoBindingsAvailable:if(r.isOptional())return t;var i=ya(e),a=pA;throw a+=DA(i,r),a+=vl(n,i,_a),new Error(a);case To.OnlyOneBindingAvailable:if(!r.isArray())return t;case To.MultipleBindingsAvailable:default:if(r.isArray())return t;var i=ya(e),a=hA+" "+i;throw a+=vl(n,i,_a),new Error(a)}}function wy(e,t,r,n,i,a){var o,s;if(i===null){o=pl(e,t,n,null,a),s=new ku(r,n,null,o,a);var u=new FA(n,s);n.addPlan(u)}else o=pl(e,t,n,i,a),s=i.addChildRequest(a.serviceIdentifier,o,a);o.forEach(function(c){var f=null;if(a.isArray())f=s.addChildRequest(c.serviceIdentifier,c,a);else{if(c.cache)return;f=s}if(c.type===ar.Instance&&c.implementationType!==null){var d=UA(e,c.implementationType);if(!n.container.options.skipBaseClassChecks){var v=Ay(e,c.implementationType);if(d.length<v){var g=RA(Fo(c.implementationType));throw new Error(g)}}d.forEach(function(T){wy(e,!1,T.serviceIdentifier,n,f,T)})}})}function _a(e,t){var r=[],n=du(e);return n.hasKey(t)?r=n.get(t):e.parent!==null&&(r=_a(e.parent,t)),r}function HA(e,t,r,n,i,a,o,s){s===void 0&&(s=!1);var u=new yy(t),c=jA(r,n,i,"",a,o);try{return wy(e,s,i,u,null,c),u}catch(f){throw vy(f)&&u.plan&&my(u.plan.rootRequest),f}}function XA(e,t,r,n){var i=new Go(en.Variable,"",t,new _n(r,n)),a=new yy(e),o=new ku(t,a,null,[],i);return o}var WA=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};function YA(e,t,r){var n=t.filter(function(a){return a.target!==null&&a.target.type===en.ClassProperty}),i=n.map(r);return n.forEach(function(a,o){var s="";s=a.target.name.value();var u=i[o];e[s]=u}),e}function qA(e,t){return new(e.bind.apply(e,WA([void 0],t)))}function KA(e,t){if(Reflect.hasMetadata(ll,e)){var r=Reflect.getMetadata(ll,e);try{t[r.value]()}catch(n){throw new Error(IA(e.name,n.message))}}}function QA(e,t,r){var n=null;if(t.length>0){var i=t.filter(function(o){return o.target!==null&&o.target.type===en.ConstructorArgument}),a=i.map(r);n=qA(e,a),n=YA(n,t,r)}else n=new e;return KA(e,n),n}var Xs=function(e,t,r){try{return r()}catch(n){throw vy(n)?new Error(PA(e,t.toString())):n}},hu=function(e){return function(t){t.parentContext.setCurrentRequest(t);var r=t.bindings,n=t.childRequests,i=t.target&&t.target.isArray(),a=!t.parentRequest||!t.parentRequest.target||!t.target||!t.parentRequest.target.matchesArray(t.target.serviceIdentifier);if(i&&a)return n.map(function(d){var v=hu(e);return v(d)});var o=null;if(t.target.isOptional()&&r.length===0)return;var s=r[0],u=s.scope===or.Singleton,c=s.scope===or.Request;if(u&&s.activated)return s.cache;if(c&&e!==null&&e.has(s.id))return e.get(s.id);if(s.type===ar.ConstantValue)o=s.cache,s.activated=!0;else if(s.type===ar.Function)o=s.cache,s.activated=!0;else if(s.type===ar.Constructor)o=s.implementationType;else if(s.type===ar.DynamicValue&&s.dynamicValue!==null)o=Xs("toDynamicValue",s.serviceIdentifier,function(){return s.dynamicValue(t.parentContext)});else if(s.type===ar.Factory&&s.factory!==null)o=Xs("toFactory",s.serviceIdentifier,function(){return s.factory(t.parentContext)});else if(s.type===ar.Provider&&s.provider!==null)o=Xs("toProvider",s.serviceIdentifier,function(){return s.provider(t.parentContext)});else if(s.type===ar.Instance&&s.implementationType!==null)o=QA(s.implementationType,n,hu(e));else{var f=ya(t.serviceIdentifier);throw new Error(bA+" "+f)}return typeof s.onActivation=="function"&&(o=s.onActivation(t.parentContext,o)),u&&(s.cache=o,s.activated=!0),c&&e!==null&&!e.has(s.id)&&e.set(s.id,o),o}};function ZA(e){var t=hu(e.plan.rootRequest.requestScope);return t(e.plan.rootRequest)}var Zr=function(e,t){var r=e.parentRequest;return r!==null?t(r)?!0:Zr(r,t):!1},ca=function(e){return function(t){var r=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(e)(t)};return r.metaData=new _n(e,t),r}},no=ca(Lr),Ws=function(e){return function(t){var r=null;if(t!==null)if(r=t.bindings[0],typeof e=="string"){var n=r.serviceIdentifier;return n===e}else{var i=t.bindings[0].implementationType;return e===i}return!1}},Du=function(){function e(t){this._binding=t}return e.prototype.when=function(t){return this._binding.constraint=t,new ir(this._binding)},e.prototype.whenTargetNamed=function(t){return this._binding.constraint=no(t),new ir(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){var r=t.target!==null&&!t.target.isNamed()&&!t.target.isTagged();return r},new ir(this._binding)},e.prototype.whenTargetTagged=function(t,r){return this._binding.constraint=ca(t)(r),new ir(this._binding)},e.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(r){return Ws(t)(r.parentRequest)},new ir(this._binding)},e.prototype.whenParentNamed=function(t){return this._binding.constraint=function(r){return no(t)(r.parentRequest)},new ir(this._binding)},e.prototype.whenParentTagged=function(t,r){return this._binding.constraint=function(n){return ca(t)(r)(n.parentRequest)},new ir(this._binding)},e.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(r){return Zr(r,Ws(t))},new ir(this._binding)},e.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(r){return!Zr(r,Ws(t))},new ir(this._binding)},e.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(r){return Zr(r,no(t))},new ir(this._binding)},e.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(r){return!Zr(r,no(t))},new ir(this._binding)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._binding.constraint=function(n){return Zr(n,ca(t)(r))},new ir(this._binding)},e.prototype.whenNoAncestorTagged=function(t,r){return this._binding.constraint=function(n){return!Zr(n,ca(t)(r))},new ir(this._binding)},e.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(r){return Zr(r,t)},new ir(this._binding)},e.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(r){return!Zr(r,t)},new ir(this._binding)},e}(),ir=function(){function e(t){this._binding=t}return e.prototype.onActivation=function(t){return this._binding.onActivation=t,new Du(this._binding)},e}(),vn=function(){function e(t){this._binding=t,this._bindingWhenSyntax=new Du(this._binding),this._bindingOnSyntax=new ir(this._binding)}return e.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},e.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(t,r){return this._bindingWhenSyntax.whenTargetTagged(t,r)},e.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},e.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},e.prototype.whenParentTagged=function(t,r){return this._bindingWhenSyntax.whenParentTagged(t,r)},e.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},e.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},e.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,r)},e.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},e.prototype.whenNoAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenNoAncestorTagged(t,r)},e.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},e.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},e.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},e}(),JA=function(){function e(t){this._binding=t}return e.prototype.inRequestScope=function(){return this._binding.scope=or.Request,new vn(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=or.Singleton,new vn(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=or.Transient,new vn(this._binding)},e}(),ml=function(){function e(t){this._binding=t,this._bindingWhenSyntax=new Du(this._binding),this._bindingOnSyntax=new ir(this._binding),this._bindingInSyntax=new JA(t)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},e.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(t,r){return this._bindingWhenSyntax.whenTargetTagged(t,r)},e.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},e.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},e.prototype.whenParentTagged=function(t,r){return this._bindingWhenSyntax.whenParentTagged(t,r)},e.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},e.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},e.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,r)},e.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},e.prototype.whenNoAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenNoAncestorTagged(t,r)},e.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},e.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},e.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},e}(),e1=function(){function e(t){this._binding=t}return e.prototype.to=function(t){return this._binding.type=ar.Instance,this._binding.implementationType=t,new ml(this._binding)},e.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+SA);var t=this._binding.serviceIdentifier;return this.to(t)},e.prototype.toConstantValue=function(t){return this._binding.type=ar.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=or.Singleton,new vn(this._binding)},e.prototype.toDynamicValue=function(t){return this._binding.type=ar.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new ml(this._binding)},e.prototype.toConstructor=function(t){return this._binding.type=ar.Constructor,this._binding.implementationType=t,this._binding.scope=or.Singleton,new vn(this._binding)},e.prototype.toFactory=function(t){return this._binding.type=ar.Factory,this._binding.factory=t,this._binding.scope=or.Singleton,new vn(this._binding)},e.prototype.toFunction=function(t){if(typeof t!="function")throw new Error(AA);var r=this.toConstantValue(t);return this._binding.type=ar.Function,this._binding.scope=or.Singleton,r},e.prototype.toAutoFactory=function(t){return this._binding.type=ar.Factory,this._binding.factory=function(r){var n=function(){return r.container.get(t)};return n},this._binding.scope=or.Singleton,new vn(this._binding)},e.prototype.toProvider=function(t){return this._binding.type=ar.Provider,this._binding.provider=t,this._binding.scope=or.Singleton,new vn(this._binding)},e.prototype.toService=function(t){this.toDynamicValue(function(r){return r.container.get(t)})},e}(),t1=function(){function e(){}return e.of=function(t,r){var n=new e;return n.bindings=t,n.middleware=r,n},e}(),yl=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(t,r){if(t==null)throw new Error(Xi);if(r==null)throw new Error(Xi);var n=this._map.get(t);n!==void 0?(n.push(r),this._map.set(t,n)):this._map.set(t,[r])},e.prototype.get=function(t){if(t==null)throw new Error(Xi);var r=this._map.get(t);if(r!==void 0)return r;throw new Error(hl)},e.prototype.remove=function(t){if(t==null)throw new Error(Xi);if(!this._map.delete(t))throw new Error(hl)},e.prototype.removeByCondition=function(t){var r=this;this._map.forEach(function(n,i){var a=n.filter(function(o){return!t(o)});a.length>0?r._map.set(i,a):r._map.delete(i)})},e.prototype.hasKey=function(t){if(t==null)throw new Error(Xi);return this._map.has(t)},e.prototype.clone=function(){var t=new e;return this._map.forEach(function(r,n){r.forEach(function(i){return t.add(n,i.clone())})}),t},e.prototype.traverse=function(t){this._map.forEach(function(r,n){t(n,r)})},e}(),r1=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(f){try{c(n.next(f))}catch(d){o(d)}}function u(f){try{c(n.throw(f))}catch(d){o(d)}}function c(f){f.done?a(f.value):i(f.value).then(s,u)}c((n=n.apply(e,t||[])).next())})},n1=globalThis&&globalThis.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(f){return u([c,f])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=c[0]&2?i.return:c[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,c[1])).done)return a;switch(i=0,a&&(c=[c[0]&2,a.value]),c[0]){case 0:case 1:a=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!a||c[1]>a[0]&&c[1]<a[3])){r.label=c[1];break}if(c[0]===6&&r.label<a[1]){r.label=a[1],a=c;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(c);break}a[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(f){c=[6,f],i=0}finally{n=a=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},i1=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},Ry=function(){function e(t){this._appliedMiddleware=[];var r=t||{};if(typeof r!="object")throw new Error(""+CA);if(r.defaultScope===void 0)r.defaultScope=or.Transient;else if(r.defaultScope!==or.Singleton&&r.defaultScope!==or.Transient&&r.defaultScope!==or.Request)throw new Error(""+xA);if(r.autoBindInjectable===void 0)r.autoBindInjectable=!1;else if(typeof r.autoBindInjectable!="boolean")throw new Error(""+NA);if(r.skipBaseClassChecks===void 0)r.skipBaseClassChecks=!1;else if(typeof r.skipBaseClassChecks!="boolean")throw new Error(""+OA);this.options={autoBindInjectable:r.autoBindInjectable,defaultScope:r.defaultScope,skipBaseClassChecks:r.skipBaseClassChecks},this.id=ga(),this._bindingDictionary=new yl,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new MA}return e.merge=function(t,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var a=new e,o=i1([t,r],n).map(function(c){return du(c)}),s=du(a);function u(c,f){c.traverse(function(d,v){v.forEach(function(g){f.add(g.serviceIdentifier,g.clone())})})}return o.forEach(function(c){u(c,s)}),a},e.prototype.load=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n=this._getContainerModuleHelpersFactory(),i=0,a=t;i<a.length;i++){var o=a[i],s=n(o.id);o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)}},e.prototype.loadAsync=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return r1(this,void 0,void 0,function(){var n,i,a,o,s;return n1(this,function(u){switch(u.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,a=t,u.label=1;case 1:return i<a.length?(o=a[i],s=n(o.id),[4,o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)]):[3,4];case 2:u.sent(),u.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},e.prototype.unload=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=function(a){return function(o){return o.moduleId===a}};r.forEach(function(a){var o=i(a.id);t._bindingDictionary.removeByCondition(o)})},e.prototype.bind=function(t){var r=this.options.defaultScope||or.Transient,n=new fA(t,r);return this._bindingDictionary.add(t,n),new e1(n)},e.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},e.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch{throw new Error(vA+" "+ya(t))}},e.prototype.unbindAll=function(){this._bindingDictionary=new yl},e.prototype.isBound=function(t){var r=this._bindingDictionary.hasKey(t);return!r&&this.parent&&(r=this.parent.isBound(t)),r},e.prototype.isBoundNamed=function(t,r){return this.isBoundTagged(t,Lr,r)},e.prototype.isBoundTagged=function(t,r,n){var i=!1;if(this._bindingDictionary.hasKey(t)){var a=this._bindingDictionary.get(t),o=XA(this,t,r,n);i=a.some(function(s){return s.constraint(o)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(t,r,n)),i},e.prototype.snapshot=function(){this._snapshots.push(t1.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var t=this._snapshots.pop();if(t===void 0)throw new Error(gA);this._bindingDictionary=t.bindings,this._middleware=t.middleware},e.prototype.createChild=function(t){var r=new e(t||this.options);return r.parent=this,r},e.prototype.applyMiddleware=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce(function(i,a){return a(i)},n)},e.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},e.prototype.get=function(t){return this._get(!1,!1,en.Variable,t)},e.prototype.getTagged=function(t,r,n){return this._get(!1,!1,en.Variable,t,r,n)},e.prototype.getNamed=function(t,r){return this.getTagged(t,Lr,r)},e.prototype.getAll=function(t){return this._get(!0,!0,en.Variable,t)},e.prototype.getAllTagged=function(t,r,n){return this._get(!1,!0,en.Variable,t,r,n)},e.prototype.getAllNamed=function(t,r){return this.getAllTagged(t,Lr,r)},e.prototype.resolve=function(t){var r=this.createChild();return r.bind(t).toSelf(),this._appliedMiddleware.forEach(function(n){r.applyMiddleware(n)}),r.get(t)},e.prototype._getContainerModuleHelpersFactory=function(){var t=this,r=function(s,u){s._binding.moduleId=u},n=function(s){return function(u){var c=t.bind.bind(t),f=c(u);return r(f,s),f}},i=function(s){return function(u){var c=t.unbind.bind(t);c(u)}},a=function(s){return function(u){var c=t.isBound.bind(t);return c(u)}},o=function(s){return function(u){var c=t.rebind.bind(t),f=c(u);return r(f,s),f}};return function(s){return{bindFunction:n(s),isboundFunction:a(),rebindFunction:o(s),unbindFunction:i()}}},e.prototype._get=function(t,r,n,i,a,o){var s=null,u={avoidConstraints:t,contextInterceptor:function(c){return c},isMultiInject:r,key:a,serviceIdentifier:i,targetType:n,value:o};if(this._middleware){if(s=this._middleware(u),s==null)throw new Error(TA)}else s=this._planAndResolve()(u);return s},e.prototype._planAndResolve=function(){var t=this;return function(r){var n=HA(t._metadataReader,t,r.isMultiInject,r.targetType,r.serviceIdentifier,r.key,r.value,r.avoidConstraints);n=r.contextInterceptor(n);var i=ZA(n);return i}},e}();function gt(){return function(e){if(Reflect.hasOwnMetadata(lu,e))throw new Error(lA);var t=Reflect.getMetadata(sA,e)||[];return Reflect.defineMetadata(lu,t,e),e}}function zr(e){return function(t,r,n){var i=new _n(Lr,e);typeof n=="number"?_y(t,r,n,i):Ey(t,r,i)}}var re={HierarchyComponentManager:Symbol("HierarchyComponentManager"),TransformComponentManager:Symbol("TransformComponentManager"),NameComponentManager:Symbol("NameComponentManager"),SceneGraphSystem:Symbol("SceneGraphSystem"),FrameGraphSystem:Symbol("FrameGraphSystem"),ResourcePool:Symbol("ResourcePool"),ResourceHandleComponentManager:Symbol("ResourceHandleComponentManager"),PassNodeComponentManager:Symbol("PassNodeComponentManager"),RendererSystem:Symbol("RendererSystem"),RenderPass:Symbol("RenderPass"),RenderPassFactory:Symbol("Factory<IRenderPass>"),Renderable:Symbol("Factory<IRenderPass>"),MeshSystem:Symbol("MeshSystem"),MeshComponentManager:Symbol("MeshComponentManager"),CullableComponentManager:Symbol("CullableComponentManager"),Geometry:Symbol("Geometry"),GeometrySystem:Symbol("GeometrySystem"),GeometryComponentManager:Symbol("GeometryComponentManager"),Material:Symbol("Material"),MaterialSystem:Symbol("MaterialSystem"),MaterialComponentManager:Symbol("MaterialComponentManager"),ForwardRenderPath:Symbol("ForwardRenderPath"),ComputeSystem:Symbol("ComputeSystem"),ComputeComponentManager:Symbol("ComputeComponentManager"),ComputeStrategy:Symbol("ComputeStrategy"),Systems:Symbol("Systems"),World:Symbol("World"),RenderEngine:Symbol("RenderEngine"),WebGPUEngine:Symbol("WebGPUEngine"),WebGLEngine:Symbol("WebGLEngine"),ShaderModuleService:Symbol("ShaderModuleService"),ConfigService:Symbol("ConfigService"),InteractorService:Symbol("InteractorService"),IEventEmitter:Symbol("IEventEmitter"),Light:Symbol("Light")},a1=function e(){Le(this,e),this.index=void 0},o1=function e(){Le(this,e),this.name=void 0,this.data=void 0,this.execute=void 0,this.tearDown=void 0},s1=function(){function e(){Le(this,e),this.name=void 0,this.refCount=0,this.hasSideEffect=!1,this.devirtualize=[],this.destroy=[],this.reads=[],this.writes=[]}return ze(e,[{key:"read",value:function(r){return this.reads.find(function(n){return n.index===r.index})||this.reads.push(r),r}},{key:"sample",value:function(r){return this.read(r),r}},{key:"write",value:function(r,n){var i=this.writes.find(function(u){return u.index===n.index});if(i)return n;var a=r.getResourceNode(n);a.resource.version++,a.resource.imported&&(this.hasSideEffect=!0);var o=r.createResourceNode(a.resource),s=r.getResourceNode(o);return s.writer=this,this.writes.push(o),o}}]),e}(),u1=function e(){Le(this,e),this.first=void 0,this.last=void 0};function c1(e){var t=f1();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function f1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var _l=function(e){ur(r,e);var t=c1(r);function r(){var n;Le(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),n.version=0,n.refs=0,n.name=void 0,n.imported=void 0,n.priority=void 0,n.discardStart=!0,n.discardEnd=!1,n.descriptor=void 0,n.resource=void 0,n}return ze(r,[{key:"preExecuteDestroy",value:function(){this.discardEnd=!0}},{key:"postExecuteDestroy",value:function(){this.imported}},{key:"postExecuteDevirtualize",value:function(){this.discardStart=!1}},{key:"preExecuteDevirtualize",value:function(){this.imported}}]),r}(u1),l1=function e(){Le(this,e),this.resource=void 0,this.writer=void 0,this.readerCount=0,this.version=void 0},El,bl,gl,Ys,Tl,Al;function Ar(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=d1(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function d1(e,t){if(!!e){if(typeof e=="string")return Sl(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Sl(e,t)}}function Sl(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h1=(El=gt(),bl=Ue(re.RenderEngine),El(gl=(Ys=(Al=function(){function e(){Le(this,e),this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[],Ge(this,"engine",Tl,this)}return ze(e,[{key:"execute",value:function(){var t=_t(Ne.mark(function n(i){return Ne.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.compile(),o.next=3,this.executePassNodes(i);case 3:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.frameGraphPasses.forEach(function(r){r.tearDown&&r.tearDown()}),this.reset()}},{key:"addPass",value:function(r,n,i,a){var o=new o1;o.execute=i,a&&(o.tearDown=a),o.name=r;var s=new s1;return s.name=r,this.passNodes.push(s),this.frameGraphPasses.push(o),n(this,s,o),o}},{key:"getPass",value:function(r){return this.frameGraphPasses.find(function(n){return n.name===r})}},{key:"compile",value:function(){var r=this,n=Ar(this.passNodes),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.refCount=a.writes.length+(a.hasSideEffect?1:0),a.reads.forEach(function(ct){r.resourceNodes[ct.index].readerCount++})}}catch(ct){n.e(ct)}finally{n.f()}var o=[],s=Ar(this.resourceNodes),u;try{for(s.s();!(u=s.n()).done;){var c=u.value;c.readerCount===0&&o.push(c)}}catch(ct){s.e(ct)}finally{s.f()}for(;o.length;){var f=o.pop(),d=f&&f.writer;if(d&&--d.refCount===0){var v=Ar(d.reads),g;try{for(v.s();!(g=v.n()).done;){var T=g.value,C=this.resourceNodes[T.index];--C.readerCount===0&&o.push(C)}}catch(ct){v.e(ct)}finally{v.f()}}}this.resourceNodes.forEach(function(ct){ct.resource.refs+=ct.readerCount});var x=Ar(this.passNodes),$;try{for(x.s();!($=x.n()).done;){var Q=$.value;if(!!Q.refCount){var X=Ar(Q.reads),he;try{for(X.s();!(he=X.n()).done;){var ae=he.value,Ae=this.resourceNodes[ae.index].resource;Ae.first=Ae.first?Ae.first:Q,Ae.last=Q}}catch(ct){X.e(ct)}finally{X.f()}var Ie=Ar(Q.writes),Ve;try{for(Ie.s();!(Ve=Ie.n()).done;){var tt=Ve.value,$e=this.resourceNodes[tt.index].resource;$e.first=$e.first?$e.first:Q,$e.last=Q}}catch(ct){Ie.e(ct)}finally{Ie.f()}}}}catch(ct){x.e(ct)}finally{x.f()}for(var Ke=0;Ke<2;Ke++){var He=Ar(this.resourceNodes),lt;try{for(He.s();!(lt=He.n()).done;){var Me=lt.value,wt=Me.resource;if(wt.priority===Ke&&wt.refs){var fr=wt.first,mt=wt.last;fr&&mt&&(fr.devirtualize.push(wt),mt.destroy.push(wt))}}}catch(ct){He.e(ct)}finally{He.f()}}}},{key:"executePassNodes",value:function(){var t=_t(Ne.mark(function n(i){var a,o,s,u,c,f,d,v,g,T,C,x,$,Q,X,he,ae;return Ne.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:a=Ar(this.passNodes.entries()),Ie.prev=1,a.s();case 3:if((o=a.n()).done){Ie.next=18;break}if(s=ko(o.value,2),u=s[0],c=s[1],!c.refCount){Ie.next=16;break}f=Ar(c.devirtualize);try{for(f.s();!(d=f.n()).done;)v=d.value,v.preExecuteDevirtualize(this.engine)}catch(Ve){f.e(Ve)}finally{f.f()}g=Ar(c.destroy);try{for(g.s();!(T=g.n()).done;)C=T.value,C.preExecuteDestroy(this.engine)}catch(Ve){g.e(Ve)}finally{g.f()}return Ie.next=12,this.frameGraphPasses[u].execute(this,this.frameGraphPasses[u],i);case 12:x=Ar(c.devirtualize);try{for(x.s();!($=x.n()).done;)Q=$.value,Q.postExecuteDevirtualize(this.engine)}catch(Ve){x.e(Ve)}finally{x.f()}X=Ar(c.destroy);try{for(X.s();!(he=X.n()).done;)ae=he.value,ae.postExecuteDestroy(this.engine)}catch(Ve){X.e(Ve)}finally{X.f()}case 16:Ie.next=3;break;case 18:Ie.next=23;break;case 20:Ie.prev=20,Ie.t0=Ie.catch(1),a.e(Ie.t0);case 23:return Ie.prev=23,a.f(),Ie.finish(23);case 26:this.reset();case 27:case"end":return Ie.stop()}},n,this,[[1,20,23,26]])}));function r(n){return t.apply(this,arguments)}return r}()},{key:"reset",value:function(){this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[]}},{key:"getResourceNode",value:function(r){return this.resourceNodes[r.index]}},{key:"createResourceNode",value:function(r){var n=new l1;n.resource=r,n.version=r.version,this.resourceNodes.push(n);var i=new a1;return i.index=this.resourceNodes.length-1,i}},{key:"createTexture",value:function(r,n,i){var a=new _l;return a.name=n,a.descriptor=i,this.createResourceNode(a)}},{key:"createRenderTarget",value:function(r,n,i){var a=new _l;return a.name=n,a.descriptor=i,this.createResourceNode(a)}},{key:"present",value:function(r){this.addPass("Present",function(n,i){i.read(r),i.hasSideEffect=!0},_t(Ne.mark(function n(){return Ne.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},n)})))}}]),e}(),Al),Tl=Be(Ys.prototype,"engine",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys))||gl),Ao=1e-6,pr=typeof Float32Array<"u"?Float32Array:Array,v1="zyx";function Ta(){var e=new pr(9);return pr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function p1(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function m1(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],f=t[8],d=t[9],v=t[10],g=t[11],T=t[12],C=t[13],x=t[14],$=t[15],Q=r*s-n*o,X=r*u-i*o,he=r*c-a*o,ae=n*u-i*s,Ae=n*c-a*s,Ie=i*c-a*u,Ve=f*C-d*T,tt=f*x-v*T,$e=f*$-g*T,Ke=d*x-v*C,He=d*$-g*C,lt=v*$-g*x,Me=Q*lt-X*He+he*Ke+ae*$e-Ae*tt+Ie*Ve;return Me?(Me=1/Me,e[0]=(s*lt-u*He+c*Ke)*Me,e[1]=(u*$e-o*lt-c*tt)*Me,e[2]=(o*He-s*$e+c*Ve)*Me,e[3]=(i*He-n*lt-a*Ke)*Me,e[4]=(r*lt-i*$e+a*tt)*Me,e[5]=(n*$e-r*He-a*Ve)*Me,e[6]=(C*Ie-x*Ae+$*ae)*Me,e[7]=(x*he-T*Ie-$*X)*Me,e[8]=(T*Ae-C*he+$*Q)*Me,e):null}function Er(){var e=new pr(16);return pr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function y1(e){var t=new pr(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function vu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Cy(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Oo(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],f=t[8],d=t[9],v=t[10],g=t[11],T=t[12],C=t[13],x=t[14],$=t[15],Q=r*s-n*o,X=r*u-i*o,he=r*c-a*o,ae=n*u-i*s,Ae=n*c-a*s,Ie=i*c-a*u,Ve=f*C-d*T,tt=f*x-v*T,$e=f*$-g*T,Ke=d*x-v*C,He=d*$-g*C,lt=v*$-g*x,Me=Q*lt-X*He+he*Ke+ae*$e-Ae*tt+Ie*Ve;return Me?(Me=1/Me,e[0]=(s*lt-u*He+c*Ke)*Me,e[1]=(i*He-n*lt-a*Ke)*Me,e[2]=(C*Ie-x*Ae+$*ae)*Me,e[3]=(v*Ae-d*Ie-g*ae)*Me,e[4]=(u*$e-o*lt-c*tt)*Me,e[5]=(r*lt-i*$e+a*tt)*Me,e[6]=(x*he-T*Ie-$*X)*Me,e[7]=(f*Ie-v*he+g*X)*Me,e[8]=(o*He-s*$e+c*Ve)*Me,e[9]=(n*$e-r*He-a*Ve)*Me,e[10]=(T*Ae-C*he+$*Q)*Me,e[11]=(d*he-f*Ae-g*Q)*Me,e[12]=(s*tt-o*Ke-u*Ve)*Me,e[13]=(r*Ke-n*tt+i*Ve)*Me,e[14]=(C*X-T*ae-x*Q)*Me,e[15]=(f*ae-d*X+v*Q)*Me,e):null}function Gn(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],f=t[7],d=t[8],v=t[9],g=t[10],T=t[11],C=t[12],x=t[13],$=t[14],Q=t[15],X=r[0],he=r[1],ae=r[2],Ae=r[3];return e[0]=X*n+he*s+ae*d+Ae*C,e[1]=X*i+he*u+ae*v+Ae*x,e[2]=X*a+he*c+ae*g+Ae*$,e[3]=X*o+he*f+ae*T+Ae*Q,X=r[4],he=r[5],ae=r[6],Ae=r[7],e[4]=X*n+he*s+ae*d+Ae*C,e[5]=X*i+he*u+ae*v+Ae*x,e[6]=X*a+he*c+ae*g+Ae*$,e[7]=X*o+he*f+ae*T+Ae*Q,X=r[8],he=r[9],ae=r[10],Ae=r[11],e[8]=X*n+he*s+ae*d+Ae*C,e[9]=X*i+he*u+ae*v+Ae*x,e[10]=X*a+he*c+ae*g+Ae*$,e[11]=X*o+he*f+ae*T+Ae*Q,X=r[12],he=r[13],ae=r[14],Ae=r[15],e[12]=X*n+he*s+ae*d+Ae*C,e[13]=X*i+he*u+ae*v+Ae*x,e[14]=X*a+he*c+ae*g+Ae*$,e[15]=X*o+he*f+ae*T+Ae*Q,e}function Wi(e,t,r){var n=r[0],i=r[1],a=r[2],o,s,u,c,f,d,v,g,T,C,x,$;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*a+t[12],e[13]=t[1]*n+t[5]*i+t[9]*a+t[13],e[14]=t[2]*n+t[6]*i+t[10]*a+t[14],e[15]=t[3]*n+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],c=t[3],f=t[4],d=t[5],v=t[6],g=t[7],T=t[8],C=t[9],x=t[10],$=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=c,e[4]=f,e[5]=d,e[6]=v,e[7]=g,e[8]=T,e[9]=C,e[10]=x,e[11]=$,e[12]=o*n+f*i+T*a+t[12],e[13]=s*n+d*i+C*a+t[13],e[14]=u*n+v*i+x*a+t[14],e[15]=c*n+g*i+$*a+t[15]),e}function _1(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],f=t[9],d=t[10],v=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+c*n,e[5]=o*i+f*n,e[6]=s*i+d*n,e[7]=u*i+v*n,e[8]=c*i-a*n,e[9]=f*i-o*n,e[10]=d*i-s*n,e[11]=v*i-u*n,e}function E1(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],u=t[3],c=t[8],f=t[9],d=t[10],v=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-c*n,e[1]=o*i-f*n,e[2]=s*i-d*n,e[3]=u*i-v*n,e[8]=a*n+c*i,e[9]=o*n+f*i,e[10]=s*n+d*i,e[11]=u*n+v*i,e}function Yi(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function gi(e,t){var r=t[0],n=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],c=t[9],f=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(u*u+c*c+f*f),e}function qi(e,t){var r=new pr(3);gi(r,t);var n=1/r[0],i=1/r[1],a=1/r[2],o=t[0]*n,s=t[1]*i,u=t[2]*a,c=t[4]*n,f=t[5]*i,d=t[6]*a,v=t[8]*n,g=t[9]*i,T=t[10]*a,C=o+f+T,x=0;return C>0?(x=Math.sqrt(C+1)*2,e[3]=.25*x,e[0]=(d-g)/x,e[1]=(v-u)/x,e[2]=(s-c)/x):o>f&&o>T?(x=Math.sqrt(1+o-f-T)*2,e[3]=(d-g)/x,e[0]=.25*x,e[1]=(s+c)/x,e[2]=(v+u)/x):f>T?(x=Math.sqrt(1+f-o-T)*2,e[3]=(v-u)/x,e[0]=(s+c)/x,e[1]=.25*x,e[2]=(d+g)/x):(x=Math.sqrt(1+T-o-f)*2,e[3]=(s-c)/x,e[0]=(v+u)/x,e[1]=(d+g)/x,e[2]=.25*x),e}function b1(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,c=a+a,f=o+o,d=i*u,v=i*c,g=i*f,T=a*c,C=a*f,x=o*f,$=s*u,Q=s*c,X=s*f,he=n[0],ae=n[1],Ae=n[2];return e[0]=(1-(T+x))*he,e[1]=(v+X)*he,e[2]=(g-Q)*he,e[3]=0,e[4]=(v-X)*ae,e[5]=(1-(d+x))*ae,e[6]=(C+$)*ae,e[7]=0,e[8]=(g+Q)*Ae,e[9]=(C-$)*Ae,e[10]=(1-(d+T))*Ae,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function wl(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,u=i+i,c=r*o,f=n*o,d=n*s,v=i*o,g=i*s,T=i*u,C=a*o,x=a*s,$=a*u;return e[0]=1-d-T,e[1]=f+$,e[2]=v-x,e[3]=0,e[4]=f-$,e[5]=1-c-T,e[6]=g+C,e[7]=0,e[8]=v+x,e[9]=g-C,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function g1(e,t,r,n,i){var a=1/Math.tan(t/2);if(e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){var o=1/(n-i);e[10]=(i+n)*o,e[14]=2*i*n*o}else e[10]=-1,e[14]=-2*n;return e}var T1=g1;function A1(e,t,r,n,i,a,o){var s=1/(t-r),u=1/(n-i),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*u,e[14]=(o+a)*c,e[15]=1,e}var S1=A1;function w1(e,t,r,n){var i,a,o,s,u,c,f,d,v,g,T=t[0],C=t[1],x=t[2],$=n[0],Q=n[1],X=n[2],he=r[0],ae=r[1],Ae=r[2];return Math.abs(T-he)<Ao&&Math.abs(C-ae)<Ao&&Math.abs(x-Ae)<Ao?Cy(e):(f=T-he,d=C-ae,v=x-Ae,g=1/Math.sqrt(f*f+d*d+v*v),f*=g,d*=g,v*=g,i=Q*v-X*d,a=X*f-$*v,o=$*d-Q*f,g=Math.sqrt(i*i+a*a+o*o),g?(g=1/g,i*=g,a*=g,o*=g):(i=0,a=0,o=0),s=d*o-v*a,u=v*i-f*o,c=f*a-d*i,g=Math.sqrt(s*s+u*u+c*c),g?(g=1/g,s*=g,u*=g,c*=g):(s=0,u=0,c=0),e[0]=i,e[1]=s,e[2]=f,e[3]=0,e[4]=a,e[5]=u,e[6]=d,e[7]=0,e[8]=o,e[9]=c,e[10]=v,e[11]=0,e[12]=-(i*T+a*C+o*x),e[13]=-(s*T+u*C+c*x),e[14]=-(f*T+d*C+v*x),e[15]=1,e)}function At(){var e=new pr(3);return pr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Jr(e){var t=new pr(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function So(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function st(e,t,r){var n=new pr(3);return n[0]=e,n[1]=t,n[2]=r,n}function sr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function di(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function tn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function pu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function R1(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Ea(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function C1(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function da(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Io(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function qs(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],u=r[2];return e[0]=i*u-a*s,e[1]=a*o-n*u,e[2]=n*s-i*o,e}function Un(e,t,r,n){var i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e}function Fu(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e}function Gu(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e}function x1(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=t[0],u=t[1],c=t[2],f=i*c-a*u,d=a*s-n*c,v=n*u-i*s;return f=f+f,d=d+d,v=v+v,e[0]=s+o*f+i*v-a*d,e[1]=u+o*d+a*f-n*v,e[2]=c+o*v+n*d-i*f,e}var mu=pu,Rl=C1,xy=So;(function(){var e=At();return function(t,r,n,i,a,o){var s,u;for(r||(r=3),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();function fa(){var e=new pr(4);return pr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ny(e,t,r,n){var i=new pr(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function N1(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function O1(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e}function la(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e}(function(){var e=fa();return function(t,r,n,i,a,o){var s,u;for(r||(r=4),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}})();function Jt(){var e=new pr(4);return pr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Dn(e,t,r){r=r*.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function wr(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],c=r[2],f=r[3];return e[0]=n*f+o*s+i*c-a*u,e[1]=i*f+o*u+a*s-n*c,e[2]=a*f+o*c+n*u-i*s,e[3]=o*f-n*s-i*u-a*c,e}function wo(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],u=r[0],c=r[1],f=r[2],d=r[3],v,g,T,C,x;return g=i*u+a*c+o*f+s*d,g<0&&(g=-g,u=-u,c=-c,f=-f,d=-d),1-g>Ao?(v=Math.acos(g),T=Math.sin(v),C=Math.sin((1-n)*v)/T,x=Math.sin(n*v)/T):(C=1-n,x=n),e[0]=C*i+x*u,e[1]=C*a+x*c,e[2]=C*o+x*f,e[3]=C*s+x*d,e}function Cl(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e}function I1(e,t){var r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[a*3+a]-t[o*3+o]+1),e[i]=.5*n,n=.5/n,e[3]=(t[a*3+o]-t[o*3+a])*n,e[a]=(t[a*3+i]+t[i*3+a])*n,e[o]=(t[o*3+i]+t[i*3+o])*n}return e}function Ks(e,t,r,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:v1,a=Math.PI/360;t*=a,n*=a,r*=a;var o=Math.sin(t),s=Math.cos(t),u=Math.sin(r),c=Math.cos(r),f=Math.sin(n),d=Math.cos(n);switch(i){case"xyz":e[0]=o*c*d+s*u*f,e[1]=s*u*d-o*c*f,e[2]=s*c*f+o*u*d,e[3]=s*c*d-o*u*f;break;case"xzy":e[0]=o*c*d-s*u*f,e[1]=s*u*d-o*c*f,e[2]=s*c*f+o*u*d,e[3]=s*c*d+o*u*f;break;case"yxz":e[0]=o*c*d+s*u*f,e[1]=s*u*d-o*c*f,e[2]=s*c*f-o*u*d,e[3]=s*c*d+o*u*f;break;case"yzx":e[0]=o*c*d+s*u*f,e[1]=s*u*d+o*c*f,e[2]=s*c*f-o*u*d,e[3]=s*c*d-o*u*f;break;case"zxy":e[0]=o*c*d-s*u*f,e[1]=s*u*d+o*c*f,e[2]=s*c*f+o*u*d,e[3]=s*c*d-o*u*f;break;case"zyx":e[0]=o*c*d-s*u*f,e[1]=s*u*d+o*c*f,e[2]=s*c*f-o*u*d,e[3]=s*c*d+o*u*f;break;default:throw new Error("Unknown angle order "+i)}return e}var Qs=Ny,Ki=N1,P1=wr,Ti=O1;(function(){var e=At(),t=st(1,0,0),r=st(0,1,0);return function(n,i,a){var o=Io(i,a);return o<-.999999?(qs(e,t,i),xy(e)<1e-6&&qs(e,r,i),da(e,e),Dn(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(qs(e,i,a),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,Ti(n,n))}})();(function(){var e=Jt(),t=Jt();return function(r,n,i,a,o,s){return wo(e,n,o,s),wo(t,i,a,s),wo(r,e,t,2*s*(1-s)),r}})();(function(){var e=Ta();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Ti(t,I1(t,e))}})();var L1=9007199254740991,M1="[object Arguments]",k1="[object Array]",D1="[object Boolean]",F1="[object Date]",G1="[object Error]",B1="[object Function]",U1="[object Map]",$1="[object Number]",V1="[object Object]",j1="[object RegExp]",z1="[object Set]",H1="[object String]",X1="[object WeakMap]",W1="[object ArrayBuffer]",Y1="[object DataView]",q1="[object Float32Array]",K1="[object Float64Array]",Q1="[object Int8Array]",Z1="[object Int16Array]",J1="[object Int32Array]",eS="[object Uint8Array]",tS="[object Uint8ClampedArray]",rS="[object Uint16Array]",nS="[object Uint32Array]",Nt={};Nt[q1]=Nt[K1]=Nt[Q1]=Nt[Z1]=Nt[J1]=Nt[eS]=Nt[tS]=Nt[rS]=Nt[nS]=!0;Nt[M1]=Nt[k1]=Nt[W1]=Nt[D1]=Nt[Y1]=Nt[F1]=Nt[G1]=Nt[B1]=Nt[U1]=Nt[$1]=Nt[V1]=Nt[j1]=Nt[z1]=Nt[H1]=Nt[X1]=!1;var iS=Object.prototype,aS=iS.toString;function oS(e){return uS(e)&&sS(e.length)&&!!Nt[aS.call(e)]}function sS(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=L1}function uS(e){return!!e&&wi(e)==="object"}var xl=oS;function Nl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ol(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Nl(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cS(e){var t=fS();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function fS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var lS=function(e){ur(r,e);var t=cS(r);function r(n){var i;return Le(this,r),i=t.call(this,n),i.dirty=!0,i.attributes=[],i.indices=void 0,i.indicesBuffer=void 0,i.vertexCount=0,i.maxInstancedCount=void 0,i.aabb=void 0,i.entity=void 0,Object.assign(jt(i),n),i}return ze(r,[{key:"setAttribute",value:function(i,a,o,s){var u=this.attributes.find(function(c){return c.name===i});return u?(u.data=a,u.dirty=!0):this.attributes.push(Ol(Ol({dirty:!0,name:i,data:a},o),{},{bufferGetter:s})),this.dirty=!0,this}},{key:"setIndex",value:function(i){return this.indices=new Uint32Array(i.buffer?i.buffer:i),this.dirty=!0,this}},{key:"applyMatrix",value:function(i){var a=this.attributes.find(function(v){var g=v.name;return g==="position"}),o=this.attributes.find(function(v){var g=v.name;return g==="normal"});if(a&&(a.dirty=!0,a.data&&a.data.length))for(var s=0;s<a.data.length;s+=3){var u=Ny(a.data[s],a.data[s+1],a.data[s+2],1);la(u,u,i),xl(a.data)?a.data.set([u[0],u[1],u[2]],s):(a.data[s]=u[0],a.data[s+1]=u[1],a.data[s+2]=u[2])}if(o){var c=m1(Ta(),i);if(o.data&&o.data.length)for(var f=0;f<o.data.length;f+=3){var d=st(o.data[f],o.data[f+1],o.data[f+2]);Gu(d,d,c),da(d,d),xl(o.data)?o.data.set([d[0],d[1],d[2]],f):(o.data[f]=d[0],o.data[f+1]=d[1],o.data[f+2]=d[2])}}}}]),r}(jn),M;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(M||(M={}));var Il,Pl,Ll,Ml,io,kl,Dl,Fl,dS=(Il=gt(),Pl=Ue(re.GeometryComponentManager),Ll=Ue(re.RenderEngine),Il(Ml=(io=(Fl=function(){function e(){Le(this,e),Ge(this,"geometry",kl,this),Ge(this,"engine",Dl,this)}return ze(e,[{key:"execute",value:function(){var t=_t(Ne.mark(function n(){var i=this;return Ne.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this.geometry.forEach(function(s,u){u.dirty&&(u.attributes.forEach(function(c){if(c.dirty&&c.data){if(!c.buffer)c.buffer=i.engine.createBuffer({data:c.data,type:M.FLOAT});else{var f;(f=c.buffer)===null||f===void 0||f.subData({data:c.data,offset:0})}c.dirty=!1}}),u.indices&&(u.indicesBuffer?u.indicesBuffer.subData({data:u.indices,offset:0}):u.indicesBuffer=i.engine.createElements({data:u.indices,count:u.indices.length,type:M.UNSIGNED_INT,usage:M.STATIC_DRAW})),u.dirty=!1)});case 1:case"end":return o.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.geometry.forEach(function(r,n){n.indicesBuffer&&n.indicesBuffer.destroy(),n.attributes.forEach(function(i){i.buffer&&i.buffer.destroy()})}),this.geometry.clear()}},{key:"createBufferGeometry",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{vertexCount:3},n=r.vertexCount,i=Vr();return this.geometry.create(i,{vertexCount:n})}},{key:"createInstancedBufferGeometry",value:function(r){var n=r.maxInstancedCount,i=r.vertexCount,a=Vr();return this.geometry.create(a,{maxInstancedCount:n,vertexCount:i})}}]),e}(),Fl),kl=Be(io.prototype,"geometry",[Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl=Be(io.prototype,"engine",[Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),io))||Ml);function Gl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Bl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Gl(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hS(e){var t=vS();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function vS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var pS=function(e){ur(r,e);var t=hS(r);function r(n){var i;return Le(this,r),i=t.call(this,n),i.vertexShaderGLSL=void 0,i.fragmentShaderGLSL=void 0,i.defines={},i.dirty=!0,i.uniforms=[],i.cull={enable:!0,face:M.BACK},i.depth={enable:!0},i.blend=void 0,i.entity=void 0,i.type=void 0,Object.assign(jt(i),n),i}return ze(r,[{key:"setDefines",value:function(i){return this.defines=Bl(Bl({},this.defines),i),this}},{key:"setCull",value:function(i){return this.cull=i,this}},{key:"setDepth",value:function(i){return this.depth=i,this}},{key:"setBlend",value:function(i){return this.blend=i,this}},{key:"setUniform",value:function(i,a){var o=this;if(typeof i!="string")return Object.keys(i).forEach(function(u){return o.setUniform(u,i[u])}),this;var s=this.uniforms.find(function(u){return u.name===i});return s?(s.dirty=!0,s.data=a):this.uniforms.push({name:i,dirty:!0,data:a}),this.dirty=!0,this}}]),r}(jn),Ul,$l,Vl,jl,zl,Qi,Hl,Xl,Wl,Yl;function ql(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Kl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ql(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ql(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var mS=(Ul=gt(),$l=Ue(re.MaterialComponentManager),Vl=Ue(re.RenderEngine),jl=Ue(re.ShaderModuleService),Ul(zl=(Qi=(Yl=function(){function e(){Le(this,e),Ge(this,"material",Hl,this),Ge(this,"engine",Xl,this),Ge(this,"shaderModule",Wl,this)}return ze(e,[{key:"execute",value:function(){var t=_t(Ne.mark(function n(){return Ne.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.material.clear()}},{key:"createShaderMaterial",value:function(r){var n=Vr(),i=r.vertexShader,a=r.fragmentShader,o=[];if(!this.engine.supportWebGPU){var s="material-".concat(n);this.shaderModule.registerModule(s,{vs:r.vertexShader,fs:r.fragmentShader});var u=this.shaderModule.getModule(s);i=u.vs,a=u.fs,u.uniforms&&(o=Object.keys(u.uniforms).map(function(c){return{dirty:!0,name:c,data:u.uniforms[c]}}))}return this.material.create(n,Kl(Kl({vertexShaderGLSL:i,fragmentShaderGLSL:a},r),{},{uniforms:o}))}}]),e}(),Yl),Hl=Be(Qi.prototype,"material",[$l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xl=Be(Qi.prototype,"engine",[Vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=Be(Qi.prototype,"shaderModule",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qi))||zl);function yS(e){var t=_S();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function _S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var yu;(function(e){e[e.Standard=0]="Standard"})(yu||(yu={}));var ES=function(e){ur(r,e);var t=yS(r);function r(n){var i;return Le(this,r),i=t.call(this,n),i.strategy=yu.Standard,i.visibilityPlaneMask=0,i.visible=!1,Object.assign(jt(i),n),i}return r}(jn),Bu=function(){function e(t,r){Le(this,e),this.center=void 0,this.halfExtents=void 0,this.min=At(),this.max=At(),this.update(t,r)}return ze(e,[{key:"update",value:function(r,n){this.center=r||At(),this.halfExtents=n||st(.5,.5,.5),this.min=mu(this.min,this.center,this.halfExtents),this.max=tn(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(r,n){tn(this.center,n,r),Ea(this.center,this.center,.5),mu(this.halfExtents,n,r),Ea(this.halfExtents,this.halfExtents,.5),sr(this.min,r),sr(this.max,n)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(r){var n=this.center,i=n[0],a=n[1],o=n[2],s=this.halfExtents,u=s[0],c=s[1],f=s[2],d=i-u,v=i+u,g=a-c,T=a+c,C=o-f,x=o+f,$=r.center,Q=$[0],X=$[1],he=$[2],ae=r.halfExtents,Ae=ae[0],Ie=ae[1],Ve=ae[2],tt=Q-Ae,$e=Q+Ae,Ke=X-Ie,He=X+Ie,lt=he-Ve,Me=he+Ve;tt<d&&(d=tt),$e>v&&(v=$e),Ke<g&&(g=Ke),He>T&&(T=He),lt<C&&(C=lt),Me>x&&(x=Me),n[0]=(d+v)*.5,n[1]=(g+T)*.5,n[2]=(C+x)*.5,s[0]=(v-d)*.5,s[1]=(T-g)*.5,s[2]=(x-C)*.5,this.min[0]=d,this.min[1]=g,this.min[2]=C,this.max[0]=v,this.max[1]=T,this.max[2]=x}},{key:"intersects",value:function(r){var n=this.getMax(),i=this.getMin(),a=r.getMax(),o=r.getMin();return i[0]<=a[0]&&n[0]>=o[0]&&i[1]<=a[1]&&n[1]>=o[1]&&i[2]<=a[2]&&n[2]>=o[2]}},{key:"containsPoint",value:function(r){var n=this.getMin(),i=this.getMax();return!(r[0]<n[0]||r[0]>i[0]||r[1]<n[1]||r[1]>i[1]||r[2]<n[2]||r[2]>i[2])}},{key:"getNegativeFarPoint",value:function(r){return r.pnVertexFlag===273?sr(At(),this.min):r.pnVertexFlag===272?st(this.min[0],this.min[1],this.max[2]):r.pnVertexFlag===257?st(this.min[0],this.max[1],this.min[2]):r.pnVertexFlag===256?st(this.min[0],this.max[1],this.max[2]):r.pnVertexFlag===17?st(this.max[0],this.min[1],this.min[2]):r.pnVertexFlag===16?st(this.max[0],this.min[1],this.max[2]):r.pnVertexFlag===1?st(this.max[0],this.max[1],this.min[2]):st(this.max[0],this.max[1],this.max[2])}},{key:"getPositiveFarPoint",value:function(r){return r.pnVertexFlag===273?sr(At(),this.max):r.pnVertexFlag===272?st(this.max[0],this.max[1],this.min[2]):r.pnVertexFlag===257?st(this.max[0],this.min[1],this.max[2]):r.pnVertexFlag===256?st(this.max[0],this.min[1],this.min[2]):r.pnVertexFlag===17?st(this.min[0],this.max[1],this.max[2]):r.pnVertexFlag===16?st(this.min[0],this.max[1],this.min[2]):r.pnVertexFlag===1?st(this.min[0],this.min[1],this.max[2]):st(this.min[0],this.min[1],this.min[2])}}]),e}();function bS(e){var t=gS();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function gS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var TS=function(e){ur(r,e);var t=bS(r);function r(n){var i;return Le(this,r),i=t.call(this,n),i.material=void 0,i.geometry=void 0,i.aabb=new Bu,i.aabbDirty=!0,i.model=void 0,i.visible=!0,i.children=[],Object.assign(jt(i),n),i}return r}(jn),AS=function(){function e(t,r){Le(this,e),this.distance=void 0,this.normal=void 0,this.pnVertexFlag=void 0,this.distance=t||0,this.normal=r||st(0,1,0),this.updatePNVertexFlag()}return ze(e,[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(r){return Io(r,this.normal)-this.distance}},{key:"normalize",value:function(){var r=1/xy(this.normal);Ea(this.normal,this.normal,r),this.distance*=r}},{key:"intersectsLine",value:function(r,n,i){var a=this.distanceToPoint(r),o=this.distanceToPoint(n),s=a/(a-o),u=s>=0&&s<=1;return u&&i&&Un(i,r,n,s),u}}]),e}(),hn;(function(e){e[e.OUTSIDE=4294967295]="OUTSIDE",e[e.INSIDE=0]="INSIDE",e[e.INDETERMINATE=2147483647]="INDETERMINATE"})(hn||(hn={}));var SS=function(){function e(t){if(Le(this,e),this.planes=[],t)this.planes=t;else for(var r=0;r<6;r++)this.planes.push(new AS)}return ze(e,[{key:"extractFromVPMatrix",value:function(r){var n=ko(r,16),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],f=n[6],d=n[7],v=n[8],g=n[9],T=n[10],C=n[11],x=n[12],$=n[13],Q=n[14],X=n[15];di(this.planes[0].normal,s-i,d-u,C-v),this.planes[0].distance=-(X-x),di(this.planes[1].normal,s+i,d+u,C+v),this.planes[1].distance=-(X+x),di(this.planes[2].normal,s+a,d+c,C+g),this.planes[2].distance=-(X+$),di(this.planes[3].normal,s-a,d-c,C-g),this.planes[3].distance=-(X-$),di(this.planes[4].normal,s-o,d-f,C-T),this.planes[4].distance=-(X-Q),di(this.planes[5].normal,s+o,d+f,C+T),this.planes[5].distance=-(X+Q),this.planes.forEach(function(he){he.normalize(),he.updatePNVertexFlag()})}}]),e}();function wS(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function RS(e){var t=ko(e,3),r=t[0],n=t[1],i=t[2],a=r+n*256+i*65536-1;return a}var Ql,Zl,Jl,ed,td,rd,nd,Pn,id,ad,od,sd,ud,cd;function fd(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=CS(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function CS(e,t){if(!!e){if(typeof e=="string")return ld(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ld(e,t)}}function ld(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var xS=(Ql=gt(),Zl=Ue(re.MeshComponentManager),Jl=Ue(re.CullableComponentManager),ed=Ue(re.GeometryComponentManager),td=Ue(re.HierarchyComponentManager),rd=Ue(re.TransformComponentManager),Ql(nd=(Pn=(cd=function(){function e(){Le(this,e),Ge(this,"mesh",id,this),Ge(this,"cullable",ad,this),Ge(this,"geometry",od,this),Ge(this,"hierarchy",sd,this),Ge(this,"transform",ud,this),this.planes=void 0}return ze(e,[{key:"setFrustumPlanes",value:function(r){this.planes=r}},{key:"execute",value:function(){var t=_t(Ne.mark(function n(i){var a,o,s,u,c,f,d,v,g,T,C,x,$,Q,X,he,ae,Ae,Ie,Ve,tt;return Ne.wrap(function(Ke){for(;;)switch(Ke.prev=Ke.next){case 0:a=fd(i);try{for(a.s();!(o=a.n()).done;){s=o.value,u=s.getScene(),c=s.getCamera(),f=fd(u.getEntities());try{for(f.s();!(d=f.n()).done;)v=d.value,g=this.mesh.getComponentByEntity(v),g&&(T=this.hierarchy.getComponentByEntity(v),C=this.cullable.getComponentByEntity(v),x=g.geometry,$=this.transform.getComponentByEntity(v),x&&x.aabb&&$&&g.aabbDirty&&(Q=$.worldTransform,X=x.aabb,he=X.center,ae=X.halfExtents,Ae=Fu(At(),he,Q),Ie=wS(Q,Ta()),Ve=Gu(At(),ae,Ie),g.aabb.update(Ae,Ve),g.aabbDirty=!1),C&&x&&(tt=this.cullable.getComponentByEntity((T==null?void 0:T.parentID)||-1),C.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(g.aabb,(tt==null?void 0:tt.visibilityPlaneMask)||hn.INDETERMINATE,this.planes||c.getFrustum().planes),C.visible=C.visibilityPlaneMask!==hn.OUTSIDE))}catch(He){f.e(He)}finally{f.f()}}}catch(He){a.e(He)}finally{a.f()}case 2:case"end":return Ke.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.cullable.clear(),this.mesh.clear()}},{key:"computeVisibilityWithPlaneMask",value:function(r,n,i){if(n===hn.OUTSIDE||n===hn.INSIDE)return n;for(var a=hn.INSIDE,o=0,s=i.length;o<s;++o){var u=o<31?1<<o:0;if(!(o<31&&(n&u)===0)){var c=i[o],f=c.normal,d=c.distance;if(Io(f,r.getNegativeFarPoint(i[o]))+d>0)return hn.OUTSIDE;Io(f,r.getPositiveFarPoint(i[o]))+d>0&&(a|=u)}}return a}}]),e}(),cd),id=Be(Pn.prototype,"mesh",[Zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=Be(Pn.prototype,"cullable",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=Be(Pn.prototype,"geometry",[ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sd=Be(Pn.prototype,"hierarchy",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ud=Be(Pn.prototype,"transform",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pn))||nd),dd,hd,vd,pd,md,yd,_d,Ed,bd,gd,Td,Ad,Pr,Sd,wd,Rd,Cd,xd,Nd,Od,Id,Pd,Ld,Md;function ao(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=NS(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function NS(e,t){if(!!e){if(typeof e=="string")return kd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kd(e,t)}}function kd(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Si=(dd=gt(),hd=Ue(re.MeshComponentManager),vd=Ue(re.GeometryComponentManager),pd=Ue(re.MaterialComponentManager),md=Ue(re.CullableComponentManager),yd=Ue(re.TransformComponentManager),_d=Ue(re.HierarchyComponentManager),Ed=Ue(re.Systems),bd=zr(re.FrameGraphSystem),gd=Ue(re.RenderEngine),Td=Ue(re.ResourcePool),dd(Ad=(Pr=(Md=Ld=function(){function e(){var t=this;Le(this,e),Ge(this,"mesh",Sd,this),Ge(this,"geometry",wd,this),Ge(this,"material",Rd,this),Ge(this,"cullable",Cd,this),Ge(this,"transform",xd,this),Ge(this,"hierarchy",Nd,this),Ge(this,"frameGraphSystem",Od,this),Ge(this,"engine",Id,this),Ge(this,"resourcePool",Pd,this),this.modelCache={},this.setup=function(r,n,i){var a=r.createRenderTarget(n,"color buffer",{width:1,height:1,usage:M.RENDER_ATTACHMENT|M.SAMPLED|M.COPY_SRC});i.data={output:n.write(r,a)}},this.execute=function(){var r=_t(Ne.mark(function n(i,a,o){var s,u,c,f,d,v;return Ne.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:s=i.getResourceNode(a.data.output),u=t.resourcePool.getOrCreateResource(s.resource),c=ao(o),T.prev=3,c.s();case 5:if((f=c.n()).done){T.next=11;break}return d=f.value,T.next=9,t.initView(d);case 9:T.next=5;break;case 11:T.next=16;break;case 13:T.prev=13,T.t0=T.catch(3),c.e(T.t0);case 16:return T.prev=16,c.f(),T.finish(16);case 19:v=t.engine.getCanvas(),u.resize({width:v.width,height:v.height}),t.engine.setScissor({enable:!1}),t.engine.clear({framebuffer:u,color:o[0].getClearColor(),depth:1}),t.engine.useFramebuffer(u,function(){var C=ao(o),x;try{for(C.s();!(x=C.n()).done;){var $=x.value;t.renderView($)}}catch(Q){C.e(Q)}finally{C.f()}});case 24:case"end":return T.stop()}},n,null,[[3,13,16,19]])}));return function(n,i,a){return r.apply(this,arguments)}}()}return ze(e,[{key:"renderView",value:function(r){var n=r.getScene(),i=r.getCamera(),a=i.getViewTransform(),o=Gn(Er(),i.getPerspective(),a);i.getFrustum().extractFromVPMatrix(o);var s=r.getViewport(),u=s.x,c=s.y,f=s.width,d=s.height;this.engine.viewport({x:u,y:c,width:f,height:d});var v=ao(n.getEntities()),g;try{for(v.s();!(g=v.n()).done;){var T=g.value;this.renderMesh(T,{camera:i,view:r,viewMatrix:a})}}catch(C){v.e(C)}finally{v.f()}}},{key:"renderMesh",value:function(r,n){var i=n.camera,a=n.view,o=n.viewMatrix,s=this.mesh.getComponentByEntity(r);if(!(!s||!s.visible)){var u=s.material,c=s.geometry;if(!(!c||c.dirty||!u)){var f=this.transform.getComponentByEntity(r),d=Gn(Er(),o,f.worldTransform),v=a.getViewport(),g=v.width,T=v.height;u.setUniform({projectionMatrix:i.getPerspective(),modelViewMatrix:d,modelMatrix:f.worldTransform,viewMatrix:o,cameraPosition:i.getPosition(),u_viewport:[g,T]}),s.model&&(s.model.draw({uniforms:u.uniforms.reduce(function(C,x){return C[x.name]=x.data,C},{})}),u.uniforms.forEach(function(C){C.dirty=!1}),u.dirty=!1)}}}},{key:"initMesh",value:function(){var t=_t(Ne.mark(function n(i,a){var o,s,u,c,f,d,v,g;return Ne.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(o=this.mesh.getComponentByEntity(i),o){C.next=3;break}return C.abrupt("return");case 3:if(s=o.material,u=o.geometry,!(!u||u.dirty||!s)){C.next=7;break}return C.abrupt("return");case 7:if(o.model){C.next=24;break}if(c="m-".concat(s.entity,"-g-").concat(u.entity),!this.modelCache[c]){C.next=12;break}return o.model=this.modelCache[c],C.abrupt("return");case 12:return s.setUniform({projectionMatrix:1,modelViewMatrix:1,modelMatrix:1,viewMatrix:1,cameraPosition:1,u_viewport:1}),f=this.engine,d=f.createModel,v=f.createAttribute,g={vs:s.vertexShaderGLSL,fs:s.fragmentShaderGLSL,defines:s.defines,attributes:u.attributes.reduce(function(x,$){return $.data&&$.buffer&&(x[$.name]=v({buffer:$.buffer,attributes:$.attributes,arrayStride:$.arrayStride,stepMode:$.stepMode,divisor:$.stepMode==="vertex"?0:1})),x},{}),uniforms:s.uniforms.reduce(function(x,$){return x[$.name]=$.data,x},{}),scissor:{enable:!0,box:function(){return a.getViewport()}}},s.cull&&(g.cull=s.cull),s.depth&&(g.depth=s.depth),s.blend&&(g.blend=s.blend),u.indicesBuffer&&(g.elements=u.indicesBuffer),u.maxInstancedCount&&(g.instances=u.maxInstancedCount,g.count=u.vertexCount||3),C.next=22,d(g);case 22:o.model=C.sent,this.modelCache[c]=o.model;case 24:case"end":return C.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"initView",value:function(){var t=_t(Ne.mark(function n(i){var a,o,s,u;return Ne.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:a=i.getScene(),o=ao(a.getEntities()),f.prev=2,o.s();case 4:if((s=o.n()).done){f.next=10;break}return u=s.value,f.next=8,this.initMesh(u,i);case 8:f.next=4;break;case 10:f.next=15;break;case 12:f.prev=12,f.t0=f.catch(2),o.e(f.t0);case 15:return f.prev=15,o.f(),f.finish(15);case 18:case"end":return f.stop()}},n,this,[[2,12,15,18]])}));function r(n){return t.apply(this,arguments)}return r}()}]),e}(),Ld.IDENTIFIER="Render Pass",Md),Sd=Be(Pr.prototype,"mesh",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=Be(Pr.prototype,"geometry",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd=Be(Pr.prototype,"material",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd=Be(Pr.prototype,"cullable",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd=Be(Pr.prototype,"transform",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=Be(Pr.prototype,"hierarchy",[_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Od=Be(Pr.prototype,"frameGraphSystem",[Ed,bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id=Be(Pr.prototype,"engine",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pd=Be(Pr.prototype,"resourcePool",[Td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pr))||Ad),Dd,Fd,Gd,Bd,Ud,$d,hi,Vd,jd,zd,Hd,Xd,Wd;function Zs(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=OS(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function OS(e,t){if(!!e){if(typeof e=="string")return Yd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yd(e,t)}}function Yd(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Js={NONE:0,ENCODE:1,HIGHLIGHT:2},_u=(Dd=gt(),Fd=Ue(re.RenderEngine),Gd=Ue(re.ResourcePool),Bd=Ue(re.RenderPassFactory),Ud=Ue(re.MeshComponentManager),Dd($d=(hi=(Wd=Xd=function(){function e(){var t=this;Le(this,e),Ge(this,"engine",Vd,this),Ge(this,"resourcePool",jd,this),Ge(this,"renderPassFactory",zd,this),Ge(this,"mesh",Hd,this),this.pickingFBO=void 0,this.views=void 0,this.highlightEnabled=!0,this.highlightColor=[255,0,0,255],this.alreadyInRendering=!1,this.setup=function(r,n,i){var a=r.createRenderTarget(n,"picking fbo",{width:1,height:1});i.data={output:n.write(r,a)},n.hasSideEffect=!0},this.execute=function(){var r=_t(Ne.mark(function n(i,a,o){var s,u,c;return Ne.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(t.views=o,!t.alreadyInRendering){d.next=3;break}return d.abrupt("return");case 3:s=Zs(o);try{for(c=function(){var g=u.value,T=g.getViewport(),C=T.width,x=T.height;t.alreadyInRendering=!0;var $=i.getResourceNode(a.data.output);t.pickingFBO=t.resourcePool.getOrCreateResource($.resource),t.pickingFBO.resize({width:C,height:x}),t.engine.useFramebuffer(t.pickingFBO,function(){t.engine.clear({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Q=t.renderPassFactory(Si.IDENTIFIER),X=[],he=g.getScene(),ae=Zs(he.getEntities()),Ae;try{for(ae.s();!(Ae=ae.n()).done;){var Ie=Ae.value,Ve=t.mesh.getComponentByEntity(Ie),tt=Ve.material;tt.setUniform("u_PickingStage",Js.ENCODE),X.push(Ve)}}catch($e){ae.e($e)}finally{ae.f()}Q.renderView(g),X.forEach(function($e){var Ke=$e.material;Ke.setUniform("u_PickingStage",Js.HIGHLIGHT)}),t.alreadyInRendering=!1})},s.s();!(u=s.n()).done;)c()}catch(v){s.e(v)}finally{s.f()}case 5:case"end":return d.stop()}},n)}));return function(n,i,a){return r.apply(this,arguments)}}(),this.pick=function(r,n){var i=r.x,a=r.y,o=t.engine,s=o.readPixels,u=o.useFramebuffer,c=n.getViewport(),f=c.width,d=c.height,v=i*window.devicePixelRatio,g=a*window.devicePixelRatio;if(!(v>f||v<0||g>d||g<0)){var T,C;return u(t.pickingFBO,function(){T=s({x:Math.round(v),y:Math.round(d-(a+1)*window.devicePixelRatio),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:t.pickingFBO}),(T[0]!==0||T[1]!==0||T[2]!==0)&&(C=RS(T),t.highlightEnabled&&t.highlightPickedFeature(T,n))}),C}}}return ze(e,[{key:"enableHighlight",value:function(r){this.highlightEnabled=r}},{key:"setHighlightColor",value:function(r){this.highlightColor=r}},{key:"highlightPickedFeature",value:function(r,n){if(r){var i=Zs(n.getScene().getEntities()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=this.mesh.getComponentByEntity(o),u=s.material;u.setUniform("u_PickingStage",Js.HIGHLIGHT),u.setUniform("u_PickingColor",[r[0],r[1],r[2]]),u.setUniform("u_HighlightColor",this.highlightColor)}}catch(c){i.e(c)}finally{i.f()}}}}]),e}(),Xd.IDENTIFIER="PixelPicking Pass",Wd),Vd=Be(hi.prototype,"engine",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=Be(hi.prototype,"resourcePool",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd=Be(hi.prototype,"renderPassFactory",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=Be(hi.prototype,"mesh",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hi))||$d),qd,Kd,Qd,Zd,oo,Jd,eh,th,rh,IS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,PS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,LS=`layout(set = 0, binding = 0) uniform sampler u_TextureSampler;
layout(set = 0, binding = 1) uniform texture2D u_Texture;

layout(location = 0) in vec2 v_UV;
layout(location = 0) out vec4 outColor;

void main() {
  outColor = texture(sampler2D(u_Texture, u_TextureSampler), v_UV);
}`,MS=`layout(location = 0) in vec2 a_Position;
layout(location = 0) out vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Po=(qd=gt(),Kd=Ue(re.RenderEngine),Qd=Ue(re.ResourcePool),qd(Zd=(oo=(rh=th=function e(){var t=this;Le(this,e),Ge(this,"engine",Jd,this),Ge(this,"resourcePool",eh,this),this.model=void 0,this.setup=function(r,n,i){var a=r.getPass(Si.IDENTIFIER);if(a){var o=r.createRenderTarget(n,"render to screen",{width:1,height:1});i.data={input:n.read(a.data.output),output:n.write(r,o)}}},this.execute=function(){var r=_t(Ne.mark(function n(i,a){var o,s,u,c,f,d,v;return Ne.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(o=t.engine,s=o.createModel,u=o.createAttribute,c=o.createBuffer,t.model){T.next=6;break}return T.next=4,s({vs:t.engine.supportWebGPU?MS:PS,fs:t.engine.supportWebGPU?LS:IS,attributes:{a_Position:u({buffer:c({data:[-4,-4,4,-4,0,4],type:M.FLOAT}),size:2,arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})},uniforms:{u_Texture:null},depth:{enable:!1},count:3,blend:{enable:!0}});case 4:f=T.sent,t.model=f;case 6:d=i.getResourceNode(a.data.input),v=t.resourcePool.getOrCreateResource(d.resource),t.engine.useFramebuffer(null,function(){t.engine.clear({framebuffer:null,color:[0,0,0,0],depth:1,stencil:0}),t.model.draw({uniforms:{u_Texture:v}})});case 9:case"end":return T.stop()}},n)}));return function(n,i){return r.apply(this,arguments)}}(),this.tearDown=function(){t.model=void 0}},th.IDENTIFIER="Copy Pass",rh),Jd=Be(oo.prototype,"engine",[Kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eh=Be(oo.prototype,"resourcePool",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo))||Zd),nh,ih,ah,oh,sh,uh,ch,vi,fh,lh,dh,hh,vh,kS=(nh=gt(),ih=Ue(re.Systems),ah=zr(re.FrameGraphSystem),oh=Ue(re.RenderPassFactory),sh=Ue(re.ConfigService),uh=Ue(re.ResourcePool),nh(ch=(vi=(vh=function(){function e(){Le(this,e),Ge(this,"frameGraphSystem",fh,this),Ge(this,"renderPassFactory",lh,this),Ge(this,"configService",dh,this),Ge(this,"resourcePool",hh,this)}return ze(e,[{key:"execute",value:function(){var t=_t(Ne.mark(function n(i){var a,o,s,u,c,f,d,v;return Ne.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:a=this.renderPassFactory(Si.IDENTIFIER),o=a.setup,s=a.execute,this.frameGraphSystem.addPass(Si.IDENTIFIER,o,s),u=this.renderPassFactory(Po.IDENTIFIER),c=u.setup,f=u.execute,d=u.tearDown,v=this.frameGraphSystem.addPass(Po.IDENTIFIER,c,f,d),this.frameGraphSystem.present(v.data.output);case 5:case"end":return T.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.resourcePool.clean()}},{key:"pick",value:function(r,n){var i=this.renderPassFactory(_u.IDENTIFIER);return i.pick(r,n)}}]),e}(),vh),fh=Be(vi.prototype,"frameGraphSystem",[ih,ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=Be(vi.prototype,"renderPassFactory",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dh=Be(vi.prototype,"configService",[sh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh=Be(vi.prototype,"resourcePool",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vi))||ch);function DS(e){var t=FS();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function FS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var GS=function(e){ur(r,e);var t=DS(r);function r(n){var i;return Le(this,r),i=t.call(this,n),i.parentID=void 0,Object.assign(jt(i),n),i}return r}(jn),ph,mh,yh,_h,Eh,Zi,bh,gh,Th,Ah,BS=(ph=gt(),mh=Ue(re.HierarchyComponentManager),yh=Ue(re.TransformComponentManager),_h=Ue(re.MeshComponentManager),ph(Eh=(Zi=(Ah=function(){function e(){Le(this,e),Ge(this,"hierarchy",bh,this),Ge(this,"transform",gh,this),Ge(this,"mesh",Th,this)}return ze(e,[{key:"execute",value:function(){var t=_t(Ne.mark(function n(){return Ne.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this.runTransformUpdateSystem(),this.runHierarchyUpdateSystem();case 2:case"end":return a.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.hierarchy.clear(),this.transform.clear()}},{key:"getHierarchyComponentManager",value:function(){return this.hierarchy}},{key:"getTransformComponentManager",value:function(){return this.transform}},{key:"runTransformUpdateSystem",value:function(){var r=this;this.transform.forEach(function(n,i){(i.isDirty()||i.isLocalDirty())&&(r.setMeshAABBDirty(r.mesh.getComponentByEntity(n)),i.updateTransform())})}},{key:"runHierarchyUpdateSystem",value:function(){var r=this;this.hierarchy.forEach(function(n,i){var a=r.transform.getComponentByEntity(n),o=r.transform.getComponentByEntity(i.parentID);a!==null&&o!==null&&a.updateTransformWithParent(o)})}},{key:"attach",value:function(r,n,i){this.hierarchy.contains(r)&&this.detach(r),this.hierarchy.create(r,{parentID:n});var a=this.mesh.getComponentByEntity(n);if(this.setMeshAABBDirty(a),a&&a.children.indexOf(r)===-1&&a.children.push(r),this.hierarchy.getCount()>1)for(var o=this.hierarchy.getCount()-1;o>0;--o)for(var s=this.hierarchy.getEntity(o),u=0;u<o;++u){var c=this.hierarchy.getComponent(u);if(c.parentID===s){this.hierarchy.moveItem(o,u),++o;break}}this.hierarchy.getComponentByEntity(r);var f=this.transform.getComponentByEntity(n);f===null&&(f=this.transform.create(n));var d=this.transform.getComponentByEntity(r);d===null&&(d=this.transform.create(r),f=this.transform.getComponentByEntity(n)),d.parent=f,!i&&f&&(d.matrixTransform(Oo(Er(),f.worldTransform)),d.updateTransform()),f&&d.updateTransformWithParent(f)}},{key:"detach",value:function(r){var n=this.hierarchy.getComponentByEntity(r);if(n!==null){var i=this.transform.getComponentByEntity(r);i!==null&&(i.parent=null,i.applyTransform()),this.hierarchy.removeKeepSorted(r);var a=this.mesh.getComponentByEntity(n.parentID);if(a){var o=a.children.indexOf(r);a.children.splice(o,1)}this.setMeshAABBDirty(a)}}},{key:"detachChildren",value:function(r){var n=this.mesh.getComponentByEntity(r);n&&(n.children=[]);for(var i=0;i<this.hierarchy.getCount();){var a;if(((a=this.hierarchy.getComponent(i))===null||a===void 0?void 0:a.parentID)===r){var o=this.hierarchy.getEntity(i);this.detach(o)}else++i}}},{key:"setMeshAABBDirty",value:function(r){r&&(r.aabbDirty=!0)}}]),e}(),Ah),bh=Be(Zi.prototype,"hierarchy",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gh=Be(Zi.prototype,"transform",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Th=Be(Zi.prototype,"mesh",[_h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zi))||Eh);function US(e){var t=$S();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function $S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Oy=function(e){ur(r,e);var t=US(r);function r(n){var i;return Le(this,r),i=t.call(this,n),i.dirtyFlag=void 0,i.localDirtyFlag=void 0,i.parent=null,i.localPosition=st(0,0,0),i.localRotation=Qs(0,0,0,1),i.localScale=st(1,1,1),i.localTransform=Er(),i.position=st(0,0,0),i.rotation=Qs(0,0,0,1),i.scaling=st(1,1,1),i.worldTransform=Er(),i.matrixTransform=function(){var a=Er();return function(o){Gn(a,i.getLocalTransform(),o),gi(i.localScale,a),Yi(i.localPosition,a),qi(i.localRotation,a)}}(),i.rotateRollPitchYaw=function(){var a=Jt(),o=Jt(),s=Jt();return function(u,c,f){i.setDirty(),Ks(a,u,0,0),Ks(o,0,c,0),Ks(s,0,0,f),wr(i.localRotation,a,i.localRotation),wr(i.localRotation,i.localRotation,o),wr(i.localRotation,s,i.localRotation),Ti(i.localRotation,i.localRotation)}}(),i.lerp=function(){var a=At(),o=Jt(),s=At(),u=At(),c=Jt(),f=At();return function(d,v,g){i.setDirty(),gi(a,d.worldTransform),Yi(s,d.worldTransform),qi(o,d.worldTransform),gi(u,v.worldTransform),Yi(f,v.worldTransform),qi(c,v.worldTransform),Un(i.localScale,a,u,g),wo(i.localRotation,o,c,g),Un(i.localPosition,s,f,g)}}(),i.translate=function(){var a=At();return function(o){return tn(a,i.getPosition(),o),i.setPosition(a),i.setDirty(!0),jt(i)}}(),i.translateLocal=function(){return function(a){return x1(a,a,i.localRotation),tn(i.localPosition,i.localPosition,a),i.setLocalDirty(!0),jt(i)}}(),i.setPosition=function(){var a=Er();return function(o){return i.position=o,i.setLocalDirty(!0),i.parent===null?sr(i.localPosition,o):(vu(a,i.parent.worldTransform),Oo(a,a),Fu(i.localPosition,o,a)),jt(i)}}(),i.rotate=function(){var a=Jt();return function(o){if(i.parent===null)wr(i.localRotation,i.localRotation,o),Ti(i.localRotation,i.localRotation);else{var s=i.getRotation(),u=i.parent.getRotation();Ki(a,u),Cl(a,a),wr(a,a,o),wr(i.localRotation,o,s),Ti(i.localRotation,i.localRotation)}return i.setLocalDirty(),jt(i)}}(),i.rotateLocal=function(){return function(a){return wr(i.localRotation,i.localRotation,a),Ti(i.localRotation,i.localRotation),i.setLocalDirty(!0),jt(i)}}(),i.setRotation=function(){var a=Jt();return function(o){return i.parent===null?Ki(i.localRotation,o):(Ki(a,i.parent.getRotation()),Cl(a,a),Ki(i.localRotation,a),P1(i.localRotation,i.localRotation,o)),i.setLocalDirty(!0),jt(i)}}(),i}return ze(r,[{key:"setLocalPosition",value:function(i){sr(this.localPosition,i),this.setLocalDirty(!0)}},{key:"setLocalScale",value:function(i){sr(this.localScale,i),this.setLocalDirty(!0)}},{key:"setLocalRotation",value:function(i){return Ki(this.localRotation,i),this.setLocalDirty(!0),this}},{key:"isDirty",value:function(){return this.dirtyFlag}},{key:"setDirty",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i?this.dirtyFlag|=r.DIRTY:this.dirtyFlag&=~r.DIRTY}},{key:"isLocalDirty",value:function(){return this.localDirtyFlag}},{key:"setLocalDirty",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i?(this.localDirtyFlag|=r.DIRTY,this.setDirty(!0)):this.localDirtyFlag&=~r.DIRTY}},{key:"updateTransform",value:function(){this.isLocalDirty()&&this.getLocalTransform(),this.isDirty()&&this.parent===null&&(vu(this.worldTransform,this.getLocalTransform()),this.setDirty(!1))}},{key:"updateTransformWithParent",value:function(i){Gn(this.worldTransform,i.worldTransform,this.getLocalTransform())}},{key:"applyTransform",value:function(){this.setDirty(),gi(this.localScale,this.worldTransform),Yi(this.localPosition,this.worldTransform),qi(this.localRotation,this.worldTransform)}},{key:"clearTransform",value:function(){this.setDirty(),this.localPosition=st(0,0,0),this.localRotation=Qs(0,0,0,1),this.localScale=st(1,1,1)}},{key:"scaleLocal",value:function(i){return this.setLocalDirty(),R1(this.localScale,this.localScale,i),this}},{key:"getLocalPosition",value:function(){return this.localPosition}},{key:"getLocalRotation",value:function(){return this.localRotation}},{key:"getLocalScale",value:function(){return this.localScale}},{key:"getLocalTransform",value:function(){return this.localDirtyFlag&&(b1(this.localTransform,this.localRotation,this.localPosition,this.localScale),this.setLocalDirty(!1)),this.localTransform}},{key:"getWorldTransform",value:function(){return!this.isLocalDirty()&&!this.isDirty()?this.worldTransform:(this.parent&&this.parent.getWorldTransform(),this.updateTransform(),this.worldTransform)}},{key:"getPosition",value:function(){return Yi(this.position,this.worldTransform),this.position}},{key:"getRotation",value:function(){return qi(this.rotation,this.worldTransform),this.rotation}},{key:"getScale",value:function(){return gi(this.scaling,this.worldTransform),this.scaling}}]),r}(jn);Oy.DIRTY=1<<0;var Sh,wh,Rh,eu,Ch,xh,VS=(Sh=gt(),wh=Ue(re.RenderEngine),Sh(Rh=(eu=(xh=function(){function e(){Le(this,e),Ge(this,"engine",Ch,this),this.resourcePool={}}return ze(e,[{key:"getOrCreateResource",value:function(r){if(!this.resourcePool[r.name]){var n=r.descriptor,i=n.width,a=n.height,o=n.usage;this.resourcePool[r.name]=this.engine.createFramebuffer({color:this.engine.createTexture2D({width:i,height:a,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE,usage:o})})}return this.resourcePool[r.name]}},{key:"clean",value:function(){this.resourcePool={}}}]),e}(),xh),Ch=Be(eu.prototype,"engine",[wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eu))||Rh);function jS(e){var t=zS();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function zS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var HS=function(e){ur(r,e);var t=jS(r);function r(n){var i;return Le(this,r),i=t.call(this,n),i.name=void 0,i.name=n.name||"",i}return r}(jn),Nh,Oh,Ih,XS=(Nh=gt(),Nh(Oh=(Ih=function(){function e(){Le(this,e),this.config=void 0}return ze(e,[{key:"get",value:function(){return this.config}},{key:"set",value:function(r){this.config=r}}]),e}(),Ih))||Oh),Ph,Lh,Mh;(function(e){e.PANSTART="PANSTART",e.PANEND="PANEND",e.PANMOVE="PANMOVE",e.PINCH="PINCH",e.KEYDOWN="KEYDOWN",e.KEYUP="KEYUP",e.HOVER="HOVER"})(Mh||(Mh={}));var WS=(Ph=gt(),Ph(Lh=function(){function e(){Le(this,e)}return ze(e,[{key:"listen",value:function(r){}},{key:"on",value:function(r,n){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"destroy",value:function(){}}]),e}())||Lh);function YS(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break}return t}var qS=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function kh(e){var t={};return e=e.replace(qS,function(r,n,i){var a=i.split(":"),o=a[0].trim(),s="";switch(a.length>1&&(s=a[1].trim()),n){case"bool":s=s==="true";break;case"float":case"int":s=Number(s);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":s?s=s.replace("[","").replace("]","").split(",").reduce(function(u,c){return u.push(Number(c.trim())),u},[]):s=new Array(YS(n)).fill(0);break}return t[o]=s,"uniform ".concat(n," ").concat(o,`;
`)}),{content:e,uniforms:t}}function KS(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}var Dh,Fh,Gh;function Bh(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ji(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Bh(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var QS=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,ZS=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}`,JS=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}`,ew=/precision\s+(high|low|medium)p\s+float/,tw=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,rw=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,nw=(Dh=gt(),Dh(Fh=(Gh=function(){function e(){Le(this,e),this.moduleCache={},this.rawContentCache={}}return ze(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("picking",{vs:ZS,fs:QS}),this.registerModule("sdf2d",{vs:"",fs:JS})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var i=n.vs,a=i===void 0?"":i,o=n.fs,s=o===void 0?"":o,u=n.uniforms,c=kh(a),f=c.content,d=c.uniforms,v=kh(s),g=v.content,T=v.uniforms;this.rawContentCache[r]={fs:g,uniforms:Ji(Ji(Ji({},d),T),u),vs:f}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var i=this.rawContentCache[r].vs||"",a=this.rawContentCache[r].fs||"",o=this.processModule(i,[],"vs"),s=o.content,u=o.includeList,c=this.processModule(a,[],"fs"),f=c.content,d=c.includeList,v=f,g=KS(u.concat(d).concat(r)).reduce(function(T,C){return Ji(Ji({},T),n.rawContentCache[C].uniforms)},{});return ew.test(f)||(v=tw+f),this.moduleCache[r]={fs:v.trim(),uniforms:g,vs:s.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,i){var a=this,o=r.replace(rw,function(s,u){var c=u.split(" "),f=c[0].replace(/"/g,"");if(n.indexOf(f)>-1)return"";var d=a.rawContentCache[f][i];n.push(f);var v=a.processModule(d||"",n,i),g=v.content;return g});return{content:o,includeList:n}}}]),e}(),Gh))||Fh),rn=new Ry;rn.bind(re.ShaderModuleService).to(nw).inSingletonScope();rn.bind(re.NameComponentManager).toConstantValue(new zn(HS));rn.bind(re.HierarchyComponentManager).toConstantValue(new zn(GS));rn.bind(re.TransformComponentManager).toConstantValue(new zn(Oy));rn.bind(re.MeshComponentManager).toConstantValue(new zn(TS));rn.bind(re.CullableComponentManager).toConstantValue(new zn(ES));rn.bind(re.GeometryComponentManager).toConstantValue(new zn(lS));rn.bind(re.MaterialComponentManager).toConstantValue(new zn(pS));function iw(){var e=new Ry;return e.parent=rn,e.bind(re.Systems).to(BS).inSingletonScope().whenTargetNamed(re.SceneGraphSystem),e.bind(re.Systems).to(h1).inSingletonScope().whenTargetNamed(re.FrameGraphSystem),e.bind(re.Systems).to(xS).inSingletonScope().whenTargetNamed(re.MeshSystem),e.bind(re.Systems).to(dS).inSingletonScope().whenTargetNamed(re.GeometrySystem),e.bind(re.Systems).to(mS).inSingletonScope().whenTargetNamed(re.MaterialSystem),e.bind(re.Systems).to(kS).inSingletonScope().whenTargetNamed(re.RendererSystem),e.bind(re.ResourcePool).to(VS).inSingletonScope(),e.bind(re.ConfigService).to(XS).inSingletonScope(),e.bind(re.InteractorService).to(WS).inSingletonScope(),e.bind(re.RenderPass).to(Si).inSingletonScope().whenTargetNamed(Si.IDENTIFIER),e.bind(re.RenderPass).to(Po).inSingletonScope().whenTargetNamed(Po.IDENTIFIER),e.bind(re.RenderPass).to(_u).inSingletonScope().whenTargetNamed(_u.IDENTIFIER),e.bind(re.RenderPassFactory).toFactory(function(t){return function(r){return t.container.getNamed(re.RenderPass,r)}}),e}function Uu(e){for(var t=new Bu,r=st(e[0],e[1],e[2]),n=st(e[0],e[1],e[2]),i=3;i<e.length;){var a=e[i++],o=e[i++],s=e[i++];a<r[0]&&(r[0]=a),o<r[1]&&(r[1]=o),s<r[2]&&(r[2]=s),a>n[0]&&(n[0]=a),o>n[1]&&(n[1]=o),s>n[2]&&(n[2]=s)}return t.setMinMax(r,n),t}var _r=typeof navigator<"u"&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);At();At();At();At();At();At();var Uh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Uh||(Uh={}));var $n;(function(e){e.Void="Void",e.Boolean="Boolean",e.Float="Float",e.Uint32="Uint32",e.Int32="Int32",e.Vector="Vector",e.Vector2Float="vec2<f32>",e.Vector3Float="vec3<f32>",e.Vector4Float="vec4<f32>",e.Vector2Boolean="vec2<bool>",e.Vector3Boolean="vec3<bool>",e.Vector4Boolean="vec4<bool>",e.Vector2Uint="vec2<u32>",e.Vector3Uint="vec3<u32>",e.Vector4Uint="vec4<u32>",e.Vector2Int="vec2<i32>",e.Vector3Int="vec3<i32>",e.Vector4Int="vec4<i32>",e.Matrix="Matrix",e.Matrix3x3Float="mat3x3<f32>",e.Matrix4x4Float="mat4x4<i32>",e.Struct="Struct",e.FloatArray="Float[]",e.Vector4FloatArray="vec4<f32>[]"})($n||($n={}));var $h;(function(e){e.Program="Program",e.Identifier="Identifier",e.VariableDeclaration="VariableDeclaration",e.BlockStatement="BlockStatement",e.ReturnStatement="ReturnStatement",e.FunctionDeclaration="FunctionDeclaration",e.VariableDeclarator="VariableDeclarator",e.AssignmentExpression="AssignmentExpression",e.LogicalExpression="LogicalExpression",e.BinaryExpression="BinaryExpression",e.ArrayExpression="ArrayExpression",e.UnaryExpression="UnaryExpression",e.UpdateExpression="UpdateExpression",e.FunctionExpression="FunctionExpression",e.MemberExpression="MemberExpression",e.ConditionalExpression="ConditionalExpression",e.ExpressionStatement="ExpressionStatement",e.CallExpression="CallExpression",e.NumThreadStatement="NumThreadStatement",e.StorageStatement="StorageStatement",e.DoWhileStatement="DoWhileStatement",e.WhileStatement="WhileStatement",e.ForStatement="ForStatement",e.BreakStatement="BreakStatement",e.ContinueStatement="ContinueStatement",e.IfStatement="IfStatement",e.ImportedFunctionStatement="ImportedFunctionStatement"})($h||($h={}));var En;(function(e){e.Input="Input",e.Output="Output",e.Uniform="Uniform",e.Workgroup="Workgroup",e.UniformConstant="UniformConstant",e.Image="Image",e.StorageBuffer="StorageBuffer",e.Private="Private",e.Function="Function"})(En||(En={}));var ha;(function(e){e.GLSL100="GLSL100",e.GLSL450="GLSL450",e.WGSL="WGSL"})(ha||(ha={}));var aw="__DefineValuePlaceholder__";function $u(e){return typeof e=="number"}function Wr(e){return e===void 0?0:e>360||e<-360?e%360:e}function Ln(e,t,r){return $u(e)?st(e,t,r):e.length===3?Jr(e):st(e[0],e[1],e[2])}var Vh=function(){function e(t,r){Le(this,e),this.name=void 0,this.matrix=void 0,this.right=void 0,this.up=void 0,this.forward=void 0,this.position=void 0,this.focalPoint=void 0,this.distanceVector=void 0,this.distance=void 0,this.dollyingStep=void 0,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=t,this.matrix=y1(r.matrix),this.right=Jr(r.right),this.up=Jr(r.up),this.forward=Jr(r.forward),this.position=Jr(r.position),this.focalPoint=Jr(r.focalPoint),this.distanceVector=Jr(r.distanceVector),this.azimuth=r.azimuth,this.elevation=r.elevation,this.roll=r.roll,this.relAzimuth=r.relAzimuth,this.relElevation=r.relElevation,this.relRoll=r.relRoll,this.dollyingStep=r.dollyingStep,this.distance=r.distance}return ze(e,[{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getRoll",value:function(){return this.roll}},{key:"retrieve",value:function(r){r.matrix=vu(r.matrix,this.matrix),r.right=sr(r.right,this.right),r.up=sr(r.up,this.up),r.forward=sr(r.forward,this.forward),r.position=sr(r.position,this.position),r.focalPoint=sr(r.focalPoint,this.focalPoint),r.distanceVector=sr(r.distanceVector,this.distanceVector),r.azimuth=this.azimuth,r.elevation=this.elevation,r.roll=this.roll,r.relAzimuth=this.relAzimuth,r.relElevation=this.relElevation,r.relRoll=this.relRoll,r.dollyingStep=this.dollyingStep,r.distance=this.distance}}]),e}(),jh,zh,Hh,tu,Xh,Wh,Yh,Rt;(function(e){e.ORBITING="ORBITING",e.EXPLORING="EXPLORING",e.TRACKING="TRACKING"})(Rt||(Rt={}));var Lo;(function(e){e.DEFAULT="DEFAULT",e.ROTATIONAL="ROTATIONAL",e.TRANSLATIONAL="TRANSLATIONAL",e.CINEMATIC="CINEMATIC"})(Lo||(Lo={}));var Fn;(function(e){e.ORTHOGRAPHIC="ORTHOGRAPHIC",e.PERSPECTIVE="PERSPECTIVE"})(Fn||(Fn={}));var Yr=Math.PI/180,ln=180/Math.PI,qh=(jh=gt(),zh=Ue(re.InteractorService),jh(Hh=(tu=(Yh=Wh=function(){function e(){Le(this,e),this.matrix=Er(),this.right=st(1,0,0),this.up=st(0,1,0),this.forward=st(0,0,1),this.position=st(0,0,1),this.focalPoint=st(0,0,0),this.distanceVector=st(0,0,0),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.rotateWorld=!1,Ge(this,"interactor",Xh,this),this.fov=30,this.near=.1,this.far=1e4,this.aspect=1,this.left=void 0,this.rright=void 0,this.top=void 0,this.bottom=void 0,this.zoom=1,this.perspective=Er(),this.view=void 0,this.following=void 0,this.type=Rt.EXPLORING,this.trackingMode=Lo.DEFAULT,this.projectionMode=Fn.PERSPECTIVE,this.frustum=new SS,this.landmarks=[],this.landmarkAnimationID=void 0}return ze(e,[{key:"clone",value:function(){var r=new e;return r.setType(this.type,void 0),r.interactor=this.interactor,r}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.perspective}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"setType",value:function(r,n){return this.type=r,this.type===Rt.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===Rt.TRACKING&&n!==void 0&&this.setTrackingMode(n),this}},{key:"setProjectionMode",value:function(r){return this.projectionMode=r,this}},{key:"setTrackingMode",value:function(r){if(this.type!==Rt.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=r,this}},{key:"setWorldRotation",value:function(r){this.rotateWorld=r,this._getAngles()}},{key:"getViewTransform",value:function(){return Oo(Er(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"setMatrix",value:function(r){return this.matrix=r,this._update(),this}},{key:"setAspect",value:function(r){return this.setPerspective(this.near,this.far,this.fov,r),this}},{key:"setViewOffset",value:function(r,n,i,a,o,s){return this.aspect=r/n,this.view===void 0&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=a,this.view.width=o,this.view.height=s,this.projectionMode===Fn.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return this.view!==void 0&&(this.view.enabled=!1),this.projectionMode===Fn.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setPerspective",value:function(r,n,i,a){return this.projectionMode=Fn.PERSPECTIVE,this.fov=i,this.near=r,this.far=n,this.aspect=a,T1(this.perspective,this.fov*Yr,this.aspect,this.near,this.far),this}},{key:"setOrthographic",value:function(r,n,i,a,o,s){this.projectionMode=Fn.ORTHOGRAPHIC,this.rright=n,this.left=r,this.top=i,this.bottom=a,this.near=o,this.far=s;var u=(this.rright-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),f=(this.rright+this.left)/2,d=(this.top+this.bottom)/2,v=f-u,g=f+u,T=d+c,C=d-c;if(this.view!==void 0&&this.view.enabled){var x=(this.rright-this.left)/this.view.fullWidth/this.zoom,$=(this.top-this.bottom)/this.view.fullHeight/this.zoom;v+=x*this.view.offsetX,g=v+x*this.view.width,T-=$*this.view.offsetY,C=T-$*this.view.height}return S1(this.perspective,v,g,T,C,o,s),this}},{key:"setPosition",value:function(r,n,i){return this._setPosition(r,n,i),this.setFocalPoint(this.focalPoint),this}},{key:"setFocalPoint",value:function(r,n,i){var a=st(0,1,0);if(this.focalPoint=Ln(r,n,i),this.trackingMode===Lo.CINEMATIC){var o=pu(At(),this.focalPoint,this.position);r=o[0],n=o[1],i=o[2];var s=So(o),u=Math.asin(n/s)*ln,c=90+Math.atan2(i,r)*ln,f=Er();E1(f,f,c*Yr),_1(f,f,u*Yr),a=Fu(At(),[0,1,0],f)}return Oo(this.matrix,w1(Er(),this.position,this.focalPoint,a)),this._getAxes(),this._getDistance(),this._getAngles(),this}},{key:"setDistance",value:function(r){if(!(this.distance===r||r<0)){this.distance=r,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var n=At();r=this.distance;var i=this.forward,a=this.focalPoint;return n[0]=r*i[0]+a[0],n[1]=r*i[1]+a[1],n[2]=r*i[2]+a[2],this._setPosition(n),this}}},{key:"setMaxDistance",value:function(r){return this.maxDistance=r,this}},{key:"setMinDistance",value:function(r){return this.minDistance=r,this}},{key:"changeAzimuth",value:function(r){return this.setAzimuth(this.azimuth+r),this}},{key:"changeElevation",value:function(r){return this.setElevation(this.elevation+r),this}},{key:"changeRoll",value:function(r){return this.setRoll(this.roll+r),this}},{key:"setAzimuth",value:function(r){return this.azimuth=Wr(r),this.computeMatrix(),this._getAxes(),this.type===Rt.ORBITING||this.type===Rt.EXPLORING?this._getPosition():this.type===Rt.TRACKING&&this._getFocalPoint(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(r){return this.elevation=Wr(r),this.computeMatrix(),this._getAxes(),this.type===Rt.ORBITING||this.type===Rt.EXPLORING?this._getPosition():this.type===Rt.TRACKING&&this._getFocalPoint(),this}},{key:"setRoll",value:function(r){return this.roll=Wr(r),this.computeMatrix(),this._getAxes(),this.type===Rt.ORBITING||this.type===Rt.EXPLORING?this._getPosition():this.type===Rt.TRACKING&&this._getFocalPoint(),this}},{key:"rotate",value:function(r,n,i){if(this.type===Rt.EXPLORING){r=Wr(r),n=Wr(n),i=Wr(i);var a=Dn(Jt(),[1,0,0],(this.rotateWorld?1:-1)*n*Yr),o=Dn(Jt(),[0,1,0],(this.rotateWorld?1:-1)*r*Yr),s=Dn(Jt(),[0,0,1],i*Yr),u=wr(Jt(),o,a);u=wr(Jt(),u,s);var c=wl(Er(),u);Wi(this.matrix,this.matrix,[0,0,-this.distance]),Gn(this.matrix,this.matrix,c),Wi(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation+n)>90)return;this.relElevation=Wr(n),this.relAzimuth=Wr(r),this.relRoll=Wr(i),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.computeMatrix()}return this._getAxes(),this.type===Rt.ORBITING||this.type===Rt.EXPLORING?this._getPosition():this.type===Rt.TRACKING&&this._getFocalPoint(),this._update(),this}},{key:"pan",value:function(r,n){var i=Ln(r,n,0),a=Jr(this.position);return tn(a,a,Ea(At(),this.right,i[0])),tn(a,a,Ea(At(),this.up,i[1])),this._setPosition(a),this}},{key:"dolly",value:function(r){var n=this.forward,i=Jr(this.position),a=r*this.dollyingStep,o=this.distance+r*this.dollyingStep;return a=Math.max(Math.min(o,this.maxDistance),this.minDistance)-this.distance,i[0]+=a*n[0],i[1]+=a*n[1],i[2]+=a*n[2],this._setPosition(i),this.type===Rt.ORBITING||this.type===Rt.EXPLORING?this._getDistance():this.type===Rt.TRACKING&&tn(this.focalPoint,i,this.distanceVector),this}},{key:"createLandmark",value:function(r,n){var i=this.clone();i.setPosition(n.position),i.setFocalPoint(n.focalPoint),n.roll!==void 0&&i.setRoll(n.roll);var a=new Vh(r,i);return this.landmarks.push(a),a}},{key:"setLandmark",value:function(r){var n=new Vh(r,this);return this.landmarks.push(n),this}},{key:"gotoLandmark",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3,a=this.landmarks.find(function(d){return d.name===r});if(a){if(i===0){a.retrieve(this);return}this.landmarkAnimationID!==void 0&&window.cancelAnimationFrame(this.landmarkAnimationID),this.interactor.disconnect();var o=a.getPosition(),s=a.getFocalPoint(),u=a.getRoll(),c,f=function d(v){c===void 0&&(c=v);var g=v-c,T=(1-Math.cos(g/i*Math.PI))/2,C=At(),x=At(),$=0;Un(C,n.focalPoint,s,T),Un(x,n.position,o,T),$=n.roll*(1-T)+u*T,n.setFocalPoint(C),n.setPosition(x),n.setRoll($),n.computeMatrix();var Q=Rl(C,s)+Rl(x,o);if(!(Q>.01)){n.setFocalPoint(C),n.setPosition(x),n.setRoll($),n.computeMatrix(),n.interactor.connect();return}g<i&&(n.landmarkAnimationID=window.requestAnimationFrame(d))};window.requestAnimationFrame(f)}}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles()}},{key:"computeMatrix",value:function(){var r,n,i=Dn(Jt(),[0,0,1],this.roll*Yr);Cy(this.matrix),r=Dn(Jt(),[1,0,0],(this.rotateWorld&&this.type!==Rt.TRACKING||this.type===Rt.TRACKING?1:-1)*this.elevation*Yr),n=Dn(Jt(),[0,1,0],(this.rotateWorld&&this.type!==Rt.TRACKING||this.type===Rt.TRACKING?1:-1)*this.azimuth*Yr);var a=wr(Jt(),n,r);a=wr(Jt(),a,i);var o=wl(Er(),a);this.type===Rt.ORBITING||this.type===Rt.EXPLORING?(Wi(this.matrix,this.matrix,this.focalPoint),Gn(this.matrix,this.matrix,o),Wi(this.matrix,this.matrix,[0,0,this.distance])):this.type===Rt.TRACKING&&(Wi(this.matrix,this.matrix,this.position),Gn(this.matrix,this.matrix,o))}},{key:"_setPosition",value:function(r,n,i){this.position=Ln(r,n,i);var a=this.matrix;a[12]=this.position[0],a[13]=this.position[1],a[14]=this.position[2],a[15]=1}},{key:"_getAxes",value:function(){sr(this.right,Ln(la(fa(),[1,0,0,0],this.matrix))),sr(this.up,Ln(la(fa(),[0,1,0,0],this.matrix))),sr(this.forward,Ln(la(fa(),[0,0,1,0],this.matrix))),da(this.right,this.right),da(this.up,this.up),da(this.forward,this.forward)}},{key:"_getAngles",value:function(){var r=this.distanceVector[0],n=this.distanceVector[1],i=this.distanceVector[2],a=So(this.distanceVector);if(a===0){this.elevation=0,this.azimuth=0;return}this.type===Rt.TRACKING?(this.elevation=Math.asin(n/a)*ln,this.azimuth=Math.atan2(-r,-i)*ln):this.rotateWorld?(this.elevation=Math.asin(n/a)*ln,this.azimuth=Math.atan2(-r,-i)*ln):(this.elevation=-Math.asin(n/a)*ln,this.azimuth=-Math.atan2(-r,-i)*ln)}},{key:"_getPosition",value:function(){sr(this.position,Ln(la(fa(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){Gu(this.distanceVector,[0,0,-this.distance],p1(Ta(),this.matrix)),tn(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=pu(At(),this.focalPoint,this.position),this.distance=So(this.distanceVector),this.dollyingStep=this.distance/100}}]),e}(),Wh.ProjectionMode={ORTHOGRAPHIC:"ORTHOGRAPHIC",PERSPECTIVE:"PERSPECTIVE"},Yh),Xh=Be(tu.prototype,"interactor",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tu))||Hh),Kh,Qh,Zh,ru,Jh,ea,ev,mn=(Kh=gt(),Qh=Ue(re.GeometryComponentManager),Kh(Zh=(ru=(ev=ea=function(){function e(){Le(this,e),this.config=void 0,Ge(this,"geometry",Jh,this),this.entity=void 0,this.component=void 0}return ze(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r){this.entity=r,this.component=this.geometry.create(r),this.component.entity=r,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),e}(),ea.BOX="box",ea.SPHERE="sphere",ea.PLANE="plane",ea.MERGED="merged",ev),Jh=Be(ru.prototype,"geometry",[Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ru))||Zh),be={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.TextureCompressionBC="texture-compression-bc"}(e.ExtensionName||(e.ExtensionName={})),function(t){t.ClampToEdge="clamp-to-edge",t.Repeat="repeat",t.MirrorRepeat="mirror-repeat"}(e.AddressMode||(e.AddressMode={})),function(t){t.UniformBuffer="uniform-buffer",t.StorageBuffer="storage-buffer",t.ReadonlyStorageBuffer="readonly-storage-buffer",t.Sampler="sampler",t.ComparisonSampler="comparison-sampler",t.SampledTexture="sampled-texture",t.ReadonlyStorageTexture="readonly-storage-texture",t.WriteonlyStorageTexture="writeonly-storage-texture"}(e.BindingType||(e.BindingType={})),function(t){t.Zero="zero",t.One="one",t.SrcColor="src-color",t.OneMinusSrcColor="one-minus-src-color",t.SrcAlpha="src-alpha",t.OneMinusSrcAlpha="one-minus-src-alpha",t.DstColor="dst-color",t.OneMinusDstColor="one-minus-dst-color",t.DstAlpha="dst-alpha",t.OneMinusDstAlpha="one-minus-dst-alpha",t.SrcAlphaSaturated="src-alpha-saturated",t.BlendColor="blend-color",t.OneMinusBlendColor="one-minus-blend-color"}(e.BlendFactor||(e.BlendFactor={})),function(t){t.Add="add",t.Subtract="subtract",t.ReverseSubtract="reverse-subtract",t.Min="min",t.Max="max"}(e.BlendOperation||(e.BlendOperation={})),function(t){t.Never="never",t.Less="less",t.Equal="equal",t.LessEqual="less-equal",t.Greater="greater",t.NotEqual="not-equal",t.GreaterEqual="greater-equal",t.Always="always"}(e.CompareFunction||(e.CompareFunction={})),function(t){t.None="none",t.Front="front",t.Back="back"}(e.CullMode||(e.CullMode={})),function(t){t.Nearest="nearest",t.Linear="linear"}(e.FilterMode||(e.FilterMode={})),function(t){t.CCW="ccw",t.CW="cw"}(e.FrontFace||(e.FrontFace={})),function(t){t.Uint16="uint16",t.Uint32="uint32"}(e.IndexFormat||(e.IndexFormat={})),function(t){t.Vertex="vertex",t.Instance="instance"}(e.InputStepMode||(e.InputStepMode={})),function(t){t.Load="load"}(e.LoadOp||(e.LoadOp={})),function(t){t.PointList="point-list",t.LineList="line-list",t.LineStrip="line-strip",t.TriangleList="triangle-list",t.TriangleStrip="triangle-strip"}(e.PrimitiveTopology||(e.PrimitiveTopology={})),function(t){t.Keep="keep",t.Zero="zero",t.Replace="replace",t.Invert="invert",t.IncrementClamp="increment-clamp",t.DecrementClamp="decrement-clamp",t.IncrementWrap="increment-wrap",t.DecrementWrap="decrement-wrap"}(e.StencilOperation||(e.StencilOperation={})),function(t){t.Store="store",t.Clear="clear"}(e.StoreOp||(e.StoreOp={})),function(t){t.E1d="1d",t.E2d="2d",t.E3d="3d"}(e.TextureDimension||(e.TextureDimension={})),function(t){t.R8Unorm="r8unorm",t.R8Snorm="r8snorm",t.R8Uint="r8uint",t.R8Sint="r8sint",t.R16Uint="r16uint",t.R16Sint="r16sint",t.R16Float="r16float",t.RG8Unorm="rg8unorm",t.RG8Snorm="rg8snorm",t.RG8Uint="rg8uint",t.RG8Sint="rg8sint",t.R32Uint="r32uint",t.R32Sint="r32sint",t.R32Float="r32float",t.RG16Uint="rg16uint",t.RG16Sint="rg16sint",t.RG16Float="rg16float",t.RGBA8Unorm="rgba8unorm",t.RGBA8UnormSRGB="rgba8unorm-srgb",t.RGBA8Snorm="rgba8snorm",t.RGBA8Uint="rgba8uint",t.RGBA8Sint="rgba8sint",t.BGRA8Unorm="bgra8unorm",t.BGRA8UnormSRGB="bgra8unorm-srgb",t.RGB10A2Unorm="rgb10a2unorm",t.RG11B10Float="rg11b10float",t.RG32Uint="rg32uint",t.RG32Sint="rg32sint",t.RG32Float="rg32float",t.RGBA16Uint="rgba16uint",t.RGBA16Sint="rgba16sint",t.RGBA16Float="rgba16float",t.RGBA32Uint="rgba32uint",t.RGBA32Sint="rgba32sint",t.RGBA32Float="rgba32float",t.Depth32Float="depth32float",t.Depth24Plus="depth24plus",t.Depth24PlusStencil8="depth24plus-stencil8"}(e.TextureFormat||(e.TextureFormat={})),function(t){t.Float="float",t.Sint="sint",t.Uint="uint"}(e.TextureComponentType||(e.TextureComponentType={})),function(t){t.E1d="1d",t.E2d="2d",t.E2dArray="2d-array",t.Cube="cube",t.CubeArray="cube-array",t.E3d="3d"}(e.TextureViewDimension||(e.TextureViewDimension={})),function(t){t.Uchar2="uchar2",t.Uchar4="uchar4",t.Char2="char2",t.Char4="char4",t.Uchar2Norm="uchar2norm",t.Uchar4Norm="uchar4norm",t.Char2Norm="char2norm",t.Char4Norm="char4norm",t.Ushort2="ushort2",t.Ushort4="ushort4",t.Short2="short2",t.Short4="short4",t.Ushort2Norm="ushort2norm",t.Ushort4Norm="ushort4norm",t.Short2Norm="short2norm",t.Short4Norm="short4norm",t.Half2="half2",t.Half4="half4",t.Float="float",t.Float2="float2",t.Float3="float3",t.Float4="float4",t.Uint="uint",t.Uint2="uint2",t.Uint3="uint3",t.Uint4="uint4",t.Int="int",t.Int2="int2",t.Int3="int3",t.Int4="int4"}(e.VertexFormat||(e.VertexFormat={})),function(t){t.All="all",t.StencilOnly="stencil-only",t.DepthOnly="depth-only"}(e.TextureAspect||(e.TextureAspect={})),function(t){t.Error="error",t.Warning="warning",t.Info="info"}(e.CompilationMessageType||(e.CompilationMessageType={})),function(t){t.Occlusion="occlusion"}(e.QueryType||(e.QueryType={})),function(t){t[t.MapRead=1]="MapRead",t[t.MapWrite=2]="MapWrite",t[t.CopySrc=4]="CopySrc",t[t.CopyDst=8]="CopyDst",t[t.Index=16]="Index",t[t.Vertex=32]="Vertex",t[t.Uniform=64]="Uniform",t[t.Storage=128]="Storage",t[t.Indirect=256]="Indirect",t[t.QueryResolve=512]="QueryResolve"}(e.BufferUsage||(e.BufferUsage={})),function(t){t[t.Red=1]="Red",t[t.Green=2]="Green",t[t.Blue=4]="Blue",t[t.Alpha=8]="Alpha",t[t.All=15]="All"}(e.ColorWrite||(e.ColorWrite={})),function(t){t[t.Vertex=1]="Vertex",t[t.Fragment=2]="Fragment",t[t.Compute=4]="Compute"}(e.ShaderStage||(e.ShaderStage={})),function(t){t[t.CopySrc=1]="CopySrc",t[t.CopyDst=2]="CopyDst",t[t.Sampled=4]="Sampled",t[t.Storage=8]="Storage",t[t.OutputAttachment=16]="OutputAttachment"}(e.TextureUsage||(e.TextureUsage={})),function(t){t[t.Read=1]="Read",t[t.Write=2]="Write"}(e.MapMode||(e.MapMode={}))})(be);function Iy(){if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}var ow={}.toString,sw=function(t,r){return ow.call(t)==="[object "+r+"]"};const uw=function(e){return Array.isArray?Array.isArray(e):sw(e,"Array")};var cw=9007199254740991,fw="[object Arguments]",lw="[object Array]",dw="[object Boolean]",hw="[object Date]",vw="[object Error]",pw="[object Function]",mw="[object Map]",yw="[object Number]",_w="[object Object]",Ew="[object RegExp]",bw="[object Set]",gw="[object String]",Tw="[object WeakMap]",Aw="[object ArrayBuffer]",Sw="[object DataView]",ww="[object Float32Array]",Rw="[object Float64Array]",Cw="[object Int8Array]",xw="[object Int16Array]",Nw="[object Int32Array]",Ow="[object Uint8Array]",Iw="[object Uint8ClampedArray]",Pw="[object Uint16Array]",Lw="[object Uint32Array]",Ot={};Ot[ww]=Ot[Rw]=Ot[Cw]=Ot[xw]=Ot[Nw]=Ot[Ow]=Ot[Iw]=Ot[Pw]=Ot[Lw]=!0;Ot[fw]=Ot[lw]=Ot[Aw]=Ot[dw]=Ot[Sw]=Ot[hw]=Ot[vw]=Ot[pw]=Ot[mw]=Ot[yw]=Ot[_w]=Ot[Ew]=Ot[bw]=Ot[gw]=Ot[Tw]=!1;var Mw=Object.prototype,kw=Mw.toString;function Dw(e){return Gw(e)&&Fw(e.length)&&!!Ot[kw.call(e)]}function Fw(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=cw}function Gw(e){return!!e&&wi(e)==="object"}var Py=Dw,tv,rv,nv,iv,so,av,ov,sv;function uv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function cv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uv(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var fv=(tv=gt(),rv=Ue(re.RenderEngine),nv=Ue(re.ConfigService),tv(iv=(so=(sv=function(){function e(){Le(this,e),Ge(this,"engine",av,this),Ge(this,"configService",ov,this),this.entity=Vr(),this.model=void 0,this.dirty=!0,this.compiledBundle=void 0,this.initPromise=void 0}return ze(e,[{key:"init",value:function(){var r=this.configService.get(),n=r.canvas,i=r.engineOptions;this.initPromise=this.engine.init(cv({canvas:n||Iy(),swapChainFormat:be.TextureFormat.BGRA8Unorm,antialiasing:!1},i))}},{key:"setBundle",value:function(r){this.compiledBundle=JSON.parse(JSON.stringify(r))}},{key:"setDispatch",value:function(r){return this.compiledBundle.context&&(this.compiledBundle.context.dispatch=r),this}},{key:"setMaxIteration",value:function(r){return this.compiledBundle.context&&(this.compiledBundle.context.maxIteration=r),this}},{key:"setBinding",value:function(r,n){var i=this;if(typeof r=="string"){var a=$u(n)||Py(n)||uw(n);if(this.compiledBundle&&this.compiledBundle.context){var o=this.compiledBundle.context.defines.find(function(u){return u.name===r});if(o)return o.value=n,this;var s=this.compiledBundle.context.uniforms.find(function(u){return u.name===r});s&&(a?(s.data=n,s.isReferer=!1,s.storageClass===En.Uniform?this.model&&this.model.updateUniform(r,n):this.model&&this.model.updateBuffer(r,n)):(s.isReferer=!0,s.data=n))}}else Object.keys(r).forEach(function(u){i.setBinding(u,r[u])});return this}},{key:"execute",value:function(){var t=_t(Ne.mark(function n(){var i=this,a,o,s=arguments;return Ne.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(a=s.length>0&&s[0]!==void 0?s[0]:1,!this.dirty){c.next=6;break}return this.compiledBundle.context&&(a>1?this.compiledBundle.context.maxIteration=a:this.compiledBundle.context.maxIteration++),c.next=5,this.compile();case 5:this.dirty=!1;case 6:for(this.engine.beginFrame(),this.engine.clear({}),this.compiledBundle.context&&this.compiledBundle.context.uniforms.filter(function(f){var d=f.isReferer;return d}).forEach(function(f){var d=f.data,v=f.name;i.model.confirmInput(d.model,v)}),o=0;o<a;o++)this.model.run();return this.engine.endFrame(),c.abrupt("return",this);case 12:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getOutput",value:function(){var t=_t(Ne.mark(function n(){return Ne.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.model.readData());case 1:case"end":return a.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"compile",value:function(){var t=_t(Ne.mark(function n(){var i,a,o;return Ne.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.initPromise;case 2:return i=cv({},this.compiledBundle.context),a=this.engine.supportWebGPU?this.engine.useWGSL?ha.WGSL:ha.GLSL450:ha.GLSL100,o=this.compiledBundle.shaders[a],i.defines.filter(function(c){return c.runtime}).forEach(function(c){var f="".concat(aw).concat(c.name);o=o.replace(f,"".concat(c.value))}),i.shader=o,i.uniforms.forEach(function(c){if(!c.data&&c.storageClass===En.StorageBuffer){var f=1;c.type===$n.FloatArray?f=1:c.type===$n.Vector4FloatArray&&(f=4),c.data=new Float32Array(i.output.length*f).fill(0)}}),this.compiledBundle.context=i,u.next=11,this.engine.createComputeModel(this.compiledBundle.context);case 11:this.model=u.sent;case 12:case"end":return u.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()}]),e}(),sv),av=Be(so.prototype,"engine",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov=Be(so.prototype,"configService",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so))||iv),lv,dv,hv,nu,vv,pv,mv,Ly=(lv=gt(),dv=Ue(re.MaterialComponentManager),lv(hv=(nu=(mv=pv=function(){function e(){Le(this,e),this.config=void 0,Ge(this,"material",vv,this),this.entity=void 0,this.component=void 0}return ze(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r,n){this.entity=r,this.component=this.material.create(r),this.component.entity=r,this.component.type=n,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),e}(),pv.BASIC="basic",mv),vv=Be(nu.prototype,"material",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nu))||hv),yv,_v,Ev,bv,gv,Tv,Av,pi,Sv,wv,Rv,Cv,uo,xv,pn=(yv=gt(),_v=Ue(re.MeshComponentManager),Ev=Ue(re.CullableComponentManager),bv=Ue(re.TransformComponentManager),gv=Ue(re.Systems),Tv=zr(re.SceneGraphSystem),yv(Av=(pi=(xv=uo=function(){function e(){Le(this,e),this.attributes={},this.config=void 0,Ge(this,"mesh",Sv,this),Ge(this,"cullable",wv,this),Ge(this,"transform",Rv,this),Ge(this,"sceneGraphSystem",Cv,this),this.meshComponent=void 0,this.transformComponent=void 0,this.entity=void 0}return ze(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getTransformComponent",value:function(){return this.transformComponent}},{key:"getMeshComponent",value:function(){return this.meshComponent}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r){this.entity=r,this.cullable.create(r),this.meshComponent=this.mesh.create(r),this.transformComponent=this.transform.create(r),this.onEntityCreated()}},{key:"setMaterial",value:function(r){return this.meshComponent.material=r,this}},{key:"setGeometry",value:function(r){return this.meshComponent.geometry=r,this}},{key:"setAttributes",value:function(r){var n=this;Object.keys(r).forEach(function(i){r[i]!==void 0&&r[i]!==n.attributes[i]&&(n.onAttributeChanged({name:i,data:r[i]}),n.attributes[i]=r[i])})}},{key:"setVisible",value:function(r){var n=this;return this.meshComponent.visible=r,this.meshComponent.children.forEach(function(i){var a=n.mesh.getComponentByEntity(i);a&&(a.visible=r)}),this}},{key:"isVisible",value:function(){return this.meshComponent.visible}},{key:"attach",value:function(r){return this.sceneGraphSystem.attach(this.entity,r.entity),this}},{key:"detach",value:function(){return this.sceneGraphSystem.detach(this.entity),this}},{key:"detachChildren",value:function(){return this.sceneGraphSystem.detachChildren(this.entity),this}},{key:"onEntityCreated",value:function(){}},{key:"onAttributeChanged",value:function(r){var n=r.name,i=r.data;this.meshComponent&&this.meshComponent.material&&this.meshComponent.material.setUniform(this.convertAttributeName2UniformName(n),i)}},{key:"convertAttributeName2UniformName",value:function(r){return r}}]),e}(),uo.POINT="point",uo.LINE="line",uo.GRID="grid",xv),Sv=Be(pi.prototype,"mesh",[_v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=Be(pi.prototype,"cullable",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rv=Be(pi.prototype,"transform",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cv=Be(pi.prototype,"sceneGraphSystem",[gv,Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pi))||Av),My={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(su,function(){var r=function(l){return l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array||l instanceof Int8Array||l instanceof Int16Array||l instanceof Int32Array||l instanceof Float32Array||l instanceof Float64Array||l instanceof Uint8ClampedArray},n=function(l,p){for(var A=Object.keys(p),B=0;B<A.length;++B)l[A[B]]=p[A[B]];return l},i=`
`;function a(l){return typeof atob<"u"?atob(l):"base64:"+l}function o(l){var p=new Error("(regl) "+l);throw console.error(p),p}function s(l,p){l||o(p)}function u(l){return l?": "+l:""}function c(l,p,A){l in p||o("unknown parameter ("+l+")"+u(A)+". possible values: "+Object.keys(p).join())}function f(l,p){r(l)||o("invalid parameter type"+u(p)+". must be a typed array")}function d(l,p){switch(p){case"number":return typeof l=="number";case"object":return typeof l=="object";case"string":return typeof l=="string";case"boolean":return typeof l=="boolean";case"function":return typeof l=="function";case"undefined":return typeof l>"u";case"symbol":return typeof l=="symbol"}}function v(l,p,A){d(l,p)||o("invalid parameter type"+u(A)+". expected "+p+", got "+typeof l)}function g(l,p){l>=0&&(l|0)===l||o("invalid parameter type, ("+l+")"+u(p)+". must be a nonnegative integer")}function T(l,p,A){p.indexOf(l)<0&&o("invalid value"+u(A)+". must be one of: "+p)}var C=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function x(l){Object.keys(l).forEach(function(p){C.indexOf(p)<0&&o('invalid regl constructor argument "'+p+'". must be one of '+C)})}function $(l,p){for(l=l+"";l.length<p;)l=" "+l;return l}function Q(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function X(l,p){this.number=l,this.line=p,this.errors=[]}function he(l,p,A){this.file=l,this.line=p,this.message=A}function ae(){var l=new Error,p=(l.stack||l).toString(),A=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(p);if(A)return A[1];var B=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(p);return B?B[1]:"unknown"}function Ae(){var l=new Error,p=(l.stack||l).toString(),A=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(p);if(A)return A[1];var B=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(p);return B?B[1]:"unknown"}function Ie(l,p){var A=l.split(`
`),B=1,q=0,G={unknown:new Q,0:new Q};G.unknown.name=G[0].name=p||ae(),G.unknown.lines.push(new X(0,""));for(var V=0;V<A.length;++V){var ne=A[V],se=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ne);if(se)switch(se[1]){case"line":var le=/(\d+)(\s+\d+)?/.exec(se[2]);le&&(B=le[1]|0,le[2]&&(q=le[2]|0,q in G||(G[q]=new Q)));break;case"define":var ue=/SHADER_NAME(_B64)?\s+(.*)$/.exec(se[2]);ue&&(G[q].name=ue[1]?a(ue[2]):ue[2]);break}G[q].lines.push(new X(B++,ne))}return Object.keys(G).forEach(function(ve){var _e=G[ve];_e.lines.forEach(function(ie){_e.index[ie.number]=ie})}),G}function Ve(l){var p=[];return l.split(`
`).forEach(function(A){if(!(A.length<5)){var B=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(A);B?p.push(new he(B[1]|0,B[2]|0,B[3].trim())):A.length>0&&p.push(new he("unknown",0,A))}}),p}function tt(l,p){p.forEach(function(A){var B=l[A.file];if(B){var q=B.index[A.line];if(q){q.errors.push(A),B.hasErrors=!0;return}}l.unknown.hasErrors=!0,l.unknown.lines[0].errors.push(A)})}function $e(l,p,A,B,q){if(!l.getShaderParameter(p,l.COMPILE_STATUS)){var G=l.getShaderInfoLog(p),V=B===l.FRAGMENT_SHADER?"fragment":"vertex";mt(A,"string",V+" shader source must be a string",q);var ne=Ie(A,q),se=Ve(G);tt(ne,se),Object.keys(ne).forEach(function(le){var ue=ne[le];if(!ue.hasErrors)return;var ve=[""],_e=[""];function ie(pe,L){ve.push(pe),_e.push(L||"")}ie("file number "+le+": "+ue.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),ue.lines.forEach(function(pe){if(pe.errors.length>0){ie($(pe.number,4)+"|  ","background-color:yellow; font-weight:bold"),ie(pe.line+i,"color:red; background-color:yellow; font-weight:bold");var L=0;pe.errors.forEach(function(j){var fe=j.message,Te=/^\s*'(.*)'\s*:\s*(.*)$/.exec(fe);if(Te){var J=Te[1];switch(fe=Te[2],J){case"assign":J="=";break}L=Math.max(pe.line.indexOf(J,L),0)}else L=0;ie($("| ",6)),ie($("^^^",L+3)+i,"font-weight:bold"),ie($("| ",6)),ie(fe+i,"font-weight:bold")}),ie($("| ",6)+i)}else ie($(pe.number,4)+"|  "),ie(pe.line+i,"color:red")}),typeof document<"u"&&!window.chrome?(_e[0]=ve.join("%c"),console.log.apply(console,_e)):console.log(ve.join(""))}),s.raise("Error compiling "+V+" shader, "+ne[0].name)}}function Ke(l,p,A,B,q){if(!l.getProgramParameter(p,l.LINK_STATUS)){var G=l.getProgramInfoLog(p),V=Ie(A,q),ne=Ie(B,q),se='Error linking program with vertex shader, "'+ne[0].name+'", and fragment shader "'+V[0].name+'"';typeof document<"u"?console.log("%c"+se+i+"%c"+G,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(se+i+G),s.raise(se)}}function He(l){l._commandRef=ae()}function lt(l,p,A,B){He(l);function q(se){return se?B.id(se):0}l._fragId=q(l.static.frag),l._vertId=q(l.static.vert);function G(se,le){Object.keys(le).forEach(function(ue){se[B.id(ue)]=!0})}var V=l._uniformSet={};G(V,p.static),G(V,p.dynamic);var ne=l._attributeSet={};G(ne,A.static),G(ne,A.dynamic),l._hasCount="count"in l.static||"count"in l.dynamic||"elements"in l.static||"elements"in l.dynamic}function Me(l,p){var A=Ae();o(l+" in command "+(p||ae())+(A==="unknown"?"":" called from "+A))}function wt(l,p,A){l||Me(p,A||ae())}function fr(l,p,A,B){l in p||Me("unknown parameter ("+l+")"+u(A)+". possible values: "+Object.keys(p).join(),B||ae())}function mt(l,p,A,B){d(l,p)||Me("invalid parameter type"+u(A)+". expected "+p+", got "+typeof l,B||ae())}function ct(l){l()}function Lt(l,p,A){l.texture?T(l.texture._texture.internalformat,p,"unsupported texture format for attachment"):T(l.renderbuffer._renderbuffer.format,A,"unsupported renderbuffer format for attachment")}var Ct=33071,Tt=9728,qt=9984,Mr=9985,Mt=9986,Hn=9987,Xn=5120,nn=5121,Bo=5122,xr=5123,Aa=5124,an=5125,Ri=5126,Sa=32819,Ci=32820,wa=33635,Ra=34042,Uo=36193,lr={};lr[Xn]=lr[nn]=1,lr[Bo]=lr[xr]=lr[Uo]=lr[wa]=lr[Sa]=lr[Ci]=2,lr[Aa]=lr[an]=lr[Ri]=lr[Ra]=4;function Wn(l,p){return l===Ci||l===Sa||l===wa?2:l===Ra?4:lr[l]*p}function Yn(l){return!(l&l-1)&&!!l}function $o(l,p,A){var B,q=p.width,G=p.height,V=p.channels;s(q>0&&q<=A.maxTextureSize&&G>0&&G<=A.maxTextureSize,"invalid texture shape"),(l.wrapS!==Ct||l.wrapT!==Ct)&&s(Yn(q)&&Yn(G),"incompatible wrap mode for texture, both width and height must be power of 2"),p.mipmask===1?q!==1&&G!==1&&s(l.minFilter!==qt&&l.minFilter!==Mt&&l.minFilter!==Mr&&l.minFilter!==Hn,"min filter requires mipmap"):(s(Yn(q)&&Yn(G),"texture must be a square power of 2 to support mipmapping"),s(p.mipmask===(q<<1)-1,"missing or incomplete mipmap data")),p.type===Ri&&(A.extensions.indexOf("oes_texture_float_linear")<0&&s(l.minFilter===Tt&&l.magFilter===Tt,"filter not supported, must enable oes_texture_float_linear"),s(!l.genMipmaps,"mipmap generation not supported with float textures"));var ne=p.images;for(B=0;B<16;++B)if(ne[B]){var se=q>>B,le=G>>B;s(p.mipmask&1<<B,"missing mipmap data");var ue=ne[B];if(s(ue.width===se&&ue.height===le,"invalid shape for mip images"),s(ue.format===p.format&&ue.internalformat===p.internalformat&&ue.type===p.type,"incompatible type for mip image"),!ue.compressed)if(ue.data){var ve=Math.ceil(Wn(ue.type,V)*se/ue.unpackAlignment)*ue.unpackAlignment;s(ue.data.byteLength===ve*le,"invalid data for image, buffer size is inconsistent with image format")}else ue.element||ue.copy}else l.genMipmaps||s((p.mipmask&1<<B)===0,"extra mipmap data");p.compressed&&s(!l.genMipmaps,"mipmap generation for compressed images not supported")}function Vo(l,p,A,B){var q=l.width,G=l.height,V=l.channels;s(q>0&&q<=B.maxTextureSize&&G>0&&G<=B.maxTextureSize,"invalid texture shape"),s(q===G,"cube map must be square"),s(p.wrapS===Ct&&p.wrapT===Ct,"wrap mode not supported by cube map");for(var ne=0;ne<A.length;++ne){var se=A[ne];s(se.width===q&&se.height===G,"inconsistent cube map face shape"),p.genMipmaps&&(s(!se.compressed,"can not generate mipmap for compressed textures"),s(se.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var le=se.images,ue=0;ue<16;++ue){var ve=le[ue];if(ve){var _e=q>>ue,ie=G>>ue;s(se.mipmask&1<<ue,"missing mipmap data"),s(ve.width===_e&&ve.height===ie,"invalid shape for mip images"),s(ve.format===l.format&&ve.internalformat===l.internalformat&&ve.type===l.type,"incompatible type for mip image"),ve.compressed||(ve.data?s(ve.data.byteLength===_e*ie*Math.max(Wn(ve.type,V),ve.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ve.element||ve.copy)}}}}var y=n(s,{optional:ct,raise:o,commandRaise:Me,command:wt,parameter:c,commandParameter:fr,constructor:x,type:v,commandType:mt,isTypedArray:f,nni:g,oneOf:T,shaderError:$e,linkError:Ke,callSite:Ae,saveCommandRef:He,saveDrawInfo:lt,framebufferFormat:Lt,guessCommand:ae,texture2D:$o,textureCube:Vo}),z=0,oe=0,ge=5,xe=6;function De(l,p){this.id=z++,this.type=l,this.data=p}function Kt(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function nt(l){if(l.length===0)return[];var p=l.charAt(0),A=l.charAt(l.length-1);if(l.length>1&&p===A&&(p==='"'||p==="'"))return['"'+Kt(l.substr(1,l.length-2))+'"'];var B=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(l);if(B)return nt(l.substr(0,B.index)).concat(nt(B[1])).concat(nt(l.substr(B.index+B[0].length)));var q=l.split(".");if(q.length===1)return['"'+Kt(l)+'"'];for(var G=[],V=0;V<q.length;++V)G=G.concat(nt(q[V]));return G}function ft(l){return"["+nt(l).join("][")+"]"}function qe(l,p){return new De(l,ft(p+""))}function bt(l){return typeof l=="function"&&!l._reglType||l instanceof De}function Et(l,p){if(typeof l=="function")return new De(oe,l);if(typeof l=="number"||typeof l=="boolean")return new De(ge,l);if(Array.isArray(l))return new De(xe,l.map((A,B)=>Et(A,p+"["+B+"]")));if(l instanceof De)return l;y(!1,"invalid option type in uniform "+p)}var Gt={DynamicVariable:De,define:qe,isDynamic:bt,unbox:Et,accessor:ft},qn={next:typeof requestAnimationFrame=="function"?function(l){return requestAnimationFrame(l)}:function(l){return setTimeout(l,16)},cancel:typeof cancelAnimationFrame=="function"?function(l){return cancelAnimationFrame(l)}:clearTimeout},zu=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function n_(){var l={"":0},p=[""];return{id:function(A){var B=l[A];return B||(B=l[A]=p.length,p.push(A),B)},str:function(A){return p[A]}}}function i_(l,p,A){var B=document.createElement("canvas");n(B.style,{border:0,margin:0,padding:0,top:0,left:0}),l.appendChild(B),l===document.body&&(B.style.position="absolute",n(l.style,{margin:0,padding:0}));function q(){var ne=window.innerWidth,se=window.innerHeight;if(l!==document.body){var le=l.getBoundingClientRect();ne=le.right-le.left,se=le.bottom-le.top}B.width=A*ne,B.height=A*se,n(B.style,{width:ne+"px",height:se+"px"})}var G;l!==document.body&&typeof ResizeObserver=="function"?(G=new ResizeObserver(function(){setTimeout(q)}),G.observe(l)):window.addEventListener("resize",q,!1);function V(){G?G.disconnect():window.removeEventListener("resize",q),l.removeChild(B)}return q(),{canvas:B,onDestroy:V}}function a_(l,p){function A(B){try{return l.getContext(B,p)}catch{return null}}return A("webgl")||A("experimental-webgl")||A("webgl-experimental")}function o_(l){return typeof l.nodeName=="string"&&typeof l.appendChild=="function"&&typeof l.getBoundingClientRect=="function"}function s_(l){return typeof l.drawArrays=="function"||typeof l.drawElements=="function"}function Hu(l){return typeof l=="string"?l.split():(y(Array.isArray(l),"invalid extension array"),l)}function Xu(l){return typeof l=="string"?(y(typeof document<"u","not supported outside of DOM"),document.querySelector(l)):l}function u_(l){var p=l||{},A,B,q,G,V={},ne=[],se=[],le=typeof window>"u"?1:window.devicePixelRatio,ue=!1,ve=function(pe){pe&&y.raise(pe)},_e=function(){};if(typeof p=="string"?(y(typeof document<"u","selector queries only supported in DOM enviroments"),A=document.querySelector(p),y(A,"invalid query string for element")):typeof p=="object"?o_(p)?A=p:s_(p)?(G=p,q=G.canvas):(y.constructor(p),"gl"in p?G=p.gl:"canvas"in p?q=Xu(p.canvas):"container"in p&&(B=Xu(p.container)),"attributes"in p&&(V=p.attributes,y.type(V,"object","invalid context attributes")),"extensions"in p&&(ne=Hu(p.extensions)),"optionalExtensions"in p&&(se=Hu(p.optionalExtensions)),"onDone"in p&&(y.type(p.onDone,"function","invalid or missing onDone callback"),ve=p.onDone),"profile"in p&&(ue=!!p.profile),"pixelRatio"in p&&(le=+p.pixelRatio,y(le>0,"invalid pixel ratio"))):y.raise("invalid arguments to regl"),A&&(A.nodeName.toLowerCase()==="canvas"?q=A:B=A),!G){if(!q){y(typeof document<"u","must manually specify webgl context outside of DOM environments");var ie=i_(B||document.body,ve,le);if(!ie)return null;q=ie.canvas,_e=ie.onDestroy}V.premultipliedAlpha===void 0&&(V.premultipliedAlpha=!0),G=a_(q,V)}return G?{gl:G,canvas:q,container:B,extensions:ne,optionalExtensions:se,pixelRatio:le,profile:ue,onDone:ve,onDestroy:_e}:(_e(),ve("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function c_(l,p){var A={};function B(V){y.type(V,"string","extension name must be string");var ne=V.toLowerCase(),se;try{se=A[ne]=l.getExtension(ne)}catch{}return!!se}for(var q=0;q<p.extensions.length;++q){var G=p.extensions[q];if(!B(G))return p.onDestroy(),p.onDone('"'+G+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return p.optionalExtensions.forEach(B),{extensions:A,restore:function(){Object.keys(A).forEach(function(V){if(A[V]&&!B(V))throw new Error("(regl): error restoring extension "+V)})}}}function mr(l,p){for(var A=Array(l),B=0;B<l;++B)A[B]=p(B);return A}var f_=5120,l_=5121,d_=5122,h_=5123,v_=5124,p_=5125,m_=5126;function y_(l){for(var p=16;p<=1<<28;p*=16)if(l<=p)return p;return 0}function Wu(l){var p,A;return p=(l>65535)<<4,l>>>=p,A=(l>255)<<3,l>>>=A,p|=A,A=(l>15)<<2,l>>>=A,p|=A,A=(l>3)<<1,l>>>=A,p|=A,p|l>>1}function Yu(){var l=mr(8,function(){return[]});function p(G){var V=y_(G),ne=l[Wu(V)>>2];return ne.length>0?ne.pop():new ArrayBuffer(V)}function A(G){l[Wu(G.byteLength)>>2].push(G)}function B(G,V){var ne=null;switch(G){case f_:ne=new Int8Array(p(V),0,V);break;case l_:ne=new Uint8Array(p(V),0,V);break;case d_:ne=new Int16Array(p(2*V),0,V);break;case h_:ne=new Uint16Array(p(2*V),0,V);break;case v_:ne=new Int32Array(p(4*V),0,V);break;case p_:ne=new Uint32Array(p(4*V),0,V);break;case m_:ne=new Float32Array(p(4*V),0,V);break;default:return null}return ne.length!==V?ne.subarray(0,V):ne}function q(G){A(G.buffer)}return{alloc:p,free:A,allocType:B,freeType:q}}var Bt=Yu();Bt.zero=Yu();var __=3408,E_=3410,b_=3411,g_=3412,T_=3413,A_=3414,S_=3415,w_=33901,R_=33902,C_=3379,x_=3386,N_=34921,O_=36347,I_=36348,P_=35661,L_=35660,M_=34930,k_=36349,D_=34076,F_=34024,G_=7936,B_=7937,U_=7938,$_=35724,V_=34047,j_=36063,z_=34852,Ca=3553,qu=34067,H_=34069,X_=33984,xi=6408,jo=5126,Ku=5121,zo=36160,W_=36053,Y_=36064,q_=16384,K_=function(l,p){var A=1;p.ext_texture_filter_anisotropic&&(A=l.getParameter(V_));var B=1,q=1;p.webgl_draw_buffers&&(B=l.getParameter(z_),q=l.getParameter(j_));var G=!!p.oes_texture_float;if(G){var V=l.createTexture();l.bindTexture(Ca,V),l.texImage2D(Ca,0,xi,1,1,0,xi,jo,null);var ne=l.createFramebuffer();if(l.bindFramebuffer(zo,ne),l.framebufferTexture2D(zo,Y_,Ca,V,0),l.bindTexture(Ca,null),l.checkFramebufferStatus(zo)!==W_)G=!1;else{l.viewport(0,0,1,1),l.clearColor(1,0,0,1),l.clear(q_);var se=Bt.allocType(jo,4);l.readPixels(0,0,1,1,xi,jo,se),l.getError()?G=!1:(l.deleteFramebuffer(ne),l.deleteTexture(V),G=se[0]===1),Bt.freeType(se)}}var le=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),ue=!0;if(!le){var ve=l.createTexture(),_e=Bt.allocType(Ku,36);l.activeTexture(X_),l.bindTexture(qu,ve),l.texImage2D(H_,0,xi,3,3,0,xi,Ku,_e),Bt.freeType(_e),l.bindTexture(qu,null),l.deleteTexture(ve),ue=!l.getError()}return{colorBits:[l.getParameter(E_),l.getParameter(b_),l.getParameter(g_),l.getParameter(T_)],depthBits:l.getParameter(A_),stencilBits:l.getParameter(S_),subpixelBits:l.getParameter(__),extensions:Object.keys(p).filter(function(ie){return!!p[ie]}),maxAnisotropic:A,maxDrawbuffers:B,maxColorAttachments:q,pointSizeDims:l.getParameter(w_),lineWidthDims:l.getParameter(R_),maxViewportDims:l.getParameter(x_),maxCombinedTextureUnits:l.getParameter(P_),maxCubeMapSize:l.getParameter(D_),maxRenderbufferSize:l.getParameter(F_),maxTextureUnits:l.getParameter(M_),maxTextureSize:l.getParameter(C_),maxAttributes:l.getParameter(N_),maxVertexUniforms:l.getParameter(O_),maxVertexTextureUnits:l.getParameter(L_),maxVaryingVectors:l.getParameter(I_),maxFragmentUniforms:l.getParameter(k_),glsl:l.getParameter($_),renderer:l.getParameter(B_),vendor:l.getParameter(G_),version:l.getParameter(U_),readFloat:G,npotTextureCube:ue}};function Nr(l){return!!l&&typeof l=="object"&&Array.isArray(l.shape)&&Array.isArray(l.stride)&&typeof l.offset=="number"&&l.shape.length===l.stride.length&&(Array.isArray(l.data)||r(l.data))}var br=function(l){return Object.keys(l).map(function(p){return l[p]})},xa={shape:e0,flatten:J_};function Q_(l,p,A){for(var B=0;B<p;++B)A[B]=l[B]}function Z_(l,p,A,B){for(var q=0,G=0;G<p;++G)for(var V=l[G],ne=0;ne<A;++ne)B[q++]=V[ne]}function Qu(l,p,A,B,q,G){for(var V=G,ne=0;ne<p;++ne)for(var se=l[ne],le=0;le<A;++le)for(var ue=se[le],ve=0;ve<B;++ve)q[V++]=ue[ve]}function Zu(l,p,A,B,q){for(var G=1,V=A+1;V<p.length;++V)G*=p[V];var ne=p[A];if(p.length-A===4){var se=p[A+1],le=p[A+2],ue=p[A+3];for(V=0;V<ne;++V)Qu(l[V],se,le,ue,B,q),q+=G}else for(V=0;V<ne;++V)Zu(l[V],p,A+1,B,q),q+=G}function J_(l,p,A,B){var q=1;if(p.length)for(var G=0;G<p.length;++G)q*=p[G];else q=0;var V=B||Bt.allocType(A,q);switch(p.length){case 0:break;case 1:Q_(l,p[0],V);break;case 2:Z_(l,p[0],p[1],V);break;case 3:Qu(l,p[0],p[1],p[2],V,0);break;default:Zu(l,p,0,V,0)}return V}function e0(l){for(var p=[],A=l;A.length;A=A[0])p.push(A.length);return p}var Ho={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},t0=5120,r0=5122,n0=5124,i0=5121,a0=5123,o0=5125,s0=5126,u0=5126,gn={int8:t0,int16:r0,int32:n0,uint8:i0,uint16:a0,uint32:o0,float:s0,float32:u0},c0=35048,f0=35040,Na={dynamic:c0,stream:f0,static:35044},Xo=xa.flatten,Ju=xa.shape,ec=35044,l0=35040,Wo=5121,Yo=5126,on=[];on[5120]=1,on[5122]=2,on[5124]=4,on[5121]=1,on[5123]=2,on[5125]=4,on[5126]=4;function Oa(l){return Ho[Object.prototype.toString.call(l)]|0}function tc(l,p){for(var A=0;A<p.length;++A)l[A]=p[A]}function rc(l,p,A,B,q,G,V){for(var ne=0,se=0;se<A;++se)for(var le=0;le<B;++le)l[ne++]=p[q*se+G*le+V]}function d0(l,p,A,B){var q=0,G={};function V(L){this.id=q++,this.buffer=l.createBuffer(),this.type=L,this.usage=ec,this.byteLength=0,this.dimension=1,this.dtype=Wo,this.persistentData=null,A.profile&&(this.stats={size:0})}V.prototype.bind=function(){l.bindBuffer(this.type,this.buffer)},V.prototype.destroy=function(){_e(this)};var ne=[];function se(L,j){var fe=ne.pop();return fe||(fe=new V(L)),fe.bind(),ve(fe,j,l0,0,1,!1),fe}function le(L){ne.push(L)}function ue(L,j,fe){L.byteLength=j.byteLength,l.bufferData(L.type,j,fe)}function ve(L,j,fe,Te,J,Se){var te;if(L.usage=fe,Array.isArray(j)){if(L.dtype=Te||Yo,j.length>0){var me;if(Array.isArray(j[0])){te=Ju(j);for(var ee=1,ye=1;ye<te.length;++ye)ee*=te[ye];L.dimension=ee,me=Xo(j,te,L.dtype),ue(L,me,fe),Se?L.persistentData=me:Bt.freeType(me)}else if(typeof j[0]=="number"){L.dimension=J;var Pe=Bt.allocType(L.dtype,j.length);tc(Pe,j),ue(L,Pe,fe),Se?L.persistentData=Pe:Bt.freeType(Pe)}else r(j[0])?(L.dimension=j[0].length,L.dtype=Te||Oa(j[0])||Yo,me=Xo(j,[j.length,j[0].length],L.dtype),ue(L,me,fe),Se?L.persistentData=me:Bt.freeType(me)):y.raise("invalid buffer data")}}else if(r(j))L.dtype=Te||Oa(j),L.dimension=J,ue(L,j,fe),Se&&(L.persistentData=new Uint8Array(new Uint8Array(j.buffer)));else if(Nr(j)){te=j.shape;var Xe=j.stride,Ee=j.offset,de=0,Z=0,je=0,Qe=0;te.length===1?(de=te[0],Z=1,je=Xe[0],Qe=0):te.length===2?(de=te[0],Z=te[1],je=Xe[0],Qe=Xe[1]):y.raise("invalid shape"),L.dtype=Te||Oa(j.data)||Yo,L.dimension=Z;var Re=Bt.allocType(L.dtype,de*Z);rc(Re,j.data,de,Z,je,Qe,Ee),ue(L,Re,fe),Se?L.persistentData=Re:Bt.freeType(Re)}else j instanceof ArrayBuffer?(L.dtype=Wo,L.dimension=J,ue(L,j,fe),Se&&(L.persistentData=new Uint8Array(new Uint8Array(j)))):y.raise("invalid buffer data")}function _e(L){p.bufferCount--,B(L);var j=L.buffer;y(j,"buffer must not be deleted already"),l.deleteBuffer(j),L.buffer=null,delete G[L.id]}function ie(L,j,fe,Te){p.bufferCount++;var J=new V(j);G[J.id]=J;function Se(ee){var ye=ec,Pe=null,Xe=0,Ee=0,de=1;return Array.isArray(ee)||r(ee)||Nr(ee)||ee instanceof ArrayBuffer?Pe=ee:typeof ee=="number"?Xe=ee|0:ee&&(y.type(ee,"object","buffer arguments must be an object, a number or an array"),"data"in ee&&(y(Pe===null||Array.isArray(Pe)||r(Pe)||Nr(Pe),"invalid data for buffer"),Pe=ee.data),"usage"in ee&&(y.parameter(ee.usage,Na,"invalid buffer usage"),ye=Na[ee.usage]),"type"in ee&&(y.parameter(ee.type,gn,"invalid buffer type"),Ee=gn[ee.type]),"dimension"in ee&&(y.type(ee.dimension,"number","invalid dimension"),de=ee.dimension|0),"length"in ee&&(y.nni(Xe,"buffer length must be a nonnegative integer"),Xe=ee.length|0)),J.bind(),Pe?ve(J,Pe,ye,Ee,de,Te):(Xe&&l.bufferData(J.type,Xe,ye),J.dtype=Ee||Wo,J.usage=ye,J.dimension=de,J.byteLength=Xe),A.profile&&(J.stats.size=J.byteLength*on[J.dtype]),Se}function te(ee,ye){y(ye+ee.byteLength<=J.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+ee.byteLength+" starting from offset "+ye+" to a buffer of size "+J.byteLength),l.bufferSubData(J.type,ye,ee)}function me(ee,ye){var Pe=(ye||0)|0,Xe;if(J.bind(),r(ee)||ee instanceof ArrayBuffer)te(ee,Pe);else if(Array.isArray(ee)){if(ee.length>0)if(typeof ee[0]=="number"){var Ee=Bt.allocType(J.dtype,ee.length);tc(Ee,ee),te(Ee,Pe),Bt.freeType(Ee)}else if(Array.isArray(ee[0])||r(ee[0])){Xe=Ju(ee);var de=Xo(ee,Xe,J.dtype);te(de,Pe),Bt.freeType(de)}else y.raise("invalid buffer data")}else if(Nr(ee)){Xe=ee.shape;var Z=ee.stride,je=0,Qe=0,Re=0,it=0;Xe.length===1?(je=Xe[0],Qe=1,Re=Z[0],it=0):Xe.length===2?(je=Xe[0],Qe=Xe[1],Re=Z[0],it=Z[1]):y.raise("invalid shape");var We=Array.isArray(ee.data)?J.dtype:Oa(ee.data),rt=Bt.allocType(We,je*Qe);rc(rt,ee.data,je,Qe,Re,it,ee.offset),te(rt,Pe),Bt.freeType(rt)}else y.raise("invalid data for buffer subdata");return Se}return fe||Se(L),Se._reglType="buffer",Se._buffer=J,Se.subdata=me,A.profile&&(Se.stats=J.stats),Se.destroy=function(){_e(J)},Se}function pe(){br(G).forEach(function(L){L.buffer=l.createBuffer(),l.bindBuffer(L.type,L.buffer),l.bufferData(L.type,L.persistentData||L.byteLength,L.usage)})}return A.profile&&(p.getTotalBufferSize=function(){var L=0;return Object.keys(G).forEach(function(j){L+=G[j].stats.size}),L}),{create:ie,createStream:se,destroyStream:le,clear:function(){br(G).forEach(_e),ne.forEach(_e)},getBuffer:function(L){return L&&L._buffer instanceof V?L._buffer:null},restore:pe,_initBuffer:ve}}var h0=0,v0=0,p0=1,m0=1,y0=4,_0=4,Kn={points:h0,point:v0,lines:p0,line:m0,triangles:y0,triangle:_0,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},E0=0,b0=1,Ni=4,g0=5120,Qn=5121,nc=5122,Zn=5123,ic=5124,Tn=5125,qo=34963,T0=35040,A0=35044;function S0(l,p,A,B){var q={},G=0,V={uint8:Qn,uint16:Zn};p.oes_element_index_uint&&(V.uint32=Tn);function ne(pe){this.id=G++,q[this.id]=this,this.buffer=pe,this.primType=Ni,this.vertCount=0,this.type=0}ne.prototype.bind=function(){this.buffer.bind()};var se=[];function le(pe){var L=se.pop();return L||(L=new ne(A.create(null,qo,!0,!1)._buffer)),ve(L,pe,T0,-1,-1,0,0),L}function ue(pe){se.push(pe)}function ve(pe,L,j,fe,Te,J,Se){pe.buffer.bind();var te;if(L){var me=Se;!Se&&(!r(L)||Nr(L)&&!r(L.data))&&(me=p.oes_element_index_uint?Tn:Zn),A._initBuffer(pe.buffer,L,j,me,3)}else l.bufferData(qo,J,j),pe.buffer.dtype=te||Qn,pe.buffer.usage=j,pe.buffer.dimension=3,pe.buffer.byteLength=J;if(te=Se,!Se){switch(pe.buffer.dtype){case Qn:case g0:te=Qn;break;case Zn:case nc:te=Zn;break;case Tn:case ic:te=Tn;break;default:y.raise("unsupported type for element array")}pe.buffer.dtype=te}pe.type=te,y(te!==Tn||!!p.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var ee=Te;ee<0&&(ee=pe.buffer.byteLength,te===Zn?ee>>=1:te===Tn&&(ee>>=2)),pe.vertCount=ee;var ye=fe;if(fe<0){ye=Ni;var Pe=pe.buffer.dimension;Pe===1&&(ye=E0),Pe===2&&(ye=b0),Pe===3&&(ye=Ni)}pe.primType=ye}function _e(pe){B.elementsCount--,y(pe.buffer!==null,"must not double destroy elements"),delete q[pe.id],pe.buffer.destroy(),pe.buffer=null}function ie(pe,L){var j=A.create(null,qo,!0),fe=new ne(j._buffer);B.elementsCount++;function Te(J){if(!J)j(),fe.primType=Ni,fe.vertCount=0,fe.type=Qn;else if(typeof J=="number")j(J),fe.primType=Ni,fe.vertCount=J|0,fe.type=Qn;else{var Se=null,te=A0,me=-1,ee=-1,ye=0,Pe=0;Array.isArray(J)||r(J)||Nr(J)?Se=J:(y.type(J,"object","invalid arguments for elements"),"data"in J&&(Se=J.data,y(Array.isArray(Se)||r(Se)||Nr(Se),"invalid data for element buffer")),"usage"in J&&(y.parameter(J.usage,Na,"invalid element buffer usage"),te=Na[J.usage]),"primitive"in J&&(y.parameter(J.primitive,Kn,"invalid element buffer primitive"),me=Kn[J.primitive]),"count"in J&&(y(typeof J.count=="number"&&J.count>=0,"invalid vertex count for elements"),ee=J.count|0),"type"in J&&(y.parameter(J.type,V,"invalid buffer type"),Pe=V[J.type]),"length"in J?ye=J.length|0:(ye=ee,Pe===Zn||Pe===nc?ye*=2:(Pe===Tn||Pe===ic)&&(ye*=4))),ve(fe,Se,te,me,ee,ye,Pe)}return Te}return Te(pe),Te._reglType="elements",Te._elements=fe,Te.subdata=function(J,Se){return j.subdata(J,Se),Te},Te.destroy=function(){_e(fe)},Te}return{create:ie,createStream:le,destroyStream:ue,getElements:function(pe){return typeof pe=="function"&&pe._elements instanceof ne?pe._elements:null},clear:function(){br(q).forEach(_e)}}}var ac=new Float32Array(1),w0=new Uint32Array(ac.buffer),R0=5123;function oc(l){for(var p=Bt.allocType(R0,l.length),A=0;A<l.length;++A)if(isNaN(l[A]))p[A]=65535;else if(l[A]===1/0)p[A]=31744;else if(l[A]===-1/0)p[A]=64512;else{ac[0]=l[A];var B=w0[0],q=B>>>31<<15,G=(B<<1>>>24)-127,V=B>>13&(1<<10)-1;if(G<-24)p[A]=q;else if(G<-14){var ne=-14-G;p[A]=q+(V+(1<<10)>>ne)}else G>15?p[A]=q+31744:p[A]=q+(G+15<<10)+V}return p}function kt(l){return Array.isArray(l)||r(l)}var sc=function(l){return!(l&l-1)&&!!l},C0=34467,kr=3553,Ko=34067,Ia=34069,An=6408,Qo=6406,Pa=6407,Oi=6409,La=6410,uc=32854,Zo=32855,cc=36194,x0=32819,N0=32820,O0=33635,I0=34042,Jo=6402,Ma=34041,es=35904,ts=35906,Jn=36193,rs=33776,ns=33777,is=33778,as=33779,fc=35986,lc=35987,dc=34798,hc=35840,vc=35841,pc=35842,mc=35843,yc=36196,ei=5121,os=5123,ss=5125,Ii=5126,P0=10242,L0=10243,M0=10497,us=33071,k0=33648,D0=10240,F0=10241,cs=9728,G0=9729,fs=9984,_c=9985,Ec=9986,ls=9987,B0=33170,ka=4352,U0=4353,$0=4354,V0=34046,j0=3317,z0=37440,H0=37441,X0=37443,bc=37444,Pi=33984,W0=[fs,Ec,_c,ls],Da=[0,Oi,La,Pa,An],gr={};gr[Oi]=gr[Qo]=gr[Jo]=1,gr[Ma]=gr[La]=2,gr[Pa]=gr[es]=3,gr[An]=gr[ts]=4;function ti(l){return"[object "+l+"]"}var gc=ti("HTMLCanvasElement"),Tc=ti("OffscreenCanvas"),Ac=ti("CanvasRenderingContext2D"),Sc=ti("ImageBitmap"),wc=ti("HTMLImageElement"),Rc=ti("HTMLVideoElement"),Y0=Object.keys(Ho).concat([gc,Tc,Ac,Sc,wc,Rc]),ri=[];ri[ei]=1,ri[Ii]=4,ri[Jn]=2,ri[os]=2,ri[ss]=4;var er=[];er[uc]=2,er[Zo]=2,er[cc]=2,er[Ma]=4,er[rs]=.5,er[ns]=.5,er[is]=1,er[as]=1,er[fc]=.5,er[lc]=1,er[dc]=1,er[hc]=.5,er[vc]=.25,er[pc]=.5,er[mc]=.25,er[yc]=.5;function Cc(l){return Array.isArray(l)&&(l.length===0||typeof l[0]=="number")}function xc(l){if(!Array.isArray(l))return!1;var p=l.length;return!(p===0||!kt(l[0]))}function Sn(l){return Object.prototype.toString.call(l)}function Nc(l){return Sn(l)===gc}function Oc(l){return Sn(l)===Tc}function q0(l){return Sn(l)===Ac}function K0(l){return Sn(l)===Sc}function Q0(l){return Sn(l)===wc}function Z0(l){return Sn(l)===Rc}function ds(l){if(!l)return!1;var p=Sn(l);return Y0.indexOf(p)>=0?!0:Cc(l)||xc(l)||Nr(l)}function Ic(l){return Ho[Object.prototype.toString.call(l)]|0}function J0(l,p){var A=p.length;switch(l.type){case ei:case os:case ss:case Ii:var B=Bt.allocType(l.type,A);B.set(p),l.data=B;break;case Jn:l.data=oc(p);break;default:y.raise("unsupported texture type, must specify a typed array")}}function Pc(l,p){return Bt.allocType(l.type===Jn?Ii:l.type,p)}function Lc(l,p){l.type===Jn?(l.data=oc(p),Bt.freeType(p)):l.data=p}function eE(l,p,A,B,q,G){for(var V=l.width,ne=l.height,se=l.channels,le=V*ne*se,ue=Pc(l,le),ve=0,_e=0;_e<ne;++_e)for(var ie=0;ie<V;++ie)for(var pe=0;pe<se;++pe)ue[ve++]=p[A*ie+B*_e+q*pe+G];Lc(l,ue)}function Fa(l,p,A,B,q,G){var V;if(typeof er[l]<"u"?V=er[l]:V=gr[l]*ri[p],G&&(V*=6),q){for(var ne=0,se=A;se>=1;)ne+=V*se*se,se/=2;return ne}else return V*A*B}function tE(l,p,A,B,q,G,V){var ne={"don't care":ka,"dont care":ka,nice:$0,fast:U0},se={repeat:M0,clamp:us,mirror:k0},le={nearest:cs,linear:G0},ue=n({mipmap:ls,"nearest mipmap nearest":fs,"linear mipmap nearest":_c,"nearest mipmap linear":Ec,"linear mipmap linear":ls},le),ve={none:0,browser:bc},_e={uint8:ei,rgba4:x0,rgb565:O0,"rgb5 a1":N0},ie={alpha:Qo,luminance:Oi,"luminance alpha":La,rgb:Pa,rgba:An,rgba4:uc,"rgb5 a1":Zo,rgb565:cc},pe={};p.ext_srgb&&(ie.srgb=es,ie.srgba=ts),p.oes_texture_float&&(_e.float32=_e.float=Ii),p.oes_texture_half_float&&(_e.float16=_e["half float"]=Jn),p.webgl_depth_texture&&(n(ie,{depth:Jo,"depth stencil":Ma}),n(_e,{uint16:os,uint32:ss,"depth stencil":I0})),p.webgl_compressed_texture_s3tc&&n(pe,{"rgb s3tc dxt1":rs,"rgba s3tc dxt1":ns,"rgba s3tc dxt3":is,"rgba s3tc dxt5":as}),p.webgl_compressed_texture_atc&&n(pe,{"rgb atc":fc,"rgba atc explicit alpha":lc,"rgba atc interpolated alpha":dc}),p.webgl_compressed_texture_pvrtc&&n(pe,{"rgb pvrtc 4bppv1":hc,"rgb pvrtc 2bppv1":vc,"rgba pvrtc 4bppv1":pc,"rgba pvrtc 2bppv1":mc}),p.webgl_compressed_texture_etc1&&(pe["rgb etc1"]=yc);var L=Array.prototype.slice.call(l.getParameter(C0));Object.keys(pe).forEach(function(b){var U=pe[b];L.indexOf(U)>=0&&(ie[b]=U)});var j=Object.keys(ie);A.textureFormats=j;var fe=[];Object.keys(ie).forEach(function(b){var U=ie[b];fe[U]=b});var Te=[];Object.keys(_e).forEach(function(b){var U=_e[b];Te[U]=b});var J=[];Object.keys(le).forEach(function(b){var U=le[b];J[U]=b});var Se=[];Object.keys(ue).forEach(function(b){var U=ue[b];Se[U]=b});var te=[];Object.keys(se).forEach(function(b){var U=se[b];te[U]=b});var me=j.reduce(function(b,U){var F=ie[U];return F===Oi||F===Qo||F===Oi||F===La||F===Jo||F===Ma||p.ext_srgb&&(F===es||F===ts)?b[F]=F:F===Zo||U.indexOf("rgba")>=0?b[F]=An:b[F]=Pa,b},{});function ee(){this.internalformat=An,this.format=An,this.type=ei,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=bc,this.width=0,this.height=0,this.channels=0}function ye(b,U){b.internalformat=U.internalformat,b.format=U.format,b.type=U.type,b.compressed=U.compressed,b.premultiplyAlpha=U.premultiplyAlpha,b.flipY=U.flipY,b.unpackAlignment=U.unpackAlignment,b.colorSpace=U.colorSpace,b.width=U.width,b.height=U.height,b.channels=U.channels}function Pe(b,U){if(!(typeof U!="object"||!U)){if("premultiplyAlpha"in U&&(y.type(U.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),b.premultiplyAlpha=U.premultiplyAlpha),"flipY"in U&&(y.type(U.flipY,"boolean","invalid texture flip"),b.flipY=U.flipY),"alignment"in U&&(y.oneOf(U.alignment,[1,2,4,8],"invalid texture unpack alignment"),b.unpackAlignment=U.alignment),"colorSpace"in U&&(y.parameter(U.colorSpace,ve,"invalid colorSpace"),b.colorSpace=ve[U.colorSpace]),"type"in U){var F=U.type;y(p.oes_texture_float||!(F==="float"||F==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),y(p.oes_texture_half_float||!(F==="half float"||F==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),y(p.webgl_depth_texture||!(F==="uint16"||F==="uint32"||F==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(F,_e,"invalid texture type"),b.type=_e[F]}var we=b.width,at=b.height,_=b.channels,h=!1;"shape"in U?(y(Array.isArray(U.shape)&&U.shape.length>=2,"shape must be an array"),we=U.shape[0],at=U.shape[1],U.shape.length===3&&(_=U.shape[2],y(_>0&&_<=4,"invalid number of channels"),h=!0),y(we>=0&&we<=A.maxTextureSize,"invalid width"),y(at>=0&&at<=A.maxTextureSize,"invalid height")):("radius"in U&&(we=at=U.radius,y(we>=0&&we<=A.maxTextureSize,"invalid radius")),"width"in U&&(we=U.width,y(we>=0&&we<=A.maxTextureSize,"invalid width")),"height"in U&&(at=U.height,y(at>=0&&at<=A.maxTextureSize,"invalid height")),"channels"in U&&(_=U.channels,y(_>0&&_<=4,"invalid number of channels"),h=!0)),b.width=we|0,b.height=at|0,b.channels=_|0;var w=!1;if("format"in U){var P=U.format;y(p.webgl_depth_texture||!(P==="depth"||P==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(P,ie,"invalid texture format");var k=b.internalformat=ie[P];b.format=me[k],P in _e&&("type"in U||(b.type=_e[P])),P in pe&&(b.compressed=!0),w=!0}!h&&w?b.channels=gr[b.format]:h&&!w?b.channels!==Da[b.format]&&(b.format=b.internalformat=Da[b.channels]):w&&h&&y(b.channels===gr[b.format],"number of channels inconsistent with specified format")}}function Xe(b){l.pixelStorei(z0,b.flipY),l.pixelStorei(H0,b.premultiplyAlpha),l.pixelStorei(X0,b.colorSpace),l.pixelStorei(j0,b.unpackAlignment)}function Ee(){ee.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function de(b,U){var F=null;if(ds(U)?F=U:U&&(y.type(U,"object","invalid pixel data type"),Pe(b,U),"x"in U&&(b.xOffset=U.x|0),"y"in U&&(b.yOffset=U.y|0),ds(U.data)&&(F=U.data)),y(!b.compressed||F instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),U.copy){y(!F,"can not specify copy and data field for the same texture");var we=q.viewportWidth,at=q.viewportHeight;b.width=b.width||we-b.xOffset,b.height=b.height||at-b.yOffset,b.needsCopy=!0,y(b.xOffset>=0&&b.xOffset<we&&b.yOffset>=0&&b.yOffset<at&&b.width>0&&b.width<=we&&b.height>0&&b.height<=at,"copy texture read out of bounds")}else if(!F)b.width=b.width||1,b.height=b.height||1,b.channels=b.channels||4;else if(r(F))b.channels=b.channels||4,b.data=F,!("type"in U)&&b.type===ei&&(b.type=Ic(F));else if(Cc(F))b.channels=b.channels||4,J0(b,F),b.alignment=1,b.needsFree=!0;else if(Nr(F)){var _=F.data;!Array.isArray(_)&&b.type===ei&&(b.type=Ic(_));var h=F.shape,w=F.stride,P,k,N,R,O,E;h.length===3?(N=h[2],E=w[2]):(y(h.length===2,"invalid ndarray pixel data, must be 2 or 3D"),N=1,E=1),P=h[0],k=h[1],R=w[0],O=w[1],b.alignment=1,b.width=P,b.height=k,b.channels=N,b.format=b.internalformat=Da[N],b.needsFree=!0,eE(b,_,R,O,E,F.offset)}else if(Nc(F)||Oc(F)||q0(F))Nc(F)||Oc(F)?b.element=F:b.element=F.canvas,b.width=b.element.width,b.height=b.element.height,b.channels=4;else if(K0(F))b.element=F,b.width=F.width,b.height=F.height,b.channels=4;else if(Q0(F))b.element=F,b.width=F.naturalWidth,b.height=F.naturalHeight,b.channels=4;else if(Z0(F))b.element=F,b.width=F.videoWidth,b.height=F.videoHeight,b.channels=4;else if(xc(F)){var S=b.width||F[0].length,m=b.height||F.length,I=b.channels;kt(F[0][0])?I=I||F[0][0].length:I=I||1;for(var D=xa.shape(F),W=1,K=0;K<D.length;++K)W*=D[K];var H=Pc(b,W);xa.flatten(F,D,"",H),Lc(b,H),b.alignment=1,b.width=S,b.height=m,b.channels=I,b.format=b.internalformat=Da[I],b.needsFree=!0}b.type===Ii?y(A.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):b.type===Jn&&y(A.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Z(b,U,F){var we=b.element,at=b.data,_=b.internalformat,h=b.format,w=b.type,P=b.width,k=b.height;Xe(b),we?l.texImage2D(U,F,h,h,w,we):b.compressed?l.compressedTexImage2D(U,F,_,P,k,0,at):b.needsCopy?(B(),l.copyTexImage2D(U,F,h,b.xOffset,b.yOffset,P,k,0)):l.texImage2D(U,F,h,P,k,0,h,w,at||null)}function je(b,U,F,we,at){var _=b.element,h=b.data,w=b.internalformat,P=b.format,k=b.type,N=b.width,R=b.height;Xe(b),_?l.texSubImage2D(U,at,F,we,P,k,_):b.compressed?l.compressedTexSubImage2D(U,at,F,we,w,N,R,h):b.needsCopy?(B(),l.copyTexSubImage2D(U,at,F,we,b.xOffset,b.yOffset,N,R)):l.texSubImage2D(U,at,F,we,N,R,P,k,h)}var Qe=[];function Re(){return Qe.pop()||new Ee}function it(b){b.needsFree&&Bt.freeType(b.data),Ee.call(b),Qe.push(b)}function We(){ee.call(this),this.genMipmaps=!1,this.mipmapHint=ka,this.mipmask=0,this.images=Array(16)}function rt(b,U,F){var we=b.images[0]=Re();b.mipmask=1,we.width=b.width=U,we.height=b.height=F,we.channels=b.channels=4}function ht(b,U){var F=null;if(ds(U))F=b.images[0]=Re(),ye(F,b),de(F,U),b.mipmask=1;else if(Pe(b,U),Array.isArray(U.mipmap))for(var we=U.mipmap,at=0;at<we.length;++at)F=b.images[at]=Re(),ye(F,b),F.width>>=at,F.height>>=at,de(F,we[at]),b.mipmask|=1<<at;else F=b.images[0]=Re(),ye(F,b),de(F,U),b.mipmask=1;ye(b,b.images[0]),b.compressed&&(b.internalformat===rs||b.internalformat===ns||b.internalformat===is||b.internalformat===as)&&y(b.width%4===0&&b.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function $t(b,U){for(var F=b.images,we=0;we<F.length;++we){if(!F[we])return;Z(F[we],U,we)}}var Qt=[];function ut(){var b=Qt.pop()||new We;ee.call(b),b.mipmask=0;for(var U=0;U<16;++U)b.images[U]=null;return b}function zt(b){for(var U=b.images,F=0;F<U.length;++F)U[F]&&it(U[F]),U[F]=null;Qt.push(b)}function xt(){this.minFilter=cs,this.magFilter=cs,this.wrapS=us,this.wrapT=us,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ka}function Vt(b,U){if("min"in U){var F=U.min;y.parameter(F,ue),b.minFilter=ue[F],W0.indexOf(b.minFilter)>=0&&!("faces"in U)&&(b.genMipmaps=!0)}if("mag"in U){var we=U.mag;y.parameter(we,le),b.magFilter=le[we]}var at=b.wrapS,_=b.wrapT;if("wrap"in U){var h=U.wrap;typeof h=="string"?(y.parameter(h,se),at=_=se[h]):Array.isArray(h)&&(y.parameter(h[0],se),y.parameter(h[1],se),at=se[h[0]],_=se[h[1]])}else{if("wrapS"in U){var w=U.wrapS;y.parameter(w,se),at=se[w]}if("wrapT"in U){var P=U.wrapT;y.parameter(P,se),_=se[P]}}if(b.wrapS=at,b.wrapT=_,"anisotropic"in U){var k=U.anisotropic;y(typeof k=="number"&&k>=1&&k<=A.maxAnisotropic,"aniso samples must be between 1 and "),b.anisotropic=U.anisotropic}if("mipmap"in U){var N=!1;switch(typeof U.mipmap){case"string":y.parameter(U.mipmap,ne,"invalid mipmap hint"),b.mipmapHint=ne[U.mipmap],b.genMipmaps=!0,N=!0;break;case"boolean":N=b.genMipmaps=U.mipmap;break;case"object":y(Array.isArray(U.mipmap),"invalid mipmap type"),b.genMipmaps=!1,N=!0;break;default:y.raise("invalid mipmap type")}N&&!("min"in U)&&(b.minFilter=fs)}}function Ht(b,U){l.texParameteri(U,F0,b.minFilter),l.texParameteri(U,D0,b.magFilter),l.texParameteri(U,P0,b.wrapS),l.texParameteri(U,L0,b.wrapT),p.ext_texture_filter_anisotropic&&l.texParameteri(U,V0,b.anisotropic),b.genMipmaps&&(l.hint(B0,b.mipmapHint),l.generateMipmap(U))}var Xt=0,Zt={},tr=A.maxTextureUnits,Dt=Array(tr).map(function(){return null});function Ze(b){ee.call(this),this.mipmask=0,this.internalformat=An,this.id=Xt++,this.refCount=1,this.target=b,this.texture=l.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new xt,V.profile&&(this.stats={size:0})}function rr(b){l.activeTexture(Pi),l.bindTexture(b.target,b.texture)}function yt(){var b=Dt[0];b?l.bindTexture(b.target,b.texture):l.bindTexture(kr,null)}function ke(b){var U=b.texture;y(U,"must not double destroy texture");var F=b.unit,we=b.target;F>=0&&(l.activeTexture(Pi+F),l.bindTexture(we,null),Dt[F]=null),l.deleteTexture(U),b.texture=null,b.params=null,b.pixels=null,b.refCount=0,delete Zt[b.id],G.textureCount--}n(Ze.prototype,{bind:function(){var b=this;b.bindCount+=1;var U=b.unit;if(U<0){for(var F=0;F<tr;++F){var we=Dt[F];if(we){if(we.bindCount>0)continue;we.unit=-1}Dt[F]=b,U=F;break}U>=tr&&y.raise("insufficient number of texture units"),V.profile&&G.maxTextureUnits<U+1&&(G.maxTextureUnits=U+1),b.unit=U,l.activeTexture(Pi+U),l.bindTexture(b.target,b.texture)}return U},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ke(this)}});function ot(b,U){var F=new Ze(kr);Zt[F.id]=F,G.textureCount++;function we(h,w){var P=F.texInfo;xt.call(P);var k=ut();return typeof h=="number"?typeof w=="number"?rt(k,h|0,w|0):rt(k,h|0,h|0):h?(y.type(h,"object","invalid arguments to regl.texture"),Vt(P,h),ht(k,h)):rt(k,1,1),P.genMipmaps&&(k.mipmask=(k.width<<1)-1),F.mipmask=k.mipmask,ye(F,k),y.texture2D(P,k,A),F.internalformat=k.internalformat,we.width=k.width,we.height=k.height,rr(F),$t(k,kr),Ht(P,kr),yt(),zt(k),V.profile&&(F.stats.size=Fa(F.internalformat,F.type,k.width,k.height,P.genMipmaps,!1)),we.format=fe[F.internalformat],we.type=Te[F.type],we.mag=J[P.magFilter],we.min=Se[P.minFilter],we.wrapS=te[P.wrapS],we.wrapT=te[P.wrapT],we}function at(h,w,P,k){y(!!h,"must specify image data");var N=w|0,R=P|0,O=k|0,E=Re();return ye(E,F),E.width=0,E.height=0,de(E,h),E.width=E.width||(F.width>>O)-N,E.height=E.height||(F.height>>O)-R,y(F.type===E.type&&F.format===E.format&&F.internalformat===E.internalformat,"incompatible format for texture.subimage"),y(N>=0&&R>=0&&N+E.width<=F.width&&R+E.height<=F.height,"texture.subimage write out of bounds"),y(F.mipmask&1<<O,"missing mipmap data"),y(E.data||E.element||E.needsCopy,"missing image data"),rr(F),je(E,kr,N,R,O),yt(),it(E),we}function _(h,w){var P=h|0,k=w|0||P;if(P===F.width&&k===F.height)return we;we.width=F.width=P,we.height=F.height=k,rr(F);for(var N=0;F.mipmask>>N;++N){var R=P>>N,O=k>>N;if(!R||!O)break;l.texImage2D(kr,N,F.format,R,O,0,F.format,F.type,null)}return yt(),V.profile&&(F.stats.size=Fa(F.internalformat,F.type,P,k,!1,!1)),we}return we(b,U),we.subimage=at,we.resize=_,we._reglType="texture2d",we._texture=F,V.profile&&(we.stats=F.stats),we.destroy=function(){F.decRef()},we}function dt(b,U,F,we,at,_){var h=new Ze(Ko);Zt[h.id]=h,G.cubeCount++;var w=new Array(6);function P(R,O,E,S,m,I){var D,W=h.texInfo;for(xt.call(W),D=0;D<6;++D)w[D]=ut();if(typeof R=="number"||!R){var K=R|0||1;for(D=0;D<6;++D)rt(w[D],K,K)}else if(typeof R=="object")if(O)ht(w[0],R),ht(w[1],O),ht(w[2],E),ht(w[3],S),ht(w[4],m),ht(w[5],I);else if(Vt(W,R),Pe(h,R),"faces"in R){var H=R.faces;for(y(Array.isArray(H)&&H.length===6,"cube faces must be a length 6 array"),D=0;D<6;++D)y(typeof H[D]=="object"&&!!H[D],"invalid input for cube map face"),ye(w[D],h),ht(w[D],H[D])}else for(D=0;D<6;++D)ht(w[D],R);else y.raise("invalid arguments to cube map");for(ye(h,w[0]),A.npotTextureCube||y(sc(h.width)&&sc(h.height),"your browser does not support non power or two texture dimensions"),W.genMipmaps?h.mipmask=(w[0].width<<1)-1:h.mipmask=w[0].mipmask,y.textureCube(h,W,w,A),h.internalformat=w[0].internalformat,P.width=w[0].width,P.height=w[0].height,rr(h),D=0;D<6;++D)$t(w[D],Ia+D);for(Ht(W,Ko),yt(),V.profile&&(h.stats.size=Fa(h.internalformat,h.type,P.width,P.height,W.genMipmaps,!0)),P.format=fe[h.internalformat],P.type=Te[h.type],P.mag=J[W.magFilter],P.min=Se[W.minFilter],P.wrapS=te[W.wrapS],P.wrapT=te[W.wrapT],D=0;D<6;++D)zt(w[D]);return P}function k(R,O,E,S,m){y(!!O,"must specify image data"),y(typeof R=="number"&&R===(R|0)&&R>=0&&R<6,"invalid face");var I=E|0,D=S|0,W=m|0,K=Re();return ye(K,h),K.width=0,K.height=0,de(K,O),K.width=K.width||(h.width>>W)-I,K.height=K.height||(h.height>>W)-D,y(h.type===K.type&&h.format===K.format&&h.internalformat===K.internalformat,"incompatible format for texture.subimage"),y(I>=0&&D>=0&&I+K.width<=h.width&&D+K.height<=h.height,"texture.subimage write out of bounds"),y(h.mipmask&1<<W,"missing mipmap data"),y(K.data||K.element||K.needsCopy,"missing image data"),rr(h),je(K,Ia+R,I,D,W),yt(),it(K),P}function N(R){var O=R|0;if(O!==h.width){P.width=h.width=O,P.height=h.height=O,rr(h);for(var E=0;E<6;++E)for(var S=0;h.mipmask>>S;++S)l.texImage2D(Ia+E,S,h.format,O>>S,O>>S,0,h.format,h.type,null);return yt(),V.profile&&(h.stats.size=Fa(h.internalformat,h.type,P.width,P.height,!1,!0)),P}}return P(b,U,F,we,at,_),P.subimage=k,P.resize=N,P._reglType="textureCube",P._texture=h,V.profile&&(P.stats=h.stats),P.destroy=function(){h.decRef()},P}function Ft(){for(var b=0;b<tr;++b)l.activeTexture(Pi+b),l.bindTexture(kr,null),Dt[b]=null;br(Zt).forEach(ke),G.cubeCount=0,G.textureCount=0}V.profile&&(G.getTotalTextureSize=function(){var b=0;return Object.keys(Zt).forEach(function(U){b+=Zt[U].stats.size}),b});function Fr(){for(var b=0;b<tr;++b){var U=Dt[b];U&&(U.bindCount=0,U.unit=-1,Dt[b]=null)}br(Zt).forEach(function(F){F.texture=l.createTexture(),l.bindTexture(F.target,F.texture);for(var we=0;we<32;++we)if((F.mipmask&1<<we)!==0)if(F.target===kr)l.texImage2D(kr,we,F.internalformat,F.width>>we,F.height>>we,0,F.internalformat,F.type,null);else for(var at=0;at<6;++at)l.texImage2D(Ia+at,we,F.internalformat,F.width>>we,F.height>>we,0,F.internalformat,F.type,null);Ht(F.texInfo,F.target)})}function In(){for(var b=0;b<tr;++b){var U=Dt[b];U&&(U.bindCount=0,U.unit=-1,Dt[b]=null),l.activeTexture(Pi+b),l.bindTexture(kr,null),l.bindTexture(Ko,null)}}return{create2D:ot,createCube:dt,clear:Ft,getTexture:function(b){return null},restore:Fr,refresh:In}}var sn=36161,Ga=32854,Mc=32855,kc=36194,Dc=33189,Fc=36168,Gc=34041,Bc=35907,Uc=34836,$c=34842,Vc=34843,Or=[];Or[Ga]=2,Or[Mc]=2,Or[kc]=2,Or[Dc]=2,Or[Fc]=1,Or[Gc]=4,Or[Bc]=4,Or[Uc]=16,Or[$c]=8,Or[Vc]=6;function jc(l,p,A){return Or[l]*p*A}var rE=function(l,p,A,B,q){var G={rgba4:Ga,rgb565:kc,"rgb5 a1":Mc,depth:Dc,stencil:Fc,"depth stencil":Gc};p.ext_srgb&&(G.srgba=Bc),p.ext_color_buffer_half_float&&(G.rgba16f=$c,G.rgb16f=Vc),p.webgl_color_buffer_float&&(G.rgba32f=Uc);var V=[];Object.keys(G).forEach(function(ie){var pe=G[ie];V[pe]=ie});var ne=0,se={};function le(ie){this.id=ne++,this.refCount=1,this.renderbuffer=ie,this.format=Ga,this.width=0,this.height=0,q.profile&&(this.stats={size:0})}le.prototype.decRef=function(){--this.refCount<=0&&ue(this)};function ue(ie){var pe=ie.renderbuffer;y(pe,"must not double destroy renderbuffer"),l.bindRenderbuffer(sn,null),l.deleteRenderbuffer(pe),ie.renderbuffer=null,ie.refCount=0,delete se[ie.id],B.renderbufferCount--}function ve(ie,pe){var L=new le(l.createRenderbuffer());se[L.id]=L,B.renderbufferCount++;function j(Te,J){var Se=0,te=0,me=Ga;if(typeof Te=="object"&&Te){var ee=Te;if("shape"in ee){var ye=ee.shape;y(Array.isArray(ye)&&ye.length>=2,"invalid renderbuffer shape"),Se=ye[0]|0,te=ye[1]|0}else"radius"in ee&&(Se=te=ee.radius|0),"width"in ee&&(Se=ee.width|0),"height"in ee&&(te=ee.height|0);"format"in ee&&(y.parameter(ee.format,G,"invalid renderbuffer format"),me=G[ee.format])}else typeof Te=="number"?(Se=Te|0,typeof J=="number"?te=J|0:te=Se):Te?y.raise("invalid arguments to renderbuffer constructor"):Se=te=1;if(y(Se>0&&te>0&&Se<=A.maxRenderbufferSize&&te<=A.maxRenderbufferSize,"invalid renderbuffer size"),!(Se===L.width&&te===L.height&&me===L.format))return j.width=L.width=Se,j.height=L.height=te,L.format=me,l.bindRenderbuffer(sn,L.renderbuffer),l.renderbufferStorage(sn,me,Se,te),y(l.getError()===0,"invalid render buffer format"),q.profile&&(L.stats.size=jc(L.format,L.width,L.height)),j.format=V[L.format],j}function fe(Te,J){var Se=Te|0,te=J|0||Se;return Se===L.width&&te===L.height||(y(Se>0&&te>0&&Se<=A.maxRenderbufferSize&&te<=A.maxRenderbufferSize,"invalid renderbuffer size"),j.width=L.width=Se,j.height=L.height=te,l.bindRenderbuffer(sn,L.renderbuffer),l.renderbufferStorage(sn,L.format,Se,te),y(l.getError()===0,"invalid render buffer format"),q.profile&&(L.stats.size=jc(L.format,L.width,L.height))),j}return j(ie,pe),j.resize=fe,j._reglType="renderbuffer",j._renderbuffer=L,q.profile&&(j.stats=L.stats),j.destroy=function(){L.decRef()},j}q.profile&&(B.getTotalRenderbufferSize=function(){var ie=0;return Object.keys(se).forEach(function(pe){ie+=se[pe].stats.size}),ie});function _e(){br(se).forEach(function(ie){ie.renderbuffer=l.createRenderbuffer(),l.bindRenderbuffer(sn,ie.renderbuffer),l.renderbufferStorage(sn,ie.format,ie.width,ie.height)}),l.bindRenderbuffer(sn,null)}return{create:ve,clear:function(){br(se).forEach(ue)},restore:_e}},Hr=36160,hs=36161,wn=3553,Ba=34069,zc=36064,Hc=36096,Xc=36128,Wc=33306,Yc=36053,nE=36054,iE=36055,aE=36057,oE=36061,sE=36193,uE=5121,cE=5126,qc=6407,Kc=6408,fE=6402,lE=[qc,Kc],vs=[];vs[Kc]=4,vs[qc]=3;var Ua=[];Ua[uE]=1,Ua[cE]=4,Ua[sE]=2;var dE=32854,hE=32855,vE=36194,pE=33189,mE=36168,Qc=34041,yE=35907,_E=34836,EE=34842,bE=34843,gE=[dE,hE,vE,yE,EE,bE,_E],ni={};ni[Yc]="complete",ni[nE]="incomplete attachment",ni[aE]="incomplete dimensions",ni[iE]="incomplete, missing attachment",ni[oE]="unsupported";function TE(l,p,A,B,q,G){var V={cur:null,next:null,dirty:!1,setFBO:null},ne=["rgba"],se=["rgba4","rgb565","rgb5 a1"];p.ext_srgb&&se.push("srgba"),p.ext_color_buffer_half_float&&se.push("rgba16f","rgb16f"),p.webgl_color_buffer_float&&se.push("rgba32f");var le=["uint8"];p.oes_texture_half_float&&le.push("half float","float16"),p.oes_texture_float&&le.push("float","float32");function ue(Ee,de,Z){this.target=Ee,this.texture=de,this.renderbuffer=Z;var je=0,Qe=0;de?(je=de.width,Qe=de.height):Z&&(je=Z.width,Qe=Z.height),this.width=je,this.height=Qe}function ve(Ee){Ee&&(Ee.texture&&Ee.texture._texture.decRef(),Ee.renderbuffer&&Ee.renderbuffer._renderbuffer.decRef())}function _e(Ee,de,Z){if(!!Ee)if(Ee.texture){var je=Ee.texture._texture,Qe=Math.max(1,je.width),Re=Math.max(1,je.height);y(Qe===de&&Re===Z,"inconsistent width/height for supplied texture"),je.refCount+=1}else{var it=Ee.renderbuffer._renderbuffer;y(it.width===de&&it.height===Z,"inconsistent width/height for renderbuffer"),it.refCount+=1}}function ie(Ee,de){de&&(de.texture?l.framebufferTexture2D(Hr,Ee,de.target,de.texture._texture.texture,0):l.framebufferRenderbuffer(Hr,Ee,hs,de.renderbuffer._renderbuffer.renderbuffer))}function pe(Ee){var de=wn,Z=null,je=null,Qe=Ee;typeof Ee=="object"&&(Qe=Ee.data,"target"in Ee&&(de=Ee.target|0)),y.type(Qe,"function","invalid attachment data");var Re=Qe._reglType;return Re==="texture2d"?(Z=Qe,y(de===wn)):Re==="textureCube"?(Z=Qe,y(de>=Ba&&de<Ba+6,"invalid cube map target")):Re==="renderbuffer"?(je=Qe,de=hs):y.raise("invalid regl object for attachment"),new ue(de,Z,je)}function L(Ee,de,Z,je,Qe){if(Z){var Re=B.create2D({width:Ee,height:de,format:je,type:Qe});return Re._texture.refCount=0,new ue(wn,Re,null)}else{var it=q.create({width:Ee,height:de,format:je});return it._renderbuffer.refCount=0,new ue(hs,null,it)}}function j(Ee){return Ee&&(Ee.texture||Ee.renderbuffer)}function fe(Ee,de,Z){Ee&&(Ee.texture?Ee.texture.resize(de,Z):Ee.renderbuffer&&Ee.renderbuffer.resize(de,Z),Ee.width=de,Ee.height=Z)}var Te=0,J={};function Se(){this.id=Te++,J[this.id]=this,this.framebuffer=l.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function te(Ee){Ee.colorAttachments.forEach(ve),ve(Ee.depthAttachment),ve(Ee.stencilAttachment),ve(Ee.depthStencilAttachment)}function me(Ee){var de=Ee.framebuffer;y(de,"must not double destroy framebuffer"),l.deleteFramebuffer(de),Ee.framebuffer=null,G.framebufferCount--,delete J[Ee.id]}function ee(Ee){var de;l.bindFramebuffer(Hr,Ee.framebuffer);var Z=Ee.colorAttachments;for(de=0;de<Z.length;++de)ie(zc+de,Z[de]);for(de=Z.length;de<A.maxColorAttachments;++de)l.framebufferTexture2D(Hr,zc+de,wn,null,0);l.framebufferTexture2D(Hr,Wc,wn,null,0),l.framebufferTexture2D(Hr,Hc,wn,null,0),l.framebufferTexture2D(Hr,Xc,wn,null,0),ie(Hc,Ee.depthAttachment),ie(Xc,Ee.stencilAttachment),ie(Wc,Ee.depthStencilAttachment);var je=l.checkFramebufferStatus(Hr);!l.isContextLost()&&je!==Yc&&y.raise("framebuffer configuration not supported, status = "+ni[je]),l.bindFramebuffer(Hr,V.next?V.next.framebuffer:null),V.cur=V.next,l.getError()}function ye(Ee,de){var Z=new Se;G.framebufferCount++;function je(Re,it){var We;y(V.next!==Z,"can not update framebuffer which is currently in use");var rt=0,ht=0,$t=!0,Qt=!0,ut=null,zt=!0,xt="rgba",Vt="uint8",Ht=1,Xt=null,Zt=null,tr=null,Dt=!1;if(typeof Re=="number")rt=Re|0,ht=it|0||rt;else if(!Re)rt=ht=1;else{y.type(Re,"object","invalid arguments for framebuffer");var Ze=Re;if("shape"in Ze){var rr=Ze.shape;y(Array.isArray(rr)&&rr.length>=2,"invalid shape for framebuffer"),rt=rr[0],ht=rr[1]}else"radius"in Ze&&(rt=ht=Ze.radius),"width"in Ze&&(rt=Ze.width),"height"in Ze&&(ht=Ze.height);("color"in Ze||"colors"in Ze)&&(ut=Ze.color||Ze.colors,Array.isArray(ut)&&y(ut.length===1||p.webgl_draw_buffers,"multiple render targets not supported")),ut||("colorCount"in Ze&&(Ht=Ze.colorCount|0,y(Ht>0,"invalid color buffer count")),"colorTexture"in Ze&&(zt=!!Ze.colorTexture,xt="rgba4"),"colorType"in Ze&&(Vt=Ze.colorType,zt?(y(p.oes_texture_float||!(Vt==="float"||Vt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),y(p.oes_texture_half_float||!(Vt==="half float"||Vt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Vt==="half float"||Vt==="float16"?(y(p.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),xt="rgba16f"):(Vt==="float"||Vt==="float32")&&(y(p.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),xt="rgba32f"),y.oneOf(Vt,le,"invalid color type")),"colorFormat"in Ze&&(xt=Ze.colorFormat,ne.indexOf(xt)>=0?zt=!0:se.indexOf(xt)>=0?zt=!1:zt?y.oneOf(Ze.colorFormat,ne,"invalid color format for texture"):y.oneOf(Ze.colorFormat,se,"invalid color format for renderbuffer"))),("depthTexture"in Ze||"depthStencilTexture"in Ze)&&(Dt=!!(Ze.depthTexture||Ze.depthStencilTexture),y(!Dt||p.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ze&&(typeof Ze.depth=="boolean"?$t=Ze.depth:(Xt=Ze.depth,Qt=!1)),"stencil"in Ze&&(typeof Ze.stencil=="boolean"?Qt=Ze.stencil:(Zt=Ze.stencil,$t=!1)),"depthStencil"in Ze&&(typeof Ze.depthStencil=="boolean"?$t=Qt=Ze.depthStencil:(tr=Ze.depthStencil,$t=!1,Qt=!1))}var yt=null,ke=null,ot=null,dt=null;if(Array.isArray(ut))yt=ut.map(pe);else if(ut)yt=[pe(ut)];else for(yt=new Array(Ht),We=0;We<Ht;++We)yt[We]=L(rt,ht,zt,xt,Vt);y(p.webgl_draw_buffers||yt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),y(yt.length<=A.maxColorAttachments,"too many color attachments, not supported"),rt=rt||yt[0].width,ht=ht||yt[0].height,Xt?ke=pe(Xt):$t&&!Qt&&(ke=L(rt,ht,Dt,"depth","uint32")),Zt?ot=pe(Zt):Qt&&!$t&&(ot=L(rt,ht,!1,"stencil","uint8")),tr?dt=pe(tr):!Xt&&!Zt&&Qt&&$t&&(dt=L(rt,ht,Dt,"depth stencil","depth stencil")),y(!!Xt+!!Zt+!!tr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ft=null;for(We=0;We<yt.length;++We)if(_e(yt[We],rt,ht),y(!yt[We]||yt[We].texture&&lE.indexOf(yt[We].texture._texture.format)>=0||yt[We].renderbuffer&&gE.indexOf(yt[We].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+We+" is invalid"),yt[We]&&yt[We].texture){var Fr=vs[yt[We].texture._texture.format]*Ua[yt[We].texture._texture.type];Ft===null?Ft=Fr:y(Ft===Fr,"all color attachments much have the same number of bits per pixel.")}return _e(ke,rt,ht),y(!ke||ke.texture&&ke.texture._texture.format===fE||ke.renderbuffer&&ke.renderbuffer._renderbuffer.format===pE,"invalid depth attachment for framebuffer object"),_e(ot,rt,ht),y(!ot||ot.renderbuffer&&ot.renderbuffer._renderbuffer.format===mE,"invalid stencil attachment for framebuffer object"),_e(dt,rt,ht),y(!dt||dt.texture&&dt.texture._texture.format===Qc||dt.renderbuffer&&dt.renderbuffer._renderbuffer.format===Qc,"invalid depth-stencil attachment for framebuffer object"),te(Z),Z.width=rt,Z.height=ht,Z.colorAttachments=yt,Z.depthAttachment=ke,Z.stencilAttachment=ot,Z.depthStencilAttachment=dt,je.color=yt.map(j),je.depth=j(ke),je.stencil=j(ot),je.depthStencil=j(dt),je.width=Z.width,je.height=Z.height,ee(Z),je}function Qe(Re,it){y(V.next!==Z,"can not resize a framebuffer which is currently in use");var We=Math.max(Re|0,1),rt=Math.max(it|0||We,1);if(We===Z.width&&rt===Z.height)return je;for(var ht=Z.colorAttachments,$t=0;$t<ht.length;++$t)fe(ht[$t],We,rt);return fe(Z.depthAttachment,We,rt),fe(Z.stencilAttachment,We,rt),fe(Z.depthStencilAttachment,We,rt),Z.width=je.width=We,Z.height=je.height=rt,ee(Z),je}return je(Ee,de),n(je,{resize:Qe,_reglType:"framebuffer",_framebuffer:Z,destroy:function(){me(Z),te(Z)},use:function(Re){V.setFBO({framebuffer:je},Re)}})}function Pe(Ee){var de=Array(6);function Z(Qe){var Re;y(de.indexOf(V.next)<0,"can not update framebuffer which is currently in use");var it={color:null},We=0,rt=null,ht="rgba",$t="uint8",Qt=1;if(typeof Qe=="number")We=Qe|0;else if(!Qe)We=1;else{y.type(Qe,"object","invalid arguments for framebuffer");var ut=Qe;if("shape"in ut){var zt=ut.shape;y(Array.isArray(zt)&&zt.length>=2,"invalid shape for framebuffer"),y(zt[0]===zt[1],"cube framebuffer must be square"),We=zt[0]}else"radius"in ut&&(We=ut.radius|0),"width"in ut?(We=ut.width|0,"height"in ut&&y(ut.height===We,"must be square")):"height"in ut&&(We=ut.height|0);("color"in ut||"colors"in ut)&&(rt=ut.color||ut.colors,Array.isArray(rt)&&y(rt.length===1||p.webgl_draw_buffers,"multiple render targets not supported")),rt||("colorCount"in ut&&(Qt=ut.colorCount|0,y(Qt>0,"invalid color buffer count")),"colorType"in ut&&(y.oneOf(ut.colorType,le,"invalid color type"),$t=ut.colorType),"colorFormat"in ut&&(ht=ut.colorFormat,y.oneOf(ut.colorFormat,ne,"invalid color format for texture"))),"depth"in ut&&(it.depth=ut.depth),"stencil"in ut&&(it.stencil=ut.stencil),"depthStencil"in ut&&(it.depthStencil=ut.depthStencil)}var xt;if(rt)if(Array.isArray(rt))for(xt=[],Re=0;Re<rt.length;++Re)xt[Re]=rt[Re];else xt=[rt];else{xt=Array(Qt);var Vt={radius:We,format:ht,type:$t};for(Re=0;Re<Qt;++Re)xt[Re]=B.createCube(Vt)}for(it.color=Array(xt.length),Re=0;Re<xt.length;++Re){var Ht=xt[Re];y(typeof Ht=="function"&&Ht._reglType==="textureCube","invalid cube map"),We=We||Ht.width,y(Ht.width===We&&Ht.height===We,"invalid cube map shape"),it.color[Re]={target:Ba,data:xt[Re]}}for(Re=0;Re<6;++Re){for(var Xt=0;Xt<xt.length;++Xt)it.color[Xt].target=Ba+Re;Re>0&&(it.depth=de[0].depth,it.stencil=de[0].stencil,it.depthStencil=de[0].depthStencil),de[Re]?de[Re](it):de[Re]=ye(it)}return n(Z,{width:We,height:We,color:xt})}function je(Qe){var Re,it=Qe|0;if(y(it>0&&it<=A.maxCubeMapSize,"invalid radius for cube fbo"),it===Z.width)return Z;var We=Z.color;for(Re=0;Re<We.length;++Re)We[Re].resize(it);for(Re=0;Re<6;++Re)de[Re].resize(it);return Z.width=Z.height=it,Z}return Z(Ee),n(Z,{faces:de,resize:je,_reglType:"framebufferCube",destroy:function(){de.forEach(function(Qe){Qe.destroy()})}})}function Xe(){V.cur=null,V.next=null,V.dirty=!0,br(J).forEach(function(Ee){Ee.framebuffer=l.createFramebuffer(),ee(Ee)})}return n(V,{getFramebuffer:function(Ee){if(typeof Ee=="function"&&Ee._reglType==="framebuffer"){var de=Ee._framebuffer;if(de instanceof Se)return de}return null},create:ye,createCube:Pe,clear:function(){br(J).forEach(me)},restore:Xe})}var AE=5126,Zc=34962;function ps(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=AE,this.offset=0,this.stride=0,this.divisor=0}function SE(l,p,A,B,q){for(var G=A.maxAttributes,V=new Array(G),ne=0;ne<G;++ne)V[ne]=new ps;var se=0,le={},ue={Record:ps,scope:{},state:V,currentVAO:null,targetVAO:null,restore:_e()?J:function(){},createVAO:Se,getVAO:pe,destroyBuffer:ve,setVAO:_e()?L:j,clear:_e()?fe:function(){}};function ve(te){for(var me=0;me<V.length;++me){var ee=V[me];ee.buffer===te&&(l.disableVertexAttribArray(me),ee.buffer=null)}}function _e(){return p.oes_vertex_array_object}function ie(){return p.angle_instanced_arrays}function pe(te){return typeof te=="function"&&te._vao?te._vao:null}function L(te){if(te!==ue.currentVAO){var me=_e();te?me.bindVertexArrayOES(te.vao):me.bindVertexArrayOES(null),ue.currentVAO=te}}function j(te){if(te!==ue.currentVAO){if(te)te.bindAttrs();else for(var me=ie(),ee=0;ee<V.length;++ee){var ye=V[ee];ye.buffer?(l.enableVertexAttribArray(ee),l.vertexAttribPointer(ee,ye.size,ye.type,ye.normalized,ye.stride,ye.offfset),me&&ye.divisor&&me.vertexAttribDivisorANGLE(ee,ye.divisor)):(l.disableVertexAttribArray(ee),l.vertexAttrib4f(ee,ye.x,ye.y,ye.z,ye.w))}ue.currentVAO=te}}function fe(){br(le).forEach(function(te){te.destroy()})}function Te(){this.id=++se,this.attributes=[];var te=_e();te?this.vao=te.createVertexArrayOES():this.vao=null,le[this.id]=this,this.buffers=[]}Te.prototype.bindAttrs=function(){for(var te=ie(),me=this.attributes,ee=0;ee<me.length;++ee){var ye=me[ee];ye.buffer?(l.enableVertexAttribArray(ee),l.bindBuffer(Zc,ye.buffer.buffer),l.vertexAttribPointer(ee,ye.size,ye.type,ye.normalized,ye.stride,ye.offset),te&&ye.divisor&&te.vertexAttribDivisorANGLE(ee,ye.divisor)):(l.disableVertexAttribArray(ee),l.vertexAttrib4f(ee,ye.x,ye.y,ye.z,ye.w))}for(var Pe=me.length;Pe<G;++Pe)l.disableVertexAttribArray(Pe)},Te.prototype.refresh=function(){var te=_e();te&&(te.bindVertexArrayOES(this.vao),this.bindAttrs(),ue.currentVAO=this)},Te.prototype.destroy=function(){if(this.vao){var te=_e();this===ue.currentVAO&&(ue.currentVAO=null,te.bindVertexArrayOES(null)),te.deleteVertexArrayOES(this.vao),this.vao=null}le[this.id]&&(delete le[this.id],B.vaoCount-=1)};function J(){var te=_e();te&&br(le).forEach(function(me){me.refresh()})}function Se(te){var me=new Te;B.vaoCount+=1;function ee(ye){y(Array.isArray(ye),"arguments to vertex array constructor must be an array"),y(ye.length<G,"too many attributes"),y(ye.length>0,"must specify at least one attribute");var Pe={},Xe=me.attributes;Xe.length=ye.length;for(var Ee=0;Ee<ye.length;++Ee){var de=ye[Ee],Z=Xe[Ee]=new ps,je=de.data||de;if(Array.isArray(je)||r(je)||Nr(je)){var Qe;me.buffers[Ee]&&(Qe=me.buffers[Ee],r(je)&&Qe._buffer.byteLength>=je.byteLength?Qe.subdata(je):(Qe.destroy(),me.buffers[Ee]=null)),me.buffers[Ee]||(Qe=me.buffers[Ee]=q.create(de,Zc,!1,!0)),Z.buffer=q.getBuffer(Qe),Z.size=Z.buffer.dimension|0,Z.normalized=!1,Z.type=Z.buffer.dtype,Z.offset=0,Z.stride=0,Z.divisor=0,Z.state=1,Pe[Ee]=1}else q.getBuffer(de)?(Z.buffer=q.getBuffer(de),Z.size=Z.buffer.dimension|0,Z.normalized=!1,Z.type=Z.buffer.dtype,Z.offset=0,Z.stride=0,Z.divisor=0,Z.state=1):q.getBuffer(de.buffer)?(Z.buffer=q.getBuffer(de.buffer),Z.size=(+de.size||Z.buffer.dimension)|0,Z.normalized=!!de.normalized||!1,"type"in de?(y.parameter(de.type,gn,"invalid buffer type"),Z.type=gn[de.type]):Z.type=Z.buffer.dtype,Z.offset=(de.offset||0)|0,Z.stride=(de.stride||0)|0,Z.divisor=(de.divisor||0)|0,Z.state=1,y(Z.size>=1&&Z.size<=4,"size must be between 1 and 4"),y(Z.offset>=0,"invalid offset"),y(Z.stride>=0&&Z.stride<=255,"stride must be between 0 and 255"),y(Z.divisor>=0,"divisor must be positive"),y(!Z.divisor||!!p.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in de?(y(Ee>0,"first attribute must not be a constant"),Z.x=+de.x||0,Z.y=+de.y||0,Z.z=+de.z||0,Z.w=+de.w||0,Z.state=2):y(!1,"invalid attribute spec for location "+Ee)}for(var Re=0;Re<me.buffers.length;++Re)!Pe[Re]&&me.buffers[Re]&&(me.buffers[Re].destroy(),me.buffers[Re]=null);return me.refresh(),ee}return ee.destroy=function(){for(var ye=0;ye<me.buffers.length;++ye)me.buffers[ye]&&me.buffers[ye].destroy();me.buffers.length=0,me.destroy()},ee._vao=me,ee._reglType="vao",ee(te)}return ue}var Jc=35632,wE=35633,RE=35718,CE=35721;function xE(l,p,A,B){var q={},G={};function V(L,j,fe,Te){this.name=L,this.id=j,this.location=fe,this.info=Te}function ne(L,j){for(var fe=0;fe<L.length;++fe)if(L[fe].id===j.id){L[fe].location=j.location;return}L.push(j)}function se(L,j,fe){var Te=L===Jc?q:G,J=Te[j];if(!J){var Se=p.str(j);J=l.createShader(L),l.shaderSource(J,Se),l.compileShader(J),y.shaderError(l,J,Se,L,fe),Te[j]=J}return J}var le={},ue=[],ve=0;function _e(L,j){this.id=ve++,this.fragId=L,this.vertId=j,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,B.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function ie(L,j,fe){var Te,J,Se=se(Jc,L.fragId),te=se(wE,L.vertId),me=L.program=l.createProgram();if(l.attachShader(me,Se),l.attachShader(me,te),fe)for(Te=0;Te<fe.length;++Te){var ee=fe[Te];l.bindAttribLocation(me,ee[0],ee[1])}l.linkProgram(me),y.linkError(l,me,p.str(L.fragId),p.str(L.vertId),j);var ye=l.getProgramParameter(me,RE);B.profile&&(L.stats.uniformsCount=ye);var Pe=L.uniforms;for(Te=0;Te<ye;++Te)if(J=l.getActiveUniform(me,Te),J)if(J.size>1)for(var Xe=0;Xe<J.size;++Xe){var Ee=J.name.replace("[0]","["+Xe+"]");ne(Pe,new V(Ee,p.id(Ee),l.getUniformLocation(me,Ee),J))}else ne(Pe,new V(J.name,p.id(J.name),l.getUniformLocation(me,J.name),J));var de=l.getProgramParameter(me,CE);B.profile&&(L.stats.attributesCount=de);var Z=L.attributes;for(Te=0;Te<de;++Te)J=l.getActiveAttrib(me,Te),J&&ne(Z,new V(J.name,p.id(J.name),l.getAttribLocation(me,J.name),J))}B.profile&&(A.getMaxUniformsCount=function(){var L=0;return ue.forEach(function(j){j.stats.uniformsCount>L&&(L=j.stats.uniformsCount)}),L},A.getMaxAttributesCount=function(){var L=0;return ue.forEach(function(j){j.stats.attributesCount>L&&(L=j.stats.attributesCount)}),L});function pe(){q={},G={};for(var L=0;L<ue.length;++L)ie(ue[L],null,ue[L].attributes.map(function(j){return[j.location,j.name]}))}return{clear:function(){var L=l.deleteShader.bind(l);br(q).forEach(L),q={},br(G).forEach(L),G={},ue.forEach(function(j){l.deleteProgram(j.program)}),ue.length=0,le={},A.shaderCount=0},program:function(L,j,fe,Te){y.command(L>=0,"missing vertex shader",fe),y.command(j>=0,"missing fragment shader",fe);var J=le[j];J||(J=le[j]={});var Se=J[L];if(Se&&(Se.refCount++,!Te))return Se;var te=new _e(j,L);return A.shaderCount++,ie(te,fe,Te),Se||(J[L]=te),ue.push(te),n(te,{destroy:function(){if(te.refCount--,te.refCount<=0){l.deleteProgram(te.program);var me=ue.indexOf(te);ue.splice(me,1),A.shaderCount--}J[te.vertId].refCount<=0&&(l.deleteShader(G[te.vertId]),delete G[te.vertId],delete le[te.fragId][te.vertId]),Object.keys(le[te.fragId]).length||(l.deleteShader(q[te.fragId]),delete q[te.fragId],delete le[te.fragId])}})},restore:pe,shader:se,frag:-1,vert:-1}}var NE=6408,Li=5121,OE=3333,$a=5126;function IE(l,p,A,B,q,G,V){function ne(ue){var ve;p.next===null?(y(q.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ve=Li):(y(p.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ve=p.next.colorAttachments[0].texture._texture.type,G.oes_texture_float?(y(ve===Li||ve===$a,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ve===$a&&y(V.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):y(ve===Li,"Reading from a framebuffer is only allowed for the type 'uint8'"));var _e=0,ie=0,pe=B.framebufferWidth,L=B.framebufferHeight,j=null;r(ue)?j=ue:ue&&(y.type(ue,"object","invalid arguments to regl.read()"),_e=ue.x|0,ie=ue.y|0,y(_e>=0&&_e<B.framebufferWidth,"invalid x offset for regl.read"),y(ie>=0&&ie<B.framebufferHeight,"invalid y offset for regl.read"),pe=(ue.width||B.framebufferWidth-_e)|0,L=(ue.height||B.framebufferHeight-ie)|0,j=ue.data||null),j&&(ve===Li?y(j instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ve===$a&&y(j instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),y(pe>0&&pe+_e<=B.framebufferWidth,"invalid width for read pixels"),y(L>0&&L+ie<=B.framebufferHeight,"invalid height for read pixels"),A();var fe=pe*L*4;return j||(ve===Li?j=new Uint8Array(fe):ve===$a&&(j=j||new Float32Array(fe))),y.isTypedArray(j,"data buffer for regl.read() must be a typedarray"),y(j.byteLength>=fe,"data buffer for regl.read() too small"),l.pixelStorei(OE,4),l.readPixels(_e,ie,pe,L,NE,ve,j),j}function se(ue){var ve;return p.setFBO({framebuffer:ue.framebuffer},function(){ve=ne(ue)}),ve}function le(ue){return!ue||!("framebuffer"in ue)?ne(ue):se(ue)}return le}function ii(l){return Array.prototype.slice.call(l)}function ai(l){return ii(l).join("")}function PE(){var l=0,p=[],A=[];function B(ve){for(var _e=0;_e<A.length;++_e)if(A[_e]===ve)return p[_e];var ie="g"+l++;return p.push(ie),A.push(ve),ie}function q(){var ve=[];function _e(){ve.push.apply(ve,ii(arguments))}var ie=[];function pe(){var L="v"+l++;return ie.push(L),arguments.length>0&&(ve.push(L,"="),ve.push.apply(ve,ii(arguments)),ve.push(";")),L}return n(_e,{def:pe,toString:function(){return ai([ie.length>0?"var "+ie.join(",")+";":"",ai(ve)])}})}function G(){var ve=q(),_e=q(),ie=ve.toString,pe=_e.toString;function L(j,fe){_e(j,fe,"=",ve.def(j,fe),";")}return n(function(){ve.apply(ve,ii(arguments))},{def:ve.def,entry:ve,exit:_e,save:L,set:function(j,fe,Te){L(j,fe),ve(j,fe,"=",Te,";")},toString:function(){return ie()+pe()}})}function V(){var ve=ai(arguments),_e=G(),ie=G(),pe=_e.toString,L=ie.toString;return n(_e,{then:function(){return _e.apply(_e,ii(arguments)),this},else:function(){return ie.apply(ie,ii(arguments)),this},toString:function(){var j=L();return j&&(j="else{"+j+"}"),ai(["if(",ve,"){",pe(),"}",j])}})}var ne=q(),se={};function le(ve,_e){var ie=[];function pe(){var J="a"+ie.length;return ie.push(J),J}_e=_e||0;for(var L=0;L<_e;++L)pe();var j=G(),fe=j.toString,Te=se[ve]=n(j,{arg:pe,toString:function(){return ai(["function(",ie.join(),"){",fe(),"}"])}});return Te}function ue(){var ve=['"use strict";',ne,"return {"];Object.keys(se).forEach(function(pe){ve.push('"',pe,'":',se[pe].toString(),",")}),ve.push("}");var _e=ai(ve).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),ie=Function.apply(null,p.concat(_e));return ie.apply(null,A)}return{global:ne,link:B,block:q,proc:le,scope:G,cond:V,compile:ue}}var oi="xyzw".split(""),ef=5121,si=1,ms=2,ys=0,_s=1,Es=2,bs=3,Va=4,tf=5,rf=6,nf="dither",af="blend.enable",of="blend.color",gs="blend.equation",Ts="blend.func",sf="depth.enable",uf="depth.func",cf="depth.range",ff="depth.mask",As="colorMask",lf="cull.enable",df="cull.face",Ss="frontFace",ws="lineWidth",hf="polygonOffset.enable",Rs="polygonOffset.offset",vf="sample.alpha",pf="sample.enable",Cs="sample.coverage",mf="stencil.enable",yf="stencil.mask",xs="stencil.func",Ns="stencil.opFront",Mi="stencil.opBack",_f="scissor.enable",ja="scissor.box",Xr="viewport",ki="profile",Rn="framebuffer",Di="vert",Fi="frag",Cn="elements",xn="primitive",Nn="count",za="offset",Ha="instances",Gi="vao",Os="Width",Is="Height",ui=Rn+Os,ci=Rn+Is,LE=Xr+Os,ME=Xr+Is,Ef="drawingBuffer",bf=Ef+Os,gf=Ef+Is,kE=[Ts,gs,xs,Ns,Mi,Cs,Xr,ja,Rs],fi=34962,DE=34963,FE=35632,GE=35633,Tf=3553,BE=34067,UE=2884,$E=3042,VE=3024,jE=2960,zE=2929,HE=3089,XE=32823,WE=32926,YE=32928,Ps=5126,Xa=35664,Wa=35665,Ya=35666,Ls=5124,qa=35667,Ka=35668,Qa=35669,Ms=35670,Za=35671,Ja=35672,eo=35673,Bi=35674,Ui=35675,$i=35676,Vi=35678,ji=35680,Af=4,zi=1028,On=1029,Sf=2304,ks=2305,qE=32775,KE=32776,QE=519,un=7680,wf=0,Rf=1,Cf=32774,ZE=513,xf=36160,JE=36064,Dr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Nf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],li={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},cn={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Of={frag:FE,vert:GE},Ds={cw:Sf,ccw:ks};function to(l){return Array.isArray(l)||r(l)||Nr(l)}function If(l){return l.sort(function(p,A){return p===Xr?-1:A===Xr?1:p<A?-1:1})}function dr(l,p,A,B){this.thisDep=l,this.contextDep=p,this.propDep=A,this.append=B}function fn(l){return l&&!(l.thisDep||l.contextDep||l.propDep)}function Ut(l){return new dr(!1,!1,!1,l)}function yr(l,p){var A=l.type;if(A===ys){var B=l.data.length;return new dr(!0,B>=1,B>=2,p)}else if(A===Va){var q=l.data;return new dr(q.thisDep,q.contextDep,q.propDep,p)}else{if(A===tf)return new dr(!1,!1,!1,p);if(A===rf){for(var G=!1,V=!1,ne=!1,se=0;se<l.data.length;++se){var le=l.data[se];if(le.type===_s)ne=!0;else if(le.type===Es)V=!0;else if(le.type===bs)G=!0;else if(le.type===ys){G=!0;var ue=le.data;ue>=1&&(V=!0),ue>=2&&(ne=!0)}else le.type===Va&&(G=G||le.data.thisDep,V=V||le.data.contextDep,ne=ne||le.data.propDep)}return new dr(G,V,ne,p)}else return new dr(A===bs,A===Es,A===_s,p)}}var Pf=new dr(!1,!1,!1,function(){});function eb(l,p,A,B,q,G,V,ne,se,le,ue,ve,_e,ie,pe){var L=le.Record,j={add:32774,subtract:32778,"reverse subtract":32779};A.ext_blend_minmax&&(j.min=qE,j.max=KE);var fe=A.angle_instanced_arrays,Te=A.webgl_draw_buffers,J={dirty:!0,profile:pe.profile},Se={},te=[],me={},ee={};function ye(_){return _.replace(".","_")}function Pe(_,h,w){var P=ye(_);te.push(_),Se[P]=J[P]=!!w,me[P]=h}function Xe(_,h,w){var P=ye(_);te.push(_),Array.isArray(w)?(J[P]=w.slice(),Se[P]=w.slice()):J[P]=Se[P]=w,ee[P]=h}Pe(nf,VE),Pe(af,$E),Xe(of,"blendColor",[0,0,0,0]),Xe(gs,"blendEquationSeparate",[Cf,Cf]),Xe(Ts,"blendFuncSeparate",[Rf,wf,Rf,wf]),Pe(sf,zE,!0),Xe(uf,"depthFunc",ZE),Xe(cf,"depthRange",[0,1]),Xe(ff,"depthMask",!0),Xe(As,As,[!0,!0,!0,!0]),Pe(lf,UE),Xe(df,"cullFace",On),Xe(Ss,Ss,ks),Xe(ws,ws,1),Pe(hf,XE),Xe(Rs,"polygonOffset",[0,0]),Pe(vf,WE),Pe(pf,YE),Xe(Cs,"sampleCoverage",[1,!1]),Pe(mf,jE),Xe(yf,"stencilMask",-1),Xe(xs,"stencilFunc",[QE,0,-1]),Xe(Ns,"stencilOpSeparate",[zi,un,un,un]),Xe(Mi,"stencilOpSeparate",[On,un,un,un]),Pe(_f,HE),Xe(ja,"scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]),Xe(Xr,Xr,[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var Ee={gl:l,context:_e,strings:p,next:Se,current:J,draw:ve,elements:G,buffer:q,shader:ue,attributes:le.state,vao:le,uniforms:se,framebuffer:ne,extensions:A,timer:ie,isBufferArgs:to},de={primTypes:Kn,compareFuncs:li,blendFuncs:Dr,blendEquations:j,stencilOps:cn,glTypes:gn,orientationType:Ds};y.optional(function(){Ee.isArrayLike=kt}),Te&&(de.backBuffer=[On],de.drawBuffer=mr(B.maxDrawbuffers,function(_){return _===0?[0]:mr(_,function(h){return JE+h})}));var Z=0;function je(){var _=PE(),h=_.link,w=_.global;_.id=Z++,_.batchId="0";var P=h(Ee),k=_.shared={props:"a0"};Object.keys(Ee).forEach(function(S){k[S]=w.def(P,".",S)}),y.optional(function(){_.CHECK=h(y),_.commandStr=y.guessCommand(),_.command=h(_.commandStr),_.assert=function(S,m,I){S("if(!(",m,"))",this.CHECK,".commandRaise(",h(I),",",this.command,");")},de.invalidBlendCombinations=Nf});var N=_.next={},R=_.current={};Object.keys(ee).forEach(function(S){Array.isArray(J[S])&&(N[S]=w.def(k.next,".",S),R[S]=w.def(k.current,".",S))});var O=_.constants={};Object.keys(de).forEach(function(S){O[S]=w.def(JSON.stringify(de[S]))}),_.invoke=function(S,m){switch(m.type){case ys:var I=["this",k.context,k.props,_.batchId];return S.def(h(m.data),".call(",I.slice(0,Math.max(m.data.length+1,4)),")");case _s:return S.def(k.props,m.data);case Es:return S.def(k.context,m.data);case bs:return S.def("this",m.data);case Va:return m.data.append(_,S),m.data.ref;case tf:return m.data.toString();case rf:return m.data.map(function(D){return _.invoke(S,D)})}},_.attribCache={};var E={};return _.scopeAttrib=function(S){var m=p.id(S);if(m in E)return E[m];var I=le.scope[m];I||(I=le.scope[m]=new L);var D=E[m]=h(I);return D},_}function Qe(_){var h=_.static,w=_.dynamic,P;if(ki in h){var k=!!h[ki];P=Ut(function(R,O){return k}),P.enable=k}else if(ki in w){var N=w[ki];P=yr(N,function(R,O){return R.invoke(O,N)})}return P}function Re(_,h){var w=_.static,P=_.dynamic;if(Rn in w){var k=w[Rn];return k?(k=ne.getFramebuffer(k),y.command(k,"invalid framebuffer object"),Ut(function(R,O){var E=R.link(k),S=R.shared;O.set(S.framebuffer,".next",E);var m=S.context;return O.set(m,"."+ui,E+".width"),O.set(m,"."+ci,E+".height"),E})):Ut(function(R,O){var E=R.shared;O.set(E.framebuffer,".next","null");var S=E.context;return O.set(S,"."+ui,S+"."+bf),O.set(S,"."+ci,S+"."+gf),"null"})}else if(Rn in P){var N=P[Rn];return yr(N,function(R,O){var E=R.invoke(O,N),S=R.shared,m=S.framebuffer,I=O.def(m,".getFramebuffer(",E,")");y.optional(function(){R.assert(O,"!"+E+"||"+I,"invalid framebuffer object")}),O.set(m,".next",I);var D=S.context;return O.set(D,"."+ui,I+"?"+I+".width:"+D+"."+bf),O.set(D,"."+ci,I+"?"+I+".height:"+D+"."+gf),I})}else return null}function it(_,h,w){var P=_.static,k=_.dynamic;function N(E){if(E in P){var S=P[E];y.commandType(S,"object","invalid "+E,w.commandStr);var m=!0,I=S.x|0,D=S.y|0,W,K;return"width"in S?(W=S.width|0,y.command(W>=0,"invalid "+E,w.commandStr)):m=!1,"height"in S?(K=S.height|0,y.command(K>=0,"invalid "+E,w.commandStr)):m=!1,new dr(!m&&h&&h.thisDep,!m&&h&&h.contextDep,!m&&h&&h.propDep,function(Oe,Je){var Ce=Oe.shared.context,Fe=W;"width"in S||(Fe=Je.def(Ce,".",ui,"-",I));var Ye=K;return"height"in S||(Ye=Je.def(Ce,".",ci,"-",D)),[I,D,Fe,Ye]})}else if(E in k){var H=k[E],ce=yr(H,function(Oe,Je){var Ce=Oe.invoke(Je,H);y.optional(function(){Oe.assert(Je,Ce+"&&typeof "+Ce+'==="object"',"invalid "+E)});var Fe=Oe.shared.context,Ye=Je.def(Ce,".x|0"),vt=Je.def(Ce,".y|0"),Pt=Je.def('"width" in ',Ce,"?",Ce,".width|0:","(",Fe,".",ui,"-",Ye,")"),hr=Je.def('"height" in ',Ce,"?",Ce,".height|0:","(",Fe,".",ci,"-",vt,")");return y.optional(function(){Oe.assert(Je,Pt+">=0&&"+hr+">=0","invalid "+E)}),[Ye,vt,Pt,hr]});return h&&(ce.thisDep=ce.thisDep||h.thisDep,ce.contextDep=ce.contextDep||h.contextDep,ce.propDep=ce.propDep||h.propDep),ce}else return h?new dr(h.thisDep,h.contextDep,h.propDep,function(Oe,Je){var Ce=Oe.shared.context;return[0,0,Je.def(Ce,".",ui),Je.def(Ce,".",ci)]}):null}var R=N(Xr);if(R){var O=R;R=new dr(R.thisDep,R.contextDep,R.propDep,function(E,S){var m=O.append(E,S),I=E.shared.context;return S.set(I,"."+LE,m[2]),S.set(I,"."+ME,m[3]),m})}return{viewport:R,scissor_box:N(ja)}}function We(_,h){var w=_.static,P=typeof w[Fi]=="string"&&typeof w[Di]=="string";if(P){if(Object.keys(h.dynamic).length>0)return null;var k=h.static,N=Object.keys(k);if(N.length>0&&typeof k[N[0]]=="number"){for(var R=[],O=0;O<N.length;++O)y(typeof k[N[O]]=="number","must specify all vertex attribute locations when using vaos"),R.push([k[N[O]]|0,N[O]]);return R}}return null}function rt(_,h,w){var P=_.static,k=_.dynamic;function N(m){if(m in P){var I=p.id(P[m]);y.optional(function(){ue.shader(Of[m],I,y.guessCommand())});var D=Ut(function(){return I});return D.id=I,D}else if(m in k){var W=k[m];return yr(W,function(K,H){var ce=K.invoke(H,W),Oe=H.def(K.shared.strings,".id(",ce,")");return y.optional(function(){H(K.shared.shader,".shader(",Of[m],",",Oe,",",K.command,");")}),Oe})}return null}var R=N(Fi),O=N(Di),E=null,S;return fn(R)&&fn(O)?(E=ue.program(O.id,R.id,null,w),S=Ut(function(m,I){return m.link(E)})):S=new dr(R&&R.thisDep||O&&O.thisDep,R&&R.contextDep||O&&O.contextDep,R&&R.propDep||O&&O.propDep,function(m,I){var D=m.shared.shader,W;R?W=R.append(m,I):W=I.def(D,".",Fi);var K;O?K=O.append(m,I):K=I.def(D,".",Di);var H=D+".program("+K+","+W;return y.optional(function(){H+=","+m.command}),I.def(H+")")}),{frag:R,vert:O,progVar:S,program:E}}function ht(_,h){var w=_.static,P=_.dynamic;function k(){if(Cn in w){var m=w[Cn];to(m)?m=G.getElements(G.create(m,!0)):m&&(m=G.getElements(m),y.command(m,"invalid elements",h.commandStr));var I=Ut(function(W,K){if(m){var H=W.link(m);return W.ELEMENTS=H,H}return W.ELEMENTS=null,null});return I.value=m,I}else if(Cn in P){var D=P[Cn];return yr(D,function(W,K){var H=W.shared,ce=H.isBufferArgs,Oe=H.elements,Je=W.invoke(K,D),Ce=K.def("null"),Fe=K.def(ce,"(",Je,")"),Ye=W.cond(Fe).then(Ce,"=",Oe,".createStream(",Je,");").else(Ce,"=",Oe,".getElements(",Je,");");return y.optional(function(){W.assert(Ye.else,"!"+Je+"||"+Ce,"invalid elements")}),K.entry(Ye),K.exit(W.cond(Fe).then(Oe,".destroyStream(",Ce,");")),W.ELEMENTS=Ce,Ce})}return null}var N=k();function R(){if(xn in w){var m=w[xn];return y.commandParameter(m,Kn,"invalid primitve",h.commandStr),Ut(function(D,W){return Kn[m]})}else if(xn in P){var I=P[xn];return yr(I,function(D,W){var K=D.constants.primTypes,H=D.invoke(W,I);return y.optional(function(){D.assert(W,H+" in "+K,"invalid primitive, must be one of "+Object.keys(Kn))}),W.def(K,"[",H,"]")})}else if(N)return fn(N)?N.value?Ut(function(D,W){return W.def(D.ELEMENTS,".primType")}):Ut(function(){return Af}):new dr(N.thisDep,N.contextDep,N.propDep,function(D,W){var K=D.ELEMENTS;return W.def(K,"?",K,".primType:",Af)});return null}function O(m,I){if(m in w){var D=w[m]|0;return y.command(!I||D>=0,"invalid "+m,h.commandStr),Ut(function(K,H){return I&&(K.OFFSET=D),D})}else if(m in P){var W=P[m];return yr(W,function(K,H){var ce=K.invoke(H,W);return I&&(K.OFFSET=ce,y.optional(function(){K.assert(H,ce+">=0","invalid "+m)})),ce})}else if(I&&N)return Ut(function(K,H){return K.OFFSET="0",0});return null}var E=O(za,!0);function S(){if(Nn in w){var m=w[Nn]|0;return y.command(typeof m=="number"&&m>=0,"invalid vertex count",h.commandStr),Ut(function(){return m})}else if(Nn in P){var I=P[Nn];return yr(I,function(K,H){var ce=K.invoke(H,I);return y.optional(function(){K.assert(H,"typeof "+ce+'==="number"&&'+ce+">=0&&"+ce+"===("+ce+"|0)","invalid vertex count")}),ce})}else if(N)if(fn(N)){if(N)return E?new dr(E.thisDep,E.contextDep,E.propDep,function(K,H){var ce=H.def(K.ELEMENTS,".vertCount-",K.OFFSET);return y.optional(function(){K.assert(H,ce+">=0","invalid vertex offset/element buffer too small")}),ce}):Ut(function(K,H){return H.def(K.ELEMENTS,".vertCount")});var D=Ut(function(){return-1});return y.optional(function(){D.MISSING=!0}),D}else{var W=new dr(N.thisDep||E.thisDep,N.contextDep||E.contextDep,N.propDep||E.propDep,function(K,H){var ce=K.ELEMENTS;return K.OFFSET?H.def(ce,"?",ce,".vertCount-",K.OFFSET,":-1"):H.def(ce,"?",ce,".vertCount:-1")});return y.optional(function(){W.DYNAMIC=!0}),W}return null}return{elements:N,primitive:R(),count:S(),instances:O(Ha,!1),offset:E}}function $t(_,h){var w=_.static,P=_.dynamic,k={};return te.forEach(function(N){var R=ye(N);function O(E,S){if(N in w){var m=E(w[N]);k[R]=Ut(function(){return m})}else if(N in P){var I=P[N];k[R]=yr(I,function(D,W){return S(D,W,D.invoke(W,I))})}}switch(N){case lf:case af:case nf:case mf:case sf:case _f:case hf:case vf:case pf:case ff:return O(function(E){return y.commandType(E,"boolean",N,h.commandStr),E},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="boolean"',"invalid flag "+N,E.commandStr)}),m});case uf:return O(function(E){return y.commandParameter(E,li,"invalid "+N,h.commandStr),li[E]},function(E,S,m){var I=E.constants.compareFuncs;return y.optional(function(){E.assert(S,m+" in "+I,"invalid "+N+", must be one of "+Object.keys(li))}),S.def(I,"[",m,"]")});case cf:return O(function(E){return y.command(kt(E)&&E.length===2&&typeof E[0]=="number"&&typeof E[1]=="number"&&E[0]<=E[1],"depth range is 2d array",h.commandStr),E},function(E,S,m){y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===2&&typeof "+m+'[0]==="number"&&typeof '+m+'[1]==="number"&&'+m+"[0]<="+m+"[1]","depth range must be a 2d array")});var I=S.def("+",m,"[0]"),D=S.def("+",m,"[1]");return[I,D]});case Ts:return O(function(E){y.commandType(E,"object","blend.func",h.commandStr);var S="srcRGB"in E?E.srcRGB:E.src,m="srcAlpha"in E?E.srcAlpha:E.src,I="dstRGB"in E?E.dstRGB:E.dst,D="dstAlpha"in E?E.dstAlpha:E.dst;return y.commandParameter(S,Dr,R+".srcRGB",h.commandStr),y.commandParameter(m,Dr,R+".srcAlpha",h.commandStr),y.commandParameter(I,Dr,R+".dstRGB",h.commandStr),y.commandParameter(D,Dr,R+".dstAlpha",h.commandStr),y.command(Nf.indexOf(S+", "+I)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+S+", "+I+")",h.commandStr),[Dr[S],Dr[I],Dr[m],Dr[D]]},function(E,S,m){var I=E.constants.blendFuncs;y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid blend func, must be an object")});function D(Ce,Fe){var Ye=S.def('"',Ce,Fe,'" in ',m,"?",m,".",Ce,Fe,":",m,".",Ce);return y.optional(function(){E.assert(S,Ye+" in "+I,"invalid "+N+"."+Ce+Fe+", must be one of "+Object.keys(Dr))}),Ye}var W=D("src","RGB"),K=D("dst","RGB");y.optional(function(){var Ce=E.constants.invalidBlendCombinations;E.assert(S,Ce+".indexOf("+W+'+", "+'+K+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var H=S.def(I,"[",W,"]"),ce=S.def(I,"[",D("src","Alpha"),"]"),Oe=S.def(I,"[",K,"]"),Je=S.def(I,"[",D("dst","Alpha"),"]");return[H,Oe,ce,Je]});case gs:return O(function(E){if(typeof E=="string")return y.commandParameter(E,j,"invalid "+N,h.commandStr),[j[E],j[E]];if(typeof E=="object")return y.commandParameter(E.rgb,j,N+".rgb",h.commandStr),y.commandParameter(E.alpha,j,N+".alpha",h.commandStr),[j[E.rgb],j[E.alpha]];y.commandRaise("invalid blend.equation",h.commandStr)},function(E,S,m){var I=E.constants.blendEquations,D=S.def(),W=S.def(),K=E.cond("typeof ",m,'==="string"');return y.optional(function(){function H(ce,Oe,Je){E.assert(ce,Je+" in "+I,"invalid "+Oe+", must be one of "+Object.keys(j))}H(K.then,N,m),E.assert(K.else,m+"&&typeof "+m+'==="object"',"invalid "+N),H(K.else,N+".rgb",m+".rgb"),H(K.else,N+".alpha",m+".alpha")}),K.then(D,"=",W,"=",I,"[",m,"];"),K.else(D,"=",I,"[",m,".rgb];",W,"=",I,"[",m,".alpha];"),S(K),[D,W]});case of:return O(function(E){return y.command(kt(E)&&E.length===4,"blend.color must be a 4d array",h.commandStr),mr(4,function(S){return+E[S]})},function(E,S,m){return y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===4","blend.color must be a 4d array")}),mr(4,function(I){return S.def("+",m,"[",I,"]")})});case yf:return O(function(E){return y.commandType(E,"number",R,h.commandStr),E|0},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="number"',"invalid stencil.mask")}),S.def(m,"|0")});case xs:return O(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.cmp||"keep",m=E.ref||0,I="mask"in E?E.mask:-1;return y.commandParameter(S,li,N+".cmp",h.commandStr),y.commandType(m,"number",N+".ref",h.commandStr),y.commandType(I,"number",N+".mask",h.commandStr),[li[S],m,I]},function(E,S,m){var I=E.constants.compareFuncs;y.optional(function(){function H(){E.assert(S,Array.prototype.join.call(arguments,""),"invalid stencil.func")}H(m+"&&typeof ",m,'==="object"'),H('!("cmp" in ',m,")||(",m,".cmp in ",I,")")});var D=S.def('"cmp" in ',m,"?",I,"[",m,".cmp]",":",un),W=S.def(m,".ref|0"),K=S.def('"mask" in ',m,"?",m,".mask|0:-1");return[D,W,K]});case Ns:case Mi:return O(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.fail||"keep",m=E.zfail||"keep",I=E.zpass||"keep";return y.commandParameter(S,cn,N+".fail",h.commandStr),y.commandParameter(m,cn,N+".zfail",h.commandStr),y.commandParameter(I,cn,N+".zpass",h.commandStr),[N===Mi?On:zi,cn[S],cn[m],cn[I]]},function(E,S,m){var I=E.constants.stencilOps;y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid "+N)});function D(W){return y.optional(function(){E.assert(S,'!("'+W+'" in '+m+")||("+m+"."+W+" in "+I+")","invalid "+N+"."+W+", must be one of "+Object.keys(cn))}),S.def('"',W,'" in ',m,"?",I,"[",m,".",W,"]:",un)}return[N===Mi?On:zi,D("fail"),D("zfail"),D("zpass")]});case Rs:return O(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.factor|0,m=E.units|0;return y.commandType(S,"number",R+".factor",h.commandStr),y.commandType(m,"number",R+".units",h.commandStr),[S,m]},function(E,S,m){y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid "+N)});var I=S.def(m,".factor|0"),D=S.def(m,".units|0");return[I,D]});case df:return O(function(E){var S=0;return E==="front"?S=zi:E==="back"&&(S=On),y.command(!!S,R,h.commandStr),S},function(E,S,m){return y.optional(function(){E.assert(S,m+'==="front"||'+m+'==="back"',"invalid cull.face")}),S.def(m,'==="front"?',zi,":",On)});case ws:return O(function(E){return y.command(typeof E=="number"&&E>=B.lineWidthDims[0]&&E<=B.lineWidthDims[1],"invalid line width, must be a positive number between "+B.lineWidthDims[0]+" and "+B.lineWidthDims[1],h.commandStr),E},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="number"&&'+m+">="+B.lineWidthDims[0]+"&&"+m+"<="+B.lineWidthDims[1],"invalid line width")}),m});case Ss:return O(function(E){return y.commandParameter(E,Ds,R,h.commandStr),Ds[E]},function(E,S,m){return y.optional(function(){E.assert(S,m+'==="cw"||'+m+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),S.def(m+'==="cw"?'+Sf+":"+ks)});case As:return O(function(E){return y.command(kt(E)&&E.length===4,"color.mask must be length 4 array",h.commandStr),E.map(function(S){return!!S})},function(E,S,m){return y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===4","invalid color.mask")}),mr(4,function(I){return"!!"+m+"["+I+"]"})});case Cs:return O(function(E){y.command(typeof E=="object"&&E,R,h.commandStr);var S="value"in E?E.value:1,m=!!E.invert;return y.command(typeof S=="number"&&S>=0&&S<=1,"sample.coverage.value must be a number between 0 and 1",h.commandStr),[S,m]},function(E,S,m){y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid sample.coverage")});var I=S.def('"value" in ',m,"?+",m,".value:1"),D=S.def("!!",m,".invert");return[I,D]})}}),k}function Qt(_,h){var w=_.static,P=_.dynamic,k={};return Object.keys(w).forEach(function(N){var R=w[N],O;if(typeof R=="number"||typeof R=="boolean")O=Ut(function(){return R});else if(typeof R=="function"){var E=R._reglType;E==="texture2d"||E==="textureCube"?O=Ut(function(S){return S.link(R)}):E==="framebuffer"||E==="framebufferCube"?(y.command(R.color.length>0,'missing color attachment for framebuffer sent to uniform "'+N+'"',h.commandStr),O=Ut(function(S){return S.link(R.color[0])})):y.commandRaise('invalid data for uniform "'+N+'"',h.commandStr)}else kt(R)?O=Ut(function(S){var m=S.global.def("[",mr(R.length,function(I){return y.command(typeof R[I]=="number"||typeof R[I]=="boolean","invalid uniform "+N,S.commandStr),R[I]}),"]");return m}):y.commandRaise('invalid or missing data for uniform "'+N+'"',h.commandStr);O.value=R,k[N]=O}),Object.keys(P).forEach(function(N){var R=P[N];k[N]=yr(R,function(O,E){return O.invoke(E,R)})}),k}function ut(_,h){var w=_.static,P=_.dynamic,k={};return Object.keys(w).forEach(function(N){var R=w[N],O=p.id(N),E=new L;if(to(R))E.state=si,E.buffer=q.getBuffer(q.create(R,fi,!1,!0)),E.type=0;else{var S=q.getBuffer(R);if(S)E.state=si,E.buffer=S,E.type=0;else if(y.command(typeof R=="object"&&R,"invalid data for attribute "+N,h.commandStr),"constant"in R){var m=R.constant;E.buffer="null",E.state=ms,typeof m=="number"?E.x=m:(y.command(kt(m)&&m.length>0&&m.length<=4,"invalid constant for attribute "+N,h.commandStr),oi.forEach(function(Oe,Je){Je<m.length&&(E[Oe]=m[Je])}))}else{to(R.buffer)?S=q.getBuffer(q.create(R.buffer,fi,!1,!0)):S=q.getBuffer(R.buffer),y.command(!!S,'missing buffer for attribute "'+N+'"',h.commandStr);var I=R.offset|0;y.command(I>=0,'invalid offset for attribute "'+N+'"',h.commandStr);var D=R.stride|0;y.command(D>=0&&D<256,'invalid stride for attribute "'+N+'", must be integer betweeen [0, 255]',h.commandStr);var W=R.size|0;y.command(!("size"in R)||W>0&&W<=4,'invalid size for attribute "'+N+'", must be 1,2,3,4',h.commandStr);var K=!!R.normalized,H=0;"type"in R&&(y.commandParameter(R.type,gn,"invalid type for attribute "+N,h.commandStr),H=gn[R.type]);var ce=R.divisor|0;"divisor"in R&&(y.command(ce===0||fe,'cannot specify divisor for attribute "'+N+'", instancing not supported',h.commandStr),y.command(ce>=0,'invalid divisor for attribute "'+N+'"',h.commandStr)),y.optional(function(){var Oe=h.commandStr,Je=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(R).forEach(function(Ce){y.command(Je.indexOf(Ce)>=0,'unknown parameter "'+Ce+'" for attribute pointer "'+N+'" (valid parameters are '+Je+")",Oe)})}),E.buffer=S,E.state=si,E.size=W,E.normalized=K,E.type=H||S.dtype,E.offset=I,E.stride=D,E.divisor=ce}}k[N]=Ut(function(Oe,Je){var Ce=Oe.attribCache;if(O in Ce)return Ce[O];var Fe={isStream:!1};return Object.keys(E).forEach(function(Ye){Fe[Ye]=E[Ye]}),E.buffer&&(Fe.buffer=Oe.link(E.buffer),Fe.type=Fe.type||Fe.buffer+".dtype"),Ce[O]=Fe,Fe})}),Object.keys(P).forEach(function(N){var R=P[N];function O(E,S){var m=E.invoke(S,R),I=E.shared,D=E.constants,W=I.isBufferArgs,K=I.buffer;y.optional(function(){E.assert(S,m+"&&(typeof "+m+'==="object"||typeof '+m+'==="function")&&('+W+"("+m+")||"+K+".getBuffer("+m+")||"+K+".getBuffer("+m+".buffer)||"+W+"("+m+'.buffer)||("constant" in '+m+"&&(typeof "+m+'.constant==="number"||'+I.isArrayLike+"("+m+".constant))))",'invalid dynamic attribute "'+N+'"')});var H={isStream:S.def(!1)},ce=new L;ce.state=si,Object.keys(ce).forEach(function(Fe){H[Fe]=S.def(""+ce[Fe])});var Oe=H.buffer,Je=H.type;S("if(",W,"(",m,")){",H.isStream,"=true;",Oe,"=",K,".createStream(",fi,",",m,");",Je,"=",Oe,".dtype;","}else{",Oe,"=",K,".getBuffer(",m,");","if(",Oe,"){",Je,"=",Oe,".dtype;",'}else if("constant" in ',m,"){",H.state,"=",ms,";","if(typeof "+m+'.constant === "number"){',H[oi[0]],"=",m,".constant;",oi.slice(1).map(function(Fe){return H[Fe]}).join("="),"=0;","}else{",oi.map(function(Fe,Ye){return H[Fe]+"="+m+".constant.length>"+Ye+"?"+m+".constant["+Ye+"]:0;"}).join(""),"}}else{","if(",W,"(",m,".buffer)){",Oe,"=",K,".createStream(",fi,",",m,".buffer);","}else{",Oe,"=",K,".getBuffer(",m,".buffer);","}",Je,'="type" in ',m,"?",D.glTypes,"[",m,".type]:",Oe,".dtype;",H.normalized,"=!!",m,".normalized;");function Ce(Fe){S(H[Fe],"=",m,".",Fe,"|0;")}return Ce("size"),Ce("offset"),Ce("stride"),Ce("divisor"),S("}}"),S.exit("if(",H.isStream,"){",K,".destroyStream(",Oe,");","}"),H}k[N]=yr(R,O)}),k}function zt(_,h){var w=_.static,P=_.dynamic;if(Gi in w){var k=w[Gi];return k!==null&&le.getVAO(k)===null&&(k=le.createVAO(k)),Ut(function(R){return R.link(le.getVAO(k))})}else if(Gi in P){var N=P[Gi];return yr(N,function(R,O){var E=R.invoke(O,N);return O.def(R.shared.vao+".getVAO("+E+")")})}return null}function xt(_){var h=_.static,w=_.dynamic,P={};return Object.keys(h).forEach(function(k){var N=h[k];P[k]=Ut(function(R,O){return typeof N=="number"||typeof N=="boolean"?""+N:R.link(N)})}),Object.keys(w).forEach(function(k){var N=w[k];P[k]=yr(N,function(R,O){return R.invoke(O,N)})}),P}function Vt(_,h,w,P,k){var N=_.static,R=_.dynamic;y.optional(function(){var Ce=[Rn,Di,Fi,Cn,xn,za,Nn,Ha,ki,Gi].concat(te);function Fe(Ye){Object.keys(Ye).forEach(function(vt){y.command(Ce.indexOf(vt)>=0,'unknown parameter "'+vt+'"',k.commandStr)})}Fe(N),Fe(R)});var O=We(_,h),E=Re(_),S=it(_,E,k),m=ht(_,k),I=$t(_,k),D=rt(_,k,O);function W(Ce){var Fe=S[Ce];Fe&&(I[Ce]=Fe)}W(Xr),W(ye(ja));var K=Object.keys(I).length>0,H={framebuffer:E,draw:m,shader:D,state:I,dirty:K,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(H.profile=Qe(_),H.uniforms=Qt(w,k),H.drawVAO=H.scopeVAO=zt(_),!H.drawVAO&&D.program&&!O&&A.angle_instanced_arrays){var ce=!0,Oe=D.program.attributes.map(function(Ce){var Fe=h.static[Ce];return ce=ce&&!!Fe,Fe});if(ce&&Oe.length>0){var Je=le.getVAO(le.createVAO(Oe));H.drawVAO=new dr(null,null,null,function(Ce,Fe){return Ce.link(Je)}),H.useVAO=!0}}return O?H.useVAO=!0:H.attributes=ut(h,k),H.context=xt(P),H}function Ht(_,h,w){var P=_.shared,k=P.context,N=_.scope();Object.keys(w).forEach(function(R){h.save(k,"."+R);var O=w[R],E=O.append(_,h);Array.isArray(E)?N(k,".",R,"=[",E.join(),"];"):N(k,".",R,"=",E,";")}),h(N)}function Xt(_,h,w,P){var k=_.shared,N=k.gl,R=k.framebuffer,O;Te&&(O=h.def(k.extensions,".webgl_draw_buffers"));var E=_.constants,S=E.drawBuffer,m=E.backBuffer,I;w?I=w.append(_,h):I=h.def(R,".next"),P||h("if(",I,"!==",R,".cur){"),h("if(",I,"){",N,".bindFramebuffer(",xf,",",I,".framebuffer);"),Te&&h(O,".drawBuffersWEBGL(",S,"[",I,".colorAttachments.length]);"),h("}else{",N,".bindFramebuffer(",xf,",null);"),Te&&h(O,".drawBuffersWEBGL(",m,");"),h("}",R,".cur=",I,";"),P||h("}")}function Zt(_,h,w){var P=_.shared,k=P.gl,N=_.current,R=_.next,O=P.current,E=P.next,S=_.cond(O,".dirty");te.forEach(function(m){var I=ye(m);if(!(I in w.state)){var D,W;if(I in R){D=R[I],W=N[I];var K=mr(J[I].length,function(ce){return S.def(D,"[",ce,"]")});S(_.cond(K.map(function(ce,Oe){return ce+"!=="+W+"["+Oe+"]"}).join("||")).then(k,".",ee[I],"(",K,");",K.map(function(ce,Oe){return W+"["+Oe+"]="+ce}).join(";"),";"))}else{D=S.def(E,".",I);var H=_.cond(D,"!==",O,".",I);S(H),I in me?H(_.cond(D).then(k,".enable(",me[I],");").else(k,".disable(",me[I],");"),O,".",I,"=",D,";"):H(k,".",ee[I],"(",D,");",O,".",I,"=",D,";")}}}),Object.keys(w.state).length===0&&S(O,".dirty=false;"),h(S)}function tr(_,h,w,P){var k=_.shared,N=_.current,R=k.current,O=k.gl;If(Object.keys(w)).forEach(function(E){var S=w[E];if(!(P&&!P(S))){var m=S.append(_,h);if(me[E]){var I=me[E];fn(S)?m?h(O,".enable(",I,");"):h(O,".disable(",I,");"):h(_.cond(m).then(O,".enable(",I,");").else(O,".disable(",I,");")),h(R,".",E,"=",m,";")}else if(kt(m)){var D=N[E];h(O,".",ee[E],"(",m,");",m.map(function(W,K){return D+"["+K+"]="+W}).join(";"),";")}else h(O,".",ee[E],"(",m,");",R,".",E,"=",m,";")}})}function Dt(_,h){fe&&(_.instancing=h.def(_.shared.extensions,".angle_instanced_arrays"))}function Ze(_,h,w,P,k){var N=_.shared,R=_.stats,O=N.current,E=N.timer,S=w.profile;function m(){return typeof performance>"u"?"Date.now()":"performance.now()"}var I,D;function W(Ce){I=h.def(),Ce(I,"=",m(),";"),typeof k=="string"?Ce(R,".count+=",k,";"):Ce(R,".count++;"),ie&&(P?(D=h.def(),Ce(D,"=",E,".getNumPendingQueries();")):Ce(E,".beginQuery(",R,");"))}function K(Ce){Ce(R,".cpuTime+=",m(),"-",I,";"),ie&&(P?Ce(E,".pushScopeStats(",D,",",E,".getNumPendingQueries(),",R,");"):Ce(E,".endQuery();"))}function H(Ce){var Fe=h.def(O,".profile");h(O,".profile=",Ce,";"),h.exit(O,".profile=",Fe,";")}var ce;if(S){if(fn(S)){S.enable?(W(h),K(h.exit),H("true")):H("false");return}ce=S.append(_,h),H(ce)}else ce=h.def(O,".profile");var Oe=_.block();W(Oe),h("if(",ce,"){",Oe,"}");var Je=_.block();K(Je),h.exit("if(",ce,"){",Je,"}")}function rr(_,h,w,P,k){var N=_.shared;function R(E){switch(E){case Xa:case qa:case Za:return 2;case Wa:case Ka:case Ja:return 3;case Ya:case Qa:case eo:return 4;default:return 1}}function O(E,S,m){var I=N.gl,D=h.def(E,".location"),W=h.def(N.attributes,"[",D,"]"),K=m.state,H=m.buffer,ce=[m.x,m.y,m.z,m.w],Oe=["buffer","normalized","offset","stride"];function Je(){h("if(!",W,".buffer){",I,".enableVertexAttribArray(",D,");}");var Fe=m.type,Ye;if(m.size?Ye=h.def(m.size,"||",S):Ye=S,h("if(",W,".type!==",Fe,"||",W,".size!==",Ye,"||",Oe.map(function(Pt){return W+"."+Pt+"!=="+m[Pt]}).join("||"),"){",I,".bindBuffer(",fi,",",H,".buffer);",I,".vertexAttribPointer(",[D,Ye,Fe,m.normalized,m.stride,m.offset],");",W,".type=",Fe,";",W,".size=",Ye,";",Oe.map(function(Pt){return W+"."+Pt+"="+m[Pt]+";"}).join(""),"}"),fe){var vt=m.divisor;h("if(",W,".divisor!==",vt,"){",_.instancing,".vertexAttribDivisorANGLE(",[D,vt],");",W,".divisor=",vt,";}")}}function Ce(){h("if(",W,".buffer){",I,".disableVertexAttribArray(",D,");",W,".buffer=null;","}if(",oi.map(function(Fe,Ye){return W+"."+Fe+"!=="+ce[Ye]}).join("||"),"){",I,".vertexAttrib4f(",D,",",ce,");",oi.map(function(Fe,Ye){return W+"."+Fe+"="+ce[Ye]+";"}).join(""),"}")}K===si?Je():K===ms?Ce():(h("if(",K,"===",si,"){"),Je(),h("}else{"),Ce(),h("}"))}P.forEach(function(E){var S=E.name,m=w.attributes[S],I;if(m){if(!k(m))return;I=m.append(_,h)}else{if(!k(Pf))return;var D=_.scopeAttrib(S);y.optional(function(){_.assert(h,D+".state","missing attribute "+S)}),I={},Object.keys(new L).forEach(function(W){I[W]=h.def(D,".",W)})}O(_.link(E),R(E.info.type),I)})}function yt(_,h,w,P,k){for(var N=_.shared,R=N.gl,O,E=0;E<P.length;++E){var S=P[E],m=S.name,I=S.info.type,D=w.uniforms[m],W=_.link(S),K=W+".location",H;if(D){if(!k(D))continue;if(fn(D)){var ce=D.value;if(y.command(ce!==null&&typeof ce<"u",'missing uniform "'+m+'"',_.commandStr),I===Vi||I===ji){y.command(typeof ce=="function"&&(I===Vi&&(ce._reglType==="texture2d"||ce._reglType==="framebuffer")||I===ji&&(ce._reglType==="textureCube"||ce._reglType==="framebufferCube")),"invalid texture for uniform "+m,_.commandStr);var Oe=_.link(ce._texture||ce.color[0]._texture);h(R,".uniform1i(",K,",",Oe+".bind());"),h.exit(Oe,".unbind();")}else if(I===Bi||I===Ui||I===$i){y.optional(function(){y.command(kt(ce),"invalid matrix for uniform "+m,_.commandStr),y.command(I===Bi&&ce.length===4||I===Ui&&ce.length===9||I===$i&&ce.length===16,"invalid length for matrix uniform "+m,_.commandStr)});var Je=_.global.def("new Float32Array(["+Array.prototype.slice.call(ce)+"])"),Ce=2;I===Ui?Ce=3:I===$i&&(Ce=4),h(R,".uniformMatrix",Ce,"fv(",K,",false,",Je,");")}else{switch(I){case Ps:y.commandType(ce,"number","uniform "+m,_.commandStr),O="1f";break;case Xa:y.command(kt(ce)&&ce.length===2,"uniform "+m,_.commandStr),O="2f";break;case Wa:y.command(kt(ce)&&ce.length===3,"uniform "+m,_.commandStr),O="3f";break;case Ya:y.command(kt(ce)&&ce.length===4,"uniform "+m,_.commandStr),O="4f";break;case Ms:y.commandType(ce,"boolean","uniform "+m,_.commandStr),O="1i";break;case Ls:y.commandType(ce,"number","uniform "+m,_.commandStr),O="1i";break;case Za:y.command(kt(ce)&&ce.length===2,"uniform "+m,_.commandStr),O="2i";break;case qa:y.command(kt(ce)&&ce.length===2,"uniform "+m,_.commandStr),O="2i";break;case Ja:y.command(kt(ce)&&ce.length===3,"uniform "+m,_.commandStr),O="3i";break;case Ka:y.command(kt(ce)&&ce.length===3,"uniform "+m,_.commandStr),O="3i";break;case eo:y.command(kt(ce)&&ce.length===4,"uniform "+m,_.commandStr),O="4i";break;case Qa:y.command(kt(ce)&&ce.length===4,"uniform "+m,_.commandStr),O="4i";break}h(R,".uniform",O,"(",K,",",kt(ce)?Array.prototype.slice.call(ce):ce,");")}continue}else H=D.append(_,h)}else{if(!k(Pf))continue;H=h.def(N.uniforms,"[",p.id(m),"]")}I===Vi?(y(!Array.isArray(H),"must specify a scalar prop for textures"),h("if(",H,"&&",H,'._reglType==="framebuffer"){',H,"=",H,".color[0];","}")):I===ji&&(y(!Array.isArray(H),"must specify a scalar prop for cube maps"),h("if(",H,"&&",H,'._reglType==="framebufferCube"){',H,"=",H,".color[0];","}")),y.optional(function(){function hr(Ir,Bf){_.assert(h,Ir,'bad data or missing for uniform "'+m+'".  '+Bf)}function Fs(Ir){y(!Array.isArray(H),"must not specify an array type for uniform"),hr("typeof "+H+'==="'+Ir+'"',"invalid type, expected "+Ir)}function Tr(Ir,Bf){Array.isArray(H)?y(H.length===Ir,"must have length "+Ir):hr(N.isArrayLike+"("+H+")&&"+H+".length==="+Ir,"invalid vector, should have length "+Ir,_.commandStr)}function Gf(Ir){y(!Array.isArray(H),"must not specify a value type"),hr("typeof "+H+'==="function"&&'+H+'._reglType==="texture'+(Ir===Tf?"2d":"Cube")+'"',"invalid texture type",_.commandStr)}switch(I){case Ls:Fs("number");break;case qa:Tr(2);break;case Ka:Tr(3);break;case Qa:Tr(4);break;case Ps:Fs("number");break;case Xa:Tr(2);break;case Wa:Tr(3);break;case Ya:Tr(4);break;case Ms:Fs("boolean");break;case Za:Tr(2);break;case Ja:Tr(3);break;case eo:Tr(4);break;case Bi:Tr(4);break;case Ui:Tr(9);break;case $i:Tr(16);break;case Vi:Gf(Tf);break;case ji:Gf(BE);break}});var Fe=1;switch(I){case Vi:case ji:var Ye=h.def(H,"._texture");h(R,".uniform1i(",K,",",Ye,".bind());"),h.exit(Ye,".unbind();");continue;case Ls:case Ms:O="1i";break;case qa:case Za:O="2i",Fe=2;break;case Ka:case Ja:O="3i",Fe=3;break;case Qa:case eo:O="4i",Fe=4;break;case Ps:O="1f";break;case Xa:O="2f",Fe=2;break;case Wa:O="3f",Fe=3;break;case Ya:O="4f",Fe=4;break;case Bi:O="Matrix2fv";break;case Ui:O="Matrix3fv";break;case $i:O="Matrix4fv";break}if(h(R,".uniform",O,"(",K,","),O.charAt(0)==="M"){var vt=Math.pow(I-Bi+2,2),Pt=_.global.def("new Float32Array(",vt,")");Array.isArray(H)?h("false,(",mr(vt,function(hr){return Pt+"["+hr+"]="+H[hr]}),",",Pt,")"):h("false,(Array.isArray(",H,")||",H," instanceof Float32Array)?",H,":(",mr(vt,function(hr){return Pt+"["+hr+"]="+H+"["+hr+"]"}),",",Pt,")")}else Fe>1?h(mr(Fe,function(hr){return Array.isArray(H)?H[hr]:H+"["+hr+"]"})):(y(!Array.isArray(H),"uniform value must not be an array"),h(H));h(");")}}function ke(_,h,w,P){var k=_.shared,N=k.gl,R=k.draw,O=P.draw;function E(){var Ye=O.elements,vt,Pt=h;return Ye?((Ye.contextDep&&P.contextDynamic||Ye.propDep)&&(Pt=w),vt=Ye.append(_,Pt)):vt=Pt.def(R,".",Cn),vt&&Pt("if("+vt+")"+N+".bindBuffer("+DE+","+vt+".buffer.buffer);"),vt}function S(){var Ye=O.count,vt,Pt=h;return Ye?((Ye.contextDep&&P.contextDynamic||Ye.propDep)&&(Pt=w),vt=Ye.append(_,Pt),y.optional(function(){Ye.MISSING&&_.assert(h,"false","missing vertex count"),Ye.DYNAMIC&&_.assert(Pt,vt+">=0","missing vertex count")})):(vt=Pt.def(R,".",Nn),y.optional(function(){_.assert(Pt,vt+">=0","missing vertex count")})),vt}var m=E();function I(Ye){var vt=O[Ye];return vt?vt.contextDep&&P.contextDynamic||vt.propDep?vt.append(_,w):vt.append(_,h):h.def(R,".",Ye)}var D=I(xn),W=I(za),K=S();if(typeof K=="number"){if(K===0)return}else w("if(",K,"){"),w.exit("}");var H,ce;fe&&(H=I(Ha),ce=_.instancing);var Oe=m+".type",Je=O.elements&&fn(O.elements);function Ce(){function Ye(){w(ce,".drawElementsInstancedANGLE(",[D,K,Oe,W+"<<(("+Oe+"-"+ef+")>>1)",H],");")}function vt(){w(ce,".drawArraysInstancedANGLE(",[D,W,K,H],");")}m?Je?Ye():(w("if(",m,"){"),Ye(),w("}else{"),vt(),w("}")):vt()}function Fe(){function Ye(){w(N+".drawElements("+[D,K,Oe,W+"<<(("+Oe+"-"+ef+")>>1)"]+");")}function vt(){w(N+".drawArrays("+[D,W,K]+");")}m?Je?Ye():(w("if(",m,"){"),Ye(),w("}else{"),vt(),w("}")):vt()}fe&&(typeof H!="number"||H>=0)?typeof H=="string"?(w("if(",H,">0){"),Ce(),w("}else if(",H,"<0){"),Fe(),w("}")):Ce():Fe()}function ot(_,h,w,P,k){var N=je(),R=N.proc("body",k);return y.optional(function(){N.commandStr=h.commandStr,N.command=N.link(h.commandStr)}),fe&&(N.instancing=R.def(N.shared.extensions,".angle_instanced_arrays")),_(N,R,w,P),N.compile().body}function dt(_,h,w,P){Dt(_,h),w.useVAO?w.drawVAO?h(_.shared.vao,".setVAO(",w.drawVAO.append(_,h),");"):h(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(h(_.shared.vao,".setVAO(null);"),rr(_,h,w,P.attributes,function(){return!0})),yt(_,h,w,P.uniforms,function(){return!0}),ke(_,h,h,w)}function Ft(_,h){var w=_.proc("draw",1);Dt(_,w),Ht(_,w,h.context),Xt(_,w,h.framebuffer),Zt(_,w,h),tr(_,w,h.state),Ze(_,w,h,!1,!0);var P=h.shader.progVar.append(_,w);if(w(_.shared.gl,".useProgram(",P,".program);"),h.shader.program)dt(_,w,h,h.shader.program);else{w(_.shared.vao,".setVAO(null);");var k=_.global.def("{}"),N=w.def(P,".id"),R=w.def(k,"[",N,"]");w(_.cond(R).then(R,".call(this,a0);").else(R,"=",k,"[",N,"]=",_.link(function(O){return ot(dt,_,h,O,1)}),"(",P,");",R,".call(this,a0);"))}Object.keys(h.state).length>0&&w(_.shared.current,".dirty=true;")}function Fr(_,h,w,P){_.batchId="a1",Dt(_,h);function k(){return!0}rr(_,h,w,P.attributes,k),yt(_,h,w,P.uniforms,k),ke(_,h,h,w)}function In(_,h,w,P){Dt(_,h);var k=w.contextDep,N=h.def(),R="a0",O="a1",E=h.def();_.shared.props=E,_.batchId=N;var S=_.scope(),m=_.scope();h(S.entry,"for(",N,"=0;",N,"<",O,";++",N,"){",E,"=",R,"[",N,"];",m,"}",S.exit);function I(Oe){return Oe.contextDep&&k||Oe.propDep}function D(Oe){return!I(Oe)}if(w.needsContext&&Ht(_,m,w.context),w.needsFramebuffer&&Xt(_,m,w.framebuffer),tr(_,m,w.state,I),w.profile&&I(w.profile)&&Ze(_,m,w,!1,!0),P)w.useVAO?w.drawVAO?I(w.drawVAO)?m(_.shared.vao,".setVAO(",w.drawVAO.append(_,m),");"):S(_.shared.vao,".setVAO(",w.drawVAO.append(_,S),");"):S(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(S(_.shared.vao,".setVAO(null);"),rr(_,S,w,P.attributes,D),rr(_,m,w,P.attributes,I)),yt(_,S,w,P.uniforms,D),yt(_,m,w,P.uniforms,I),ke(_,S,m,w);else{var W=_.global.def("{}"),K=w.shader.progVar.append(_,m),H=m.def(K,".id"),ce=m.def(W,"[",H,"]");m(_.shared.gl,".useProgram(",K,".program);","if(!",ce,"){",ce,"=",W,"[",H,"]=",_.link(function(Oe){return ot(Fr,_,w,Oe,2)}),"(",K,");}",ce,".call(this,a0[",N,"],",N,");")}}function b(_,h){var w=_.proc("batch",2);_.batchId="0",Dt(_,w);var P=!1,k=!0;Object.keys(h.context).forEach(function(W){P=P||h.context[W].propDep}),P||(Ht(_,w,h.context),k=!1);var N=h.framebuffer,R=!1;N?(N.propDep?P=R=!0:N.contextDep&&P&&(R=!0),R||Xt(_,w,N)):Xt(_,w,null),h.state.viewport&&h.state.viewport.propDep&&(P=!0);function O(W){return W.contextDep&&P||W.propDep}Zt(_,w,h),tr(_,w,h.state,function(W){return!O(W)}),(!h.profile||!O(h.profile))&&Ze(_,w,h,!1,"a1"),h.contextDep=P,h.needsContext=k,h.needsFramebuffer=R;var E=h.shader.progVar;if(E.contextDep&&P||E.propDep)In(_,w,h,null);else{var S=E.append(_,w);if(w(_.shared.gl,".useProgram(",S,".program);"),h.shader.program)In(_,w,h,h.shader.program);else{w(_.shared.vao,".setVAO(null);");var m=_.global.def("{}"),I=w.def(S,".id"),D=w.def(m,"[",I,"]");w(_.cond(D).then(D,".call(this,a0,a1);").else(D,"=",m,"[",I,"]=",_.link(function(W){return ot(In,_,h,W,2)}),"(",S,");",D,".call(this,a0,a1);"))}}Object.keys(h.state).length>0&&w(_.shared.current,".dirty=true;")}function U(_,h){var w=_.proc("scope",3);_.batchId="a2";var P=_.shared,k=P.current;Ht(_,w,h.context),h.framebuffer&&h.framebuffer.append(_,w),If(Object.keys(h.state)).forEach(function(R){var O=h.state[R],E=O.append(_,w);kt(E)?E.forEach(function(S,m){w.set(_.next[R],"["+m+"]",S)}):w.set(P.next,"."+R,E)}),Ze(_,w,h,!0,!0),[Cn,za,Nn,Ha,xn].forEach(function(R){var O=h.draw[R];!O||w.set(P.draw,"."+R,""+O.append(_,w))}),Object.keys(h.uniforms).forEach(function(R){var O=h.uniforms[R].append(_,w);Array.isArray(O)&&(O="["+O.join()+"]"),w.set(P.uniforms,"["+p.id(R)+"]",O)}),Object.keys(h.attributes).forEach(function(R){var O=h.attributes[R].append(_,w),E=_.scopeAttrib(R);Object.keys(new L).forEach(function(S){w.set(E,"."+S,O[S])})}),h.scopeVAO&&w.set(P.vao,".targetVAO",h.scopeVAO.append(_,w));function N(R){var O=h.shader[R];O&&w.set(P.shader,"."+R,O.append(_,w))}N(Di),N(Fi),Object.keys(h.state).length>0&&(w(k,".dirty=true;"),w.exit(k,".dirty=true;")),w("a1(",_.shared.context,",a0,",_.batchId,");")}function F(_){if(!(typeof _!="object"||kt(_))){for(var h=Object.keys(_),w=0;w<h.length;++w)if(Gt.isDynamic(_[h[w]]))return!0;return!1}}function we(_,h,w){var P=h.static[w];if(!P||!F(P))return;var k=_.global,N=Object.keys(P),R=!1,O=!1,E=!1,S=_.global.def("{}");N.forEach(function(I){var D=P[I];if(Gt.isDynamic(D)){typeof D=="function"&&(D=P[I]=Gt.unbox(D));var W=yr(D,null);R=R||W.thisDep,E=E||W.propDep,O=O||W.contextDep}else{switch(k(S,".",I,"="),typeof D){case"number":k(D);break;case"string":k('"',D,'"');break;case"object":Array.isArray(D)&&k("[",D.join(),"]");break;default:k(_.link(D));break}k(";")}});function m(I,D){N.forEach(function(W){var K=P[W];if(!!Gt.isDynamic(K)){var H=I.invoke(D,K);D(S,".",W,"=",H,";")}})}h.dynamic[w]=new Gt.DynamicVariable(Va,{thisDep:R,contextDep:O,propDep:E,ref:S,append:m}),delete h.static[w]}function at(_,h,w,P,k){var N=je();N.stats=N.link(k),Object.keys(h.static).forEach(function(O){we(N,h,O)}),kE.forEach(function(O){we(N,_,O)});var R=Vt(_,h,w,P,N);return Ft(N,R),U(N,R),b(N,R),n(N.compile(),{destroy:function(){R.shader.program.destroy()}})}return{next:Se,current:J,procs:function(){var _=je(),h=_.proc("poll"),w=_.proc("refresh"),P=_.block();h(P),w(P);var k=_.shared,N=k.gl,R=k.next,O=k.current;P(O,".dirty=false;"),Xt(_,h),Xt(_,w,null,!0);var E;fe&&(E=_.link(fe)),A.oes_vertex_array_object&&w(_.link(A.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var S=0;S<B.maxAttributes;++S){var m=w.def(k.attributes,"[",S,"]"),I=_.cond(m,".buffer");I.then(N,".enableVertexAttribArray(",S,");",N,".bindBuffer(",fi,",",m,".buffer.buffer);",N,".vertexAttribPointer(",S,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",m,".offset);").else(N,".disableVertexAttribArray(",S,");",N,".vertexAttrib4f(",S,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;"),w(I),fe&&w(E,".vertexAttribDivisorANGLE(",S,",",m,".divisor);")}return w(_.shared.vao,".currentVAO=null;",_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"),Object.keys(me).forEach(function(D){var W=me[D],K=P.def(R,".",D),H=_.block();H("if(",K,"){",N,".enable(",W,")}else{",N,".disable(",W,")}",O,".",D,"=",K,";"),w(H),h("if(",K,"!==",O,".",D,"){",H,"}")}),Object.keys(ee).forEach(function(D){var W=ee[D],K=J[D],H,ce,Oe=_.block();if(Oe(N,".",W,"("),kt(K)){var Je=K.length;H=_.global.def(R,".",D),ce=_.global.def(O,".",D),Oe(mr(Je,function(Ce){return H+"["+Ce+"]"}),");",mr(Je,function(Ce){return ce+"["+Ce+"]="+H+"["+Ce+"];"}).join("")),h("if(",mr(Je,function(Ce){return H+"["+Ce+"]!=="+ce+"["+Ce+"]"}).join("||"),"){",Oe,"}")}else H=P.def(R,".",D),ce=P.def(O,".",D),Oe(H,");",O,".",D,"=",H,";"),h("if(",H,"!==",ce,"){",Oe,"}");w(Oe)}),_.compile()}(),compile:at}}function tb(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var rb=34918,nb=34919,Lf=35007,ib=function(l,p){if(!p.ext_disjoint_timer_query)return null;var A=[];function B(){return A.pop()||p.ext_disjoint_timer_query.createQueryEXT()}function q(fe){A.push(fe)}var G=[];function V(fe){var Te=B();p.ext_disjoint_timer_query.beginQueryEXT(Lf,Te),G.push(Te),ie(G.length-1,G.length,fe)}function ne(){p.ext_disjoint_timer_query.endQueryEXT(Lf)}function se(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var le=[];function ue(){return le.pop()||new se}function ve(fe){le.push(fe)}var _e=[];function ie(fe,Te,J){var Se=ue();Se.startQueryIndex=fe,Se.endQueryIndex=Te,Se.sum=0,Se.stats=J,_e.push(Se)}var pe=[],L=[];function j(){var fe,Te,J=G.length;if(J!==0){L.length=Math.max(L.length,J+1),pe.length=Math.max(pe.length,J+1),pe[0]=0,L[0]=0;var Se=0;for(fe=0,Te=0;Te<G.length;++Te){var te=G[Te];p.ext_disjoint_timer_query.getQueryObjectEXT(te,nb)?(Se+=p.ext_disjoint_timer_query.getQueryObjectEXT(te,rb),q(te)):G[fe++]=te,pe[Te+1]=Se,L[Te+1]=fe}for(G.length=fe,fe=0,Te=0;Te<_e.length;++Te){var me=_e[Te],ee=me.startQueryIndex,ye=me.endQueryIndex;me.sum+=pe[ye]-pe[ee];var Pe=L[ee],Xe=L[ye];Xe===Pe?(me.stats.gpuTime+=me.sum/1e6,ve(me)):(me.startQueryIndex=Pe,me.endQueryIndex=Xe,_e[fe++]=me)}_e.length=fe}}return{beginQuery:V,endQuery:ne,pushScopeStats:ie,update:j,getNumPendingQueries:function(){return G.length},clear:function(){A.push.apply(A,G);for(var fe=0;fe<A.length;fe++)p.ext_disjoint_timer_query.deleteQueryEXT(A[fe]);G.length=0,A.length=0},restore:function(){G.length=0,A.length=0}}},ab=16384,ob=256,sb=1024,ub=34962,Mf="webglcontextlost",kf="webglcontextrestored",Df=1,cb=2,fb=3;function Ff(l,p){for(var A=0;A<l.length;++A)if(l[A]===p)return A;return-1}function lb(l){var p=u_(l);if(!p)return null;var A=p.gl,B=A.getContextAttributes(),q=A.isContextLost(),G=c_(A,p);if(!G)return null;var V=n_(),ne=tb(),se=G.extensions,le=ib(A,se),ue=zu(),ve=A.drawingBufferWidth,_e=A.drawingBufferHeight,ie={tick:0,time:0,viewportWidth:ve,viewportHeight:_e,framebufferWidth:ve,framebufferHeight:_e,drawingBufferWidth:ve,drawingBufferHeight:_e,pixelRatio:p.pixelRatio},pe={},L={elements:null,primitive:4,count:-1,offset:0,instances:-1},j=K_(A,se),fe=d0(A,ne,p,J),Te=SE(A,se,j,ne,fe);function J(ke){return Te.destroyBuffer(ke)}var Se=S0(A,se,fe,ne),te=xE(A,V,ne,p),me=tE(A,se,j,function(){Pe.procs.poll()},ie,ne,p),ee=rE(A,se,j,ne,p),ye=TE(A,se,j,me,ee,ne),Pe=eb(A,V,se,j,fe,Se,me,ye,pe,Te,te,L,ie,le,p),Xe=IE(A,ye,Pe.procs.poll,ie,B,se,j),Ee=Pe.next,de=A.canvas,Z=[],je=[],Qe=[],Re=[p.onDestroy],it=null;function We(){if(Z.length===0){le&&le.update(),it=null;return}it=qn.next(We),tr();for(var ke=Z.length-1;ke>=0;--ke){var ot=Z[ke];ot&&ot(ie,null,0)}A.flush(),le&&le.update()}function rt(){!it&&Z.length>0&&(it=qn.next(We))}function ht(){it&&(qn.cancel(We),it=null)}function $t(ke){ke.preventDefault(),q=!0,ht(),je.forEach(function(ot){ot()})}function Qt(ke){A.getError(),q=!1,G.restore(),te.restore(),fe.restore(),me.restore(),ee.restore(),ye.restore(),Te.restore(),le&&le.restore(),Pe.procs.refresh(),rt(),Qe.forEach(function(ot){ot()})}de&&(de.addEventListener(Mf,$t,!1),de.addEventListener(kf,Qt,!1));function ut(){Z.length=0,ht(),de&&(de.removeEventListener(Mf,$t),de.removeEventListener(kf,Qt)),te.clear(),ye.clear(),ee.clear(),me.clear(),Se.clear(),fe.clear(),Te.clear(),le&&le.clear(),Re.forEach(function(ke){ke()})}function zt(ke){y(!!ke,"invalid args to regl({...})"),y.type(ke,"object","invalid args to regl({...})");function ot(k){var N=n({},k);delete N.uniforms,delete N.attributes,delete N.context,delete N.vao,"stencil"in N&&N.stencil.op&&(N.stencil.opBack=N.stencil.opFront=N.stencil.op,delete N.stencil.op);function R(O){if(O in N){var E=N[O];delete N[O],Object.keys(E).forEach(function(S){N[O+"."+S]=E[S]})}}return R("blend"),R("depth"),R("cull"),R("stencil"),R("polygonOffset"),R("scissor"),R("sample"),"vao"in k&&(N.vao=k.vao),N}function dt(k,N){var R={},O={};return Object.keys(k).forEach(function(E){var S=k[E];if(Gt.isDynamic(S)){O[E]=Gt.unbox(S,E);return}else if(N&&Array.isArray(S)){for(var m=0;m<S.length;++m)if(Gt.isDynamic(S[m])){O[E]=Gt.unbox(S,E);return}}R[E]=S}),{dynamic:O,static:R}}var Ft=dt(ke.context||{},!0),Fr=dt(ke.uniforms||{},!0),In=dt(ke.attributes||{},!1),b=dt(ot(ke),!1),U={gpuTime:0,cpuTime:0,count:0},F=Pe.compile(b,In,Fr,Ft,U),we=F.draw,at=F.batch,_=F.scope,h=[];function w(k){for(;h.length<k;)h.push(null);return h}function P(k,N){var R;if(q&&y.raise("context lost"),typeof k=="function")return _.call(this,null,k,0);if(typeof N=="function")if(typeof k=="number")for(R=0;R<k;++R)_.call(this,null,N,R);else if(Array.isArray(k))for(R=0;R<k.length;++R)_.call(this,k[R],N,R);else return _.call(this,k,N,0);else if(typeof k=="number"){if(k>0)return at.call(this,w(k|0),k|0)}else if(Array.isArray(k)){if(k.length)return at.call(this,k,k.length)}else return we.call(this,k)}return n(P,{stats:U,destroy:function(){F.destroy()}})}var xt=ye.setFBO=zt({framebuffer:Gt.define.call(null,Df,"framebuffer")});function Vt(ke,ot){var dt=0;Pe.procs.poll();var Ft=ot.color;Ft&&(A.clearColor(+Ft[0]||0,+Ft[1]||0,+Ft[2]||0,+Ft[3]||0),dt|=ab),"depth"in ot&&(A.clearDepth(+ot.depth),dt|=ob),"stencil"in ot&&(A.clearStencil(ot.stencil|0),dt|=sb),y(!!dt,"called regl.clear with no buffer specified"),A.clear(dt)}function Ht(ke){if(y(typeof ke=="object"&&ke,"regl.clear() takes an object as input"),"framebuffer"in ke)if(ke.framebuffer&&ke.framebuffer_reglType==="framebufferCube")for(var ot=0;ot<6;++ot)xt(n({framebuffer:ke.framebuffer.faces[ot]},ke),Vt);else xt(ke,Vt);else Vt(null,ke)}function Xt(ke){y.type(ke,"function","regl.frame() callback must be a function"),Z.push(ke);function ot(){var dt=Ff(Z,ke);y(dt>=0,"cannot cancel a frame twice");function Ft(){var Fr=Ff(Z,Ft);Z[Fr]=Z[Z.length-1],Z.length-=1,Z.length<=0&&ht()}Z[dt]=Ft}return rt(),{cancel:ot}}function Zt(){var ke=Ee.viewport,ot=Ee.scissor_box;ke[0]=ke[1]=ot[0]=ot[1]=0,ie.viewportWidth=ie.framebufferWidth=ie.drawingBufferWidth=ke[2]=ot[2]=A.drawingBufferWidth,ie.viewportHeight=ie.framebufferHeight=ie.drawingBufferHeight=ke[3]=ot[3]=A.drawingBufferHeight}function tr(){ie.tick+=1,ie.time=Ze(),Zt(),Pe.procs.poll()}function Dt(){me.refresh(),Zt(),Pe.procs.refresh(),le&&le.update()}function Ze(){return(zu()-ue)/1e3}Dt();function rr(ke,ot){y.type(ot,"function","listener callback must be a function");var dt;switch(ke){case"frame":return Xt(ot);case"lost":dt=je;break;case"restore":dt=Qe;break;case"destroy":dt=Re;break;default:y.raise("invalid event, must be one of frame,lost,restore,destroy")}return dt.push(ot),{cancel:function(){for(var Ft=0;Ft<dt.length;++Ft)if(dt[Ft]===ot){dt[Ft]=dt[dt.length-1],dt.pop();return}}}}var yt=n(zt,{clear:Ht,prop:Gt.define.bind(null,Df),context:Gt.define.bind(null,cb),this:Gt.define.bind(null,fb),draw:zt({}),buffer:function(ke){return fe.create(ke,ub,!1,!1)},elements:function(ke){return Se.create(ke,!1)},texture:me.create2D,cube:me.createCube,renderbuffer:ee.create,framebuffer:ye.create,framebufferCube:ye.createCube,vao:Te.createVAO,attributes:B,frame:Xt,on:rr,limits:j,hasExtension:function(ke){return j.extensions.indexOf(ke.toLowerCase())>=0},read:Xe,destroy:ut,_gl:A,_refresh:Dt,poll:function(){tr(),le&&le.update()},now:Ze,stats:ne});return p.onDone(null,yt),yt}return lb})})(My);const Bw=My.exports;var Uw=function(){function e(t,r){Le(this,e),this.attribute=void 0,this.buffer=void 0;var n=r.buffer,i=r.offset,a=r.stride,o=r.normalized,s=r.size,u=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:u||0},s&&(this.attribute.size=s)}return ze(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),qr,ta,Kr,Sr,ra,dn,na,co,Gr,Mn,nr,Br,Ur,fo,$w=(qr={},Y(qr,M.POINTS,"points"),Y(qr,M.LINES,"lines"),Y(qr,M.LINE_LOOP,"line loop"),Y(qr,M.LINE_STRIP,"line strip"),Y(qr,M.TRIANGLES,"triangles"),Y(qr,M.TRIANGLE_FAN,"triangle fan"),Y(qr,M.TRIANGLE_STRIP,"triangle strip"),qr),ky=(ta={},Y(ta,M.STATIC_DRAW,"static"),Y(ta,M.DYNAMIC_DRAW,"dynamic"),Y(ta,M.STREAM_DRAW,"stream"),ta),Vu=(Kr={},Y(Kr,M.BYTE,"int8"),Y(Kr,M.UNSIGNED_INT,"int16"),Y(Kr,M.INT,"int32"),Y(Kr,M.UNSIGNED_BYTE,"uint8"),Y(Kr,M.UNSIGNED_SHORT,"uint16"),Y(Kr,M.UNSIGNED_INT,"uint32"),Y(Kr,M.FLOAT,"float"),Kr),Vw=(Sr={},Y(Sr,M.ALPHA,"alpha"),Y(Sr,M.LUMINANCE,"luminance"),Y(Sr,M.LUMINANCE_ALPHA,"luminance alpha"),Y(Sr,M.RGB,"rgb"),Y(Sr,M.RGBA,"rgba"),Y(Sr,M.RGBA4,"rgba4"),Y(Sr,M.RGB5_A1,"rgb5 a1"),Y(Sr,M.RGB565,"rgb565"),Y(Sr,M.DEPTH_COMPONENT,"depth"),Y(Sr,M.DEPTH_STENCIL,"depth stencil"),Sr),jw=(ra={},Y(ra,M.DONT_CARE,"dont care"),Y(ra,M.NICEST,"nice"),Y(ra,M.FASTEST,"fast"),ra),Nv=(dn={},Y(dn,M.NEAREST,"nearest"),Y(dn,M.LINEAR,"linear"),Y(dn,M.LINEAR_MIPMAP_LINEAR,"mipmap"),Y(dn,M.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),Y(dn,M.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),Y(dn,M.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),dn),Ov=(na={},Y(na,M.REPEAT,"repeat"),Y(na,M.CLAMP_TO_EDGE,"clamp"),Y(na,M.MIRRORED_REPEAT,"mirror"),na),zw=(co={},Y(co,M.NONE,"none"),Y(co,M.BROWSER_DEFAULT_WEBGL,"browser"),co),Hw=(Gr={},Y(Gr,M.NEVER,"never"),Y(Gr,M.ALWAYS,"always"),Y(Gr,M.LESS,"less"),Y(Gr,M.LEQUAL,"lequal"),Y(Gr,M.GREATER,"greater"),Y(Gr,M.GEQUAL,"gequal"),Y(Gr,M.EQUAL,"equal"),Y(Gr,M.NOTEQUAL,"notequal"),Gr),Iv=(Mn={},Y(Mn,M.FUNC_ADD,"add"),Y(Mn,M.MIN_EXT,"min"),Y(Mn,M.MAX_EXT,"max"),Y(Mn,M.FUNC_SUBTRACT,"subtract"),Y(Mn,M.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Mn),lo=(nr={},Y(nr,M.ZERO,"zero"),Y(nr,M.ONE,"one"),Y(nr,M.SRC_COLOR,"src color"),Y(nr,M.ONE_MINUS_SRC_COLOR,"one minus src color"),Y(nr,M.SRC_ALPHA,"src alpha"),Y(nr,M.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),Y(nr,M.DST_COLOR,"dst color"),Y(nr,M.ONE_MINUS_DST_COLOR,"one minus dst color"),Y(nr,M.DST_ALPHA,"dst alpha"),Y(nr,M.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),Y(nr,M.CONSTANT_COLOR,"constant color"),Y(nr,M.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),Y(nr,M.CONSTANT_ALPHA,"constant alpha"),Y(nr,M.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),Y(nr,M.SRC_ALPHA_SATURATE,"src alpha saturate"),nr),Xw=(Br={},Y(Br,M.NEVER,"never"),Y(Br,M.ALWAYS,"always"),Y(Br,M.LESS,"less"),Y(Br,M.LEQUAL,"lequal"),Y(Br,M.GREATER,"greater"),Y(Br,M.GEQUAL,"gequal"),Y(Br,M.EQUAL,"equal"),Y(Br,M.NOTEQUAL,"notequal"),Br),mi=(Ur={},Y(Ur,M.ZERO,"zero"),Y(Ur,M.KEEP,"keep"),Y(Ur,M.REPLACE,"replace"),Y(Ur,M.INVERT,"invert"),Y(Ur,M.INCR,"increment"),Y(Ur,M.DECR,"decrement"),Y(Ur,M.INCR_WRAP,"increment wrap"),Y(Ur,M.DECR_WRAP,"decrement wrap"),Ur),Ww=(fo={},Y(fo,M.FRONT,"front"),Y(fo,M.BACK,"back"),fo),Yw=function(){function e(t,r){Le(this,e),this.buffer=void 0;var n=r.data,i=r.usage,a=r.type;this.buffer=t.buffer({data:n,usage:ky[i||M.STATIC_DRAW],type:Vu[a||M.UNSIGNED_BYTE]})}return ze(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.buffer.subdata(n,i)}}]),e}();function qw(e){if(Array.isArray(e))return vb(e)}function Kw(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Qw(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wt(e){return qw(e)||Kw(e)||Pm(e)||Qw()}var Zw=9007199254740991,Jw="[object Arguments]",eR="[object Array]",tR="[object Boolean]",rR="[object Date]",nR="[object Error]",iR="[object Function]",aR="[object Map]",oR="[object Number]",sR="[object Object]",uR="[object RegExp]",cR="[object Set]",fR="[object String]",lR="[object WeakMap]",dR="[object ArrayBuffer]",hR="[object DataView]",vR="[object Float32Array]",pR="[object Float64Array]",mR="[object Int8Array]",yR="[object Int16Array]",_R="[object Int32Array]",ER="[object Uint8Array]",bR="[object Uint8ClampedArray]",gR="[object Uint16Array]",TR="[object Uint32Array]",It={};It[vR]=It[pR]=It[mR]=It[yR]=It[_R]=It[ER]=It[bR]=It[gR]=It[TR]=!0;It[Jw]=It[eR]=It[dR]=It[tR]=It[hR]=It[rR]=It[nR]=It[iR]=It[aR]=It[oR]=It[sR]=It[uR]=It[cR]=It[fR]=It[lR]=!1;var AR=Object.prototype,SR=AR.toString;function wR(e){return CR(e)&&RR(e.length)&&!!It[SR.call(e)]}function RR(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=Zw}function CR(e){return!!e&&wi(e)==="object"}var Eu=wR;function Pv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Lv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Pv(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var xR=`attribute vec3 a_Position;
attribute vec2 a_TexCoord;

varying vec2 v_TexCoord;

void main() {
  gl_Position = vec4(a_Position, 1.0);
  v_TexCoord = a_TexCoord;
}`,Mv=0,NR=function(){function e(t,r){var n=this;Le(this,e),this.reGl=t,this.context=r,this.entity=Vr(),this.texFBO=void 0,this.computeCommand=void 0,this.textureCache={},this.outputTextureName=void 0,this.swapOutputTextureName=void 0,this.compiledPingpong=void 0,this.dynamicPingpong=void 0;var i={};this.context.uniforms.forEach(function(c){var f=c.name,d=c.type,v=c.data,g=c.isReferer,T=c.storageClass;if(T===En.StorageBuffer){if(g)n.textureCache[f]={data:void 0},i["".concat(f,"Size")]=function(){return v.compiledBundle.context.output.textureSize};else{n.textureCache[f]=n.calcDataTexture(f,d,v);var C=n.textureCache[f],x=C.textureWidth,$=C.isOutput;i["".concat(f,"Size")]=[x,x],$&&(n.outputTextureName=f,n.context.needPingpong&&(n.outputTextureName="".concat(f,"Output"),n.textureCache[n.outputTextureName]=n.calcDataTexture(f,d,v)))}i[f]=function(){return n.textureCache[f].texture}}else if(T===En.Uniform){if(v&&(Array.isArray(v)||Eu(v))&&v.length>16)throw new Error("invalid data type ".concat(d));i[f]=function(){return c.data}}});var a=this.getOuputDataTexture(),o=a.textureWidth,s=a.texelCount;i.u_OutputTextureSize=[o,o],i.u_OutputTexelCount=s,this.context.output.textureSize=[o,o];var u={attributes:{a_Position:[[-1,1,0],[-1,-1,0],[1,1,0],[1,-1,0]],a_TexCoord:[[0,1],[0,0],[1,1],[1,0]]},frag:`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif
`.concat(this.context.shader),uniforms:i,vert:xR,primitive:"triangle strip",count:4};this.computeCommand=this.reGl(u)}return ze(e,[{key:"run",value:function(){var r=this;this.context.maxIteration>1&&this.context.needPingpong&&(this.compiledPingpong=!0),(this.compiledPingpong||this.dynamicPingpong)&&this.swap(),this.texFBO=this.reGl.framebuffer({color:this.getOuputDataTexture().texture}),this.texFBO.use(function(){r.computeCommand()})}},{key:"readData",value:function(){var t=_t(Ne.mark(function n(){var i=this,a,o,s,u,c,f,d,v;return Ne.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(this.reGl({framebuffer:this.texFBO})(function(){a=i.reGl.read()}),!a){T.next=6;break}if(o=this.getOuputDataTexture(),s=o.originalDataLength,u=o.elementsPerTexel,c=o.typedArrayConstructor,f=c===void 0?Float32Array:c,d=[],u!==4)for(v=0;v<a.length;v+=4)u===1?d.push(a[v]):u===2?d.push(a[v],a[v+1]):d.push(a[v],a[v+1],a[v+2]);else d=a;return T.abrupt("return",new f(d.slice(0,s)));case 6:return T.abrupt("return",new Float32Array);case 7:case"end":return T.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"confirmInput",value:function(r,n){var i;this.entity===r.entity?(this.dynamicPingpong=!0,i=this):i=r,this.textureCache[n].id=i.getOuputDataTexture().id,this.textureCache[n].texture=i.getOuputDataTexture().texture}},{key:"updateUniform",value:function(){}},{key:"updateBuffer",value:function(r,n){var i=this.context.uniforms.find(function(u){var c=u.name;return c===r});if(i){var a=this.calcDataTexture(r,i.type,n),o=a.texture,s=a.data;this.textureCache[r].data=s,this.textureCache[r].texture=o}}},{key:"destroy",value:function(){}},{key:"swap",value:function(){if(this.swapOutputTextureName||this.createSwapOutputDataTexture(),this.compiledPingpong){var r=this.context.output.name;this.textureCache[r].id=this.getOuputDataTexture().id,this.textureCache[r].texture=this.getOuputDataTexture().texture}var n=this.outputTextureName;this.outputTextureName=this.swapOutputTextureName,this.swapOutputTextureName=n}},{key:"getOuputDataTexture",value:function(){return this.textureCache[this.outputTextureName]}},{key:"createSwapOutputDataTexture",value:function(){var r=this.cloneDataTexture(this.getOuputDataTexture());this.swapOutputTextureName="".concat(this.entity,"-swap"),this.textureCache[this.swapOutputTextureName]=r}},{key:"cloneDataTexture",value:function(r){var n=r.data,i=r.textureWidth;return Lv(Lv({},r),{},{id:Mv++,texture:this.reGl.texture({width:i,height:i,data:n,type:"float"})})}},{key:"calcDataTexture",value:function(r,n,i){var a=1;n===$n.Vector4FloatArray&&(a=4);for(var o=[],s=0;s<i.length;s+=a)a===1?o.push(i[s],0,0,0):a===2?o.push(i[s],i[s+1],0,0):a===3?o.push(i[s],i[s+1],i[s+2],0):a===4&&o.push(i[s],i[s+1],i[s+2],i[s+3]);var u=i.length,c=Math.ceil(u/a),f=Math.ceil(Math.sqrt(c)),d=f*f;c<d&&o.push.apply(o,Wt(new Array((d-c)*4).fill(0)));var v=this.reGl.texture({width:f,height:f,data:o,type:"float"});return{id:Mv++,data:o,originalDataLength:u,typedArrayConstructor:Eu(i)?i.constructor:void 0,textureWidth:f,texture:v,texelCount:c,elementsPerTexel:a,isOutput:r===this.context.output.name}}}]),e}(),OR=function(){function e(t,r){Le(this,e),this.elements=void 0;var n=r.data,i=r.usage,a=r.type,o=r.count;this.elements=t.elements({data:n,usage:ky[i||M.STATIC_DRAW],type:Vu[a||M.UNSIGNED_BYTE],count:o})}return ze(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){this.elements.destroy()}}]),e}(),IR=function(){function e(t,r){Le(this,e),this.framebuffer=void 0;var n=r.width,i=r.height,a=r.color,o=r.colors;r.depth,r.stencil;var s={width:n,height:i};Array.isArray(o)&&(s.colors=o.map(function(u){return u.get()})),a&&typeof a!="boolean"&&(s.color=a.get()),this.framebuffer=t.framebuffer(s)}return ze(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.framebuffer.resize(n,i)}}]),e}();function PR(e){var t=wi(e);return e!=null&&(t==="object"||t==="function")}function va(e){var t={};return Object.keys(e).forEach(function(r){bu(r,e[r],t,"")}),t}function bu(e,t,r,n){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||Eu(t)||t===""||t.resize!==void 0){r["".concat(n&&n+".").concat(e)]=t;return}PR(t)&&Object.keys(t).forEach(function(i){bu(i,t[i],r,"".concat(n&&n+".").concat(e))}),Array.isArray(t)&&t.forEach(function(i,a){Object.keys(i).forEach(function(o){bu(o,i[o],r,"".concat(n&&n+".").concat(e,"[").concat(a,"]"))})})}function kv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function yi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kv(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var LR=function(){function e(t,r){Le(this,e),this.reGl=void 0,this.drawCommand=void 0,this.uniforms={},this.reGl=t;var n=r.vs,i=r.fs,a=r.defines,o=r.attributes,s=r.uniforms,u=r.primitive,c=r.count,f=r.elements,d=r.depth,v=r.blend,g=r.stencil,T=r.cull,C=r.instances,x=r.scissor,$=r.viewport,Q={};s&&(this.uniforms=va(s),Object.keys(s).forEach(function(Ae){Q[Ae]=t.prop(Ae)}));var X={};Object.keys(o).forEach(function(Ae){X[Ae]=o[Ae].get()});var he=a&&this.generateDefines(a)||"",ae={attributes:X,frag:`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif
`.concat(he,`
`).concat(i),uniforms:Q,vert:`
`.concat(he,`
`).concat(n),primitive:$w[u===void 0?M.TRIANGLES:u]};C&&(ae.instances=C),c&&(ae.count=c),f&&(ae.elements=f.get()),x&&(ae.scissor=x),$&&(ae.viewport=$),this.initDepthDrawParams({depth:d},ae),this.initBlendDrawParams({blend:v},ae),this.initStencilDrawParams({stencil:g},ae),this.initCullDrawParams({cull:T},ae),this.drawCommand=t(ae)}return ze(e,[{key:"addUniforms",value:function(r){this.uniforms=yi(yi({},this.uniforms),va(r))}},{key:"draw",value:function(r){var n=yi(yi({},this.uniforms),va(r.uniforms||{})),i={};Object.keys(n).forEach(function(a){var o=wi(n[a]);o==="boolean"||o==="number"||Array.isArray(n[a])||n[a].BYTES_PER_ELEMENT?i[a]=n[a]:o==="string"||(i[a]=n[a].get())}),this.drawCommand(i)}},{key:"destroy",value:function(){}},{key:"initDepthDrawParams",value:function(r,n){var i=r.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:Hw[i.func||M.LESS],range:i.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var i=r.blend;if(i){var a=i.enable,o=i.func,s=i.equation,u=i.color,c=u===void 0?[0,0,0,0]:u;n.blend={enable:!!a,func:{srcRGB:lo[o&&o.srcRGB||M.SRC_ALPHA],srcAlpha:lo[o&&o.srcAlpha||M.SRC_ALPHA],dstRGB:lo[o&&o.dstRGB||M.ONE_MINUS_SRC_ALPHA],dstAlpha:lo[o&&o.dstAlpha||M.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Iv[s&&s.rgb||M.FUNC_ADD],alpha:Iv[s&&s.alpha||M.FUNC_ADD]},color:c}}}},{key:"initStencilDrawParams",value:function(r,n){var i=r.stencil;if(i){var a=i.enable,o=i.mask,s=o===void 0?-1:o,u=i.func,c=u===void 0?{cmp:M.ALWAYS,ref:0,mask:-1}:u,f=i.opFront,d=f===void 0?{fail:M.KEEP,zfail:M.KEEP,zpass:M.KEEP}:f,v=i.opBack,g=v===void 0?{fail:M.KEEP,zfail:M.KEEP,zpass:M.KEEP}:v;n.stencil={enable:!!a,mask:s,func:yi(yi({},c),{},{cmp:Xw[c.cmp]}),opFront:{fail:mi[d.fail],zfail:mi[d.zfail],zpass:mi[d.zpass]},opBack:{fail:mi[g.fail],zfail:mi[g.zfail],zpass:mi[g.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var i=r.cull;if(i){var a=i.enable,o=i.face,s=o===void 0?M.BACK:o;n.cull={enable:!!a,face:Ww[s]}}}},{key:"generateDefines",value:function(r){return Object.keys(r).map(function(n){return"#define ".concat(n," ").concat(Number(r[n]))}).join(`
`)}}]),e}(),MR=function(){function e(t,r){Le(this,e),this.texture=void 0,this.width=void 0,this.height=void 0;var n=r.data,i=r.type,a=i===void 0?M.UNSIGNED_BYTE:i,o=r.width,s=r.height,u=r.flipY,c=u===void 0?!1:u,f=r.format,d=f===void 0?M.RGBA:f,v=r.mipmap,g=v===void 0?!1:v,T=r.wrapS,C=T===void 0?M.CLAMP_TO_EDGE:T,x=r.wrapT,$=x===void 0?M.CLAMP_TO_EDGE:x,Q=r.aniso,X=Q===void 0?0:Q,he=r.alignment,ae=he===void 0?1:he,Ae=r.premultiplyAlpha,Ie=Ae===void 0?!1:Ae,Ve=r.mag,tt=Ve===void 0?M.NEAREST:Ve,$e=r.min,Ke=$e===void 0?M.NEAREST:$e,He=r.colorSpace,lt=He===void 0?M.BROWSER_DEFAULT_WEBGL:He;this.width=o,this.height=s;var Me={width:o,height:s,type:Vu[a],format:Vw[d],wrapS:Ov[C],wrapT:Ov[$],mag:Nv[tt],min:Nv[Ke],alignment:ae,flipY:c,colorSpace:zw[lt],premultiplyAlpha:Ie,aniso:X};n&&(Me.data=n),typeof g=="number"?Me.mipmap=jw[g]:typeof g=="boolean"&&(Me.mipmap=g),this.texture=t.texture(Me)}return ze(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"destroy",value:function(){this.texture.destroy()}}]),e}(),Dv,Fv,Gv,kR=(Dv=gt(),Dv(Fv=(Gv=function(){function e(){var t=this;Le(this,e),this.supportWebGPU=!1,this.useWGSL=!1,this.$canvas=void 0,this.gl=void 0,this.inited=void 0,this.createModel=function(){var r=_t(Ne.mark(function n(i){return Ne.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!i.uniforms){o.next=3;break}return o.next=3,Promise.all(Object.keys(i.uniforms).map(function(){var s=_t(Ne.mark(function u(c){var f;return Ne.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(i.uniforms[c]&&i.uniforms[c].load!==void 0)){v.next=5;break}return v.next=3,i.uniforms[c].load();case 3:f=v.sent,i.uniforms[c]=f;case 5:case"end":return v.stop()}},u)}));return function(u){return s.apply(this,arguments)}}()));case 3:return o.abrupt("return",new LR(t.gl,i));case 4:case"end":return o.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.createAttribute=function(r){return new Uw(t.gl,r)},this.createBuffer=function(r){return new Yw(t.gl,r)},this.createElements=function(r){return new OR(t.gl,r)},this.createTexture2D=function(r){return new MR(t.gl,r)},this.createFramebuffer=function(r){return new IR(t.gl,r)},this.useFramebuffer=function(r,n){t.gl({framebuffer:r?r.get():null})(n)},this.createComputeModel=function(){var r=_t(Ne.mark(function n(i){return Ne.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new NR(t.gl,i));case 1:case"end":return o.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.clear=function(r){var n=r.color,i=r.depth,a=r.stencil,o=r.framebuffer,s=o===void 0?null:o,u={color:n,depth:i,stencil:a};u.framebuffer=s===null?s:s.get(),t.gl.clear(u)},this.setScissor=function(r){t.gl&&t.gl._gl&&(r.enable&&r.box?(t.gl._gl.enable(M.SCISSOR_TEST),t.gl._gl.scissor(r.box.x,r.box.y,r.box.width,r.box.height)):t.gl._gl.disable(M.SCISSOR_TEST),t.gl._refresh())},this.viewport=function(r){var n=r.x,i=r.y,a=r.width,o=r.height;t.gl&&t.gl._gl&&(t.gl._gl.viewport(n,i,a,o),t.gl._refresh())},this.readPixels=function(r){var n=r.framebuffer,i=r.x,a=r.y,o=r.width,s=r.height,u={x:i,y:a,width:o,height:s};return n&&(u.framebuffer=n.get()),t.gl.read(u)},this.getCanvas=function(){return t.$canvas},this.getGLContext=function(){return t.gl._gl},this.destroy=function(){t.gl&&(t.gl.destroy(),t.inited=!1)}}return ze(e,[{key:"init",value:function(){var t=_t(Ne.mark(function n(i){return Ne.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.inited){o.next=2;break}return o.abrupt("return");case 2:return this.$canvas=i.canvas,o.next=5,new Promise(function(s,u){Bw({canvas:i.canvas,attributes:{alpha:!0,antialias:i.antialias,premultipliedAlpha:!0},pixelRatio:1,extensions:["OES_element_index_uint","OES_texture_float","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(f,d){(f||!d)&&u(f),s(d)}})});case 5:this.gl=o.sent,this.inited=!0;case 7:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"isFloatSupported",value:function(){return this.gl.limits.readFloat}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}(),Gv))||Fv);function DR(){return typeof window<"u"}function FR(e,t,r,n){if(!!DR()){var i=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e),n&&(a.id=n),a.onload=function(){t&&t()},a.onerror=function(o){r&&r("Unable to load script '".concat(e,"'"),o)},i.appendChild(a)}}function GR(e,t){return new Promise(function(r,n){FR(e,function(){r()},function(i,a){n(a)})})}var ho;function BR(){return gu.apply(this,arguments)}function gu(){return gu=_t(Ne.mark(function e(){return Ne.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!ho){r.next=2;break}return r.abrupt("return",ho);case 2:return r.next=4,GR("https://preview.babylonjs.com/glslang/glslang.js");case 4:return ho=window.glslang("https://preview.babylonjs.com/glslang/glslang.wasm"),r.abrupt("return",ho);case 6:case"end":return r.stop()}},e)})),gu.apply(this,arguments)}var UR=function(){function e(t,r){Le(this,e),this.engine=t,this.options=r,this.attribute=void 0,this.buffer=void 0;var n=r,i=n.buffer,a=n.offset,o=n.stride,s=n.normalized,u=n.size,c=n.divisor,f=n.arrayStride,d=n.attributes,v=n.stepMode;this.buffer=i,this.attribute={buffer:i.get(),offset:a||0,stride:o||0,normalized:s||!1,divisor:c||0,arrayStride:f||0,attributes:d,stepMode:v||"vertex"},u&&(this.attribute.size=u)}return ze(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Ai=function(){function e(t,r){Le(this,e),this.engine=t,this.options=r,this.buffer=void 0;var n=r,i=n.data,a=n.usage;n.type,this.buffer=this.createBuffer(i instanceof Array?new Float32Array(i):i,a||be.BufferUsage.Vertex|be.BufferUsage.CopyDst)}return ze(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.setSubData(this.buffer,i,n instanceof Array?new Float32Array(n):n)}},{key:"createBuffer",value:function(r,n){var i=r.byteLength%4,a={size:r.byteLength+i,usage:n},o=this.engine.device.createBuffer(a);return this.setSubData(o,0,r),o}},{key:"setSubData",value:function(r,n,i){var a=_r?this.engine.device.getQueue():this.engine.device.defaultQueue;a.writeBuffer(r,n,i)}}]),e}();function $R(e){return typeof e=="number"}var VR=function(){function e(t,r){Le(this,e),this.engine=t,this.context=r,this.entity=Vr(),this.uniformGPUBufferLayout=[],this.uniformBuffer=void 0,this.vertexBuffers={},this.outputBuffer=void 0,this.bindGroupEntries=void 0,this.bindGroup=void 0,this.computePipeline=void 0}return ze(e,[{key:"init",value:function(){var t=_t(Ne.mark(function n(){var i=this,a,o,s,u,c,f,d;return Ne.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.compileComputePipelineStageDescriptor(this.context.shader);case 2:a=g.sent,o=a.computeStage,s=this.context.uniforms.filter(function(T){return T.storageClass===En.StorageBuffer}),u=this.context.uniforms.filter(function(T){return T.storageClass===En.Uniform}),c=u.length?1:0,this.bindGroupEntries=[],c&&(f=0,d=[],u.forEach(function(T){if($R(T.data))i.uniformGPUBufferLayout.push({name:T.name,offset:f}),f+=4,d.push(T.data);else{var C,x=((C=T.data)===null||C===void 0?void 0:C.length)||1;x===3&&(x=4,T.data.push(0));var $=f/4%4;if($>0){var Q=4-$;if(x>1&&x<=Q)x===2&&(Q===3&&(f+=4,d.push(0)),d.push.apply(d,Wt(T.data)),i.uniformGPUBufferLayout.push({name:T.name,offset:f}));else{for(var X=0;X<Q;X++)f+=4,d.push(0);d.push.apply(d,Wt(T.data)),i.uniformGPUBufferLayout.push({name:T.name,offset:f})}}f+=4*x}}),this.uniformBuffer=new Ai(this.engine,{data:d instanceof Array?new Float32Array(d):d,usage:be.BufferUsage.Uniform|be.BufferUsage.CopyDst}),this.bindGroupEntries.push({binding:0,resource:{buffer:this.uniformBuffer.get()}})),s.forEach(function(T){if(T.data!==null&&(T.type===$n.Vector4FloatArray||T.type===$n.FloatArray)){var C;T.name===i.context.output.name?(C=new Ai(i.engine,{data:isFinite(Number(T.data))?[T.data]:T.data,usage:be.BufferUsage.Storage|be.BufferUsage.CopyDst|be.BufferUsage.CopySrc}),i.outputBuffer=C,i.context.output={name:T.name,length:isFinite(Number(T.data))?1:T.data.length,typedArrayConstructor:Float32Array,gpuBuffer:C.get()}):T.isReferer?T.data.model&&T.data.model.outputBuffer&&(C=T.data.model.outputBuffer):C=new Ai(i.engine,{data:isFinite(Number(T.data))?[T.data]:T.data,usage:be.BufferUsage.Storage|be.BufferUsage.CopyDst|be.BufferUsage.CopySrc}),i.vertexBuffers[T.name]=C,i.bindGroupEntries.push({binding:c,resource:{name:T.name,refer:C?void 0:T.data,buffer:C?C.get():void 0}}),c++}}),this.computePipeline=this.engine.device.createComputePipeline({computeStage:o}),console.log(this.bindGroupEntries),this.bindGroup=this.engine.device.createBindGroup({layout:this.computePipeline.getBindGroupLayout(0),entries:this.bindGroupEntries});case 13:case"end":return g.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r=this;this.uniformBuffer&&this.uniformBuffer.destroy(),Object.keys(this.vertexBuffers).forEach(function(n){return r.vertexBuffers[n].destroy()})}},{key:"readData",value:function(){var t=_t(Ne.mark(function n(){var i,a,o,s,u,c,f,d,v,g;return Ne.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(i=this.context.output,!i){C.next=16;break}if(a=i.length,o=i.typedArrayConstructor,s=i.gpuBuffer,!s){C.next=16;break}return u=a*o.BYTES_PER_ELEMENT,c=this.engine.device.createBuffer({size:u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),f=this.engine.device.createCommandEncoder(),f.copyBufferToBuffer(s,0,c,0,u),d=_r?this.engine.device.getQueue():this.engine.device.defaultQueue,d.submit([f.finish()]),C.next=12,c.mapAsync(be.MapMode.Read);case 12:return v=c.getMappedRange(),g=new o(v.slice(0)),c.unmap(),C.abrupt("return",g);case 16:return C.abrupt("return",new Float32Array);case 17:case"end":return C.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"run",value:function(){if(this.engine.currentComputePass){var r;this.engine.currentComputePass.setPipeline(this.computePipeline),this.engine.currentComputePass.setBindGroup(0,this.bindGroup),(r=this.engine.currentComputePass).dispatch.apply(r,Wt(this.context.dispatch))}}},{key:"updateBuffer",value:function(r,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=this.vertexBuffers[r];a&&a.subData({data:n,offset:i})}},{key:"updateUniform",value:function(r,n){var i=this.uniformGPUBufferLayout.find(function(a){return a.name===r});i&&this.uniformBuffer.subData({data:Number.isFinite(n)?new Float32Array([n]):new Float32Array(n),offset:i.offset})}},{key:"confirmInput",value:function(r,n){var i=this.vertexBuffers[n],a=r.outputBuffer;if(i&&a&&i!==a){var o=this.engine.device.createCommandEncoder(),s=r.context.output,u=s.length,c=s.typedArrayConstructor,f=u*c.BYTES_PER_ELEMENT;o.copyBufferToBuffer(a.get(),0,i.get(),0,f);var d=_r?this.engine.device.getQueue():this.engine.device.defaultQueue;d.submit([o.finish()])}}},{key:"compileShaderToSpirV",value:function(r,n,i){return this.compileRawShaderToSpirV(i+r,n)}},{key:"compileRawShaderToSpirV",value:function(r,n){return this.engine.glslang.compileGLSL(r,n)}},{key:"compileComputePipelineStageDescriptor",value:function(){var t=_t(Ne.mark(function n(i){var a,o;return Ne.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(a=i,o=`#version 450
`,this.engine.options.useWGSL){u.next=6;break}return u.next=5,this.compileShaderToSpirV(i,"compute",o);case 5:a=u.sent;case 6:return u.abrupt("return",{computeStage:{module:this.engine.device.createShaderModule({code:a,isWHLSL:_r}),entryPoint:"main"}});case 7:case"end":return u.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()}]),e}(),jR=function(){function e(t,r){Le(this,e),this.engine=t,this.options=r,this.indexCount=void 0,this.buffer=void 0;var n=r,i=n.data;n.usage,n.type;var a=n.count;this.indexCount=a||0,this.buffer=new Ai(t,{data:i instanceof Array?new Uint16Array(i):i,usage:be.BufferUsage.Index|be.BufferUsage.CopyDst})}return ze(e,[{key:"get",value:function(){return this.buffer}},{key:"subData",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),zR=function(){function e(t,r){Le(this,e),this.engine=t,this.options=r,this.colorTexture=void 0,this.depthTexture=void 0,this.width=0,this.height=0;var n=r;n.width,n.height;var i=n.color;n.colors;var a=n.depth;n.stencil,i&&(this.colorTexture=i),a&&(this.depthTexture=a)}return ze(e,[{key:"get",value:function(){var r,n;return{color:(r=this.colorTexture)===null||r===void 0?void 0:r.get(),depth:(n=this.depthTexture)===null||n===void 0?void 0:n.get()}}},{key:"destroy",value:function(){var r,n;(r=this.colorTexture)===null||r===void 0||r.destroy(),(n=this.depthTexture)===null||n===void 0||n.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;if(n!==this.width||i!==this.height){var a,o;(a=this.colorTexture)===null||a===void 0||a.resize({width:n,height:i}),(o=this.depthTexture)===null||o===void 0||o.resize({width:n,height:i})}this.width=n,this.height=i}}]),e}(),Qr,$r,kn,vr,_i,vo,ia,HR=(Qr={},Y(Qr,M.POINTS,be.PrimitiveTopology.PointList),Y(Qr,M.LINES,be.PrimitiveTopology.LineList),Y(Qr,M.LINE_LOOP,be.PrimitiveTopology.LineList),Y(Qr,M.LINE_STRIP,be.PrimitiveTopology.LineStrip),Y(Qr,M.TRIANGLES,be.PrimitiveTopology.TriangleList),Y(Qr,M.TRIANGLE_FAN,be.PrimitiveTopology.TriangleList),Y(Qr,M.TRIANGLE_STRIP,be.PrimitiveTopology.TriangleStrip),Qr),XR=($r={},Y($r,M.NEVER,be.CompareFunction.Never),Y($r,M.ALWAYS,be.CompareFunction.Always),Y($r,M.LESS,be.CompareFunction.Less),Y($r,M.LEQUAL,be.CompareFunction.LessEqual),Y($r,M.GREATER,be.CompareFunction.Greater),Y($r,M.GEQUAL,be.CompareFunction.GreaterEqual),Y($r,M.EQUAL,be.CompareFunction.Equal),Y($r,M.NOTEQUAL,be.CompareFunction.NotEqual),$r),Bv=(kn={},Y(kn,M.FUNC_ADD,be.BlendOperation.Add),Y(kn,M.MIN_EXT,be.BlendOperation.Min),Y(kn,M.MAX_EXT,be.BlendOperation.Max),Y(kn,M.FUNC_SUBTRACT,be.BlendOperation.Subtract),Y(kn,M.FUNC_REVERSE_SUBTRACT,be.BlendOperation.ReverseSubtract),kn),po=(vr={},Y(vr,M.ZERO,be.BlendFactor.Zero),Y(vr,M.ONE,be.BlendFactor.One),Y(vr,M.SRC_COLOR,be.BlendFactor.SrcColor),Y(vr,M.ONE_MINUS_SRC_COLOR,be.BlendFactor.OneMinusSrcColor),Y(vr,M.SRC_ALPHA,be.BlendFactor.SrcAlpha),Y(vr,M.ONE_MINUS_SRC_ALPHA,be.BlendFactor.OneMinusSrcAlpha),Y(vr,M.DST_COLOR,be.BlendFactor.DstColor),Y(vr,M.ONE_MINUS_DST_COLOR,be.BlendFactor.OneMinusDstColor),Y(vr,M.DST_ALPHA,be.BlendFactor.DstAlpha),Y(vr,M.ONE_MINUS_DST_ALPHA,be.BlendFactor.OneMinusDstAlpha),Y(vr,M.CONSTANT_COLOR,be.BlendFactor.BlendColor),Y(vr,M.ONE_MINUS_CONSTANT_COLOR,be.BlendFactor.OneMinusBlendColor),Y(vr,M.SRC_ALPHA_SATURATE,be.BlendFactor.SrcAlphaSaturated),vr),WR=(_i={},Y(_i,M.ALPHA,"r8unorm"),Y(_i,M.RGBA,"rgba8unorm"),Y(_i,M.DEPTH_COMPONENT,"depth32float"),Y(_i,M.DEPTH_STENCIL,"depth24plus-stencil8"),_i),Uv=(vo={},Y(vo,M.NEAREST,"nearest"),Y(vo,M.LINEAR,"linear"),vo),iu=(ia={},Y(ia,M.REPEAT,"repeat"),Y(ia,M.CLAMP_TO_EDGE,"clamp-to-edge"),Y(ia,M.MIRRORED_REPEAT,"mirror-repeat"),ia);function YR(e){var t=e.cull;if(!t||!t.enable)return be.CullMode.None;if(t.face)return t.face===M.FRONT?be.CullMode.Front:be.CullMode.Back}function qR(e){var t=e.depth;e.stencil;var r={compare:be.CompareFunction.Always,depthFailOp:be.StencilOperation.Keep,failOp:be.StencilOperation.Keep,passOp:be.StencilOperation.Keep};return{depthWriteEnabled:t&&t.enable,depthCompare:XR[(t==null?void 0:t.func)||M.ALWAYS],format:be.TextureFormat.Depth24PlusStencil8,stencilFront:r,stencilBack:r,stencilReadMask:4294967295,stencilWriteMask:4294967295}}function KR(e,t){var r=e.blend;return[{format:t,alphaBlend:{srcFactor:po[r&&r.func&&r.func.srcAlpha||M.ONE],dstFactor:po[r&&r.func&&r.func.dstAlpha||M.ZERO],operation:Bv[r&&r.equation&&r.equation.alpha||M.FUNC_ADD]},colorBlend:{srcFactor:po[r&&r.func&&r.func.srcRGB||M.ONE],dstFactor:po[r&&r.func&&r.func.dstRGB||M.ZERO],operation:Bv[r&&r.equation&&r.equation.rgb||M.FUNC_ADD]},writeMask:be.ColorWrite.All}]}function $v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ei(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$v(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$v(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QR(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,o=n;a<o.length;a++){var s=o[a];t+=s.length}for(var u=new e(t),c=0,f=0,d=n;f<d.length;f++){var v=d[f];u.set(v,c),c+=v.length}return u}var ZR=function(){function e(t,r){Le(this,e),this.engine=t,this.options=r,this.pipelineLayout=void 0,this.renderPipeline=void 0,this.uniformsBindGroupLayout=void 0,this.uniformBindGroup=void 0,this.uniformBuffer=void 0,this.uniforms={},this.uniformGPUBufferLayout=[],this.attributeCache={},this.indexBuffer=void 0,this.indexCount=void 0}return ze(e,[{key:"init",value:function(){var t=_t(Ne.mark(function n(){var i=this,a,o,s,u,c,f,d,v,g,T,C,x,$,Q,X,he;return Ne.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return a=this.options,o=a.vs,s=a.fs,u=a.attributes,c=a.uniforms,f=a.primitive,a.count,d=a.elements,v=a.depth,g=a.blend,T=a.stencil,C=a.cull,a.instances,Ae.next=3,this.compilePipelineStageDescriptor(o,s,null);case 3:x=Ae.sent,$=x.vertexStage,Q=x.fragmentStage,c&&this.buildUniformBindGroup(c),d&&(this.indexBuffer=d.get(),this.indexCount=d.indexCount),X={vertexBuffers:Object.keys(u).map(function(Ie,Ve){var tt=u[Ie],$e=tt.get(),Ke=$e.arrayStride,He=$e.stepMode,lt=$e.attributes;return i.attributeCache[Ie]=tt,{arrayStride:Ke,stepMode:He,attributes:lt}})},he={sampleCount:this.engine.mainPassSampleCount,primitiveTopology:HR[f||M.TRIANGLES],rasterizationState:Ei(Ei({},this.getDefaultRasterizationStateDescriptor()),{},{cullMode:YR({cull:C})}),depthStencilState:qR({depth:v,stencil:T}),colorStates:KR({blend:g},this.engine.options.swapChainFormat),layout:this.pipelineLayout,vertexStage:$,fragmentStage:Q,vertexState:X},this.renderPipeline=this.engine.device.createRenderPipeline(he);case 11:case"end":return Ae.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"addUniforms",value:function(r){this.uniforms=Ei(Ei({},this.uniforms),va(r))}},{key:"draw",value:function(r){var n=this,i=this.engine.getCurrentRenderPass(),a=Ei(Ei({},this.uniforms),va(r.uniforms||{})),o=[];Object.keys(a).forEach(function(s){var u=wi(a[s]);if(u==="boolean"||u==="number"||Array.isArray(a[s])||a[s].BYTES_PER_ELEMENT){var c,f=(c=n.uniformGPUBufferLayout.find(function($){var Q=$.name;return Q===s}))===null||c===void 0?void 0:c.offset;f!==null&&n.uniformBuffer.subData({data:a[s],offset:f})}else{var d,v=(d=n.uniformGPUBufferLayout.find(function($){var Q=$.name;return Q===s}))===null||d===void 0?void 0:d.offset;if(v!==null){var g=a[s].get(),T=g.color||g,C=T.texture,x=T.sampler;x&&(o.push({binding:v,resource:x}),v++),o.push({binding:v,resource:C.createView()})}}}),this.uniformBuffer&&(o[0]={binding:0,resource:{buffer:this.uniformBuffer.get()}}),this.uniformBindGroup=this.engine.device.createBindGroup({layout:this.uniformsBindGroupLayout,entries:o}),this.renderPipeline&&i.setPipeline(this.renderPipeline),i.setBindGroup(0,this.uniformBindGroup),this.indexBuffer&&i.setIndexBuffer(this.indexBuffer.get(),be.IndexFormat.Uint32,0),Object.keys(this.attributeCache).forEach(function(s,u){i.setVertexBuffer(0+u,n.attributeCache[s].get().buffer,0)}),this.indexBuffer?i.drawIndexed(this.indexCount,this.options.instances||1,0,0,0):i.draw(this.options.count||0,this.options.instances||0,0,0)}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}},{key:"compilePipelineStageDescriptor",value:function(){var t=_t(Ne.mark(function n(i,a,o){var s,u,c;return Ne.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(s=`#version 450
`,u=i,c=a,this.engine.options.useWGSL){d.next=10;break}return d.next=6,this.compileShaderToSpirV(i,"vertex",s);case 6:return u=d.sent,d.next=9,this.compileShaderToSpirV(a,"fragment",s);case 9:c=d.sent;case 10:return d.abrupt("return",this.createPipelineStageDescriptor(u,c));case 11:case"end":return d.stop()}},n,this)}));function r(n,i,a){return t.apply(this,arguments)}return r}()},{key:"compileShaderToSpirV",value:function(r,n,i){return this.compileRawShaderToSpirV(i+r,n)}},{key:"compileRawShaderToSpirV",value:function(r,n){return this.engine.glslang.compileGLSL(r,n)}},{key:"createPipelineStageDescriptor",value:function(r,n){return{vertexStage:{module:this.engine.device.createShaderModule({code:r,isWHLSL:_r}),entryPoint:"main"},fragmentStage:{module:this.engine.device.createShaderModule({code:n,isWHLSL:_r}),entryPoint:"main"}}}},{key:"getDefaultRasterizationStateDescriptor",value:function(){return{frontFace:be.FrontFace.CCW,cullMode:be.CullMode.None,depthBias:0,depthBiasSlopeScale:0,depthBiasClamp:0}}},{key:"buildUniformBindGroup",value:function(r){var n=this,i=0,a=QR.apply(void 0,[Float32Array].concat(Wt(Object.keys(r).map(function(u){return r[u]?(n.uniformGPUBufferLayout.push({name:u,offset:i}),i+=(r[u].length||1)*4,r[u]):[]})))),o=[],s=!1;a.length&&(s=!0,o.push({binding:0,visibility:be.ShaderStage.Fragment|be.ShaderStage.Vertex,type:be.BindingType.UniformBuffer})),Object.keys(r).filter(function(u){return r[u]===null}).forEach(function(u,c){n.uniformGPUBufferLayout.push({name:u,offset:c*2+(s?1:0)}),o.push({binding:c*2+(s?1:0),visibility:be.ShaderStage.Fragment,type:be.BindingType.Sampler},{binding:c*2+(s?1:0)+1,visibility:be.ShaderStage.Fragment,type:be.BindingType.SampledTexture})}),this.uniformsBindGroupLayout=this.engine.device.createBindGroupLayout({entries:o}),this.pipelineLayout=this.engine.device.createPipelineLayout({bindGroupLayouts:[this.uniformsBindGroupLayout]}),s&&(this.uniformBuffer=new Ai(this.engine,{data:a instanceof Array?new Float32Array(a):a,usage:be.BufferUsage.Uniform|be.BufferUsage.CopyDst}))}}]),e}(),JR=function(){function e(t,r){Le(this,e),this.engine=t,this.options=r,this.texture=void 0,this.sampler=void 0,this.width=void 0,this.height=void 0,this.createTexture()}return ze(e,[{key:"get",value:function(){return{texture:this.texture,sampler:this.sampler}}},{key:"update",value:function(){}},{key:"resize",value:function(r){var n=r.width,i=r.height;(n!==this.width||i!==this.height)&&(this.destroy(),this.createTexture()),this.width=n,this.height=i}},{key:"destroy",value:function(){this.texture&&this.texture.destroy()}},{key:"createTexture",value:function(){var r=this.options;r.data;var n=r.type;n===void 0&&M.UNSIGNED_BYTE;var i=r.width,a=r.height;r.flipY;var o=r.format,s=o===void 0?M.RGBA:o;r.mipmap;var u=r.wrapS,c=u===void 0?M.CLAMP_TO_EDGE:u,f=r.wrapT,d=f===void 0?M.CLAMP_TO_EDGE:f,v=r.aniso,g=v===void 0?0:v;r.alignment,r.premultiplyAlpha;var T=r.mag,C=T===void 0?M.NEAREST:T,x=r.min,$=x===void 0?M.NEAREST:x,Q=r.colorSpace;Q===void 0&&M.BROWSER_DEFAULT_WEBGL;var X=r.usage;this.width=i,this.height=a,this.texture=this.engine.device.createTexture({size:[i,a,1],mipLevelCount:1,sampleCount:1,dimension:be.TextureDimension.E2d,format:WR[s],usage:X||be.TextureUsage.Sampled|be.TextureUsage.CopyDst}),(!X||X&be.TextureUsage.Sampled)&&(this.sampler=this.engine.device.createSampler({addressModeU:iu[c],addressModeV:iu[d],addressModeW:iu[c],magFilter:Uv[C],minFilter:Uv[$],maxAnisotropy:g}))}}]),e}(),Vv,jv,zv,eC=(Vv=gt(),Vv(jv=(zv=function(){function e(){var t=this;Le(this,e),this.supportWebGPU=!0,this.useWGSL=!1,this.options=void 0,this.canvas=void 0,this.context=void 0,this.glslang=void 0,this.adapter=void 0,this.device=void 0,this.swapChain=void 0,this.mainPassSampleCount=void 0,this.mainTexture=void 0,this.depthTexture=void 0,this.mainColorAttachments=void 0,this.mainTextureExtends=void 0,this.mainDepthAttachment=void 0,this.uploadEncoder=void 0,this.renderEncoder=void 0,this.computeEncoder=void 0,this.renderTargetEncoder=void 0,this.commandBuffers=new Array(4).fill(void 0),this.currentRenderPass=null,this.mainRenderPass=null,this.currentRenderTargetViewDescriptor=void 0,this.currentComputePass=null,this.bundleEncoder=void 0,this.tempBuffers=[],this.currentRenderTarget=null,this.uploadEncoderDescriptor={label:"upload"},this.renderEncoderDescriptor={label:"render"},this.renderTargetEncoderDescriptor={label:"renderTarget"},this.computeEncoderDescriptor={label:"compute"},this.pipelines={},this.computePipelines={},this.defaultSampleCount=4,this.clearDepthValue=1,this.clearStencilValue=0,this.transientViewport={x:1/0,y:0,width:0,height:0},this.cachedViewport={x:0,y:0,width:0,height:0},this.clear=function(r){r.framebuffer;var n=r.color,i=r.depth,a=r.stencil;t.options.supportCompute&&t.startComputePass(),t.currentRenderTarget?(t.currentRenderPass&&t.endRenderTargetRenderPass(),t.startRenderTargetRenderPass(t.currentRenderTarget,n||null,!!i,!!a)):(t.mainColorAttachments[0].loadValue=n||be.LoadOp.Load,t.mainDepthAttachment.depthLoadValue=i||be.LoadOp.Load,t.mainDepthAttachment.stencilLoadValue=a?t.clearStencilValue:be.LoadOp.Load,t.mainRenderPass&&t.endMainRenderPass(),t.startMainRenderPass())},this.createModel=function(){var r=_t(Ne.mark(function n(i){var a;return Ne.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=new ZR(t,i),s.next=3,a.init();case 3:return s.abrupt("return",a);case 4:case"end":return s.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.createAttribute=function(r){return new UR(t,r)},this.createBuffer=function(r){return new Ai(t,r)},this.createElements=function(r){return new jR(t,r)},this.createTexture2D=function(r){return new JR(t,r)},this.createFramebuffer=function(r){return new zR(t,r)},this.useFramebuffer=function(r,n){t.currentRenderTarget&&t.unbindFramebuffer(t.currentRenderTarget),t.currentRenderTarget=r,t.currentRenderTargetViewDescriptor={dimension:be.TextureViewDimension.E2d,arrayLayerCount:1,aspect:be.TextureAspect.All},t.currentRenderPass=null,n()},this.createComputeModel=function(){var r=_t(Ne.mark(function n(i){var a;return Ne.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=new VR(t,i),s.next=3,a.init();case 3:return s.abrupt("return",a);case 4:case"end":return s.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.getCanvas=function(){return t.canvas},this.getGLContext=function(){throw new Error("Method not implemented.")},this.viewport=function(r){var n=r.x,i=r.y,a=r.width,o=r.height;if(!t.currentRenderPass)t.transientViewport={x:n,y:i,width:a,height:o};else if(t.transientViewport.x!==1/0){var s=t.getCurrentRenderPass();s.setViewport(t.transientViewport.x,t.transientViewport.y,t.transientViewport.width,t.transientViewport.height,0,1)}else if(n!==t.cachedViewport.x||i!==t.cachedViewport.y||a!==t.cachedViewport.width||o!==t.cachedViewport.height){t.cachedViewport={x:n,y:i,width:a,height:o};var u=t.getCurrentRenderPass();u.setViewport(n,i,a,o,0,1)}},this.readPixels=function(r){throw new Error("Method not implemented.")}}return ze(e,[{key:"isFloatSupported",value:function(){return!0}},{key:"init",value:function(){var t=_t(Ne.mark(function n(i){return Ne.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.canvas=i.canvas,this.options=i,this.useWGSL=!!i.useWGSL,this.mainPassSampleCount=i.antialiasing?this.defaultSampleCount:1,o.next=6,this.initGlslang();case 6:this.initContextAndSwapChain(),this.initMainAttachments();case 8:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"setScissor",value:function(r){throw new Error("Method not implemented.")}},{key:"destroy",value:function(){this.mainTexture&&this.mainTexture.destroy(),this.depthTexture&&this.depthTexture.destroy(),this.tempBuffers.forEach(function(r){return r.destroy()}),this.tempBuffers=[]}},{key:"beginFrame",value:function(){this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),this.renderEncoder=this.device.createCommandEncoder(this.renderEncoderDescriptor),this.renderTargetEncoder=this.device.createCommandEncoder(this.renderTargetEncoderDescriptor),this.options.supportCompute&&(this.computeEncoder=this.device.createCommandEncoder(this.computeEncoderDescriptor))}},{key:"endFrame",value:function(){this.options.supportCompute&&this.endComputePass(),this.endMainRenderPass(),this.commandBuffers[0]=this.uploadEncoder.finish(),this.commandBuffers[1]=this.renderEncoder.finish(),this.options.supportCompute&&(this.commandBuffers[2]=this.computeEncoder.finish()),this.commandBuffers[3]=this.renderTargetEncoder.finish(),_r?this.device.getQueue().submit(this.commandBuffers.filter(function(r){return r})):this.device.defaultQueue.submit(this.commandBuffers.filter(function(r){return r}))}},{key:"getCurrentRenderPass",value:function(){return this.currentRenderTarget&&!this.currentRenderPass?this.startRenderTargetRenderPass(this.currentRenderTarget,null,!1,!1):this.currentRenderPass||this.startMainRenderPass(),this.currentRenderPass}},{key:"initGlslang",value:function(){var t=_t(Ne.mark(function n(){var i,a;return Ne.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,BR();case 2:return this.glslang=s.sent,s.next=5,(i=navigator)===null||i===void 0||(a=i.gpu)===null||a===void 0?void 0:a.requestAdapter();case 5:return this.adapter=s.sent,s.next=8,this.adapter.requestDevice();case 8:this.device=s.sent;case 9:case"end":return s.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"initContextAndSwapChain",value:function(){this.context=this.canvas.getContext(_r?"gpu":"gpupresent"),this.swapChain=this.context.configureSwapChain({device:this.device,format:this.options.swapChainFormat,usage:be.TextureUsage.OutputAttachment|be.TextureUsage.CopySrc})}},{key:"initMainAttachments",value:function(){if(this.mainTextureExtends={width:this.canvas.width,height:this.canvas.height,depth:1},this.options.antialiasing){var r={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:be.TextureDimension.E2d,format:be.TextureFormat.BGRA8Unorm,usage:be.TextureUsage.OutputAttachment};this.mainTexture&&this.mainTexture.destroy(),this.mainTexture=this.device.createTexture(r),this.mainColorAttachments=[{attachment:_r?this.mainTexture.createDefaultView():this.mainTexture.createView(),loadValue:[0,0,0,1],storeOp:be.StoreOp.Store}]}else this.mainColorAttachments=[{attachment:_r?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),loadValue:[0,0,0,1],storeOp:be.StoreOp.Store}];var n={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:be.TextureDimension.E2d,format:_r?"depth32float-stencil8":be.TextureFormat.Depth24PlusStencil8,usage:be.TextureUsage.OutputAttachment};this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture(n),this.mainDepthAttachment={attachment:_r?this.depthTexture.createDefaultView():this.depthTexture.createView(),depthLoadValue:this.clearDepthValue,depthStoreOp:be.StoreOp.Store,stencilLoadValue:this.clearStencilValue,stencilStoreOp:be.StoreOp.Store}}},{key:"startComputePass",value:function(){this.currentComputePass&&this.endComputePass(),this.currentComputePass=this.computeEncoder.beginComputePass()}},{key:"startMainRenderPass",value:function(){this.currentRenderPass&&!this.currentRenderTarget&&this.endMainRenderPass(),this.options.antialiasing?this.mainColorAttachments[0].resolveTarget=_r?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView():this.mainColorAttachments[0].attachment=_r?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),this.currentRenderPass=this.renderEncoder.beginRenderPass({colorAttachments:this.mainColorAttachments,depthStencilAttachment:this.mainDepthAttachment}),this.mainRenderPass=this.currentRenderPass,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"startRenderTargetRenderPass",value:function(r,n,i){var a,o,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,u=(a=r.get().color)===null||a===void 0?void 0:a.texture,c;u&&(c=u.createView(this.currentRenderTargetViewDescriptor));var f=(o=r.get().depth)===null||o===void 0?void 0:o.texture,d;f&&(d=f.createView());var v=this.renderTargetEncoder.beginRenderPass({colorAttachments:[{attachment:c,loadValue:n!==null?n:be.LoadOp.Load,storeOp:be.StoreOp.Store}],depthStencilAttachment:f&&d?{attachment:d,depthLoadValue:i?this.clearDepthValue:be.LoadOp.Load,depthStoreOp:be.StoreOp.Store,stencilLoadValue:s?this.clearStencilValue:be.LoadOp.Load,stencilStoreOp:be.StoreOp.Store}:void 0});this.currentRenderPass=v,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"endMainRenderPass",value:function(){this.currentRenderPass===this.mainRenderPass&&this.currentRenderPass!==null&&(this.currentRenderPass.endPass(),this.resetCachedViewport(),this.currentRenderPass=null,this.mainRenderPass=null)}},{key:"endComputePass",value:function(){this.currentComputePass&&(this.currentComputePass.endPass(),this.currentComputePass=null)}},{key:"endRenderTargetRenderPass",value:function(){this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport())}},{key:"resetCachedViewport",value:function(){this.cachedViewport={x:0,y:0,width:0,height:0}}},{key:"unbindFramebuffer",value:function(r){this.currentRenderPass&&this.currentRenderPass!==this.mainRenderPass&&this.endRenderTargetRenderPass(),this.transientViewport.x=1/0,this.currentRenderTarget=null,this.currentRenderPass=this.mainRenderPass}}]),e}(),zv))||jv),Hv,Xv;function tC(e){var t=rC();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function rC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Tu=4/64,Wv=1-Tu*2,nC=(Hv=gt(),Hv(Xv=function(e){ur(r,e);var t=tC(r);function r(){return Le(this,r),t.apply(this,arguments)}return ze(r,[{key:"onEntityCreated",value:function(){var i=this.config,a=i.widthSegments,o=a===void 0?1:a,s=i.heightSegments,u=s===void 0?1:s,c=i.depthSegments,f=c===void 0?1:c,d=i.halfExtents,v=d===void 0?st(.5,.5,.5):d,g=o,T=u,C=f,x=ko(v,3),$=x[0],Q=x[1],X=x[2],he=[st(-$,-Q,X),st($,-Q,X),st($,Q,X),st(-$,Q,X),st($,-Q,-X),st(-$,-Q,-X),st(-$,Q,-X),st($,Q,-X)],ae=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],Ae=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Ie={FRONT:0,BACK:1,TOP:2,BOTTOM:3,RIGHT:4,LEFT:5},Ve=[],tt=[],$e=[],Ke=[],He=0,lt=function(mt,ct,Lt){var Ct,Tt,qt,Mr;for(qt=0;qt<=ct;qt++)for(Mr=0;Mr<=Lt;Mr++){var Mt=At(),Hn=At(),Xn=At(),nn=At();Un(Mt,he[ae[mt][0]],he[ae[mt][1]],qt/ct),Un(Hn,he[ae[mt][0]],he[ae[mt][2]],Mr/Lt),mu(Xn,Hn,he[ae[mt][0]]),tn(nn,Mt,Xn),Ct=qt/ct,Tt=Mr/Lt,Ve.push(nn[0],nn[1],nn[2]),tt.push(Ae[mt][0],Ae[mt][1],Ae[mt][2]),$e.push(Ct,Tt),Ct/=3,Tt/=3,Ct=Ct*Wv+Tu,Tt=Tt*Wv+Tu,Ct+=mt%3/3,Tt+=Math.floor(mt/3)/3,qt<ct&&Mr<Lt&&(Ke.push(He+Lt+1,He+1,He),Ke.push(He+Lt+1,He+Lt+2,He+1)),He++}};lt(Ie.FRONT,g,T),lt(Ie.BACK,g,T),lt(Ie.TOP,g,C),lt(Ie.BOTTOM,g,C),lt(Ie.RIGHT,C,T),lt(Ie.LEFT,C,T);var Me=Uu(Ve),wt=this.getComponent();wt.indices=Uint32Array.from(Ke),wt.aabb=Me,wt.vertexCount=He,wt.attributes=[{dirty:!0,name:"position",data:Float32Array.from(Ve),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(tt),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from($e),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(mn))||Xv);function iC(e,t){if(!e&&!t)throw new Error("Please specify valid arguments for parameters a and b.");if(!t||t.length===0)return e;if(!e||e.length===0)return t;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))throw new Error("The types of the two arguments passed for parameters a and b do not match.");var r=new e.constructor(e.length+t.length);return r.set(e),r.set(t,e.length),r}var Yv,qv;function aC(e){var t=oC();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function oC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var sC=(Yv=gt(),Yv(qv=function(e){ur(r,e);var t=aC(r);function r(){return Le(this,r),t.apply(this,arguments)}return ze(r,[{key:"onEntityCreated",value:function(){var i=this.config.geometries,a=i===void 0?[]:i,o=this.getComponent();o.aabb=new Bu;var s=[],u=[],c=0;a.forEach(function(f){var d=f.aabb,v=f.indices,g=f.vertexCount,T=f.attributes;o.aabb.add(d),o.vertexCount+=g,v&&u.push.apply(u,Wt(v.map(function(C){return C+c}))),c+=g,T.forEach(function(C,x){s[x]?C.data&&($u(C.data)?s[x].push(C.data):Py(C.data)?s[x].data=iC(s[x].data,C.data):s[x].data=s[x].data.concat(C.data)):(s[x]=C,s[x].dirty=!0)})}),o.attributes=s,o.indices=Uint32Array.from(u),o.dirty=!0}}]),r}(mn))||qv),Kv,Qv;function uC(e){var t=cC();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function cC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var fC=(Kv=gt(),Kv(Qv=function(e){ur(r,e);var t=uC(r);function r(){return Le(this,r),t.apply(this,arguments)}return ze(r,[{key:"onEntityCreated",value:function(){for(var i=this.config,a=i.halfExtents,o=a===void 0?[.5,.5]:a,s=i.widthSegments,u=s===void 0?5:s,c=i.lengthSegments,f=c===void 0?5:c,d=[],v=[],g=[],T=[],C=0,x=0;x<=u;x++)for(var $=0;$<=f;$++){var Q=-o[0]+2*o[0]*x/u,X=0,he=-(-o[1]+2*o[1]*$/f),ae=x/u,Ae=$/f;d.push(Q,X,he),v.push(0,1,0),g.push(ae,Ae),x<u&&$<f&&(T.push(C+f+1,C+1,C),T.push(C+f+1,C+f+2,C+1)),C++}var Ie=Uu(d),Ve=this.getComponent();Ve.indices=Uint32Array.from(T),Ve.aabb=Ie,Ve.vertexCount=C,Ve.attributes=[{dirty:!0,name:"position",data:Float32Array.from(d),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(v),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(g),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(mn))||Qv),Zv,Jv;function lC(e){var t=dC();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function dC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var hC=(Zv=gt(),Zv(Jv=function(e){ur(r,e);var t=lC(r);function r(){return Le(this,r),t.apply(this,arguments)}return ze(r,[{key:"onEntityCreated",value:function(){for(var i=this.config,a=i.radius,o=a===void 0?.5:a,s=i.latitudeBands,u=s===void 0?16:s,c=i.longitudeBands,f=c===void 0?16:c,d=[],v=[],g=[],T=[],C=0;C<=u;C++)for(var x=C*Math.PI/u,$=Math.sin(x),Q=Math.cos(x),X=0;X<=f;X++){var he=X*2*Math.PI/f-Math.PI/2,ae=Math.sin(he),Ae=Math.cos(he),Ie=Ae*$,Ve=Q,tt=ae*$,$e=1-X/f,Ke=1-C/u;d.push(Ie*o,Ve*o,tt*o),v.push(Ie,Ve,tt),g.push($e,Ke)}for(var He=0;He<u;++He)for(var lt=0;lt<f;++lt){var Me=He*(f+1)+lt,wt=Me+f+1;T.push(Me+1,wt,Me),T.push(Me+1,wt+1,wt)}var fr=Uu(d),mt=this.getComponent();mt.indices=Uint32Array.from(T),mt.aabb=fr,mt.vertexCount=d.length/3,mt.attributes=[{dirty:!0,name:"position",data:Float32Array.from(d),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(v),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(g),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(mn))||Jv),ep,tp,rp,np,mo,ip,ap,op;function vC(e){var t=pC();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function pC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var mC=`varying vec4 fragColor;

#pragma include "uv.frag.declaration"
#pragma include "map.frag.declaration"

void main() {
  vec4 diffuseColor = fragColor;

  #pragma include "map.frag.main"

  gl_FragColor = diffuseColor;
}`,yC=`attribute vec3 position;
attribute vec3 normal;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform vec4 color;

varying vec4 fragColor;

#pragma include "uv.vert.declaration"

void main() {
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  fragColor = color;

  #pragma include "uv.vert.main"
}`,_C=`// layout(set = 0, binding = 1) uniform WireframeUniforms {
//   float lineWidth;
//   vec4 lineColor;
// } wireframe;

layout(location = 0) in vec4 fragColor;
// layout(location = 1) in vec3 v_Barycentric;

layout(location = 0) out vec4 outColor;

// wireframe
// float edgeFactor() {
//   vec3 d = fwidth(v_Barycentric);
//   vec3 a3 = smoothstep(vec3(0.0), d * wireframe.lineWidth, v_Barycentric);
//   return min(min(a3.x, a3.y), a3.z);
// }

void main() {
  // outColor = mix(fragColor, wireframe.lineColor, (1.0 - edgeFactor()));
  outColor = fragColor;
}`,EC=`layout(set = 0, binding = 0) uniform Uniforms {
  vec4 color;
  mat4 projectionMatrix;
  mat4 modelViewMatrix;
} uniforms;

layout(location = 0) in vec3 position;
// layout(location = 1) in vec3 barycentric;

layout(location = 0) out vec4 fragColor;
// layout(location = 1) out vec3 v_Barycentric;

void main() {
  gl_Position = uniforms.projectionMatrix * uniforms.modelViewMatrix * vec4(position, 1.0);
  fragColor = uniforms.color;
  // v_Barycentric = barycentric;
}`,bC=(ep=gt(),tp=Ue(re.RenderEngine),rp=Ue(re.ShaderModuleService),ep(np=(mo=(op=function(e){ur(r,e);var t=vC(r);function r(){var n;Le(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),Ge(n,"engine",ip,jt(n)),Ge(n,"shaderModuleService",ap,jt(n)),n}return ze(r,[{key:"onEntityCreated",value:function(){var i=this.getComponent(),a=this.engine.supportWebGPU?EC:yC,o=this.engine.supportWebGPU?_C:mC;this.shaderModuleService.registerModule("material-basic",{vs:a,fs:o});var s=this.shaderModuleService.getModule("material-basic"),u=s.vs,c=s.fs,f=s.uniforms;i.vertexShaderGLSL=u,i.fragmentShaderGLSL=c,i.setUniform(f),this.config.map&&(i.setDefines({USE_UV:1,USE_MAP:1}),i.setUniform({map:this.config.map,uvTransform:Ta()}))}}]),r}(Ly),op),ip=Be(mo.prototype,"engine",[tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ap=Be(mo.prototype,"shaderModuleService",[rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mo))||np),sp,up,cp,fp,lp,dp,hp,aa,vp,pp,mp,yp;function gC(e){var t=TC();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function TC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var AC=`// generate grid, borrow from clay.gl viewer
// @see https://github.com/pissang/clay-viewer/blob/master/src/graphic/ground.glsl
#extension GL_OES_standard_derivatives : enable

varying vec3 v_Position;
// varying vec3 v_Normal;

uniform float u_GridSize : 5;
uniform float u_GridSize2 : .5;
uniform vec4 u_GridColor : [0, 0, 0, 1];
uniform vec4 u_GridColor2 : [0.3, 0.3, 0.3, 1];
uniform bool u_GridEnabled : true;

// uniform vec3 u_LightDirection;
// uniform vec3 u_LightColor;
// uniform vec3 u_Camera;

void main() {
  // vec3 n = v_Normal;
  // vec3 l = normalize(u_LightDirection);
  // float NdotL = clamp(dot(n, l), 0.001, 1.0);

  gl_FragColor = vec4(1.);

  if (u_GridEnabled) {
    float wx = v_Position.x;
    float wz = v_Position.z;
    // float x0 = abs(fract(wx / u_GridSize - 0.5) - 0.5) / fwidth(wx) * u_GridSize / 2.0;
    // float z0 = abs(fract(wz / u_GridSize - 0.5) - 0.5) / fwidth(wz) * u_GridSize / 2.0;

    float x1 = abs(fract(wx / u_GridSize2 - 0.5) - 0.5) / fwidth(wx) * u_GridSize2;
    float z1 = abs(fract(wz / u_GridSize2 - 0.5) - 0.5) / fwidth(wz) * u_GridSize2;

    // float v0 = 1.0 - clamp(min(x0, z0), 0.0, 1.0);
    float v1 = 1.0 - clamp(min(x1, z1), 0.0, 1.0);
    // if (v0 > 0.1) {
        // gl_FragColor = mix(gl_FragColor, u_GridColor, v0);
    // }
    // else {
        gl_FragColor = mix(gl_FragColor, u_GridColor2, v1);
    // }
  }

  // float shadowFactor = calcShadow(u_ShadowMap, v_PositionFromLight, l, n);
  // vec3 diffuseColor = u_LightColor * NdotL * shadowFactor;

  // gl_FragColor.rgb *= diffuseColor;
}`,SC=`attribute vec3 a_Position;

varying vec3 v_Position;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;

void main() {
  v_Position = a_Position;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_Position, 1.);
}`,wC=(sp=gt(),up=Ue(re.Systems),cp=zr(re.MaterialSystem),fp=Ue(re.Systems),lp=zr(re.GeometrySystem),dp=Ue(re.ShaderModuleService),sp(hp=(aa=(yp=function(e){ur(r,e);var t=gC(r);function r(){var n;Le(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),Ge(n,"materialSystem",vp,jt(n)),Ge(n,"geometrySystem",pp,jt(n)),Ge(n,"shaderModuleService",mp,jt(n)),n}return ze(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();s&&s.material&&(a==="gridColor"?(s.material.setUniform("u_GridColor",o),s.material.setUniform("u_GridColor2",o)):a==="gridSize"&&(s.material.setUniform("u_GridSize",o),s.material.setUniform("u_GridSize2",o)))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:SC,fs:AC});var i=this.shaderModuleService.getModule("grid"),a=i.vs,o=i.fs,s=i.uniforms,u=this.materialSystem.createShaderMaterial({vertexShader:a,fragmentShader:o});this.setMaterial(u);var c=this.geometrySystem.createBufferGeometry({vertexCount:4});this.setGeometry(c),u.setCull({enable:!1,face:M.BACK}).setDepth({enable:!0,func:M.LESS}),u.setUniform(s),this.setAttributes({gridColor:this.config.gridColor,gridSize:this.config.gridSize}),c.setIndex([0,3,2,2,1,0]),c.setAttribute("a_Position",Float32Array.from([-4,-1,-4,4,-1,-4,4,-1,4,-4,-1,4]),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})}}]),r}(pn),yp),vp=Be(aa.prototype,"materialSystem",[up,cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp=Be(aa.prototype,"geometrySystem",[fp,lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=Be(aa.prototype,"shaderModuleService",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aa))||hp),Dy=1e-6,Fy=RC;function RC(){var e=new Float32Array(2);return e[0]=0,e[1]=0,e}var CC=xC;function xC(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}var NC=OC;function OC(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r}var IC=PC;function PC(e,t){return e[0]=t[0],e[1]=t[1],e}var Gy=LC;function LC(e,t,r){return e[0]=t,e[1]=r,e}var MC=kC,_p=Dy;function kC(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(r-i)<=_p*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=_p*Math.max(1,Math.abs(n),Math.abs(a))}var DC=FC;function FC(e,t){return e[0]===t[0]&&e[1]===t[1]}var By=GC;function GC(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}var ju=BC;function BC(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}var Uy={exports:{}};(function(e){e.exports=ju})(Uy);var $y=UC;function UC(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}var Vy={exports:{}};(function(e){e.exports=$y})(Vy);var jy=$C;function $C(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}var zy={exports:{}};(function(e){e.exports=jy})(zy);var VC=jC;function jC(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}var zC=HC;function HC(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}var XC=WC;function WC(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}var YC=qC;function qC(e,t,r){var n=Math.cos(r),i=Math.sin(r),a=t[0],o=t[1];return e[0]=a*n-o*i,e[1]=a*i+o*n,e}var KC=QC;function QC(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}var ZC=JC;function JC(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}var ex=tx;function tx(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}var rx=nx;function nx(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}var ix=ax;function ax(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}var Hy=ox;function ox(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}var Xy={exports:{}};(function(e){e.exports=Hy})(Xy);var Wy=sx;function sx(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}var Yy={exports:{}};(function(e){e.exports=Wy})(Yy);var qy=ux;function ux(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}var Ky={exports:{}};(function(e){e.exports=qy})(Ky);var Qy=cx;function cx(e){var t=e[0],r=e[1];return t*t+r*r}var Zy={exports:{}};(function(e){e.exports=Qy})(Zy);var fx=lx;function lx(e,t){return e[0]=-t[0],e[1]=-t[1],e}var Jy=dx;function dx(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}var e_=hx;function hx(e,t){return e[0]*t[0]+e[1]*t[1]}var vx=px;function px(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}var mx=yx;function yx(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e}var _x=Ex;function Ex(e,t){t=t||1;var r=Math.random()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}var bx=gx;function gx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}var Tx=Ax;function Ax(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}var Sx=wx;function wx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}var Rx=Cx;function Cx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}var xx=Nx,bi=Fy();function Nx(e,t,r,n,i,a){var o,s;for(t||(t=2),r||(r=0),n?s=Math.min(n*t+r,e.length):s=e.length,o=r;o<s;o+=t)bi[0]=e[o],bi[1]=e[o+1],i(bi,bi,a),e[o]=bi[0],e[o+1]=bi[1];return e}var Ox=Ix;function Ix(e,t,r){var n=t[0]*t[0]+t[1]*t[1];if(n>r*r){var i=Math.sqrt(n);e[0]=t[0]/i*r,e[1]=t[1]/i*r}else e[0]=t[0],e[1]=t[1];return e}var yo={EPSILON:Dy,create:Fy,clone:CC,fromValues:NC,copy:IC,set:Gy,equals:MC,exactEquals:DC,add:By,subtract:ju,sub:Uy.exports,multiply:$y,mul:Vy.exports,divide:jy,div:zy.exports,inverse:VC,min:zC,max:XC,rotate:YC,floor:KC,ceil:ZC,round:ex,scale:rx,scaleAndAdd:ix,distance:Hy,dist:Xy.exports,squaredDistance:Wy,sqrDist:Yy.exports,length:qy,len:Ky.exports,squaredLength:Qy,sqrLen:Zy.exports,negate:fx,normalize:Jy,dot:e_,cross:vx,lerp:mx,random:_x,transformMat2:bx,transformMat2d:Tx,transformMat3:Sx,transformMat4:Rx,forEach:xx,limit:Ox},Px=By,Au=Gy,t_=Jy,Lx=ju,Mx=e_,Ep=[0,0],kx=function(t,r,n,i,a){return Px(t,n,i),t_(t,t),Au(r,-t[1],t[0]),Au(Ep,-n[1],n[0]),a/Mx(r,Ep)},_o=function(t,r){return Au(t,-r[1],r[0]),t},bp=function(t,r,n){return Lx(t,r,n),t_(t,t),t};function Eo(e,t,r,n,i){pa(t,n,-i),pa(t,n,i),e.push(r),e.push(r)}function pa(e,t,r){e.push([[t[0],t[1]],r])}function Dx(e,t,r){var n=[0,0],i=[0,0],a=[0,0],o=[0,0],s=-1,u=!1,c=null,f=yo.create(),d=r||0,v=3,g=[],T=[],C=[],x=[0,0];t&&(e=e.slice(),e.push(e[0]));for(var $=e.length,Q=1;Q<$;Q++){var X=d,he=e[Q-1],ae=e[Q],Ae=Q<e.length-1?e[Q+1]:null;if(x.push(Q/$,Q/$),bp(n,ae,he),c||(c=[0,0],_o(c,n)),u||(u=!0,Eo(T,g,he,c,1)),C.push([X+0,X+1,X+2]),!Ae)_o(c,n),Eo(T,g,ae,c,1),C.push(s===1?[X,X+2,X+3]:[X+2,X+1,X+3]),d+=2;else{bp(i,Ae,ae);var Ie=kx(a,o,n,i,1),Ve=yo.dot(a,c)<0?-1:1,tt=Ie>v;if(!isFinite(Ie)){_o(c,n),Eo(T,g,ae,c,1),C.push(s===1?[X,X+2,X+3]:[X+2,X+1,X+3]),d+=2,s=Ve;continue}tt?(Ie=v,x.push(Q/$),pa(g,c,-Ve),T.push(ae),pa(g,o,Ie*Ve),T.push(ae),C.push(s!==-Ve?[X,X+2,X+3]:[X+2,X+1,X+3]),C.push([X+2,X+3,X+4]),_o(f,i),yo.copy(c,f),pa(g,c,-Ve),T.push(ae),d+=3):(Eo(T,g,ae,o,Ie),C.push(s===1?[X,X+2,X+3]:[X+2,X+1,X+3]),Ve=-1,yo.copy(c,o),d+=2),s=Ve}}return{normals:g,attrIndex:C,attrPos:T,attrCounters:x}}var gp,Tp,Ap,Sp,wp,Rp,Cp,oa,xp,Np,Op,Ip;function Fx(e){var t=Gx();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function Gx(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Bx=`uniform float u_dash_array : 0.02;
uniform float u_dash_offset : 0;
uniform float u_dash_ratio : 0;
uniform float u_thickness : 0.02;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_counters;

void main() {
    float blur = 1. - smoothstep(0.98, 1., length(v_normal));

    gl_FragColor = v_color;
    gl_FragColor.a *= blur * ceil(mod(v_counters + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));
}`,Ux=`attribute vec2 a_pos;
attribute vec4 a_color;
attribute float a_line_miter;
attribute vec2 a_line_normal;
attribute float a_counters;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform float u_thickness : 0.02;
uniform vec2 u_viewport;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_counters;

void main() {
  v_color = a_color;
  v_counters = a_counters;

  vec3 normal = normalize(vec3(a_line_normal, 0.0));

  vec4 offset = vec4(normal * u_thickness / 2.0 * a_line_miter, 0.0);

  v_normal = vec2(normal * sign(a_line_miter));

  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_pos, 0.0, 1.0) + offset;
}
`,$x=(gp=gt(),Tp=Ue(re.Systems),Ap=zr(re.MaterialSystem),Sp=Ue(re.Systems),wp=zr(re.GeometrySystem),Rp=Ue(re.ShaderModuleService),gp(Cp=(oa=(Ip=function(e){ur(r,e);var t=Fx(r);function r(){var n;Le(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),Ge(n,"materialSystem",xp,jt(n)),Ge(n,"geometrySystem",Np,jt(n)),Ge(n,"shaderModuleService",Op,jt(n)),n.vertexCount=void 0,n}return ze(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();if(s&&s.material)switch(a){case"dashArray":s.material.setUniform("u_dash_array",o);break;case"dashOffset":s.material.setUniform("u_dash_offset",o);break;case"dashRatio":s.material.setUniform("u_dash_ratio",o);break;case"thickness":s.material.setUniform("u_thickness",o);break;case"color":var u=new Array(this.vertexCount).fill(void 0).map(function(){return o}).reduce(function(c,f){return[].concat(Wt(c),Wt(f))},[]);s.geometry.setAttribute("a_color",Float32Array.from(u),{arrayStride:4*4,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]});break}}},{key:"onEntityCreated",value:function(){var i=this;this.shaderModuleService.registerModule("line",{vs:Ux,fs:Bx});var a=this.shaderModuleService.getModule("line"),o=a.vs,s=a.fs,u=a.uniforms,c=this.materialSystem.createShaderMaterial({vertexShader:o,fragmentShader:s}),f=Dx(this.config.points,!1),d=f.normals,v=f.attrIndex,g=f.attrPos,T=f.attrCounters,C=g.length;this.vertexCount=C;var x=this.geometrySystem.createBufferGeometry({vertexCount:C});this.setMaterial(c),this.setGeometry(x),c.setCull({enable:!1,face:M.BACK}).setUniform(u),this.setAttributes({dashArray:this.config.dashArray,dashOffset:this.config.dashOffset,dashRatio:this.config.dashRatio,thickness:this.config.thickness});var $=[],Q=[];d.forEach(function(he){var ae=he[0],Ae=he[1];$.push([ae[0],ae[1]]),Q.push(Ae)}),x.setIndex(v.reduce(function(he,ae){return[].concat(Wt(he),Wt(ae))},[])),x.setAttribute("a_pos",Float32Array.from(g.reduce(function(he,ae){return[].concat(Wt(he),Wt(ae))},[])),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]});var X=new Array(C).fill(void 0).map(function(){return Wt(i.config.color)}).reduce(function(he,ae){return[].concat(Wt(he),Wt(ae))},[]);x.setAttribute("a_color",Float32Array.from(X),{arrayStride:4*4,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]}),x.setAttribute("a_line_miter",Float32Array.from(Q),{arrayStride:4*1,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float"}]}),x.setAttribute("a_line_normal",Float32Array.from($.reduce(function(he,ae){return[].concat(Wt(he),Wt(ae))},[])),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:3,offset:0,format:"float2"}]}),x.setAttribute("a_counters",Float32Array.from(T),{arrayStride:4*1,stepMode:"vertex",attributes:[{shaderLocation:4,offset:0,format:"float"}]})}}]),r}(pn),Ip),xp=Be(oa.prototype,"materialSystem",[Tp,Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Np=Be(oa.prototype,"geometrySystem",[Sp,wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op=Be(oa.prototype,"shaderModuleService",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oa))||Cp);function Vx(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}var Pp,Lp,Mp,kp,Dp,Fp,Gp,sa,Bp,Up,$p,Vp;function jp(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function jx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jp(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zx(e){var t=Hx();return function(){var n=St(e),i;if(t){var a=St(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function Hx(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Xx=`uniform float u_blur : 0.05;
uniform float u_opacity : 0.7;
uniform float u_stroke_width : 0.01;
uniform vec4 u_stroke_color : [0, 0, 0, 0];
uniform float u_stroke_opacity : 1;

varying vec4 v_color;
varying vec4 v_data;
varying float v_radius;

#pragma include "sdf2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  // if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  // } else if (shape == 1) {
  //   outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
  //   inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  // } else if (shape == 2) {
  //   outer_df = sdBox(v_data.xy, vec2(1.));
  //   inner_df = sdBox(v_data.xy, vec2(r));
  // } else if (shape == 3) {
  //   outer_df = sdPentagon(v_data.xy, 0.8);
  //   inner_df = sdPentagon(v_data.xy, r * 0.8);
  // } else if (shape == 4) {
  //   outer_df = sdHexagon(v_data.xy, 0.8);
  //   inner_df = sdHexagon(v_data.xy, r * 0.8);
  // } else if (shape == 5) {
  //   outer_df = sdOctogon(v_data.xy, 1.0);
  //   inner_df = sdOctogon(v_data.xy, r);
  // } else if (shape == 6) {
  //   outer_df = sdHexagram(v_data.xy, 0.52);
  //   inner_df = sdHexagram(v_data.xy, r * 0.52);
  // } else if (shape == 7) {
  //   outer_df = sdRhombus(v_data.xy, vec2(1.0));
  //   inner_df = sdRhombus(v_data.xy, vec2(r));
  // } else if (shape == 8) {
  //   outer_df = sdVesica(v_data.xy, 1.1, 0.8);
  //   inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  // }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor.a = gl_FragColor.a * opacity_t;

  gl_FragColor = filterColor(gl_FragColor);
}`,Wx=`attribute vec2 position;
attribute vec4 color;
attribute float shape;
attribute vec2 offset;
attribute float size;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;

uniform float u_stroke_width : 0.01;
uniform float u_device_pixel_ratio;
uniform vec2 u_viewport;

varying vec4 v_color;
varying vec4 v_data;
varying float v_radius;

#pragma include "picking"

void main() {
  v_color = color;
  v_radius = size;

  lowp float antialiasblur = 1.0 / u_device_pixel_ratio * (size + u_stroke_width);

  // construct point coords
  v_data = vec4(position, antialiasblur, shape);

  gl_Position = projectionMatrix * modelViewMatrix
    * vec4(position * size + offset, 0.0, 1.0);

  setPickingColor(a_PickingColor);
}`,Yx=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],qx=(Pp=gt(),Lp=Ue(re.Systems),Mp=zr(re.MaterialSystem),kp=Ue(re.Systems),Dp=zr(re.GeometrySystem),Fp=Ue(re.ShaderModuleService),Pp(Gp=(sa=(Vp=function(e){ur(r,e);var t=zx(r);function r(){var n;Le(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),Ge(n,"materialSystem",Bp,jt(n)),Ge(n,"geometrySystem",Up,jt(n)),Ge(n,"shaderModuleService",$p,jt(n)),n}return ze(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();s&&s.material&&(a==="strokeWidth"?s.material.setUniform("u_stroke_width",o):a==="strokeColor"?s.material.setUniform("u_stroke_color",o):a==="strokeOpacity"?s.material.setUniform("u_stroke_opacity",o):a==="opacity"?s.material.setUniform("u_opacity",o):a==="blur"&&s.material.setUniform("u_blur",o))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:Wx,fs:Xx});var i=this.shaderModuleService.getModule("grid"),a=i.vs,o=i.fs,s=i.uniforms,u=this.materialSystem.createShaderMaterial({vertexShader:a,fragmentShader:o,cull:{enable:!1},depth:{enable:!1},blend:{enable:!0,func:{srcRGB:M.SRC_ALPHA,dstRGB:M.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}});u.setUniform(jx({u_device_pixel_ratio:window.devicePixelRatio},s));var c=this.buildAttributes(),f=this.geometrySystem.createInstancedBufferGeometry({maxInstancedCount:c.instancedOffsets.length/2,vertexCount:6});f.setIndex([0,2,1,0,3,2]),f.setAttribute("position",Float32Array.from(c.positions),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]}),f.setAttribute("offset",Float32Array.from(c.instancedOffsets),{arrayStride:4*2,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float2"}]}),f.setAttribute("color",Float32Array.from(c.instancedColors),{arrayStride:4*4,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]}),f.setAttribute("size",Float32Array.from(c.instancedSizes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float"}]}),f.setAttribute("shape",Float32Array.from(c.instancedShapes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:4,offset:0,format:"float"}]}),f.setAttribute("a_PickingColor",Float32Array.from(c.instancedPickingColors),{arrayStride:4*3,stepMode:"instance",attributes:[{shaderLocation:6,offset:0,format:"float3"}]}),this.setMaterial(u),this.setGeometry(f)}},{key:"buildAttribute",value:function(i,a,o){var s,u,c,f;(s=a.instancedPickingColors).push.apply(s,Wt(Vx(i.id||o))),a.instancedShapes.push(Yx.indexOf(i.shape||"circle")),(u=a.instancedColors).push.apply(u,Wt(i.color||[1,0,0,1])),(c=a.instancedOffsets).push.apply(c,Wt(i.position||[0,0])),(f=a.instancedSizes).push.apply(f,Wt(i.size||[.2,.2]))}},{key:"buildAttributes",value:function(){var i=this,a={positions:[1,1,1,-1,-1,-1,-1,1],instancedOffsets:[],instancedColors:[],instancedSizes:[],instancedShapes:[],instancedPickingColors:[]};return Array.isArray(this.config)?this.config.forEach(function(o,s){i.buildAttribute(o,a,s)}):this.buildAttribute(this.config,a,0),a}}]),r}(pn),Vp),Bp=Be(sa.prototype,"materialSystem",[Lp,Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Up=Be(sa.prototype,"geometrySystem",[kp,Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$p=Be(sa.prototype,"shaderModuleService",[Fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sa))||Gp),zp,Hp,Xp,Wp,Yp,ua,qp,Kp,Qp,Zp;function Jp(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=Kx(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function Kx(e,t){if(!!e){if(typeof e=="string")return em(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return em(e,t)}}function em(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Qx=`#ifdef USE_MAP
  uniform sampler2D map;
#endif`,Zx=`#ifdef USE_MAP
  vec4 texelColor = texture2D(map, vUv);
  // texelColor = mapTexelToLinear(texelColor);
  diffuseColor *= texelColor;
#endif`,Jx=`#if (defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ))
  varying vec2 vUv;
#endif`,e2=`#ifdef USE_UV
  attribute vec2 uv;
	#ifdef UVS_VERTEX_ONLY
    vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,t2=`#ifdef USE_UV
  vUv = (uvTransform * vec3(uv, 1)).xy;
#endif`,tm=(zp=gt(),Hp=Ue(re.RenderEngine),Xp=Ue(re.ShaderModuleService),Wp=Ue(re.ConfigService),zp(Yp=(ua=(Zp=function(){function e(){Le(this,e),this.container=void 0,Ge(this,"engine",qp,this),Ge(this,"shaderModule",Kp,this),Ge(this,"configService",Qp,this),this.inited=!1,this.rendering=!1,this.pendings=[],this.views=[],this.size=void 0}return ze(e,[{key:"init",value:function(){var t=_t(Ne.mark(function n(){var i,a,o,s,u;return Ne.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.shaderModule.registerBuiltinModules(),this.shaderModule.registerModule("uv.vert.declaration",{vs:e2}),this.shaderModule.registerModule("uv.vert.main",{vs:t2}),this.shaderModule.registerModule("uv.frag.declaration",{fs:Jx}),this.shaderModule.registerModule("map.frag.declaration",{fs:Qx}),this.shaderModule.registerModule("map.frag.main",{fs:Zx}),i=this.container.getAll(re.Systems),a=this.configService.get(),!a.canvas){f.next=30;break}return f.next=11,this.engine.init({canvas:a.canvas,swapChainFormat:be.TextureFormat.BGRA8Unorm,antialiasing:!1});case 11:o=Jp(i),f.prev=12,o.s();case 14:if((s=o.n()).done){f.next=21;break}if(u=s.value,!u.initialize){f.next=19;break}return f.next=19,u.initialize();case 19:f.next=14;break;case 21:f.next=26;break;case 23:f.prev=23,f.t0=f.catch(12),o.e(f.t0);case 26:return f.prev=26,o.f(),f.finish(26);case 29:this.inited=!0;case 30:case"end":return f.stop()}},n,this,[[12,23,26,29]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){var t=_t(Ne.mark(function n(){var i,a,o,s,u,c,f,d=arguments;return Ne.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(!this.inited||this.rendering)){g.next=2;break}return g.abrupt("return");case 2:for(this.pendings.length&&this.pendings.forEach(function(T){T()}),this.rendering=!0,this.engine.beginFrame(),i=this.container.getAll(re.Systems),a=d.length,o=new Array(a),s=0;s<a;s++)o[s]=d[s];u=Jp(i),g.prev=8,u.s();case 10:if((c=u.n()).done){g.next=17;break}if(f=c.value,!f.execute){g.next=15;break}return g.next=15,f.execute(o);case 15:g.next=10;break;case 17:g.next=22;break;case 19:g.prev=19,g.t0=g.catch(8),u.e(g.t0);case 22:return g.prev=22,u.f(),g.finish(22);case 25:this.engine.endFrame(),this.rendering=!1;case 27:case"end":return g.stop()}},n,this,[[8,19,22,25]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"clear",value:function(r){var n=this;return this.inited?this.engine.clear(r):this.pendings.unshift(function(){n.engine.clear(r),n.pendings.shift()}),this}},{key:"setSize",value:function(r){var n=r.width,i=r.height,a=this.engine.getCanvas();return this.size={width:n,height:i},a.width=n,a.height=i,this}},{key:"getSize",value:function(){return this.size}}]),e}(),Zp),qp=Be(ua.prototype,"engine",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=Be(ua.prototype,"shaderModule",[Xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qp=Be(ua.prototype,"configService",[Wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ua))||Yp),rm,nm,im,am=(rm=gt(),rm(nm=(im=function(){function e(){Le(this,e),this.entities=[]}return ze(e,[{key:"getEntities",value:function(){return this.entities}},{key:"addRenderable",value:function(r){return this.addEntity(r.getEntity()),this}},{key:"removeRenderable",value:function(r){return this.removeEntity(r.getEntity()),this}},{key:"addLight",value:function(){}},{key:"addEntity",value:function(r){return this.entities.indexOf(r)===-1&&this.entities.push(r),this}},{key:"removeEntity",value:function(r){var n=this.entities.indexOf(r);return this.entities.splice(n,1),this}}]),e}(),im))||nm),om,sm,um,r_=(om=gt(),om(sm=(um=function(){function e(){Le(this,e),this.cache={}}return ze(e,[{key:"get",value:function(r){return this.cache[r]}},{key:"set",value:function(r,n){this.cache[r]=n}}]),e}(),um))||sm),cm,fm,lm,dm,bo,hm,vm,pm;function mm(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ym(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mm(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var _m=(cm=gt(),fm=Ue(r_),lm=Ue(re.RenderEngine),cm(dm=(bo=(pm=function(){function e(){Le(this,e),Ge(this,"textureCache",hm,this),Ge(this,"engine",vm,this),this.config=void 0,this.loaded=!1,this.texture=void 0}return ze(e,[{key:"setConfig",value:function(r){this.config=r}},{key:"isLoaded",value:function(){return this.loaded}},{key:"load",value:function(){var t=_t(Ne.mark(function n(){var i=this;return Ne.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.config.url){o.next=4;break}return o.abrupt("return",new Promise(function(s,u){var c=i.textureCache.get(i.config.url);if(c)s(c);else{var f=new Image;f.crossOrigin="Anonymous",f.src=i.config.url,f.onload=function(){var d=i.engine.createTexture2D(ym(ym({},i.config),{},{data:f,width:f.width,height:f.height,flipY:!0}));i.textureCache.set(i.config.url,d),i.texture=d,i.loaded=!0,s(d)},f.onerror=function(){u()}}}));case 4:return this.loaded=!0,this.texture=this.engine.createTexture2D(this.config),o.abrupt("return",this.texture);case 7:case"end":return o.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()}]),e}(),pm),hm=Be(bo.prototype,"textureCache",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=Be(bo.prototype,"engine",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bo))||dm),Em,bm,gm,Tm,au,Am,Sm,wm=(Em=gt(),bm=Ue(re.Systems),gm=zr(re.RendererSystem),Em(Tm=(au=(Sm=function(){function e(){Le(this,e),Ge(this,"rendererSystem",Am,this),this.camera=void 0,this.scene=void 0,this.viewport={x:0,y:0,width:0,height:0},this.clearColor=[1,1,1,1]}return ze(e,[{key:"getCamera",value:function(){return this.camera}},{key:"getScene",value:function(){return this.scene}},{key:"getViewport",value:function(){return this.viewport}},{key:"getClearColor",value:function(){return this.clearColor}},{key:"setCamera",value:function(r){return this.camera=r,this}},{key:"setScene",value:function(r){return this.scene=r,this}},{key:"setViewport",value:function(r){return this.viewport=r,this}},{key:"setClearColor",value:function(r){return this.clearColor=r,this}},{key:"pick",value:function(r){return this.rendererSystem.pick(r,this)}}]),e}(),Sm),Am=Be(au.prototype,"rendererSystem",[bm,gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),au))||Tm),Rm,Cm,xm,ou,Nm,Om;function Im(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function r2(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Im(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Im(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}Rm=gt(),Cm=Ue(re.ConfigService),Rm(xm=(ou=(Om=function(){function e(){Le(this,e),Ge(this,"configService",Nm,this),this.container=void 0}return ze(e,[{key:"getEngine",value:function(){var t=_t(Ne.mark(function n(){var i,a,o,s;return Ne.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=this.container.get(re.RenderEngine),a=this.configService.get(),o=a.canvas,s=a.engineOptions,c.next=4,i.init(r2({canvas:o||Iy(),swapChainFormat:be.TextureFormat.BGRA8Unorm,antialiasing:!1},s));case 4:return c.abrupt("return",i);case 5:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getTransformComponent",value:function(r){var n=this.container.get(re.TransformComponentManager);return n.getComponentByEntity(r)}},{key:"getMeshComponent",value:function(r){var n=this.container.get(re.MeshComponentManager);return n.getComponentByEntity(r)}},{key:"setConfig",value:function(r){this.configService.set(r)}},{key:"setContainer",value:function(r){this.container=r}},{key:"getContainer",value:function(){return this.container}},{key:"createEntity",value:function(){return Vr()}},{key:"createScene",value:function(){return this.container.get(am)}},{key:"createCamera",value:function(){return this.container.get(qh)}},{key:"createView",value:function(){return this.container.get(wm)}},{key:"createRenderable",value:function(r,n){var i=r?this.container.getNamed(re.Renderable,r):this.container.get(pn),a=Vr();return i.setConfig(n||{}),i.setEntity(a),i}},{key:"createGeometry",value:function(r,n){var i=this.container.getNamed(re.Geometry,r),a=Vr();return i.setConfig(n||{}),i.setEntity(a),i.getComponent()}},{key:"createMaterial",value:function(r,n){var i=this.container.getNamed(re.Material,r),a=Vr();return i.setConfig(n||{}),i.setEntity(a,r),i.getComponent()}},{key:"createTexture2D",value:function(r){var n=this.container.get(_m);return n.setConfig(r),n}},{key:"createBufferGeometry",value:function(r){var n=this.container.getNamed(re.Systems,re.GeometrySystem);return n.createBufferGeometry(r)}},{key:"createInstancedBufferGeometry",value:function(r){var n=this.container.getNamed(re.Systems,re.GeometrySystem);return n.createInstancedBufferGeometry(r)}},{key:"createShaderMaterial",value:function(r){var n=this.container.getNamed(re.Systems,re.MaterialSystem);return n.createShaderMaterial(r)}},{key:"createKernel",value:function(r){var n=this.container.get(fv);return typeof r=="string"?n.setBundle(JSON.parse(r)):n.setBundle(r),n.init(),n}},{key:"createRenderer",value:function(){var r=this.container.get(tm);return r.container=this.container,r.init(),r}},{key:"destroy",value:function(){var r=this.container.getAll(re.Systems);r.forEach(function(a){a.tearDown&&a.tearDown()});var n=this.container.get(re.RenderEngine);n.destroy();var i=this.container.get(re.InteractorService);i.destroy()}}],[{key:"create",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=iw(),i=navigator.gpu?eC:kR;n.isBound(re.RenderEngine)||n.bind(re.RenderEngine).to(i).inSingletonScope(),n.bind(tm).toSelf(),n.bind(fv).toSelf(),n.bind(pn).toSelf(),n.bind(wm).toSelf(),n.bind(qh).toSelf(),n.bind(am).toSelf(),n.bind(e).toSelf(),n.bind(r_).toSelf(),n.bind(_m).toSelf(),n.bind(re.Geometry).to(nC).whenTargetNamed(mn.BOX),n.bind(re.Geometry).to(hC).whenTargetNamed(mn.SPHERE),n.bind(re.Geometry).to(fC).whenTargetNamed(mn.PLANE),n.bind(re.Geometry).to(sC).whenTargetNamed(mn.MERGED),n.bind(re.Material).to(bC).whenTargetNamed(Ly.BASIC),n.bind(re.Renderable).to(qx).whenTargetNamed(pn.POINT),n.bind(re.Renderable).to($x).whenTargetNamed(pn.LINE),n.bind(re.Renderable).to(wC).whenTargetNamed(pn.GRID);var a=n.get(e);return a.setContainer(n),a.setConfig(r),a}}]),e}(),Om),Nm=Be(ou.prototype,"configService",[Cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ou));globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;export{o2 as a,Uf as b,bn as g,s2 as i,u2 as l,Rg as n,wg as t};
