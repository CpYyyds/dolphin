import{d as Y,u as Q,bI as X,g as Z,r as $,G as ee,o as te,H as ae,I as S,c as e,h as x,an as oe,i as re}from"./index.02a17cf1.js";import{M as le}from"./index.08dd828f.js";import{u as ne,a as se}from"./use-modal.c59c2056.js";import{q as ue}from"./index.1f780a3d.js";import{A as D,a as V}from"./ArrowUpOutlined.5d908421.js";import{N as ie}from"./Icon.0cd298dd.js";import{N as pe}from"./Form.de76c832.js";import{N as l}from"./FormItem.aeb1ee46.js";import{N as v}from"./RadioGroup.7b709552.js";import{N as m}from"./Space.8a344b95.js";import{N as p}from"./Radio.4578e023.js";import{N as w}from"./Select.51d2f90f.js";import{a as de}from"./Checkbox.c8f5c3b1.js";import{N as ce}from"./InputNumber.cad532d0.js";import{N as fe}from"./RadioButton.2774fa7f.js";import{N as me}from"./DatePicker.d4b2a484.js";import{N as P}from"./Input.59461546.js";import{N as we}from"./DynamicInput.728c18a6.js";import{N as ve,a as O}from"./Grid.1918be0a.js";import{N as he}from"./Switch.a01ace9e.js";const _e="_startup_14f40_17",ke="_formItem_14f40_24",A={startup:_e,formItem:ke};function u(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!re(n)}const be={row:{type:Object,default:{}},show:{type:Boolean,default:!1},taskCode:{type:String}},Ne=Y({name:"workflowDefinitionStart",props:be,emits:["update:show","update:row","updateList"],setup(n,h){var G;const{t:c}=Q(),_=X(),{startState:f}=ne(),{variables:r,handleStartDefinition:k,getWorkerGroups:b,getTenantList:N,getAlertGroups:F,getEnvironmentList:y,getStartParamsList:L}=se(f,h),T=()=>{h.emit("update:show")},j=()=>{k(n.row.code,n.row.version)},E=()=>[{value:"NONE",label:c("project.workflow.none_send")},{value:"SUCCESS",label:c("project.workflow.success_send")},{value:"FAILURE",label:c("project.workflow.failure_send")},{value:"ALL",label:c("project.workflow.all_send")}],a=()=>[{value:"HIGHEST",label:"HIGHEST",color:"#ff0000",icon:D},{value:"HIGH",label:"HIGH",color:"#ff0000",icon:D},{value:"MEDIUM",label:"MEDIUM",color:"#EA7D24",icon:D},{value:"LOW",label:"LOW",color:"#2A8734",icon:V},{value:"LOWEST",label:"LOWEST",color:"#2A8734",icon:V}],t=Z(()=>_.name==="workflow-definition-detail"),d=o=>[x(ie,{style:{verticalAlign:"middle",marginRight:"4px",marginBottom:"3px"},color:o.color},{default:()=>x(o.icon)}),o.label],s=$({}),H=async o=>{o&&await ue(o).then(i=>{(i==null?void 0:i.preferences)&&i.state===1&&(s.value=JSON.parse(i.preferences))})},g=(o,i)=>{for(const{value:I}of o)if(i===I)return!0;return!1},W=async o=>{var i,I,R,U,C,M;await H(n.row.projectCode),(i=s.value)!=null&&i.taskPriority&&(o.workflowInstancePriority=s.value.taskPriority),(I=s.value)!=null&&I.warningType&&(o.warningType=s.value.warningType),(R=s.value)!=null&&R.workerGroup&&g(r.workerGroups,s.value.workerGroup)&&(o.workerGroup=s.value.workerGroup),(U=s.value)!=null&&U.tenant&&g(r.tenantList,s.value.tenant)&&(o.tenantCode=s.value.tenant),((C=s.value)==null?void 0:C.environmentCode)&&(r==null?void 0:r.environmentList)&&g(r.environmentList,s.value.environmentCode)&&(o.environmentCode=s.value.environmentCode),((M=s.value)==null?void 0:M.alertGroups)&&(r==null?void 0:r.alertGroups)&&g(r.alertGroups,s.value.alertGroups)&&(o.warningGroupId=s.value.alertGroups)},B=()=>{f.startForm.environmentCode=null},q=()=>{r.startParamsList.push({prop:"",value:""})},K=(o,i)=>{r.startParamsList[o].prop=i[0],r.startParamsList[o].value=i[1]},z=o=>{r.startParamsList.splice(o,1)},J=(G=ee())==null?void 0:G.appContext.config.globalProperties.trim;return te(()=>{b(),N(),F(),y()}),ae(()=>n.show,()=>{n.show&&(L(n.row.code),W(f.startForm),n.taskCode&&(f.startForm.startNodeList=n.taskCode))}),{t:c,showTaskDependType:t,hideModal:T,handleStart:j,generalWarningTypeListOptions:E,generalPriorityList:a,renderLabel:d,updateWorkerGroup:B,removeStartParams:z,addStartParams:q,updateParamsList:K,...S(r),...S(f),...S(n),trim:J}},render(){let n,h,c,_,f,r,k,b,N,F,y,L,T,j,E;const{t:a}=this;return e(le,{show:this.show,title:a("project.workflow.set_parameters_before_starting"),onCancel:this.hideModal,onConfirm:this.handleStart,confirmLoading:this.saving},{default:()=>[e(pe,{ref:"startFormRef",model:this.startForm,rules:this.rules},{default:()=>[e(l,{label:a("project.workflow.workflow_name"),path:"workflow_name"},{default:()=>[e("div",{class:A.formItem,title:this.row.name},[this.row.name])]}),e(l,{label:a("project.workflow.failure_strategy"),path:"failureStrategy"},{default:()=>[e(v,{value:this.startForm.failureStrategy,"onUpdate:value":t=>this.startForm.failureStrategy=t},{default:()=>[e(m,null,{default:()=>[e(p,{value:"CONTINUE"},u(n=a("project.workflow.continue"))?n:{default:()=>[n]}),e(p,{value:"END"},u(h=a("project.workflow.end"))?h:{default:()=>[h]})]})]})]}),this.showTaskDependType&&e(l,{label:a("project.workflow.node_execution"),path:"taskDependType"},{default:()=>[e(v,{value:this.startForm.taskDependType,"onUpdate:value":t=>this.startForm.taskDependType=t},{default:()=>[e(m,null,{default:()=>[e(p,{value:"TASK_POST"},u(c=a("project.workflow.backward_execution"))?c:{default:()=>[c]}),e(p,{value:"TASK_PRE"},u(_=a("project.workflow.forward_execution"))?_:{default:()=>[_]}),e(p,{value:"TASK_ONLY"},u(f=a("project.workflow.current_node_execution"))?f:{default:()=>[f]})]})]})]}),e(l,{label:a("project.workflow.notification_strategy"),path:"warningType"},{default:()=>[e(w,{options:this.generalWarningTypeListOptions(),value:this.startForm.warningType,"onUpdate:value":t=>this.startForm.warningType=t},null)]}),this.startForm.warningType!=="NONE"&&e(l,{label:a("project.workflow.alarm_group"),path:"warningGroupId",required:!0},{default:()=>[e(w,{options:this.alertGroups,placeholder:a("project.workflow.please_choose"),value:this.startForm.warningGroupId,"onUpdate:value":t=>this.startForm.warningGroupId=t,clearable:!0,filterable:!0},null)]}),e(l,{label:a("project.workflow.workflow_priority"),path:"workflowInstancePriority"},{default:()=>[e(w,{options:this.generalPriorityList(),renderLabel:this.renderLabel,value:this.startForm.workflowInstancePriority,"onUpdate:value":t=>this.startForm.workflowInstancePriority=t},null)]}),e(l,{label:a("project.workflow.worker_group"),path:"workerGroup"},{default:()=>[e(w,{options:this.workerGroups,onUpdateValue:this.updateWorkerGroup,value:this.startForm.workerGroup,"onUpdate:value":t=>this.startForm.workerGroup=t,filterable:!0},null)]}),e(l,{label:a("project.workflow.tenant_code"),path:"tenantCode"},{default:()=>[e(w,{options:this.tenantList,value:this.startForm.tenantCode,"onUpdate:value":t=>this.startForm.tenantCode=t,filterable:!0},null)]}),e(l,{label:a("project.workflow.environment_name"),path:"environmentCode"},{default:()=>[e(w,{options:this.environmentList.filter(t=>{var d;return(d=t.workerGroups)==null?void 0:d.includes(this.startForm.workerGroup)}),value:this.startForm.environmentCode,"onUpdate:value":t=>this.startForm.environmentCode=t,clearable:!0,filterable:!0},null)]}),e(l,{label:a("project.workflow.complement_data"),path:"complement_data"},{default:()=>[e(de,{checkedValue:"COMPLEMENT_DATA",uncheckedValue:"START_PROCESS",checked:this.startForm.execType,"onUpdate:checked":t=>this.startForm.execType=t},u(r=a("project.workflow.whether_complement_data"))?r:{default:()=>[r]})]}),this.startForm.execType&&this.startForm.execType!=="START_PROCESS"&&e(m,{vertical:!0,class:A["width-100"]},{default:()=>[e(l,{label:a("project.workflow.mode_of_dependent"),path:"complementDependentMode"},{default:()=>[e(v,{value:this.startForm.complementDependentMode,"onUpdate:value":t=>this.startForm.complementDependentMode=t},{default:()=>[e(m,null,{default:()=>[e(p,{value:"OFF_MODE"},u(k=a("project.workflow.close"))?k:{default:()=>[k]}),e(p,{value:"ALL_DEPENDENT"},u(b=a("project.workflow.open"))?b:{default:()=>[b]})]})]})]}),this.startForm.complementDependentMode==="ALL_DEPENDENT"&&e(l,{label:a("project.workflow.all_level_dependent"),path:"allLevelDependent"},{default:()=>[e(v,{value:this.startForm.allLevelDependent,"onUpdate:value":t=>this.startForm.allLevelDependent=t},{default:()=>[e(m,null,{default:()=>[e(p,{value:"false"},u(N=a("project.workflow.close"))?N:{default:()=>[N]}),e(p,{value:"true"},u(F=a("project.workflow.open"))?F:{default:()=>[F]})]})]})]}),e(l,{label:a("project.workflow.mode_of_execution"),path:"runMode"},{default:()=>[e(v,{value:this.startForm.runMode,"onUpdate:value":t=>this.startForm.runMode=t},{default:()=>[e(m,null,{default:()=>[e(p,{value:"RUN_MODE_SERIAL"},u(y=a("project.workflow.serial_execution"))?y:{default:()=>[y]}),e(p,{value:"RUN_MODE_PARALLEL"},u(L=a("project.workflow.parallel_execution"))?L:{default:()=>[L]})]})]})]}),this.startForm.runMode==="RUN_MODE_PARALLEL"&&e(l,{label:a("project.workflow.parallelism"),path:"expectedParallelismNumber",feedback:a("project.workflow.warning_too_large_parallelism_number"),validationStatus:"warning",showFeedback:parseInt(this.startForm.expectedParallelismNumber)>10},{default:()=>[e(ce,{placeholder:a("project.workflow.please_enter_parallelism"),value:this.startForm.expectedParallelismNumber,"onUpdate:value":t=>this.startForm.expectedParallelismNumber=t,min:"1"},null)]}),this.startForm.runMode==="RUN_MODE_SERIAL"&&e(l,{label:a("project.workflow.order_of_execution"),path:"executionOrder"},{default:()=>[e(v,{value:this.startForm.executionOrder,"onUpdate:value":t=>this.startForm.executionOrder=t},{default:()=>[e(m,null,{default:()=>[e(p,{value:"DESC_ORDER"},u(T=a("project.workflow.descending_order"))?T:{default:()=>[T]}),e(p,{value:"ASC_ORDER"},u(j=a("project.workflow.ascending_order"))?j:{default:()=>[j]})]})]})]}),e(l,{label:a("project.workflow.schedule_date"),path:this.startForm.dataDateType===1?"startEndTime":"scheduleTime"},{default:()=>[e(m,{vertical:!0,class:A["width-100"]},{default:()=>[e(v,{name:"data-date",value:this.startForm.dataDateType,"onUpdate:value":t=>this.startForm.dataDateType=t},u(E=[{label:a("project.workflow.select_date"),value:1},{label:a("project.workflow.enter_date"),value:2}].map(t=>e(fe,oe(t,{key:t.value}),null)))?E:{default:()=>[E]}),this.startForm.dataDateType===1?e(me,{type:"datetimerange",clearable:!0,value:this.startForm.startEndTime,"onUpdate:value":t=>this.startForm.startEndTime=t,placement:"top"},null):e(P,{allowInput:this.trim,clearable:!0,type:"textarea",value:this.startForm.scheduleTime,"onUpdate:value":t=>this.startForm.scheduleTime=t,placeholder:a("project.workflow.schedule_date_tips")},null)]})]})]}),e(l,{label:a("project.workflow.startup_parameter"),path:"startup_parameter"},{default:()=>[e(we,{value:this.startParamsList,"onUpdate:value":t=>this.startParamsList=t,onCreate:()=>({key:"",direct:"IN",type:"VARCHAR",value:""}),class:"input-startup-params"},{default:t=>e(ve,{xGap:12,cols:24},{default:()=>[e(O,{span:6},{default:()=>[e(P,{value:t.value.prop,"onUpdate:value":d=>t.value.prop=d,placeholder:a("project.dag.key")},null)]}),e(O,{span:5},{default:()=>[e(w,{options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],value:t.value.direct,"onUpdate:value":d=>t.value.direct=d,defaultValue:"IN"},null)]}),e(O,{span:7},{default:()=>[e(w,{options:[{value:"VARCHAR",label:"VARCHAR"},{value:"INTEGER",label:"INTEGER"},{value:"LONG",label:"LONG"},{value:"FLOAT",label:"FLOAT"},{value:"DOUBLE",label:"DOUBLE"},{value:"DATE",label:"DATE"},{value:"TIME",label:"TIME"},{value:"BOOLEAN",label:"BOOLEAN"},{value:"LIST",label:"LIST"},{value:"FILE",label:"FILE"}],value:t.value.type,"onUpdate:value":d=>t.value.type=d,defaultValue:"VARCHAR"},null)]}),e(O,{span:6},{default:()=>[e(P,{value:t.value.value,"onUpdate:value":d=>t.value.value=d,placeholder:a("project.dag.value")},null)]})]})})]}),e(l,{label:a("project.workflow.whether_dry_run"),path:"dryRun"},{default:()=>[e(he,{checkedValue:1,uncheckedValue:0,value:this.startForm.dryRun,"onUpdate:value":t=>this.startForm.dryRun=t},null)]})]})]})}}),He=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{Ne as S,He as a,A as s};
